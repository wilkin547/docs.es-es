### <a name="avoiding-endless-recursion-for-iworkflowinstancemanagementtransactedcancel-and-iworkflowinstancemanagementtransactedterminate"></a><span data-ttu-id="ae8fb-101">Evitar la recursión sin fin para IWorkflowInstanceManagement.TransactedCancel e IWorkflowInstanceManagement.TransactedTerminate</span><span class="sxs-lookup"><span data-stu-id="ae8fb-101">Avoiding endless recursion for IWorkflowInstanceManagement.TransactedCancel and IWorkflowInstanceManagement.TransactedTerminate</span></span>

|   |   |
|---|---|
|<span data-ttu-id="ae8fb-102">Detalles</span><span class="sxs-lookup"><span data-stu-id="ae8fb-102">Details</span></span>|<span data-ttu-id="ae8fb-103">En algunas circunstancias, cuando se usan las API <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedCancel%2A?displayProperty=nameWithType> o <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedTerminate%2A?displayProperty=nameWithType> para cancelar o finalizar una instancia del servicio de flujo de trabajo, se puede producir un desbordamiento de pila en la instancia de flujo de trabajo debido a la recursión sin fin cuando el tiempo de ejecución de <code>Workflow</code> intenta conservar la instancia del servicio como parte del procesamiento de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="ae8fb-103">Under some circumstances when using <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedCancel%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedTerminate%2A?displayProperty=nameWithType> APIs to cancel or terminate a worklow service instance, the workflow instance may encounter a stack overflow due to endless recursion when the <code>Workflow</code> runtime attempts to persist the service instance as part of processing the request.</span></span> <span data-ttu-id="ae8fb-104">El problema se produce si la instancia del flujo de trabajo está en un estado en el que espera que finalice otra solicitud de WCF pendiente a otro servicio. Las operaciones <code>TransactedCancel</code> y <code>TransactedTerminate</code> crean elementos de trabajo que se ponen en cola para la instancia del servicio de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="ae8fb-104">The problem occurs if the workflow instance is in a state where it is waiting for some other outstanding WCF request to another service to complete.The <code>TransactedCancel</code> and <code>TransactedTerminate</code> operations create work items that are queued for the workflow service instance.</span></span> <span data-ttu-id="ae8fb-105">Estos elementos de trabajo no se ejecutan como parte del procesamiento de la solicitud de <code>TransactedCancel/TransactedTerminate</code>.</span><span class="sxs-lookup"><span data-stu-id="ae8fb-105">These work items are not executed as part of the processing of the <code>TransactedCancel/TransactedTerminate</code> request.</span></span> <span data-ttu-id="ae8fb-106">Como la instancia del servicio de flujo de trabajo está ocupada en espera a que finalice la otra solicitud de WCF pendiente, el elemento de trabajo que se crea permanece en cola.</span><span class="sxs-lookup"><span data-stu-id="ae8fb-106">Because the workflow service instance is busy waiting for the other outstanding WCF request to complete, the work item created remains queued.</span></span> <span data-ttu-id="ae8fb-107">La operación <code>TransactedCancel/TransactedTerminate</code> se completa y el control se devuelve al cliente.</span><span class="sxs-lookup"><span data-stu-id="ae8fb-107">The <code>TransactedCancel/TransactedTerminate</code> operation completes and control is returned back to the client.</span></span> <span data-ttu-id="ae8fb-108">Cuando la transacción asociada con la operación <code>TransactedCancel/TransactedTerminate</code> intenta confirmar, debe guardar el estado de la instancia del servicio de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="ae8fb-108">When the transaction associated with the <code>TransactedCancel/TransactedTerminate</code> operation attempts to commit, it needs to persist the workflow serivce instance state.</span></span> <span data-ttu-id="ae8fb-109">Pero como existe una solicitud de <code>WCF</code> pendiente para la instancia, el tiempo de ejecución del flujo de trabajo no puede conservar la instancia del servicio de flujo de trabajo y un bucle de recursión sin fin genera el desbordamiento de pila. Dado que <code>TransactedCancel</code> y <code>TransactedTerminate</code> solo crean un elemento de trabajo en memoria, el hecho de que exista una transacción no tiene ningún efecto.</span><span class="sxs-lookup"><span data-stu-id="ae8fb-109">But because there is an outstanding <code>WCF</code> request for the instance, the Workflow runtime cannot persist the workflow service instance, and an endless recursion loop leads to the stack overflow.Because <code>TransactedCancel</code> and <code>TransactedTerminate</code> only create a work item in memory, the fact that a transaction exists doesn't have any effect.</span></span> <span data-ttu-id="ae8fb-110">La reversión de la transacción no descarta el elemento de trabajo. Para solucionar este problema, a partir de .NET Framework 4.7.2, se ha introducido un <code>AppSetting</code> que se puede agregar a la sección <code>web.config/app.config</code> del servicio de flujo de trabajo que le indica que ignore las transacciones para <code>TransactedCancel</code> y <code>TransactedTerminate</code>.</span><span class="sxs-lookup"><span data-stu-id="ae8fb-110">A rollback of the transaction does not discard the work item.To address this issue, starting in .NET Framework 4.7.2, we have introduced an <code>AppSetting</code> that can be added to the <code>web.config/app.config</code> of the workflow service that tells it to ignore transactions for <code>TransactedCancel</code> and <code>TransactedTerminate</code>.</span></span> <span data-ttu-id="ae8fb-111">Esto permite que la transacción se confirme sin esperar a que se conserve la instancia del flujo de trabajo. El AppSetting para esta característica se denomina <code>microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate</code>.</span><span class="sxs-lookup"><span data-stu-id="ae8fb-111">This allows the transaction to commit without waiting for the workflow instance to persist.The AppSetting for this feature is named <code>microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate</code>.</span></span> <span data-ttu-id="ae8fb-112">Un valor de <code>true</code> indica que la transacción se debe ignorar, lo que evita el desbordamiento de pila.</span><span class="sxs-lookup"><span data-stu-id="ae8fb-112">A value of <code>true</code> indicates that the transaction should be ignored, thus avoiding the stack overflow.</span></span> <span data-ttu-id="ae8fb-113">El valor predeterminado de este AppSetting es <code>false</code>, por lo que las instancias del servicio de flujo de trabajo existentes no se ven afectadas.</span><span class="sxs-lookup"><span data-stu-id="ae8fb-113">The default value of this AppSetting is <code>false</code>, so existing workflow service instances are not affected.</span></span>|
|<span data-ttu-id="ae8fb-114">Sugerencia</span><span class="sxs-lookup"><span data-stu-id="ae8fb-114">Suggestion</span></span>|<span data-ttu-id="ae8fb-115">Si se usa AppFabric u otro cliente de <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> y se produce un desbordamiento de pila en la instancia del servicio de flujo de trabajo al intentar cancelar o finalizar una instancia del flujo de trabajo, se puede agregar lo siguiente a la sección <code>&lt;appSettings&gt;</code> del archivo web.config/app.config del servicio de flujo de trabajo:</span><span class="sxs-lookup"><span data-stu-id="ae8fb-115">If you are using AppFabric or another <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> client and are encountering a stack overflow in the workflow serivce instance when trying to cancel or terminate a workflow instance, you can add the following to the <code>&lt;appSettings&gt;</code> section of the web.config/app.config file for the workflow service:</span></span><pre><code class="lang-xml">&lt;add key=&quot;microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate&quot; value=&quot;true&quot;/&gt;&#13;&#10;</code></pre><span data-ttu-id="ae8fb-116">Si el problema no se produce, no es necesario hacer esto.</span><span class="sxs-lookup"><span data-stu-id="ae8fb-116">If you are not encountering the problem, you do not need to do this.</span></span>|
|<span data-ttu-id="ae8fb-117">Ámbito</span><span class="sxs-lookup"><span data-stu-id="ae8fb-117">Scope</span></span>|<span data-ttu-id="ae8fb-118">Borde</span><span class="sxs-lookup"><span data-stu-id="ae8fb-118">Edge</span></span>|
|<span data-ttu-id="ae8fb-119">Versión</span><span class="sxs-lookup"><span data-stu-id="ae8fb-119">Version</span></span>|<span data-ttu-id="ae8fb-120">4.7.2</span><span class="sxs-lookup"><span data-stu-id="ae8fb-120">4.7.2</span></span>|
|<span data-ttu-id="ae8fb-121">Tipo</span><span class="sxs-lookup"><span data-stu-id="ae8fb-121">Type</span></span>|<span data-ttu-id="ae8fb-122">Redestinación</span><span class="sxs-lookup"><span data-stu-id="ae8fb-122">Retargeting</span></span>|

