---
title: 'Uso de patrones en objetos: tutorial de C#'
description: En este tutorial se enseñan técnicas para usar la coincidencia de patrones en los miembros de clase a fin de crear mejores modelos para el comportamiento de objetos.
ms.date: 11/05/2020
ms.openlocfilehash: 072f6f57696504c2d691473e3a43c1cda53f227f
ms.sourcegitcommit: 6bef8abde346c59771a35f4f76bf037ff61c5ba3
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 11/06/2020
ms.locfileid: "94332180"
---
# <a name="use-pattern-matching-to-build-your-class-behavior-for-better-code"></a><span data-ttu-id="b693d-103">Uso de la coincidencia de patrones para crear el comportamiento de la clase y mejorar el código</span><span class="sxs-lookup"><span data-stu-id="b693d-103">Use pattern matching to build your class behavior for better code</span></span>

<span data-ttu-id="b693d-104">Las características de coincidencia de patrones en C# proporcionan la sintaxis para expresar los algoritmos.</span><span class="sxs-lookup"><span data-stu-id="b693d-104">The pattern matching features in C# provide syntax to express your algorithms.</span></span> <span data-ttu-id="b693d-105">Puede usar estas técnicas para implementar el comportamiento en las clases.</span><span class="sxs-lookup"><span data-stu-id="b693d-105">You can use these techniques to implement the behavior in your classes.</span></span> <span data-ttu-id="b693d-106">Puede combinar el diseño de clases orientadas a objetos con una implementación orientada a datos para proporcionar un código conciso al modelar objetos del mundo real.</span><span class="sxs-lookup"><span data-stu-id="b693d-106">You can combine object-oriented class design with a data-oriented implementation to provide concise code while modeling real-world objects.</span></span>

<span data-ttu-id="b693d-107">En este tutorial, aprenderá a:</span><span class="sxs-lookup"><span data-stu-id="b693d-107">In this tutorial, you'll learn how to:</span></span>

> [!div class="checklist"]
>
> - <span data-ttu-id="b693d-108">Expresar las clases orientadas a objetos mediante patrones de datos.</span><span class="sxs-lookup"><span data-stu-id="b693d-108">Express your object oriented classes using data patterns.</span></span>
> - <span data-ttu-id="b693d-109">Implementar dichos patrones con las características de coincidencia de patrones de C#.</span><span class="sxs-lookup"><span data-stu-id="b693d-109">Implement those patterns using C#'s pattern matching features.</span></span>
> - <span data-ttu-id="b693d-110">Aprovechar los diagnósticos del compilador para validar la implementación.</span><span class="sxs-lookup"><span data-stu-id="b693d-110">Leverage compiler diagnostics to validate your implementation.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="b693d-111">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="b693d-111">Prerequisites</span></span>

<span data-ttu-id="b693d-112">Deberá configurar la máquina para ejecutar .NET 5, incluido el compilador de C# 9.0.</span><span class="sxs-lookup"><span data-stu-id="b693d-112">You’ll need to set up your machine to run .NET 5, including the C# 9.0 compiler.</span></span> <span data-ttu-id="b693d-113">El compilador de C# 9.0 está disponible a partir de [Visual Studio 2019, versión 16.8 Preview](https://visualstudio.microsoft.com/vs/preview/) o del [SDK de .NET 5.0 Preview](https://dotnet.microsoft.com/download/dotnet/5.0).</span><span class="sxs-lookup"><span data-stu-id="b693d-113">The C# 9.0 compiler is available starting with [Visual Studio 2019 version 16.8 preview](https://visualstudio.microsoft.com/vs/preview/) or the [.NET 5.0 SDK preview](https://dotnet.microsoft.com/download/dotnet/5.0).</span></span>

## <a name="build-a-simulation-of-a-canal-lock"></a><span data-ttu-id="b693d-114">Compilación de una simulación de una esclusa de canal</span><span class="sxs-lookup"><span data-stu-id="b693d-114">Build a simulation of a canal lock</span></span>

<span data-ttu-id="b693d-115">En este tutorial, compilará una clase de C# que simula una [esclusa de canal](https://en.wikipedia.org/wiki/Lock_(water_navigation)).</span><span class="sxs-lookup"><span data-stu-id="b693d-115">In this tutorial, you'll build a C# class that simulates a [canal lock](https://en.wikipedia.org/wiki/Lock_(water_navigation)).</span></span> <span data-ttu-id="b693d-116">En pocas palabras, una esclusa de canal es un dispositivo que permite que los barcos suban y bajen cuando se mueven entre dos cuerpos de agua con distintos niveles.</span><span class="sxs-lookup"><span data-stu-id="b693d-116">Briefly, a canal lock is a device that raises and lowers boats as they travel between two stretches of water at different levels.</span></span> <span data-ttu-id="b693d-117">Una esclusa tiene dos compuertas y algún mecanismo que permite cambiar el nivel del agua.</span><span class="sxs-lookup"><span data-stu-id="b693d-117">A lock has two gates and some mechanism to change the water level.</span></span>

<span data-ttu-id="b693d-118">En su funcionamiento habitual, un barco entra por una de las compuertas mientras el nivel del agua en la esclusa se iguala al nivel del agua del lado por donde entra el barco.</span><span class="sxs-lookup"><span data-stu-id="b693d-118">In its normal operation, a boat enters one of the gates while the water level in the lock matches the water level on the side the boat enters.</span></span> <span data-ttu-id="b693d-119">Una vez en la esclusa, se modifica el nivel del agua para igualarlo al nivel de donde el barco saldrá de la esclusa.</span><span class="sxs-lookup"><span data-stu-id="b693d-119">Once in the lock, the water level is changed to match the water level where the boat will leave the lock.</span></span> <span data-ttu-id="b693d-120">Cuando el nivel del agua es igual al de ese lado, se abre la compuerta de la salida.</span><span class="sxs-lookup"><span data-stu-id="b693d-120">Once the water level matches that side, the gate on the exit side opens.</span></span> <span data-ttu-id="b693d-121">Hay medidas de seguridad que garantizan que un operador no pueda crear una situación de peligro en el canal.</span><span class="sxs-lookup"><span data-stu-id="b693d-121">Safety measures make sure an operator can't create a dangerous situation in the canal.</span></span> <span data-ttu-id="b693d-122">El nivel del agua solo se puede modificar cuando ambas compuertas están cerradas.</span><span class="sxs-lookup"><span data-stu-id="b693d-122">The water level can be changed only when both gates are closed.</span></span> <span data-ttu-id="b693d-123">Como mucho, puede haber una compuerta abierta.</span><span class="sxs-lookup"><span data-stu-id="b693d-123">At most one gate can be open.</span></span> <span data-ttu-id="b693d-124">Para abrir una compuerta, el nivel del agua de la esclusa debe coincidir con el nivel fuera de la compuerta que se está abriendo.</span><span class="sxs-lookup"><span data-stu-id="b693d-124">To open a gate, the water level in the lock must match the water level outside the gate being opened.</span></span>

<span data-ttu-id="b693d-125">Es posible compilar una clase de C# que modele este comportamiento.</span><span class="sxs-lookup"><span data-stu-id="b693d-125">You can build a C# class to model this behavior.</span></span> <span data-ttu-id="b693d-126">Una clase `CanalLock` podría admitir los comandos para abrir o cerrar cualquiera de las compuertas.</span><span class="sxs-lookup"><span data-stu-id="b693d-126">A `CanalLock` class would support commands to open or close either gate.</span></span> <span data-ttu-id="b693d-127">Tendría otros comandos para aumentar o reducir el nivel del agua.</span><span class="sxs-lookup"><span data-stu-id="b693d-127">It would have other commands to raise or lower the water.</span></span> <span data-ttu-id="b693d-128">La clase también debería admitir propiedades para leer el estado actual de ambas compuertas y el nivel del agua.</span><span class="sxs-lookup"><span data-stu-id="b693d-128">The class should also support properties to read the current state of both gates and the water level.</span></span> <span data-ttu-id="b693d-129">Los métodos implementan las medidas de seguridad.</span><span class="sxs-lookup"><span data-stu-id="b693d-129">Your methods implement the safety measures.</span></span>

## <a name="define-a-class"></a><span data-ttu-id="b693d-130">Definición de una clase</span><span class="sxs-lookup"><span data-stu-id="b693d-130">Define a class</span></span>

<span data-ttu-id="b693d-131">Compilará una aplicación de consola para probar la clase `CanalLock`.</span><span class="sxs-lookup"><span data-stu-id="b693d-131">You'll build a console application to test your `CanalLock` class.</span></span> <span data-ttu-id="b693d-132">Cree un proyecto de consola nuevo para .NET 5 con Visual Studio o la CLI de .NET.</span><span class="sxs-lookup"><span data-stu-id="b693d-132">Create a new console project for .NET 5 using either Visual Studio or the .NET CLI.</span></span> <span data-ttu-id="b693d-133">Luego, agregue una clase nueva con el nombre `CanalLock`.</span><span class="sxs-lookup"><span data-stu-id="b693d-133">Then, add a new class and name it `CanalLock`.</span></span> <span data-ttu-id="b693d-134">Luego, diseñe la API pública, pero deje los métodos sin implementar:</span><span class="sxs-lookup"><span data-stu-id="b693d-134">Next, design your public API, but leave the methods not implemented:</span></span>

:::code language="csharp" source="snippets/pattern-objects/InterimSteps.cs" ID="APIDesign":::

<span data-ttu-id="b693d-135">El código anterior inicializa el objeto de manera que ambas compuertas estén cerradas y el nivel del agua sea bajo.</span><span class="sxs-lookup"><span data-stu-id="b693d-135">The preceding code initializes the object so both gates are closed, and the water level is low.</span></span> <span data-ttu-id="b693d-136">Luego, escriba el código de prueba siguiente en el método `Main` como guía para crear una primera implementación de la clase:</span><span class="sxs-lookup"><span data-stu-id="b693d-136">Next, write the following test code in your `Main` method to guide you as you create a first implementation of the class:</span></span>

:::code language="csharp" source="snippets/pattern-objects/Program.cs" ID="HappyTests":::

<span data-ttu-id="b693d-137">A continuación, agregue una primera implementación de cada método en la clase `CanalLock`.</span><span class="sxs-lookup"><span data-stu-id="b693d-137">Next, add a first implementation of each method in the `CanalLock` class.</span></span> <span data-ttu-id="b693d-138">El código siguiente implementa los métodos de la clase sin preocuparse por las reglas de seguridad.</span><span class="sxs-lookup"><span data-stu-id="b693d-138">The following code implements the methods of the class without concern to the safety rules.</span></span> <span data-ttu-id="b693d-139">Más adelante agregará pruebas de seguridad:</span><span class="sxs-lookup"><span data-stu-id="b693d-139">You'll add safety tests later:</span></span>

:::code language="csharp" source="snippets/pattern-objects/InterimSteps.cs" ID="FirstImplementation":::

<span data-ttu-id="b693d-140">Las pruebas que ha escrito hasta el momento se completan correctamente.</span><span class="sxs-lookup"><span data-stu-id="b693d-140">The tests you've written so far pass.</span></span> <span data-ttu-id="b693d-141">Ha implementado los aspectos básicos.</span><span class="sxs-lookup"><span data-stu-id="b693d-141">You've implemented the basics.</span></span> <span data-ttu-id="b693d-142">Ahora, escriba una prueba para la primera condición de error.</span><span class="sxs-lookup"><span data-stu-id="b693d-142">Now, write a test for the first failure condition.</span></span> <span data-ttu-id="b693d-143">Al final de las pruebas anteriores, ambas compuertas están cerradas y el nivel del agua se establece en bajo.</span><span class="sxs-lookup"><span data-stu-id="b693d-143">At the end of the previous tests, both gates are closed, and the water level is set to low.</span></span> <span data-ttu-id="b693d-144">Agregue una prueba para intentar abrir la compuerta superior:</span><span class="sxs-lookup"><span data-stu-id="b693d-144">Add a test to try opening the upper gate:</span></span>

:::code language="csharp" source="snippets/pattern-objects/Program.cs" ID="HighGateSafetyTest":::

<span data-ttu-id="b693d-145">Esta prueba genera un error porque la compuerta se abre.</span><span class="sxs-lookup"><span data-stu-id="b693d-145">This test fails because the gate opens.</span></span> <span data-ttu-id="b693d-146">Como primera implementación, puede corregirlo con este código:</span><span class="sxs-lookup"><span data-stu-id="b693d-146">As a first implementation, you could fix it with the following code:</span></span>

:::code language="csharp" source="snippets/pattern-objects/InterimSteps.cs" ID="SecondImplementation":::

<span data-ttu-id="b693d-147">Las pruebas se realizan correctamente.</span><span class="sxs-lookup"><span data-stu-id="b693d-147">Your tests pass.</span></span> <span data-ttu-id="b693d-148">Pero a medida que agrega más pruebas, agregará cada vez más cláusulas `if` y probará distintas propiedades.</span><span class="sxs-lookup"><span data-stu-id="b693d-148">But, as you add more tests, you'll add more and more `if` clauses and test different properties.</span></span> <span data-ttu-id="b693d-149">Pronto, estos métodos resultarán demasiado complicados a medida que agregue más condicionales.</span><span class="sxs-lookup"><span data-stu-id="b693d-149">Soon, these methods will get too complicated as you add more conditionals.</span></span>

## <a name="implement-the-commands-with-patterns"></a><span data-ttu-id="b693d-150">Implementación de los comandos con patrones</span><span class="sxs-lookup"><span data-stu-id="b693d-150">Implement the commands with patterns</span></span>

<span data-ttu-id="b693d-151">Una mejor manera es usar *patrones* para determinar si el objeto tiene un estado válido para ejecutar un comando.</span><span class="sxs-lookup"><span data-stu-id="b693d-151">A better way is to use *patterns* to determine if the object is in a valid state to execute a command.</span></span> <span data-ttu-id="b693d-152">Puede expresar si se permite un comando como una función de tres variables: el estado de la compuerta, el nivel del agua y la nueva configuración:</span><span class="sxs-lookup"><span data-stu-id="b693d-152">You can express if a command is allowed as a function of three variables: the state of the gate, the level of the water, and the new setting:</span></span>

| <span data-ttu-id="b693d-153">Nueva configuración</span><span class="sxs-lookup"><span data-stu-id="b693d-153">New setting</span></span> | <span data-ttu-id="b693d-154">Estado de la compuerta</span><span class="sxs-lookup"><span data-stu-id="b693d-154">Gate state</span></span> | <span data-ttu-id="b693d-155">Nivel del agua</span><span class="sxs-lookup"><span data-stu-id="b693d-155">Water Level</span></span> | <span data-ttu-id="b693d-156">Resultado</span><span class="sxs-lookup"><span data-stu-id="b693d-156">Result</span></span>             |
| ----------- | ---------- | ----------- | ------------------ |
| <span data-ttu-id="b693d-157">Cerrada</span><span class="sxs-lookup"><span data-stu-id="b693d-157">Closed</span></span>      | <span data-ttu-id="b693d-158">Cerrada</span><span class="sxs-lookup"><span data-stu-id="b693d-158">Closed</span></span>     | <span data-ttu-id="b693d-159">Alto</span><span class="sxs-lookup"><span data-stu-id="b693d-159">High</span></span>        | <span data-ttu-id="b693d-160">Cerrada</span><span class="sxs-lookup"><span data-stu-id="b693d-160">Closed</span></span>             |
| <span data-ttu-id="b693d-161">Cerrada</span><span class="sxs-lookup"><span data-stu-id="b693d-161">Closed</span></span>      | <span data-ttu-id="b693d-162">Cerrada</span><span class="sxs-lookup"><span data-stu-id="b693d-162">Closed</span></span>     | <span data-ttu-id="b693d-163">Bajo</span><span class="sxs-lookup"><span data-stu-id="b693d-163">Low</span></span>         | <span data-ttu-id="b693d-164">Cerrada</span><span class="sxs-lookup"><span data-stu-id="b693d-164">Closed</span></span>             |
| <span data-ttu-id="b693d-165">Cerrada</span><span class="sxs-lookup"><span data-stu-id="b693d-165">Closed</span></span>      | <span data-ttu-id="b693d-166">Abrir</span><span class="sxs-lookup"><span data-stu-id="b693d-166">Open</span></span>       | <span data-ttu-id="b693d-167">Alto</span><span class="sxs-lookup"><span data-stu-id="b693d-167">High</span></span>        | <span data-ttu-id="b693d-168">Abrir</span><span class="sxs-lookup"><span data-stu-id="b693d-168">Open</span></span>               |
| <span data-ttu-id="b693d-169">~~Closed~~</span><span class="sxs-lookup"><span data-stu-id="b693d-169">~~Closed~~</span></span>  | <span data-ttu-id="b693d-170">~~Abrir~~</span><span class="sxs-lookup"><span data-stu-id="b693d-170">~~Open~~</span></span>   | <span data-ttu-id="b693d-171">~~Baja~~</span><span class="sxs-lookup"><span data-stu-id="b693d-171">~~Low~~</span></span>     | <span data-ttu-id="b693d-172">~~Closed~~</span><span class="sxs-lookup"><span data-stu-id="b693d-172">~~Closed~~</span></span>         |
| <span data-ttu-id="b693d-173">Abrir</span><span class="sxs-lookup"><span data-stu-id="b693d-173">Open</span></span>        | <span data-ttu-id="b693d-174">Closed</span><span class="sxs-lookup"><span data-stu-id="b693d-174">Closed</span></span>     | <span data-ttu-id="b693d-175">Alto</span><span class="sxs-lookup"><span data-stu-id="b693d-175">High</span></span>        | <span data-ttu-id="b693d-176">Abrir</span><span class="sxs-lookup"><span data-stu-id="b693d-176">Open</span></span>               |
| <span data-ttu-id="b693d-177">Abrir</span><span class="sxs-lookup"><span data-stu-id="b693d-177">Open</span></span>        | <span data-ttu-id="b693d-178">Closed</span><span class="sxs-lookup"><span data-stu-id="b693d-178">Closed</span></span>     | <span data-ttu-id="b693d-179">Bajo</span><span class="sxs-lookup"><span data-stu-id="b693d-179">Low</span></span>         | <span data-ttu-id="b693d-180">Cerrada (error)</span><span class="sxs-lookup"><span data-stu-id="b693d-180">Closed (Error)</span></span>     |
| <span data-ttu-id="b693d-181">Abrir</span><span class="sxs-lookup"><span data-stu-id="b693d-181">Open</span></span>        | <span data-ttu-id="b693d-182">Abrir</span><span class="sxs-lookup"><span data-stu-id="b693d-182">Open</span></span>       | <span data-ttu-id="b693d-183">Alto</span><span class="sxs-lookup"><span data-stu-id="b693d-183">High</span></span>        | <span data-ttu-id="b693d-184">Abrir</span><span class="sxs-lookup"><span data-stu-id="b693d-184">Open</span></span>               |
| <span data-ttu-id="b693d-185">~~Abrir~~</span><span class="sxs-lookup"><span data-stu-id="b693d-185">~~Open~~</span></span>    | <span data-ttu-id="b693d-186">~~Abrir~~</span><span class="sxs-lookup"><span data-stu-id="b693d-186">~~Open~~</span></span>   | <span data-ttu-id="b693d-187">~~Baja~~</span><span class="sxs-lookup"><span data-stu-id="b693d-187">~~Low~~</span></span>     | <span data-ttu-id="b693d-188">~~Cerrada (error)~~</span><span class="sxs-lookup"><span data-stu-id="b693d-188">~~Closed (Error)~~</span></span> |

<span data-ttu-id="b693d-189">La cuarta y la última fila de la tabla tienen tachado el texto porque no son válidas.</span><span class="sxs-lookup"><span data-stu-id="b693d-189">The fourth and last rows in the table have strike through text because they're invalid.</span></span> <span data-ttu-id="b693d-190">El código que va a agregar ahora debe garantizar que la compuerta superior no se abrirá nunca si el nivel del agua es bajo.</span><span class="sxs-lookup"><span data-stu-id="b693d-190">The code you're adding now should make sure the high water gate is never opened when the water is low.</span></span>  <span data-ttu-id="b693d-191">Esos estados se pueden codificar como una expresión switch única (recuerde que `false` indica "Cerrada"):</span><span class="sxs-lookup"><span data-stu-id="b693d-191">Those states can be coded as a single switch expression (remember that `false` indicates "Closed"):</span></span>

:::code language="csharp" source="snippets/pattern-objects/InterimSteps.cs" ID="ThirdImplementation":::

<span data-ttu-id="b693d-192">Pruebe esta versión.</span><span class="sxs-lookup"><span data-stu-id="b693d-192">Try this version.</span></span> <span data-ttu-id="b693d-193">Las pruebas se realizan correctamente, lo que valida el código.</span><span class="sxs-lookup"><span data-stu-id="b693d-193">Your tests pass, validating the code.</span></span> <span data-ttu-id="b693d-194">En la tabla completa se muestran las combinaciones posibles de entradas y resultados.</span><span class="sxs-lookup"><span data-stu-id="b693d-194">The full table shows the possible combinations of inputs and results.</span></span> <span data-ttu-id="b693d-195">Eso significa que tanto usted como otros desarrolladores pueden examinar rápidamente la tabla y ver que se han cubierto todas las entradas posibles.</span><span class="sxs-lookup"><span data-stu-id="b693d-195">That means you and other developers can quickly look at the table and see that you've covered all the possible inputs.</span></span> <span data-ttu-id="b693d-196">Usar el compilador puede hacerlo más fácil.</span><span class="sxs-lookup"><span data-stu-id="b693d-196">Even easier, the compiler can help as well.</span></span> <span data-ttu-id="b693d-197">Después de agregar el código anterior, puede ver que el compilador genera una advertencia: *CS8524* indica que la expresión switch no cubre todas las entradas posibles.</span><span class="sxs-lookup"><span data-stu-id="b693d-197">After you add the previous code, you can see that the compiler generates a warning: *CS8524* indicates the switch expression doesn't cover all possible inputs.</span></span> <span data-ttu-id="b693d-198">El motivo de esta advertencia es que una de las entradas es de tipo `enum`.</span><span class="sxs-lookup"><span data-stu-id="b693d-198">The reason for that warning is that one of the inputs is an `enum` type.</span></span> <span data-ttu-id="b693d-199">El compilador interpreta "todas las entradas posibles" como todas las entradas del tipo subyacente, por lo general, un `int`.</span><span class="sxs-lookup"><span data-stu-id="b693d-199">The compiler interprets "all possible inputs" as all inputs from the underlying type, typically an `int`.</span></span> <span data-ttu-id="b693d-200">Esta expresión `switch` solo comprueba los valores declarados en la `enum`.</span><span class="sxs-lookup"><span data-stu-id="b693d-200">This `switch` expression only checks the values declared in the `enum`.</span></span> <span data-ttu-id="b693d-201">Para quitar la advertencia, puede agregar un patrón de descarte comodín para el último segmento de la expresión.</span><span class="sxs-lookup"><span data-stu-id="b693d-201">To remove the warning, you can add a catch-all discard pattern for the last arm of the expression.</span></span> <span data-ttu-id="b693d-202">Esta condición genera una excepción porque indica una entrada no válida:</span><span class="sxs-lookup"><span data-stu-id="b693d-202">This condition throws an exception, because it indicates invalid input:</span></span>

```csharp
_  => throw new InvalidOperationException("Invalid internal state"),
```

<span data-ttu-id="b693d-203">El segmento modificador anterior debe ir al final de la expresión `switch` porque coincide con todas las entradas.</span><span class="sxs-lookup"><span data-stu-id="b693d-203">The preceding switch arm must be last in your `switch` expression because it matches all inputs.</span></span> <span data-ttu-id="b693d-204">Experimente poniendo el segmento modificador antes en la expresión.</span><span class="sxs-lookup"><span data-stu-id="b693d-204">Experiment by moving it earlier in the order.</span></span> <span data-ttu-id="b693d-205">Eso generará un error de compilador *CS8510* para un código inalcanzable en un patrón.</span><span class="sxs-lookup"><span data-stu-id="b693d-205">That causes a compiler error *CS8510* for unreachable code in a pattern.</span></span>  <span data-ttu-id="b693d-206">La estructura natural de las expresiones switch permite que el compilador genere errores y advertencias en caso de posibles errores.</span><span class="sxs-lookup"><span data-stu-id="b693d-206">The natural structure of switch expressions enables the compiler to generate errors and warnings for possible mistakes.</span></span> <span data-ttu-id="b693d-207">La "red de seguridad" del compilador facilita la creación de código correcto en menos iteraciones y brinda la libertad de combinar segmentos modificadores con caracteres comodín.</span><span class="sxs-lookup"><span data-stu-id="b693d-207">The compiler "safety net" makes it easier for you to create correct code in fewer iterations, and the freedom to combine switch arms with wildcards.</span></span> <span data-ttu-id="b693d-208">El compilador emitirá errores si la combinación da como resultado segmentos inaccesibles no esperados y advertencias si quita un segmento necesario.</span><span class="sxs-lookup"><span data-stu-id="b693d-208">The compiler will issue errors if your combination results in unreachable arms you didn't expect, and warnings if you remove an arm that's needed.</span></span>

<span data-ttu-id="b693d-209">El primer cambio consiste en combinar todos los segmentos en los que el comando va a cerrar la compuerta; eso siempre se permite.</span><span class="sxs-lookup"><span data-stu-id="b693d-209">The first change is to combine all the arms where the command is to close the gate; that's always allowed.</span></span> <span data-ttu-id="b693d-210">Agregue el código siguiente como el primer segmento de la expresión switch:</span><span class="sxs-lookup"><span data-stu-id="b693d-210">Add the following code as the first arm in your switch expression:</span></span>

```csharp
(false, _, _) => false,
```

<span data-ttu-id="b693d-211">Después de agregar el segmento modificador anterior, recibirá cuatro errores de compilador, uno en cada uno de los segmentos donde el comando es `false`.</span><span class="sxs-lookup"><span data-stu-id="b693d-211">After you add the previous switch arm, you'll get four compiler errors, one on each of the arms where the command is `false`.</span></span> <span data-ttu-id="b693d-212">Estos segmentos ya los cubre el segmento recién agregado.</span><span class="sxs-lookup"><span data-stu-id="b693d-212">Those arms are already covered by the newly added arm.</span></span> <span data-ttu-id="b693d-213">Puede quitar sin problemas esas cuatro líneas.</span><span class="sxs-lookup"><span data-stu-id="b693d-213">You can safely remove those four lines.</span></span> <span data-ttu-id="b693d-214">Su intención era que este segmento modificador nuevo reemplazara esas condiciones.</span><span class="sxs-lookup"><span data-stu-id="b693d-214">You intended this new switch arm to replace those conditions.</span></span>

<span data-ttu-id="b693d-215">Luego, puede simplificar los cuatro segmentos en los que el comando indica abrir la compuerta.</span><span class="sxs-lookup"><span data-stu-id="b693d-215">Next, you can simplify the four arms where the command is to open the gate.</span></span> <span data-ttu-id="b693d-216">En ambos casos en los que el nivel del agua es alto, se puede abrir la compuerta.</span><span class="sxs-lookup"><span data-stu-id="b693d-216">In both cases where the water level is high, the gate can be opened.</span></span> <span data-ttu-id="b693d-217">(En un caso, ya está abierta). Un caso en el que el nivel del agua es bajo genera una excepción y el otro no debería ocurrir.</span><span class="sxs-lookup"><span data-stu-id="b693d-217">(In one, it's already open.) One case where the water level is low throws an exception, and the other shouldn't happen.</span></span> <span data-ttu-id="b693d-218">Debería ser seguro generar la misma excepción si el cierre hidráulico ya tiene un estado no válido.</span><span class="sxs-lookup"><span data-stu-id="b693d-218">It should be safe to throw the same exception if the water lock is already in an invalid state.</span></span> <span data-ttu-id="b693d-219">Puede hacer estas simplificaciones para esos segmentos:</span><span class="sxs-lookup"><span data-stu-id="b693d-219">You can make the following simplifications for those arms:</span></span>

```csharp
(true, _, WaterLevel.High) => true,
(true, false, WaterLevel.Low) => throw new InvalidOperationException("Cannot open high gate when the water is low"),
_ => throw new InvalidOperationException("Invalid internal state"),
```

<span data-ttu-id="b693d-220">Vuelva a ejecutar las pruebas y las completarán correctamente.</span><span class="sxs-lookup"><span data-stu-id="b693d-220">Run your tests again, and they pass.</span></span> <span data-ttu-id="b693d-221">Esta es la versión final del método `SetHighGate`:</span><span class="sxs-lookup"><span data-stu-id="b693d-221">Here's the final version of the `SetHighGate` method:</span></span>

:::code language="csharp" source="snippets/pattern-objects/CanalLock.cs" ID="FinalImplementaton":::

## <a name="implement-patterns-yourself"></a><span data-ttu-id="b693d-222">Implementación de patrones por su cuenta</span><span class="sxs-lookup"><span data-stu-id="b693d-222">Implement patterns yourself</span></span>

<span data-ttu-id="b693d-223">Ahora que conoce la técnica, complete usted mismo los métodos `SetLowGate` y `SetWaterLevel`.</span><span class="sxs-lookup"><span data-stu-id="b693d-223">Now that you've seen the technique, fill in the `SetLowGate` and `SetWaterLevel` methods yourself.</span></span>  <span data-ttu-id="b693d-224">Empiece agregando el código siguiente para probar las operaciones no válidas en esos métodos:</span><span class="sxs-lookup"><span data-stu-id="b693d-224">Start by adding the following code to test invalid operations on those methods:</span></span>

:::code language="csharp" source="snippets/pattern-objects/Program.cs" ID="FinalTestCode":::

<span data-ttu-id="b693d-225">Vuelva a ejecutar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="b693d-225">Run your application again.</span></span> <span data-ttu-id="b693d-226">Puede ver que se generan errores en las pruebas nuevas y que la esclusa de canal queda en un estado no válido.</span><span class="sxs-lookup"><span data-stu-id="b693d-226">You can see the new tests fail, and the canal lock gets into an invalid state.</span></span> <span data-ttu-id="b693d-227">Intente implementar usted mismo el resto de los métodos.</span><span class="sxs-lookup"><span data-stu-id="b693d-227">Try to implement the remaining methods yourself.</span></span> <span data-ttu-id="b693d-228">El método para establecer la compuerta inferior debe ser similar al que se usa para establecer la compuerta superior.</span><span class="sxs-lookup"><span data-stu-id="b693d-228">The method to set the lower gate should be similar to the method to set the upper gate.</span></span> <span data-ttu-id="b693d-229">El método que cambia el nivel del agua tiene otras comprobaciones, pero debe seguir una estructura similar.</span><span class="sxs-lookup"><span data-stu-id="b693d-229">The method that changes the water level has different checks, but should follow a similar structure.</span></span> <span data-ttu-id="b693d-230">Puede que le resulte útil usar el mismo proceso para el método que establece el nivel del agua.</span><span class="sxs-lookup"><span data-stu-id="b693d-230">You may find it helpful to use the same process for the method that sets the water level.</span></span> <span data-ttu-id="b693d-231">Comience con las cuatro entradas: El estado de ambas compuertas, el estado actual del nivel del agua y el nuevo nivel del agua solicitado.</span><span class="sxs-lookup"><span data-stu-id="b693d-231">Start with all four inputs: The state of both gates, the current state of the water level, and the requested new water level.</span></span> <span data-ttu-id="b693d-232">La expresión switch debe empezar por:</span><span class="sxs-lookup"><span data-stu-id="b693d-232">The switch expression should start with:</span></span>

```csharp
CanalLockWaterLevel = (newLevel, CanalLockWaterLevel, LowWaterGateOpen, HighWaterGateOpen) switch
{
    // elided
};
```

<span data-ttu-id="b693d-233">Tendrá que completar un total de 16 segmentos modificadores.</span><span class="sxs-lookup"><span data-stu-id="b693d-233">You'll have 16 total switch arms to fill in.</span></span> <span data-ttu-id="b693d-234">Luego, realice la prueba y simplifique.</span><span class="sxs-lookup"><span data-stu-id="b693d-234">Then, test and simplify.</span></span>

<span data-ttu-id="b693d-235">¿Hizo métodos como este?</span><span class="sxs-lookup"><span data-stu-id="b693d-235">Did you make methods something like this?</span></span>

:::code language="csharp" source="snippets/pattern-objects/CanalLock.cs" ID="FinalExercise":::

<span data-ttu-id="b693d-236">Las pruebas deberían completarse correctamente y la esclusa de canal debería funcionar de manera segura.</span><span class="sxs-lookup"><span data-stu-id="b693d-236">Your tests should pass, and the canal lock should operate safely.</span></span>

## <a name="summary"></a><span data-ttu-id="b693d-237">Resumen</span><span class="sxs-lookup"><span data-stu-id="b693d-237">Summary</span></span>

<span data-ttu-id="b693d-238">En este tutorial, aprendió a usar la coincidencia de patrones para comprobar el estado interno de un objeto antes de aplicar cualquier cambio en ese estado.</span><span class="sxs-lookup"><span data-stu-id="b693d-238">In this tutorial, you learned to use pattern matching to check the internal state of an object before applying any changes to that state.</span></span> <span data-ttu-id="b693d-239">Puede comprobar combinaciones de propiedades.</span><span class="sxs-lookup"><span data-stu-id="b693d-239">You can check combinations of properties.</span></span> <span data-ttu-id="b693d-240">Una vez que cree tablas para cualquiera de esas transiciones, probará el código y, luego, lo simplificará para su lectura y mantenimiento.</span><span class="sxs-lookup"><span data-stu-id="b693d-240">Once you've built tables for any of those transitions, you test your code, then simplify for readability and maintainability.</span></span> <span data-ttu-id="b693d-241">Estas refactorizaciones iniciales pueden sugerir otras refactorizaciones que validen el estado interno o administren otros cambios de la API.</span><span class="sxs-lookup"><span data-stu-id="b693d-241">These initial refactorings may suggest further refactorings that validate internal state or manage other API changes.</span></span> <span data-ttu-id="b693d-242">En este tutorial se combinan clases y objetos con un enfoque más orientado a datos basado en patrones para implementar esas clases.</span><span class="sxs-lookup"><span data-stu-id="b693d-242">This tutorial combined classes and objects with a more data-oriented, pattern-based approach to implement those classes.</span></span>
