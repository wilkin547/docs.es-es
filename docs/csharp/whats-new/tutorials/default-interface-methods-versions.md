---
title: Actualización segura de las interfaces mediante el uso de métodos de interfaz predeterminada en C#
description: En este tutorial avanzado se describe cómo agregar de forma segura nuevas capacidades a las definiciones de la interfaz existente sin que ello interrumpa todas las clases y estructuras que implementan esa interfaz.
ms.date: 05/06/2019
ms.technlogy: csharp-advanced-concepts
ms.custom: mvc
ms.openlocfilehash: 43af25cee765ba18543b0c7bfe0069542a90e0e5
ms.sourcegitcommit: c7f0beaa2bd66ebca86362ca17d673f7e8256ca6
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 03/23/2021
ms.locfileid: "104878945"
---
# <a name="tutorial-update-interfaces-with-default-interface-methods-in-c-80"></a><span data-ttu-id="8e6a5-103">Tutorial: Actualización de las interfaces mediante el uso de métodos de interfaz predeterminados en C# 8.0</span><span class="sxs-lookup"><span data-stu-id="8e6a5-103">Tutorial: Update interfaces with default interface methods in C# 8.0</span></span>

<span data-ttu-id="8e6a5-104">A partir de C# 8.0 en .NET Core 3.0, puede definir una implementación cuando declare un miembro de una interfaz.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-104">Beginning with C# 8.0 on .NET Core 3.0, you can define an implementation when you declare a member of an interface.</span></span> <span data-ttu-id="8e6a5-105">El escenario más común es agregar de forma segura a miembros a una interfaz ya publicada y utilizada por clientes incontables.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-105">The most common scenario is to safely add members to an interface already released and used by innumerable clients.</span></span>

<span data-ttu-id="8e6a5-106">En este tutorial aprenderá lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="8e6a5-106">In this tutorial, you'll learn how to:</span></span>

> [!div class="checklist"]
>
> * <span data-ttu-id="8e6a5-107">Extender interfaces de forma segura mediante la adición de métodos con implementaciones.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-107">Extend interfaces safely by adding methods with implementations.</span></span>
> * <span data-ttu-id="8e6a5-108">Crear implementaciones con parámetros para proporcionar mayor flexibilidad.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-108">Create parameterized implementations to provide greater flexibility.</span></span>
> * <span data-ttu-id="8e6a5-109">Permitir que los implementadores proporcionen una implementación más específica en forma de una invalidación.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-109">Enable implementers to provide a more specific implementation in the form of an override.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="8e6a5-110">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="8e6a5-110">Prerequisites</span></span>

<span data-ttu-id="8e6a5-111">Deberá configurar la máquina para ejecutar .NET Core, incluido el compilador de C# 8.0.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-111">You’ll need to set up your machine to run .NET Core, including the C# 8.0 compiler.</span></span> <span data-ttu-id="8e6a5-112">El compilador de C# 8.0 está disponible a partir de la [versión 16.3 de Visual Studio 2019](https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=inline+link&utm_content=download+vs2019) o del [SDK de .NET Core 3.0](https://dotnet.microsoft.com/download).</span><span class="sxs-lookup"><span data-stu-id="8e6a5-112">The C# 8.0 compiler is available starting with [Visual Studio 2019 version 16.3](https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=inline+link&utm_content=download+vs2019) or the [.NET Core 3.0 SDK](https://dotnet.microsoft.com/download).</span></span>

## <a name="scenario-overview"></a><span data-ttu-id="8e6a5-113">Información general del escenario</span><span class="sxs-lookup"><span data-stu-id="8e6a5-113">Scenario overview</span></span>

<span data-ttu-id="8e6a5-114">Este tutorial comienza con la versión 1 de una biblioteca de relaciones con clientes.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-114">This tutorial starts with version 1 of a customer relationship library.</span></span> <span data-ttu-id="8e6a5-115">Puede obtener la aplicación de inicio en nuestro [repositorio de ejemplo en GitHub](https://github.com/dotnet/samples/tree/main/csharp/tutorials/default-interface-members-versions/starter/customer-relationship).</span><span class="sxs-lookup"><span data-stu-id="8e6a5-115">You can get the starter application on our [samples repo on GitHub](https://github.com/dotnet/samples/tree/main/csharp/tutorials/default-interface-members-versions/starter/customer-relationship).</span></span> <span data-ttu-id="8e6a5-116">La empresa que creó esta biblioteca se dirigía a los clientes con aplicaciones existentes para adoptar sus bibliotecas.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-116">The company that built this library intended customers with existing applications to adopt their library.</span></span> <span data-ttu-id="8e6a5-117">Proporcionan definiciones de una interfaz mínima para que la implemente los usuarios de su biblioteca.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-117">They provided minimal interface definitions for users of their library to implement.</span></span> <span data-ttu-id="8e6a5-118">Esta es la definición de interfaz para un cliente:</span><span class="sxs-lookup"><span data-stu-id="8e6a5-118">Here's the interface definition for a customer:</span></span>

[!code-csharp[InitialCustomerInterface](~/samples/snippets/csharp/tutorials/default-interface-members-versions/starter/customer-relationship/ICustomer.cs?name=SnippetICustomerVersion1)]

<span data-ttu-id="8e6a5-119">Definieron una segunda interfaz que representa un pedido:</span><span class="sxs-lookup"><span data-stu-id="8e6a5-119">They defined a second interface that represents an order:</span></span>

[!code-csharp[InitialOrderInterface](~/samples/snippets/csharp/tutorials/default-interface-members-versions/starter/customer-relationship/IOrder.cs?name=SnippetIorderVersion1)]

<span data-ttu-id="8e6a5-120">En esas interfaces, el equipo pudo generar una biblioteca para sus usuarios con el fin de crear una mejor experiencia para los clientes.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-120">From those interfaces, the team could build a library for their users to create a better experience for their customers.</span></span> <span data-ttu-id="8e6a5-121">Su objetivo era crear una relación más estrecha con los clientes existentes y mejorar sus relaciones con los clientes nuevos.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-121">Their goal was to create a deeper relationship with existing customers and improve their relationships with new customers.</span></span>

<span data-ttu-id="8e6a5-122">Ahora, es momento de actualizar la biblioteca para la próxima versión.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-122">Now, it's time to upgrade the library for the next release.</span></span> <span data-ttu-id="8e6a5-123">Una de las características solicitadas permite un descuento por fidelidad para los clientes que tienen muchos pedidos.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-123">One of the requested features enables a loyalty discount for customers that have lots of orders.</span></span> <span data-ttu-id="8e6a5-124">Este nuevo descuento por fidelidad se aplica cada vez que un cliente realiza un pedido.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-124">This new loyalty discount gets applied whenever a customer makes an order.</span></span> <span data-ttu-id="8e6a5-125">El descuento específico es una propiedad de cada cliente individual.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-125">The specific discount is a property of each individual customer.</span></span> <span data-ttu-id="8e6a5-126">Cada implementación de `ICustomer` puede establecer reglas diferentes para el descuento por fidelidad.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-126">Each implementation of `ICustomer` can set different rules for the loyalty discount.</span></span>

<span data-ttu-id="8e6a5-127">La forma más natural para agregar esta funcionalidad es mejorar la interfaz `ICustomer` con un método para aplicar los descuentos por fidelización.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-127">The most natural way to add this functionality is to enhance the `ICustomer` interface with a method to apply any loyalty discount.</span></span> <span data-ttu-id="8e6a5-128">Esta sugerencia de diseño es motivo de preocupación entre los desarrolladores experimentados: "Las interfaces son inmutables una vez que se han publicado.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-128">This design suggestion caused concern among experienced developers: "Interfaces are immutable once they've been released!</span></span> <span data-ttu-id="8e6a5-129">¡Es un cambio importante!"</span><span class="sxs-lookup"><span data-stu-id="8e6a5-129">This is a breaking change!"</span></span> <span data-ttu-id="8e6a5-130">C# 8.0 agrega *las implementaciones de interfaz predeterminadas* para actualizar las interfaces.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-130">C# 8.0 adds *default interface implementations* for upgrading interfaces.</span></span> <span data-ttu-id="8e6a5-131">Los autores de bibliotecas pueden agregar a nuevos miembros a la interfaz y proporcionar una implementación predeterminada para esos miembros.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-131">The library authors can add new members to the interface and provide a default implementation for those members.</span></span>

<span data-ttu-id="8e6a5-132">Las implementaciones de interfaces predeterminadas permiten a los desarrolladores actualizar una interfaz mientras siguen permitiendo que los implementadores invaliden esa implementación.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-132">Default interface implementations enable developers to upgrade an interface while still enabling any implementors to override that implementation.</span></span> <span data-ttu-id="8e6a5-133">Los usuarios de la biblioteca pueden aceptar la implementación predeterminada como un cambio sin importancia.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-133">Users of the library can accept the default implementation as a non-breaking change.</span></span> <span data-ttu-id="8e6a5-134">Si sus reglas de negocios son diferentes, se puede invalidar.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-134">If their business rules are different, they can override.</span></span>

## <a name="upgrade-with-default-interface-methods"></a><span data-ttu-id="8e6a5-135">Actualización con los métodos de interfaz predeterminados</span><span class="sxs-lookup"><span data-stu-id="8e6a5-135">Upgrade with default interface methods</span></span>

<span data-ttu-id="8e6a5-136">El equipo estuvo de acuerdo en la más probable implementación predeterminada: un descuento por fidelidad para los clientes.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-136">The team agreed on the most likely default implementation: a loyalty discount for customers.</span></span>

<span data-ttu-id="8e6a5-137">La actualización debe proporcionar la funcionalidad para establecer dos propiedades: el número de pedidos necesario para poder recibir el descuento y el porcentaje del descuento.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-137">The upgrade should provide the functionality to set two properties: the number of orders needed to be eligible for the discount, and the percentage of the discount.</span></span> <span data-ttu-id="8e6a5-138">Esto lo convierte en un escenario perfecto para los métodos de interfaz predeterminados.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-138">This makes it a perfect scenario for default interface methods.</span></span> <span data-ttu-id="8e6a5-139">Puede agregar un método a la interfaz de `ICustomer` y proporcionar la implementación más probable.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-139">You can add a method to the `ICustomer` interface, and provide the most likely implementation.</span></span> <span data-ttu-id="8e6a5-140">Todas las implementaciones existentes y nuevas pueden usar la implementación predeterminada o proporcionar una propia.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-140">All existing, and any new implementations can use the default implementation, or provide their own.</span></span>

<span data-ttu-id="8e6a5-141">En primer lugar, agregue el nuevo método a la interfaz, incluido su cuerpo:</span><span class="sxs-lookup"><span data-stu-id="8e6a5-141">First, add the new method to the interface, including the body of the method:</span></span>

[!code-csharp[InitialOrderInterface](~/samples/snippets/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/ICustomer.cs?name=SnippetLoyaltyDiscountVersionOne)]

<span data-ttu-id="8e6a5-142">El autor de la biblioteca escribió una primera prueba para comprobar la implementación:</span><span class="sxs-lookup"><span data-stu-id="8e6a5-142">The library author wrote a first test to check the implementation:</span></span>

[!code-csharp[TestDefaultImplementation](~/samples/snippets/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/Program.cs?name=SnippetTestDefaultImplementation)]

<span data-ttu-id="8e6a5-143">Tenga en cuenta la siguiente parte de la prueba:</span><span class="sxs-lookup"><span data-stu-id="8e6a5-143">Notice the following portion of the test:</span></span>

[!code-csharp[TestDefaultImplementation](~/samples/snippets/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/Program.cs?name=SnippetHighlightCast)]

<span data-ttu-id="8e6a5-144">La conversión de `SampleCustomer` a `ICustomer` es necesaria.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-144">That cast from `SampleCustomer` to `ICustomer` is necessary.</span></span> <span data-ttu-id="8e6a5-145">La clase `SampleCustomer` no necesita proporcionar una implementación para `ComputeLoyaltyDiscount`. La interfaz `ICustomer` la proporciona.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-145">The `SampleCustomer` class doesn't need to provide an implementation for `ComputeLoyaltyDiscount`; that's provided by the `ICustomer` interface.</span></span> <span data-ttu-id="8e6a5-146">Sin embargo, la clase `SampleCustomer` no hereda miembros de sus interfaces.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-146">However, the `SampleCustomer` class doesn't inherit members from its interfaces.</span></span> <span data-ttu-id="8e6a5-147">Esa no ha cambiado.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-147">That rule hasn't changed.</span></span> <span data-ttu-id="8e6a5-148">Para poder llamar a cualquier método declarado e implementado en la interfaz, la variable debe ser del tipo de la interfaz: `ICustomer` en este ejemplo.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-148">In order to call any method declared and implemented in the interface, the variable must be the type of the interface, `ICustomer` in this example.</span></span>

## <a name="provide-parameterization"></a><span data-ttu-id="8e6a5-149">Proporcionar parametrización</span><span class="sxs-lookup"><span data-stu-id="8e6a5-149">Provide parameterization</span></span>

<span data-ttu-id="8e6a5-150">Ese es un buen inicio.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-150">That's a good start.</span></span> <span data-ttu-id="8e6a5-151">Pero la implementación predeterminada es demasiado restrictiva.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-151">But, the default implementation is too restrictive.</span></span> <span data-ttu-id="8e6a5-152">Muchos consumidores de este sistema pueden elegir diferentes umbrales para el número de compras, una longitud diferente de la pertenencia o un porcentaje diferente del descuento.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-152">Many consumers of this system may choose different thresholds for number of purchases, a different length of membership, or a different percentage discount.</span></span> <span data-ttu-id="8e6a5-153">Puede proporcionar una mejor experiencia de actualización para más clientes proporcionando una manera de establecer esos parámetros.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-153">You can provide a better upgrade experience for more customers by providing a way to set those parameters.</span></span> <span data-ttu-id="8e6a5-154">Vamos a agregar un método estático que establezca esos tres parámetros controlando la implementación predeterminada:</span><span class="sxs-lookup"><span data-stu-id="8e6a5-154">Let's add a static method that sets those three parameters controlling the default implementation:</span></span>

[!code-csharp[VersionTwoImplementation](~/samples/snippets/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/ICustomer.cs?name=SnippetLoyaltyDiscountVersionTwo)]

<span data-ttu-id="8e6a5-155">Hay muchas funcionalidades nuevas de lenguaje que se muestran en este pequeño fragmento de código.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-155">There are many new language capabilities shown in that small code fragment.</span></span> <span data-ttu-id="8e6a5-156">Las interfaces ahora pueden incluir miembros estáticos, incluidos campos y métodos.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-156">Interfaces can now include static members, including fields and methods.</span></span> <span data-ttu-id="8e6a5-157">También están habilitados diferentes modificadores de acceso.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-157">Different access modifiers are also enabled.</span></span> <span data-ttu-id="8e6a5-158">Los campos adicionales son privados, el nuevo método es público.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-158">The additional fields are private, the new method is public.</span></span> <span data-ttu-id="8e6a5-159">Todos los modificadores están permitidos en los miembros de la interfaz.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-159">Any of the modifiers are allowed on interface members.</span></span>

<span data-ttu-id="8e6a5-160">Las aplicaciones que usan la fórmula general para calcular el descuento por fidelidad, pero diferentes parámetros, no necesitan proporcionar una implementación personalizada: pueden establecer los argumentos a través de un método estático.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-160">Applications that use the general formula for computing the loyalty discount, but different parameters, don't need to provide a custom implementation; they can set the arguments through a static method.</span></span> <span data-ttu-id="8e6a5-161">Por ejemplo, el siguiente código establece una "apreciación de cliente" que recompensa a cualquier cliente con más de una pertenencia al mes:</span><span class="sxs-lookup"><span data-stu-id="8e6a5-161">For example, the following code sets a "customer appreciation" that rewards any customer with more than one month's membership:</span></span>

[!code-csharp[SetLoyaltyThresholds](~/samples/snippets/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/Program.cs?name=SnippetSetLoyaltyThresholds)]

## <a name="extend-the-default-implementation"></a><span data-ttu-id="8e6a5-162">Extender la implementación predeterminada</span><span class="sxs-lookup"><span data-stu-id="8e6a5-162">Extend the default implementation</span></span>

<span data-ttu-id="8e6a5-163">El código que ha agregado hasta ahora ha proporcionado una implementación adecuada para los escenarios donde los usuarios quieren algo similar a la implementación predeterminada, o para proporcionar un conjunto de reglas no relacionado.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-163">The code you've added so far has provided a convenient implementation for those scenarios where users want something like the default implementation, or to provide an unrelated set of rules.</span></span> <span data-ttu-id="8e6a5-164">Para una característica final, vamos a refactorizar el código un poco para habilitar los escenarios donde es posible que los usuarios deseen crear en la implementación predeterminada.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-164">For a final feature, let's refactor the code a bit to enable scenarios where users may want to build on the default implementation.</span></span>

<span data-ttu-id="8e6a5-165">Considere una startup que desea captar nuevos clientes.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-165">Consider a startup that wants to attract new customers.</span></span> <span data-ttu-id="8e6a5-166">Ofrecen un descuento del 50 % en el primer pedido de un cliente nuevo.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-166">They offer a 50% discount off a new customer's first order.</span></span> <span data-ttu-id="8e6a5-167">De lo contrario, los clientes existentes obtienen el descuento estándar.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-167">Otherwise, existing customers get the standard discount.</span></span> <span data-ttu-id="8e6a5-168">El autor de la biblioteca necesita mover la implementación predeterminada a un método `protected static` para que cualquier clase que implemente esta interfaz pueda reutilizar el código en su implementación.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-168">The library author needs to move the default implementation into a `protected static` method so that any class implementing this interface can reuse the code in their implementation.</span></span> <span data-ttu-id="8e6a5-169">La implementación predeterminada del miembro de la interfaz llama a este método compartido así:</span><span class="sxs-lookup"><span data-stu-id="8e6a5-169">The default implementation of the interface member calls this shared method as well:</span></span>

[!code-csharp[VersionTwoImplementation](~/samples/snippets/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/ICustomer.cs?name=SnippetFinalVersion)]

<span data-ttu-id="8e6a5-170">En una implementación de una clase que implementa esta interfaz, la invalidación puede llamar al método auxiliar estático y ampliar esa lógica para proporcionar el descuento de "cliente nuevo":</span><span class="sxs-lookup"><span data-stu-id="8e6a5-170">In an implementation of a class that implements this interface, the override can call the static helper method, and extend that logic to provide the "new customer" discount:</span></span>

[!code-csharp[VersionTwoImplementation](~/samples/snippets/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/SampleCustomer.cs?name=SnippetOverrideAndExtend)]

<span data-ttu-id="8e6a5-171">Puede ver todo el código terminado en nuestro [repositorio de ejemplos en GitHub](https://github.com/dotnet/samples/tree/main/csharp/tutorials/default-interface-members-versions/finished/customer-relationship).</span><span class="sxs-lookup"><span data-stu-id="8e6a5-171">You can see the entire finished code in our [samples repo on GitHub](https://github.com/dotnet/samples/tree/main/csharp/tutorials/default-interface-members-versions/finished/customer-relationship).</span></span> <span data-ttu-id="8e6a5-172">Puede obtener la aplicación de inicio en nuestro [repositorio de ejemplo en GitHub](https://github.com/dotnet/samples/tree/main/csharp/tutorials/default-interface-members-versions/starter/customer-relationship).</span><span class="sxs-lookup"><span data-stu-id="8e6a5-172">You can get the starter application on our [samples repo on GitHub](https://github.com/dotnet/samples/tree/main/csharp/tutorials/default-interface-members-versions/starter/customer-relationship).</span></span>

<span data-ttu-id="8e6a5-173">Estas nuevas características significan que las interfaces se pueden actualizar de forma segura cuando hay una implementación predeterminada razonable para esos nuevos miembros.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-173">These new features mean that interfaces can be updated safely when there's a reasonable default implementation for those new members.</span></span> <span data-ttu-id="8e6a5-174">Diseñe cuidadosamente las interfaces para expresar ideas funcionales únicas que puedan implementarse con varias clases.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-174">Carefully design interfaces to express single functional ideas that can be implemented by multiple classes.</span></span> <span data-ttu-id="8e6a5-175">Esto facilita la actualización de esas definiciones de interfaz cuando se descubren nuevos requisitos para esa misma idea funcional.</span><span class="sxs-lookup"><span data-stu-id="8e6a5-175">That makes it easier to upgrade those interface definitions when new requirements are discovered for that same functional idea.</span></span>
