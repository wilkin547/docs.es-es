---
title: Problemas de migración de .NET Framework 4
ms.date: 05/02/2017
helpviewer_keywords:
- .NET Framework 4, migration
- application compatibility
ms.assetid: df478548-8c05-4de2-8ba7-adcdbe1c2a60
ms.openlocfilehash: c1c3298d87ad0f481fa30182e40cd5edcd535d6a
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 03/15/2020
ms.locfileid: "73975618"
---
# <a name="net-framework-4-migration-issues"></a>Problemas de migración de .NET Framework 4

En este tema se describen los problemas de migración entre .NET Framework versión 3.5 Service Pack 1 y .NET Framework versión 4, incluidas las correcciones, los cambios para el cumplimiento de estándares y la seguridad, y los cambios basados en los comentarios de los clientes. La mayoría de estos cambios no exigen que realice ningún tipo de modificación de programación en sus aplicaciones. Para ver los cambios que podrían implicar modificaciones, consulte la columna Cambios recomendados de la tabla. Los cambios importantes se desglosan por área, por ejemplo, ASP.NET y Windows Presentation Foundation (WPF).

Para obtener información más específica sobre los problemas incluidos en este tema, consulte la [Guía de migración para .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ff657133%28v=vs.100%29).

Para obtener información sobre las nuevas características, vea [Lo nuevo en .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms171868%28v=vs.100%29).

## <a name="aspnet-and-web"></a>ASP.NET y web

Espacios de nombres: <xref:System.Web>, <xref:System.Web.Mobile>, <xref:System.Web.Security>, <xref:System.Web.UI.WebControls>; ensamblado: System.Web (en System.Web.dll)

| Característica | Diferencias respecto a 3.5 SP1 | Cambios recomendados |
| ------- | ------------------------ | ------------------- |
| **Archivos de definición de explorador** | Los archivos de definición de explorador se han actualizado para que incluyan información sobre exploradores y dispositivos nuevos y actualizados. Se han quitado exploradores y dispositivos anteriores, como Netscape Navigator, y se han agregado exploradores y dispositivos más recientes, como Google Chrome y Apple iPhone.<br><br>Si la aplicación contiene definiciones de explorador personalizadas que heredan de una de las definiciones de explorador que se han quitado, aparecerá un error.<br><br>El objeto <xref:System.Web.HttpBrowserCapabilities> (que se expone mediante la propiedad `Request.Browse` de la página) está controlado por los archivos de definición del explorador. Por lo tanto, la información que se devuelve mediante el acceso a una propiedad de este objeto en ASP.NET 4 podría ser diferente de la información devuelta en una versión anterior de ASP.NET. | Si la aplicación se basa en los archivos de definición del explorador antiguo, puede copiarlos de la siguiente carpeta:<br><br>*Windows\\Microsoft.NET\\Framework\\v2.0.50727\\CONFIG\\Browsers*<br><br>Copie los archivos en la carpeta *\\CONFIG\\Browsers* correspondiente de ASP.NET 4. Después de copiar los archivos, ejecute la herramienta de línea de comandos [Aspnet_regbrowsers.exe](https://docs.microsoft.com/previous-versions/dotnet/netframework-3.5/ms229858(v=vs.90)). Para obtener más información, vea el sitio web [https://www.asp.net/mobile](/aspnet/mobile/overview). |
| **Aplicaciones secundarias que se ejecutan en versiones mixtas de ASP.NET** | Las aplicaciones de ASP.NET 4 configuradas como elementos secundarios de aplicaciones que ejecutan versiones anteriores de ASP.NET podrían no iniciarse debido a errores de configuración o de compilación. El error que aparezca dependerá de si la aplicación se ejecuta en IIS 6.0, en IIS 7 o en IIS 7.5. | Puede realizar cambios en los archivos de configuración de las aplicaciones afectadas para que el sistema de configuración reconozca correctamente la aplicación de ASP.NET 4. Para obtener información sobre los cambios que debe realizar, vea la sección "ASP.NET 4 Child Applications Fail to Start When Under ASP.NET 2.0 or ASP.NET 3.5 Applications" (Las aplicaciones secundarias de ASP.NET 4 no se inician cuando se ejecutan en aplicaciones de ASP.NET 2.0 o ASP.NET 3.5) en el documento [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) (Cambios importantes de ASP.NET 4) en el sitio web de ASP.NET. |
| **Cambios de ClientID** | La nueva opción `clientIDMode` de ASP.NET 4 permite especificar cómo genera ASP.NET el atributo `id` para los elementos HTML. En versiones anteriores de ASP.NET, el comportamiento predeterminado era equivalente al valor `AutoID` de `clientIDMode`. Ahora, el valor predeterminado es `Predictable`. Para obtener más información, vea [Identificación de controles de formularios Web Forms](https://docs.microsoft.com/previous-versions/aspnet/1d04y8ss%28v=vs.100%29). | Si usa Visual Studio para actualizar la aplicación desde ASP.NET 2.0 o ASP.NET 3.5, la herramienta agrega automáticamente una configuración en el archivo Web.config que conserva el comportamiento de versiones anteriores de .NET Framework. Sin embargo, si actualiza una aplicación cambiando el grupo de aplicaciones en IIS para elegir como destino .NET Framework 4, ASP.NET usará el nuevo modo de forma predeterminada. Para deshabilitar el nuevo modo de identificador de cliente, agregue el valor siguiente al archivo Web.config:<br><br>`<pages clientIDMode="AutoID" />` |
| **Seguridad de acceso del código (CAS)** | Las características de .NET de ASP.NET 2.0 que se han agregado a ASP.NET 3.5 usan el modelo de seguridad de acceso del código (CAS) de .NET Framework 1.1 y .NET Framework 2.0. Aun así, la implementación de CAS en ASP.NET 4 se ha mejorado considerablemente. Como resultado, podría producirse un error con varias excepciones de seguridad en las aplicaciones de ASP.NET de confianza parcial que se basan en código de confianza que se ejecuta en la caché global de ensamblados. También se podrían producir errores y excepciones de seguridad en las aplicaciones de confianza parcial que se basan en modificaciones extensas de la directiva de CAS del equipo. | Puede revertir las aplicaciones de ASP.NET 4 de confianza parcial al comportamiento de ASP.NET 1.1 y 2.0 mediante el uso del nuevo atributo `legacyCasModel` en el elemento de configuración `trust`, como se muestra en el ejemplo siguiente:<br><br>`<trust level= "Medium" legacyCasModel="true" />`<br><br>Importante: El hecho de revertir al modelo anterior de CAS podría reducir la seguridad.<br><br>Para obtener más información sobre el nuevo modelo de seguridad de acceso del código de ASP.NET 4, vea [Seguridad de acceso del código para aplicaciones ASP.NET 4](https://docs.microsoft.com/previous-versions/dd984947(v=vs.100)). |
| **Archivos de configuración** | Los archivos de configuración raíz (el archivo machine.config y el archivo raíz Web.config) para .NET Framework y ASP.NET 4 se han actualizado de modo que incluyan la mayor parte de la información de configuración reutilizable que se encontraba en los archivos de aplicación Web.config de ASP.NET 3.5. Dada la complejidad de los sistemas de configuración administrados de IIS 7 e IIS 7.5, la ejecución de aplicaciones de ASP.NET 3.5 en ASP.NET 4 y en IIS 7 e IIS 7.5 puede producir errores de ASP.NET o de IIS. | Actualice las aplicaciones de ASP.NET 3.5 a ASP.NET 4 mediante las herramientas de actualización de proyectos de Visual Studio. Visual Studio 2010 modifica automáticamente el archivo Web.config de la aplicación de ASP.NET 3.5 para que contenga la configuración adecuada para ASP.NET 4.<br><br>Aun así, puede ejecutar aplicaciones de ASP.NET 3.5 con .NET Framework 4 sin necesidad de volver a compilar. En ese caso, es posible que deba modificar manualmente el archivo Web.config de la aplicación antes de ejecutar la aplicación en .NET Framework 4 y en IIS 7 o IIS 7.5. El cambio específico que debe realizar depende de la combinación de software con la que trabaje, incluidas las versiones de Service Pack (SP). Para obtener información sobre las combinaciones de software que se pueden ver afectadas por este cambio y saber cómo resolver los problemas de combinaciones específicas, vea la sección "Configuration Errors Related to New ASP.NET 4 Root Configuration" (Errores de configuración relacionados con la nueva configuración raíz de ASP.NET 4) en el documento [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) (Cambios importantes de ASP.NET 4) en el sitio web de ASP.NET. |
| **Representación de controles** | En versiones anteriores de ASP.NET, algunos controles emitían un marcado que no se podía deshabilitar. De forma predeterminada, este tipo de marcado ya no se genera en ASP.NET 4. Los cambios de representación afectan a los siguientes controles:<br><br>* Los controles `Image` y `ImageButton` ya no representan un atributo `border="0"`.<br>* La clase `BaseValidator` y los controles de validación que derivan de ella ya no representan texto rojo de forma predeterminada.<br>* El control `HtmlForm` no representa un atributo `name`.<br>* El control `Table` ya no representa un atributo `border="0"`.<br><br>Los controles que no están diseñados para la entrada del usuario (por ejemplo, el control `Label`) ya no representan el atributo `disabled="disabled"` si su propiedad `Enabled` está establecida en `false` (o si heredan esta configuración de un control contenedor). | Si usa Visual Studio para actualizar la aplicación desde ASP.NET 2.0 o ASP.NET 3.5, la herramienta agrega automáticamente una configuración en el archivo Web.config que conserva la representación heredada. Sin embargo, si actualiza una aplicación cambiando el grupo de aplicaciones en IIS para elegir como destino .NET Framework 4, ASP.NET usa el nuevo modo de representación de forma predeterminada. Para deshabilitar el nuevo modo de representación, agregue el valor siguiente al archivo Web.config:<br><br>`<pages controlRenderingCompatibilityVersion="3.5" />` |
| **Controladores de eventos en documentos predeterminados** | ASP.NET 4 representa el valor de atributo `action` del elemento HTML `form` como una cadena vacía cuando se realiza una solicitud a una dirección URL sin extensión que tiene asignado un documento predeterminado. En versiones anteriores de ASP.NET, una solicitud a `http://contoso.com` daría como resultado una solicitud a Default.aspx. En ese documento, la etiqueta `form` de apertura se representaría como en el ejemplo siguiente:<br><br>`<form action="Default.aspx" />`<br><br>En ASP.NET 4, una solicitud a `http://contoso.com` también daría como resultado una solicitud a Default.aspx, pero ASP.NET ahora representa la etiqueta de apertura HTML `form` como en el ejemplo siguiente:<br><br>`<form action="" />`<br><br>Cuando el atributo `action` es una cadena vacía, el objeto `DefaultDocumentModule` de IIS crea una solicitud secundaria a Default.aspx. En la mayoría de las condiciones, esta solicitud secundaria es transparente para el código de la aplicación y la página Default.aspx se ejecuta con normalidad. A pesar de ello, una interacción potencial entre el código administrado y el modo integrado de IIS 7 o IIS 7.5 puede hacer que las páginas .aspx administradas dejen de funcionar correctamente durante la solicitud secundaria. Si se producen las condiciones siguientes, la solicitud secundaria a un documento .aspx predeterminado producirá un error o un comportamiento inesperado:<br><br>* Una página .aspx se envía al explorador con el atributo `action` del elemento `form` establecido en "".<br>* El formulario se envía de vuelta a ASP.NET.<br>* Un módulo HTTP administrado lee una parte del cuerpo de la entidad, como `Request.Form` o `Request.Params`. Esto hace que el cuerpo de la entidad de la solicitud POST se lea en la memoria administrada. Como resultado, el cuerpo de la entidad ya no está disponible para los módulos de código nativo que se ejecutan en el modo integrado de IIS 7 o IIS 7.5.<br>* El objeto `DefaultDocumentModule` de IIS finalmente se ejecuta y crea una solicitud secundaria al documento Default.aspx. Sin embargo, dado que un fragmento del código administrado ya ha leído el cuerpo de la entidad, no hay ningún cuerpo de entidad disponible para enviarlo a la solicitud secundaria.<br>* Cuando se ejecuta la canalización HTTP para la solicitud secundaria, el controlador de archivos .aspx se ejecuta durante la fase de ejecución de controlador.<br><br>Dado que no hay ningún cuerpo de entidad, no hay variables de formulario ni estado de vista. Por lo tanto, no hay información disponible para que el controlador de páginas .aspx determine qué evento se debe generar (en caso de que sea necesario). Como resultado, no se ejecuta ninguno de los controladores de eventos postback para la página .aspx afectada. | Para obtener información sobre las formas de solucionar los problemas que pueden surgir como resultado de este cambio, vea "Event Handlers Might Not Be Not Raised in a Default Document in IIS 7 or IIS 7.5 Integrated Mode" (Podrían no producirse eventos de controladores en un documento predeterminado en el modo integrado de IIS 7 o IIS 7.5) en el documento [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) (Cambios importantes de ASP.NET 4) en el sitio web de ASP.NET. |
| **Algoritmo hash** | ASP.NET usa cifrado y algoritmos hash para ayudar a proteger los datos, como las cookies de autenticación de formularios y el estado de vista. De forma predeterminada, ASP.NET 4 usa el algoritmo <xref:System.Security.Cryptography.HMACSHA256> para las operaciones de hash en las cookies y el estado de vista. Las versiones anteriores de ASP.NET usaban el algoritmo <xref:System.Security.Cryptography.HMACSHA1>, más antiguo. | Si ejecuta aplicaciones que combinan ASP.NET 2.0 y ASP.NET 4, en las que los datos como las cookies de autenticación de formularios deben funcionar en diferentes versiones de .NET Framework, configure una aplicación web de ASP.NET 4 de modo que use el algoritmo <xref:System.Security.Cryptography.HMACSHA1> antiguo. Para ello, agregue el valor de configuración siguiente en el archivo Web.config:<br><br>`<machineKey validation="SHA1" />` |
| **Hospedar controles en Internet Explorer** | Ya no se pueden hospedar controles de formularios Windows Forms en Internet Explorer, dado que existen soluciones mejores para hospedar controles en la Web. Por lo tanto, se han quitado de .NET Framework los ensamblados IEHost.dll e IEExec.exe. | Puede usar las siguientes tecnologías para el desarrollo de controles personalizados en aplicaciones web:<br><br>* Puede crear una aplicación de Silverlight y configurarla para que se ejecute fuera del explorador. Para obtener más información, vea [Out-of-Browser Support](https://docs.microsoft.com/previous-versions/windows/silverlight/dotnet-windows-silverlight/dd550721%28v=vs.95%29) (Compatibilidad fuera del explorador).<br>* Puede compilar una aplicación de explorador XAML (XBAP) aprovechar las ventajas de las funciones WPF (requiere .NET Framework en los equipos cliente). Para obtener más información, vea [Información general sobre las aplicaciones de explorador XAML de WPF](../wpf/app-development/wpf-xaml-browser-applications-overview.md). |
| **Métodos HtmlEncode y UrlEncode** | Los métodos `HtmlEncode` y `UrlEncode` de las clases <xref:System.Web.HttpUtility> y <xref:System.Web.HttpServerUtility> se han actualizado para codificar el carácter de comilla simple (') como se indica a continuación:<br><br>* El método `HtmlEncode` codifica las instancias de la comilla simple como `&#39;`<br>* El método `UrlEncode` codifica las instancias de la comilla simple como `%27` | Busque en el código los lugares en los que usa los métodos `HtmlEncode` y `UrlEncode` y asegúrese de que el cambio en la codificación no produce un cambio que afecte a la aplicación. |
| **Errores HttpException en aplicaciones de ASP.NET 2.0** | Una vez que se ha habilitado ASP.NET 4 en IIS 6, las aplicaciones de ASP.NET 2.0 que se ejecutan en IIS 6 (en Windows Server 2003 o Windows Server 2003 R2) podrían generar errores como el siguiente: `System.Web.HttpException: Path '/[yourApplicationRoot]/eurl.axd/[Value]' was not found.` | * Si no se requiere ASP.NET 4 para ejecutar el sitio web, vuelva a asignar el sitio de modo que use ASP.NET 2.0 en su lugar.<br><br>o bien<br><br>* Si se requiere ASP.NET 4 para ejecutar el sitio web, mueva los directorios virtuales secundarios de ASP.NET 2.0 a otro sitio web que esté asignado a ASP.NET 2.0.<br><br>o bien<br><br>* Deshabilite las direcciones URL sin extensión. Para obtener más información, vea "ASP.NET 2.0 Applications Might Generate HttpException Errors That Reference eurl.axd" (Las aplicaciones de ASP.NET 2.0 pueden generar errores HttpException que hacen referencia a eurl.axd) en el documento [ASP.NET 4 Breaking Changes](/aspnet/whitepapers/aspnet4/breaking-changes) (Cambios importantes de ASP.NET 4) en el sitio web de ASP.NET. |
| **Tipos de pertenencia** | Algunos tipos (por ejemplo, <xref:System.Web.Security.MembershipProvider>) que se usan en la pertenencia a ASP.NET se han movido del ensamblado System.Web.dll al ensamblado System.Web.ApplicationServices.dll. Estos tipos se han movido para resolver las dependencias de capas de arquitectura entre los tipos del cliente y de las SKU de .NET Framework extendidas. | Las bibliotecas de clases que se han actualizado desde versiones anteriores de ASP.NET y que usan tipos de pertenencia movidos podrían no compilarse cuando se usan en un proyecto de ASP.NET 4. En ese caso, agregue una referencia a System.Web.ApplicationServices.dll en el proyecto de biblioteca de clases. |
| **Cambios en el control Menu** | Los cambios en el control <xref:System.Web.UI.WebControls.Menu> provocan el siguiente comportamiento:<br><br>* Si <xref:System.Web.UI.WebControls.MenuRenderingMode> está establecido en `List`, o si <xref:System.Web.UI.WebControls.MenuRenderingMode> está establecido en `Default` y <xref:System.Web.Configuration.PagesSection.ControlRenderingCompatibilityVersion> está establecido en `4.0` o una versión posterior, la propiedad <xref:System.Web.UI.WebControls.MenuItem.PopOutImageUrl> no tiene ningún efecto.<br>* Si la ruta de acceso que se establece en las propiedades <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> y <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> contiene una barra diagonal inversa (\\), las imágenes no se representan. (En versiones anteriores de ASP.NET, la ruta de acceso podría incluir una barra diagonal inversa). | * En lugar de establecer la propiedad <xref:System.Web.UI.WebControls.MenuItem.PopOutImageUrl> para los elementos de menú individuales, establezca las propiedades <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> o <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> del control primario <xref:System.Web.UI.WebControls.Menu>.<br><br>o bien<br><br>Establezca <xref:System.Web.UI.WebControls.MenuRenderingMode> en `Table`, o establezca <xref:System.Web.UI.WebControls.MenuRenderingMode> en `Default` y <xref:System.Web.Configuration.PagesSection.ControlRenderingCompatibilityVersion> en `3.5`. Esta configuración hace que el control <xref:System.Web.UI.WebControls.Menu> use el diseño basado en la tablas HTML que se usaba en versiones anteriores de ASP.NET.<br>* Si la ruta de acceso de la propiedad <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> o <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> contiene una barra diagonal inversa (\\), sustitúyalo por un carácter de barra diagonal (/). |
| **Ensamblado móvil en el archivo Web.config** | En versiones anteriores de ASP.NET, se incluía una referencia al ensamblado System.Web.Mobile.dll en el archivo raíz Web.config en la sección `assemblies` de `system.web`/`compilation`. Para mejorar el rendimiento, se ha quitado la referencia a este ensamblado.<br><br>Nota: El ensamblado System.Web.Mobile.dll y los controles móviles de ASP.NET están incluidos en ASP.NET 4, pero están en desuso. | Si quiere usar tipos de este ensamblado, agregue una referencia al ensamblado en el archivo raíz Web.config o en un archivo de aplicación Web.config. |
| **Almacenamiento en caché de resultados** | En ASP.NET 1.0, un error hacía que las páginas en caché que especificaban `Location="ServerAndClient"` como valor de la caché de resultados emitiesen un encabezado HTTP `Vary:*` en la respuesta. Como consecuencia, se indicaba a los exploradores de cliente que nunca almacenasen en caché la página localmente. En ASP.NET 1.1 se agregó el método <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A>, al que se podía llamar para suprimir el encabezado `Vary:*`. A pesar de ello, los informes de errores sugieren que los desarrolladores no son conscientes del comportamiento de `SetOmitVaryStar`.<br><br>En ASP.NET 4, ya no se emite el encabezado HTTP `Vary:*` desde las respuestas que especifican la directiva siguiente:<br><br>`<%@ OutputCache Location="ServerAndClient" %>`<br><br>Como resultado, ya no es necesario el método <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A> para suprimir el encabezado `Vary:*`. En las aplicaciones que especifican "ServerAndClient" para el atributo `Location`, las páginas se podrán almacenar en caché en el explorador sin necesidad de llamar a <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A>. | Si las páginas de la aplicación deben emitir `Vary:*`, llame al método <xref:System.Web.HttpResponse.AppendHeader%2A> como se muestra en el ejemplo siguiente:<br><br>`System.Web.HttpResponse.AppendHeader("Vary","*");`<br><br>Como alternativa, puede cambiar el valor del atributo `Location` de la caché de resultados a "Server". |
| **Análisis de página** | El analizador de páginas de ASP.NET para páginas web (archivos .aspx) y controles de usuario (archivos .ascx) es más estricto en ASP.NET 4 que en versiones anteriores de ASP.NET, y marca como no válido un mayor porcentaje de marcado que en versiones anteriores. | Examine los mensajes de error que se producen cuando se ejecuta una página y corrija los errores derivados de un marcado no válido. |
| **Tipos de Passport** | La compatibilidad con Passport integrada en ASP.NET 2.0 está obsoleta y no se admite debido a los cambios que se han producido en Passport (ahora Live ID SDK). Como resultado, los tipos relacionados con Passport en <xref:System.Web.Security> ahora se marcan con el atributo `ObsoleteAttribute`. | Cambie el código que tenga que use tipos de Passport en el espacio de nombres <xref:System.Web.Security> (por ejemplo, <xref:System.Web.Security.PassportIdentity>) para que use el SDK de Windows Live ID. |
| **Información de PathInfo en la propiedad FilePath** | ASP.NET 4 ya no incluye el valor `PathInfo` en los valores devueltos desde propiedades como <xref:System.Web.HttpRequest.FilePath>, <xref:System.Web.HttpRequest.AppRelativeCurrentExecutionFilePath> y <xref:System.Web.HttpRequest.CurrentExecutionFilePath>. Ahora, la información de `PathInfo` está disponible en <xref:System.Web.HttpRequest.PathInfo>. Por ejemplo, veamos el siguiente fragmento de dirección URL:<br><br>`/testapp/Action.mvc/SomeAction`<br><br>En versiones anteriores de ASP.NET, las propiedades <xref:System.Web.HttpRequest> tienen los valores siguientes:<br><br>* <xref:System.Web.HttpRequest.FilePath>: `/testapp/Action.mvc/SomeAction`<br>* <xref:System.Web.HttpRequest.PathInfo>: (vacío)<br><br>En cambio, en ASP.NET 4, las propiedades <xref:System.Web.HttpRequest> tienen los siguientes valores:<br><br>* <xref:System.Web.HttpRequest.FilePath>: `/testapp/Action.mvc`<br>* <xref:System.Web.HttpRequest.PathInfo>: `SomeAction` | Busque en el código los lugares en los que las propiedades de la clase <xref:System.Web.HttpRequest> deben devolver información de la ruta de acceso y cambie el código de modo que refleje los cambios en la manera en que se devuelve la información de la ruta de acceso. |
| **Validación de solicitudes** | Para mejorar la validación de solicitudes, la validación de solicitudes de ASP.NET se invoca antes en el ciclo de vida de la solicitud. Como resultado, la validación de solicitudes se ejecuta para las solicitudes que no son de archivos .aspx, como las llamadas al servicio web y los controladores personalizados. La validación de solicitudes también estará activa cuando se ejecuten módulos HTTP personalizados en la canalización de procesamiento de solicitudes.<br><br>Como resultado de este cambio, las solicitudes de recursos que no sean archivos .aspx podrían producir errores de validación de solicitudes. El código personalizado que se ejecuta en la canalización de solicitud (por ejemplo, los módulos HTTP personalizados) también podría producir errores de validación de solicitudes. | Si es necesario, puede revertir al comportamiento anterior, en el que solo las páginas .aspx desencadenan la validación de solicitudes. Para ello, use el valor siguiente en el archivo de configuración web:<br><br>`<httpRuntime requestValidationMode="2.0" />`<br><br>Advertencia: Si revierte al comportamiento anterior, asegúrese de que todo el código de los controladores, los módulos y el resto de código personalizado realice comprobaciones en busca de las entradas HTTP potencialmente no seguras que podrían ser vectores de ataque XSS. |
| **Enrutamiento** | Si crea un sitio web del sistema de archivos en Visual Studio 2010 y dicho sitio web se encuentra en una carpeta que contiene un punto (.) en el nombre de carpeta, el enrutamiento de direcciones URL no funcionará de forma confiable. Se devolverá un error HTTP 404 desde algunas rutas de acceso virtuales. Esto se debe a que Visual Studio 2010 inicia el Servidor de desarrollo de Visual Studio mediante una ruta de acceso incorrecta para el directorio virtual raíz. | * En la página **Propiedades** del sitio web basado en archivos, cambie el atributo **Virtual Path** a "/".<br><br>o bien<br><br>* Cree un proyecto de aplicación web en lugar de un proyecto de sitio web. Los proyectos de aplicación web no tienen este problema, y el enrutamiento de direcciones URL funciona incluso si el nombre de la carpeta del proyecto tiene un punto.<br><br>o bien<br><br>* Cree un sitio web basado en HTTP que se hospede en IIS. Los sitios web hospedados en IIS pueden tener puntos en la ruta de acceso virtual, así como en la carpeta de archivos de proyecto. |
| **Sitios de SharePoint** | Si intenta ejecutar un sitio web de ASP.NET 4 que se implementa como un elemento secundario de un sitio web de SharePoint que contiene un nivel de confianza parcial personalizado denominado `WSS_Minimal`, verá el siguiente error:<br><br>`Could not find permission set named 'ASP.Net'.` | Actualmente, ninguna versión de SharePoint es compatible con ASP.NET. Como resultado, no debe intentar ejecutar un sitio web de ASP.NET 4 como un elemento secundario de un sitio web de SharePoint. |
| **Estándares de XHTML 1.1** | Para habilitar el cumplimiento de XHTML 1.1 en los nuevos sitios web, los controles de ASP.NET en .NET Framework 4 generarán código HTML compatible con XHTML 1.1. Esta representación se habilita mediante la opción siguiente en el archivo Web.config dentro del elemento `<system.Web>`:<br><br>`<pages controlRenderingCompatibilityVersion="4.0"/>`<br><br>Esta opción está establecida de forma predeterminada en 4.0. Los proyectos web que se actualizan desde Visual Studio 2008 tienen habilitado el valor 3.5 para la compatibilidad. | Ninguno. |

## <a name="core"></a>Principal

### <a name="general-features"></a>Características generales

| Característica | Diferencias respecto a 3.5 SP1 | Cambios recomendados |
| ------- | ------------------------ | ------------------- |
| **CardSpace** | Ya no se incluye Windows CardSpace en .NET Framework, sino que se proporciona por separado. | Descargue Windows CardSpace desde el [Centro de descarga de Microsoft](https://go.microsoft.com/fwlink/?LinkId=199868). |
| **Archivos de configuración** | Se han efectuado correcciones en el modo en que .NET Framework obtiene acceso a los archivos de configuración de la aplicación. | Si su archivo de configuración de la aplicación se denomina *application-name.config*, cambie el nombre a *application-name.exe.config*. Por ejemplo, cambie el nombre de *MyApp.config* a *MyApp.exe.config*. |
| **Compilador de código de C#** | Las clases `Compiler`, `CompilerError` y `ErrorLevel` que se encontraban en el espacio de nombres <xref:Microsoft.CSharp> ya no están disponibles y su ensamblado (cscompmgd.dll) ya no se incluye en .NET Framework. | Use la clase <xref:System.CodeDom.Compiler.CodeDomProvider> y otras clases en el espacio de nombres <xref:System.CodeDom.Compiler>. Para obtener más información, vea [Usar CodeDOM](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/y2k85ax6%28v=vs.100%29). |
| **Hospedaje** (API no administrada) | Para mejorar las capacidades de hospedaje, algunas de las API de activación de hospedaje han quedado en desuso. Las características de ejecución en paralelo en proceso permiten que una aplicación cargue e inicie varias versiones de .NET Framework en el mismo proceso. Por ejemplo, puede ejecutar aplicaciones que carguen complementos (o componentes) basados en .NET Framework 2.0 SP1 y complementos basados en .NET Framework 4 en el mismo proceso. Los componentes anteriores seguirán usando la versión anterior de .NET Framework y los componentes nuevos usarán la versión nueva de .NET Framework. | Use las configuraciones descritas en [Ejecución en paralelo y en proceso](../deployment/in-process-side-by-side-execution.md). |
| **Nuevo modelo de seguridad** | La directiva de seguridad de acceso del código (CAS) se ha desactivado y se ha reemplazado por un modelo simplificado, como se describe en [Cambios de seguridad en .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd233103%28v=vs.100%29). | Puede que deba realizar modificaciones si depende de CAS en sus aplicaciones. Para obtener más información, vea [Compatibilidad con la directiva de seguridad de acceso del código y migración](../misc/code-access-security-policy-compatibility-and-migration.md). |

### <a name="date-and-time"></a>Fecha y hora

Espacio de nombres: <xref:System>; ensamblado: mscorlib (en mscorlib.dll)

| Característica | Diferencias respecto a 3.5 SP1 | Cambios recomendados |
| ------- | ------------------------ | ------------------- |
| **Horario de verano** | Para ser coherentes con el reloj del sistema, las propiedades de tiempo (como <xref:System.TimeZoneInfo.Local> y <xref:System.DateTime.Now>) ahora usan las reglas del sistema operativo, en lugar de otros datos de .NET Framework, para las operaciones de horario de verano. | Ninguno. |
| **Aplicar formato a cadenas** | Para admitir el formato que tiene en cuenta la referencia cultural, la estructura <xref:System.TimeSpan> incluye nuevas sobrecargas de los métodos `ToString`, `Parse` y `TryParse`, además de los nuevos métodos `ParseExact` y `TryParseExact`. | Ninguno. |

### <a name="globalization"></a>Globalización

Para obtener una lista de las nuevas referencias culturales neutras y específicas, vea [Novedades de la globalización y localización](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd997383%28v=vs.100%29).

Espacio de nombres: <xref:System.Globalization>; ensamblado: mscorlib (en mscorlib.dll)

| Característica | Diferencias respecto a 3.5 SP1 | Cambios recomendados |
| ------- | ------------------------ | ------------------- |
| **Nombres de referencias culturales** | Los cambios de nombre siguientes afectan a las referencias culturales de alemán, divehi y afrikáans:<br><br>* <xref:System.Globalization.CultureAndRegionInfoBuilder.CurrencyEnglishName>: el nombre de la moneda de la referencia cultural de alemán (Suiza) (de-CH) ha cambiado de "sFr." a "Fr.".<br>* <xref:System.Globalization.DateTimeFormatInfo.LongDatePattern>: el patrón de fecha larga de la referencia cultural de divehi (Maldivas) (dv-MV) ha cambiado de "dd/MMMM/aaaa" a "dd/MM/aaaa".<br>* <xref:System.Globalization.DateTimeFormatInfo.PMDesignator>: el designador P.M. de la referencia cultural de afrikáans (Sudáfrica) (af-ZA) ha cambiado de "nm" a "PM". | Tenga en cuenta los cambios en los nombres de las referencias culturales. |
| **Parámetro LCID** | Para ser coherente con el comportamiento esperado en la configuración del servidor de automatización, CLR ya no pasa la referencia cultural actual para el parámetro `LCID` a las aplicaciones basadas en COM no administradas. En su lugar, pasa 1033 (en-us) para la referencia cultural. | No es necesaria ninguna modificación, excepto para las aplicaciones nativas que requieren una referencia cultural específica. |
| **Tipos de referencia cultural obsoletos** | Los tipos de referencia cultural <xref:System.Globalization.CultureTypes> y <xref:System.Globalization.CultureTypes> están obsoletos.<br><br>Para garantizar la compatibilidad con versiones anteriores, <xref:System.Globalization.CultureTypes> ahora devuelve las referencias culturales neutras y específicas incluidas en la versión anterior de .NET Framework, y <xref:System.Globalization.CultureTypes> ahora devuelve una lista vacía. | Use otros valores de la enumeración <xref:System.Globalization.CultureTypes>. |
| **Recuperar la referencia cultural** | A partir de Windows 7, .NET Framework 4 recupera la información de referencia cultural del sistema operativo, en lugar de almacenar los datos. Además, .NET Framework se sincroniza con Windows para ordenar los datos y aplicarles mayúsculas y minúsculas. | Ninguno. |
| **Estándares de Unicode 5.1** | Ahora, .NET Framework admite todos los caracteres de Unicode 5.1, lo que supone aproximadamente 1400 caracteres más. Entre los caracteres adicionales se incluyen nuevos símbolos, flechas, marcas diacríticas, puntuación, símbolos matemáticos, ideogramas y trazos de CJK, caracteres numéricos adicionales de malayalam y telugu, y varios caracteres de birmano, latino, árabe, griego, mongol y cirílico. Los nuevos scripts siguientes son compatibles con Unicode 5.1: caracteres de sundanés, lepcha, ol chiki, vai, saurashtra, kayah li, rejang, gurmukhi, odia, tamil, telugu, malayalam y cham. | Ninguno. |

### <a name="exceptions"></a>Excepciones

Espacios de nombres: <xref:System>, <xref:System.Runtime.ExceptionServices>; ensamblado: mscorlib (en mscorlib.dll)

| Característica | Diferencias respecto a 3.5 SP1 | Cambios recomendados |
| ------- | ------------------------ | ------------------- |
| **Excepciones para el estado de proceso dañado** | CLR ya no entrega excepciones para el estado de proceso dañado a controladores de excepciones en código administrado. | Estas excepciones indican que el estado de un proceso está dañado. No se recomienda ejecutar la aplicación en este estado.<br><br>Para obtener más información, vea <xref:System.Runtime.ExceptionServices.HandleProcessCorruptedStateExceptionsAttribute> y la entrada [Controlar excepciones de estado dañado](https://docs.microsoft.com/archive/msdn-magazine/2009/february/clr-inside-out-handling-corrupted-state-exceptions) en MSDN Magazine. |
| **Excepciones del motor de ejecución** | <xref:System.ExecutionEngineException> está ahora obsoleto, ya que una excepción detectable permitirá que un proceso inestable siga ejecutándose. Este cambio mejora la previsibilidad y la confiabilidad en el tiempo de ejecución. | Use <xref:System.InvalidOperationException> para indicar la condición. |

### <a name="reflection"></a>Reflexión

Espacio de nombres: <xref:System.Reflection>; ensamblado: mscorlib (en mscorlib.dll)

| Característica | Diferencias respecto a 3.5 SP1 | Cambios recomendados |
| ------- | ------------------------ | ------------------- |
| **Algoritmos hash de ensamblado** | La propiedad <xref:System.Reflection.AssemblyName.HashAlgorithm> ahora devuelve <xref:System.Configuration.Assemblies.AssemblyHashAlgorithm>, ya que el tiempo de ejecución no conoce el algoritmo hash del ensamblado al que se hace referencia cuando no carga el ensamblado. (Esto se refiere al uso de la propiedad en un ensamblado de referencia como el devuelto por el método <xref:System.Reflection.Assembly.GetReferencedAssemblies%2A>). | Ninguno. |
| **Carga de ensamblados** | Para evitar la carga redundante de ensamblados y ahorrar espacio de direcciones virtuales, CLR ahora carga los ensamblados únicamente mediante la función `MapViewOfFile` de Win32. Ya no llama también a la función `LoadLibrary`.<br><br>Este cambio afecta a las aplicaciones de diagnóstico de las maneras siguientes:<br><br>* <xref:System.Diagnostics.ProcessModuleCollection> ya no contendrá módulos de una biblioteca de clases (archivo .dll), que se obtienen de una llamada a `Process.GetCurrentProcess().Modules`.<br>* Las aplicaciones de Win32 que usan la función `EnumProcessModules` no podrán visualizar una enumeración de todos los módulos administrados. | Ninguno. |
| **Tipo declarativo** | La propiedad <xref:System.Type.DeclaringType> ahora devuelve null correctamente cuando el tipo no tiene un tipo declarativo. | Ninguno. |
| **Delegados** | Un delegado ahora produce una <xref:System.ArgumentNullException> en lugar de una <xref:System.NullReferenceException> cuando se pasa un valor null al constructor del delegado. | Asegúrese de que el control de excepciones capture <xref:System.ArgumentNullException>. |
| **Cambio en la ubicación de la caché global de ensamblados** | En el caso de los ensamblados de .NET Framework 4, la caché global de ensamblados se ha movido del directorio de Windows (%WINDIR%) al subdirectorio de Microsoft.Net ( *%WINDIR%\\Microsoft.Net*). Los ensamblados de las versiones anteriores permanecen en el directorio anterior.<br><br>La enumeración [ASM_CACHE_FLAGS](../unmanaged-api/fusion/asm-cache-flags-enumeration.md) no administrada contiene la nueva marca `ASM_CACHE_ROOT_EX`. Esta marca obtiene la ubicación de la caché de los ensamblados de .NET Framework 4, que puede obtenerse mediante la función [GetCachePath](../unmanaged-api/fusion/getcachepath-function.md). | Ninguno, siempre y cuando las aplicaciones no usen rutas de acceso explícitas a los ensamblados, lo que no se recomienda. |
| **Herramienta Caché global de ensamblados** | La [herramienta Caché global de ensamblados (Gacutil.exe)](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ex0ss12c%28v=vs.100%29) ya no es compatible con el visor de complementos de shell. | Ninguno. |

### <a name="interoperability"></a>Interoperabilidad

Espacio de nombres: <xref:System.Runtime.InteropServices>; ensamblado: mscorlib (en mscorlib.dll)

| Característica | Diferencias respecto a 3.5 SP1 | Cambios recomendados |
| ------- | ------------------------ | ------------------- |
| **Longitud del búfer** (API no administrada) | Para ahorrar memoria, la funcionalidad del parámetro `pBufferLengthOffset` para el método [ICorProfilerInfo2::GetStringLayout](../unmanaged-api/profiling/icorprofilerinfo2-getstringlayout-method.md) ha cambiado para que coincida con el parámetro `pStringLengthOffset`. Ambos parámetros ahora apuntan a la ubicación de desplazamiento de la longitud de la cadena. La longitud del búfer se ha quitado de la representación de la clase String. | Quite todas las dependencias de la longitud del búfer. |
| **Depuración JIT** | Para simplificar el registro de la depuración Just-In-Time (JIT), el depurador de .NET Framework ahora solo usa la clave del Registro AeDebug, que controla el comportamiento de la depuración JIT para el código nativo. Este cambio tiene como resultado lo siguiente:<br><br>* Ya no se pueden registrar dos depuradores diferentes para el código administrado y nativo.<br>* Ya no se puede iniciar el depurador automáticamente para un proceso no interactivo, pero se le puede preguntar al usuario en caso de un proceso interactivo.<br>* Ya no se notificará cuando el depurador no se inicie o cuando no haya un depurador registrado que se debe iniciar.<br>* Las directivas de inicio automático que dependen de la interactividad de la aplicación ya no se admiten. | Ajuste las operaciones de depuración según sea necesario. |
| **Invocación de plataforma** | Ahora, para mejorar el rendimiento de la interoperabilidad con código no administrado, las convenciones de llamada incorrectas en una invocación de plataforma hacen que la aplicación no funcione correctamente. En versiones anteriores, la capa de serialización resolvía estos errores hacia arriba en la pila. | Cuando depure las aplicaciones en Microsoft Visual Studio, se le avisará de estos errores para que pueda corregirlos.<br><br>Si tiene archivos binarios que no se pueden actualizar, puede incluir el elemento [\<NetFx40_PInvokeStackResilience>](../configure-apps/file-schema/runtime/netfx40-pinvokestackresilience-element.md) en el archivo de configuración de la aplicación para permitir que los errores de llamada se resuelvan hacia arriba en la pila, como en las versiones anteriores. Aun así, esto puede afectar al rendimiento de la aplicación. |
| **Interfaces eliminadas** (API no administrada) | Para evitar confusiones a los desarrolladores, se han quitado las interfaces siguientes porque no proporcionaban escenarios útiles en tiempo de ejecución y CLR no proporcionaba o no aceptaba implementaciones:<br><br>* **INativeImageINativeImageDependency**<br>* **INativeImageInstallInfo**<br>* **INativeImageEvaluate**<br>* **INativeImageConverter**<br>* **ICorModule**<br>* **IMetaDataConverter** | Ninguno. |

## <a name="data"></a>Datos

En esta sección se describen los problemas de migración al usar conjuntos de datos y los clientes SQL, Entity Framework, LINQ to SQL y Servicios de datos de WCF (antes conocido como ADO.NET Data Services).

### <a name="dataset-and-sql-client"></a>DataSet y el cliente SQL

En la tabla siguiente se describen las mejoras en las características que antes tenían limitaciones u otros problemas.

Espacios de nombres: <xref:System.Data>, <xref:System.Data.Objects.DataClasses>, <xref:System.Data.SqlClient>; ensamblados: System.Data (en System.Data.dll), System.Data.Entity (en System.Data.Entity.dll)

| Característica | Diferencias respecto a 3.5 SP1 |
| ------- | ------------------------ |
| **Escenarios POCO** | La interfaz <xref:System.Data.Objects.DataClasses.IRelatedEnd> tiene nuevos métodos para mejorar su uso en escenarios POCO (objeto CLR estándar). Estos nuevos métodos toman como parámetro una entidad <xref:System.Object> en lugar de una entidad <xref:System.Data.Objects.DataClasses.IEntityWithRelationships>. |
| **Edición de filas** | El método <xref:System.Collections.IList.IndexOf%2A>, tal como lo implementa la clase <xref:System.Data.DataView>, ahora devuelve correctamente el valor de una fila que se está editando, en lugar de devolver -1. |
| **Eventos** | Ahora se genera el evento <xref:System.Data.DataRowView.PropertyChanged> cuando una fila se encuentra en un estado modificado y se llama al método <xref:System.Data.DataRow.RejectChanges%2A>. Este cambio hace más fácil crear controles de interfaz de usuario que exponen el contenido de un objeto <xref:System.Data.DataSet>. |
| **Excepciones** | El método <xref:System.Data.SqlClient.SqlCommand.Prepare%2A> ahora produce una <xref:System.InvalidOperationException> cuando una conexión no se establece o no se abre, en lugar de una <xref:System.NullReferenceException>. |
| **Vistas de asignación** | Los errores de asignación de vistas de consulta ahora se detectan en tiempo de diseño, en lugar de producir una <xref:System.NullReferenceException> en tiempo de ejecución.<br><br>La validación de asignación ahora detecta el error que hace que se asignen dos conjuntos de asociaciones del esquema conceptual (CSDL) a la misma columna. |
| **Transacciones** | Si una aplicación intenta ejecutar una instrucción en una conexión después de que se haya completado una transacción (incluido si se ha anulado o revertido), ahora se produce una <xref:System.InvalidOperationException>. En las versiones anteriores no se producía una excepción y se podían ejecutar comandos adicionales, incluso en caso de que se anulase una transacción. |

### <a name="entity-framework"></a>Entity Framework

En la tabla siguiente se describen las mejoras en las características que antes tenían limitaciones u otros problemas.

Espacios de nombres: <xref:System.Data>, <xref:System.Data.Objects>, <xref:System.Data.Objects.DataClasses>; ensamblado: System.Data.Entity (en System.Data.Entity.dll)

| Característica | Diferencias respecto a 3.5 SP1 |
| ------- | ------------------------ |
| **Objetos de entidad** | Ahora hay paridad entre el método <xref:System.Data.Objects.ObjectContext.Detach%2A> y el estado del objeto de entidad cuando se llama al método <xref:System.Data.Objects.ObjectContext.SaveChanges%2A>. Esta coherencia mejorada evita que se produzcan excepciones inesperadas. |
| **Entity SQL** | Se han mejorado las reglas para las resoluciones de identificadores de Entity SQL.<br><br>El analizador de Entity SQL ha mejorado la lógica para resolver identificadores con varias partes. |
| **Anotaciones estructurales** | Entity Framework ahora reconoce las anotaciones estructurales. |
| **Consultas** | Se han realizado las siguientes mejoras en las consultas:<br><br>* Las consultas `GroupBy` que usan una clave NULL en una colección vacía no devolverán ninguna fila, independientemente de si hay selecciones adicionales en la consulta.<br>* El código SQL generado en consultas LINQ y Entity SQL ahora tratan los parámetros de cadena como valores no Unicode de forma predeterminada. |

### <a name="linq-to-sql"></a>LINQ to SQL

En la tabla siguiente se describen las mejoras en las características que antes tenían limitaciones u otros problemas.

Espacio de nombres: <xref:System.Data.Linq>; ensamblado: System.Data.Linq (en System.Data.Linq.dll)

| Característica | Diferencias respecto a 3.5 SP1 |
| ------- | ------------------------ |
| **Eventos** | Una colección <xref:System.Data.Linq.EntitySet%601> ahora genera el evento <xref:System.Data.Linq.EntitySet%601.ListChanged> para agregar y suprimir operaciones si <xref:System.Data.Linq.EntitySet%601> no se ha cargado. También genera este evento cuando la colección está cargada. |
| **Consultas** | `Skip(0)` ya no se omite en las consultas de LINQ to SQL. Como resultado, las consultas que tienen este método pueden comportarse de manera diferente. Por ejemplo, en algunos casos, se requiere una cláusula `OrderBy` con `Skip(0)`, y ahora la consulta producirá una excepción <xref:System.NotSupportedException> si la cláusula `OrderBy` no se ha incluido. |

### <a name="wcf-data-services"></a>Servicios de datos de WCF

En la tabla siguiente se describen las mejoras en las características que antes tenían limitaciones u otros problemas.

Espacios de nombres: <xref:System.Data.Services>, <xref:System.Data.Services.Client>, <xref:System.Data.Services.Common>, <xref:System.Data.Services.Providers>; ensamblados: System.Data.Services (en System.Data.Services.dll), System.Data.Services.Client (en System.Data.Services.Client.dll)

| Característica | Diferencias respecto a 3.5 SP1 |
| ------- | ------------------------ |
| **Contenido binario por lotes** | Servicios de datos de WCF admite ahora contenido binario por lotes en las solicitudes y las respuestas. |
| **Interceptores de cambios** | Ahora se ejecutan interceptores de cambios para una solicitud de eliminación.<br><br>Un interceptor de cambios es un método que se ejecuta cada vez que el servidor recibe una solicitud para modificar una entidad del conjunto de entidades. Se ejecuta antes de que se ejecute la solicitud entrante. El interceptor de cambios proporciona acceso a la entidad que se va a cambiar y a la operación que se realiza en él. |
| **Excepciones** | Las condiciones siguientes ahora producen excepciones más útiles, en lugar de una <xref:System.NullReferenceException>:<br><br>* Una <xref:System.ServiceProcess.TimeoutException> cuando se agota el tiempo de espera de una llamada a un servicio de datos.<br>* Una <xref:System.Data.Services.Client.DataServiceRequestException> cuando se realiza una solicitud incorrecta a un servicio de datos.<br><br>En las aplicaciones, debe cambiar el control de excepciones para que detecte las nuevas excepciones. |
| **Encabezados** | Se han realizado las siguientes mejoras en los encabezados:<br><br>* Servicios de datos de WCF ahora rechaza correctamente los encabezados `eTag` que tengan un valor no especificado.<br>* Servicios de datos de WCF ahora devuelve un error y no ejecuta una solicitud de eliminación a un vínculo cuando hay un encabezado `if-*` en la solicitud.<br>* Servicios de datos de WCF ahora devuelve un error al cliente en el formato (Atom, JSON) que el cliente haya especificado en el encabezado Accept. |
| **Lector JSON** | El lector de Notación de objetos JavaScript (JSON) ahora devuelve correctamente un error cuando lee el carácter de escape de barra diagonal inversa única ("\\") al procesar cargas de JSON enviadas a Servicios de datos de WCF. |
| **Combinaciones** | Se han realizado las siguientes mejoras en la enumeración <xref:System.Data.Services.Client.MergeOption>:<br><br>* La opción de combinación <xref:System.Data.Services.Client.MergeOption> ya no modifica la entidad en el cliente como resultado de una respuesta subsiguiente de un servicio de datos.<br>* La opción <xref:System.Data.Services.Client.MergeOption> ahora es coherente entre SQL dinámico y las actualizaciones basadas en procedimientos almacenados. |
| **Solicitudes** | La llamada al método <xref:System.Data.Services.DataService%601.OnStartProcessingRequest%2A> ahora se realiza antes de procesar una solicitud a los servicios de datos. Esto permite que la solicitud funcione correctamente para los servicios <xref:System.Data.Services.Providers.ServiceOperation>. |
| **Secuencias** | Servicios de datos de WCF ya no cierra la secuencia subyacente para las operaciones de lectura y escritura. |
| **URI** | Se han corregido las secuencias de escape de los URI del cliente de Servicios de datos de WCF. |

## <a name="windows-communication-foundation-wcf"></a>Windows Communication Foundation (WCF)

En la tabla siguiente se describen las mejoras en las características que antes tenían limitaciones u otros problemas.

| Característica | Diferencias respecto a 3.5 SP1 |
| ------- | ------------------------ |
| **Archivos de configuración** | Para habilitar la herencia de comportamientos mediante la jerarquía de archivos de configuración, WCF ahora permite combinar archivos de configuración.<br><br>El modelo de herencia de configuración se ha ampliado para permitir que los usuarios definan los comportamientos que se aplicarán a todos los servicios que se ejecutan en el equipo.<br><br>Puede encontrar cambios de comportamiento si hay comportamientos con el mismo nombre en distintos niveles de la jerarquía. |
| **Hospedaje de servicios** | Ya no se puede especificar el elemento de configuración `<serviceHostingEnvironment>` en el nivel de servicio mediante la adición del atributo `allowDefinition="MachineToApplication"` a la definición de elemento.<br><br>La acción de especificar el elemento `<serviceHostingEnvironment>` en el nivel de servicio es técnicamente incorrecta y provoca un comportamiento incoherente. |

## <a name="windows-presentation-foundation-wpf"></a>Windows Presentation Foundation (WPF)

### <a name="applications"></a>Aplicaciones

Espacios de nombres: <xref:System.Windows>, <xref:System.Windows.Controls>; ensamblado: PresentationFramework (en PresentationFramework.dll)

| Característica | Diferencias respecto a 3.5 SP1 | Cambios recomendados |
| ------- | ------------------------ | ------------------- |
| **Control de excepciones** | Para que los errores se detecten antes, WPF produce una <xref:System.Reflection.TargetInvocationException> y establece la propiedad <xref:System.Exception.InnerException> en las excepciones críticas, como <xref:System.NullReferenceException>, <xref:System.OutOfMemoryException>, <xref:System.StackOverflowException> y <xref:System.Security.SecurityException>, en lugar de capturar la excepción original. | Ninguno. |
| **Recursos vinculados** | Para facilitar la vinculación, los archivos de recursos (como las imágenes) que se encuentran en una ubicación distinta de la estructura de carpetas del proyecto usan la ruta de acceso completa del archivo de recursos en lugar de simplemente su nombre de archivo como identificador de recurso cuando se compila la aplicación. La aplicación podrá encontrar los archivos en tiempo de ejecución. | Ninguno. |
| **Aplicaciones de confianza parcial** | Por motivos de seguridad, las aplicaciones basadas en Windows que se ejecutan en confianza parcial y contienen un control <xref:System.Windows.Controls.WebBrowser> o un control <xref:System.Windows.Controls.Frame> que contiene código HTML producirán una <xref:System.Security.SecurityException> cuando se cree el control.<br><br>Las aplicaciones de explorador producirán una excepción y mostrarán un mensaje si se cumplen todas las condiciones siguientes:<br><br>* La aplicación se ejecuta en Firefox.<br>* La aplicación se ejecuta en confianza parcial en la zona de Internet desde sitios que no son de confianza.<br>* La aplicación contiene un control <xref:System.Windows.Controls.WebBrowser> o un control <xref:System.Windows.Controls.Frame> que contiene código HTML.<br><br>Tenga en cuenta que las aplicaciones que se ejecutan desde sitios de confianza o desde la zona de intranet no se verán afectadas. | En las aplicaciones de explorador, puede mitigar este cambio. Para ello, lleve a cabo una de las acciones siguientes:<br><br>* Ejecute la aplicación de explorador en plena confianza.<br>* Haga que los clientes agreguen el sitio de la aplicación a la zona de sitios de confianza.<br>* Haga que los clientes ejecuten la aplicación en Internet Explorer. |
| **Diccionarios de recursos** | Para mejorar los diccionarios de recursos de nivel de tema e impedir que cambien, los recursos inmovilizables que se definen en un diccionario de recursos y se combinan en un diccionario de nivel de tema ahora siempre están marcados como inmovilizados y son inmutables. Este es el comportamiento esperado para los recursos inmovilizables. | Las aplicaciones que modifican un recurso definido en un diccionario combinado de nivel de tema deben clonar el recurso y modificar la copia clonada. Como alternativa, se puede marcar el recurso como `x:Shared="false"` para que <xref:System.Windows.ResourceDictionary> cree una copia cada vez que se consulte el recurso. |
| **Windows 7** | Para que las aplicaciones de WPF funcionen mejor en Windows 7, se han realizado las siguientes mejoras para corregir el comportamiento de una ventana:<br><br>* Los estados de acoplar y gestos ahora funcionan según lo esperado en función de las interacciones del usuario.<br>* Los comandos de la barra de tareas **Ventanas en cascada, Mostrar ventanas apiladas** y **Mostrar ventanas en paralelo** ahora tienen el comportamiento correcto y actualizan las propiedades adecuadas.<br>* Las propiedades `Top`, `Left`, `Width` y `Height` de una ventana maximizada o minimizada contienen ahora la ubicación de restauración correcta de la ventana en lugar de otros valores, según el monitor. | Ninguno. |
| **Estilo de Windows y transparencia** | Se produce una <xref:System.InvalidOperationException> si se intenta establecer <xref:System.Windows.Window.WindowStyle> en un valor distinto de <xref:System.Windows.WindowStyle> cuando <xref:System.Windows.Window.AllowsTransparency> es `true` y <xref:System.Windows.WindowState> es <xref:System.Windows.WindowState>. | Si necesita cambiar <xref:System.Windows.Window.WindowStyle> cuando <xref:System.Windows.Window.AllowsTransparency> es `true`, puede llamar a la función `SetWindowLongPtr` de Win32. |
| **Visor de XPS** | WPF no incluye Microsoft XML Paper Specification Essentials Pack (XPSEP). XPSEP se incluye con Windows 7 y Windows Vista.<br><br>En un equipo que ejecuta Windows XP sin .NET Framework 3.5 SP1 instalado, la acción de imprimir mediante una API de WPF distinta de <xref:System.Windows.Controls.PrintDialog> se basará en WINSPOOL. No se notificarán algunas funciones de la impresora y no se aplicarán algunos valores de configuración de la impresora durante la impresión. | Si es necesario, instale [Microsoft XML Paper Specification Essentials Pack](https://go.microsoft.com/fwlink/?LinkId=178895). |

### <a name="controls"></a>Controles

Espacios de nombres: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>; ensamblados: PresentationFramework (en PresentationFramework.dll), PresentationCore (en PresentationCore.dll), WindowsBase (en WindowsBase.dll)

| Característica | Diferencias respecto a 3.5 SP1 | Cambios recomendados |
| ------- | ------------------------ | ------------------- |
| **Cuadros de diálogo** | Para mejorar la confiabilidad, se llama al método <xref:Microsoft.Win32.CommonDialog.ShowDialog%2A> en el mismo subproceso que ha creado el control <xref:Microsoft.Win32.FileDialog>. | Asegúrese de crear un control <xref:Microsoft.Win32.FileDialog> y llamar al método <xref:Microsoft.Win32.CommonDialog.ShowDialog%2A> en el mismo subproceso. |
| **Ventanas flotantes** | Para corregir la lógica de restauración del foco que reactiva incorrectamente una ventana flotante (lo que hace que parezca un cuadro de diálogo modal), ahora se impide la restauración del foco si el candidato no es un elemento secundario de la ventana. | Ninguno. |
| **Elementos de colecciones** | Cuando un elemento se mueve o se agrega a una colección subyacente, aparece en <xref:System.Windows.Data.CollectionView> en la misma ubicación relativa si <xref:System.Windows.Data.CollectionView> no está ordenada. Esto proporciona coherencia entre la posición del elemento en la colección y la <xref:System.Windows.Data.CollectionView> asociada. | Use el método <xref:System.Windows.Controls.ItemContainerGenerator.ContainerFromItem%2A> o <xref:System.Windows.Data.CollectionView.IndexOf%2A> para buscar la ubicación de un elemento en <xref:System.Windows.Data.CollectionView>, en lugar de depender de una ubicación fija de un elemento. |
| **Diseños** | Para eliminar la realización innecesaria de nuevos diseños, la acción de cambiar <xref:System.Windows.Controls.Page.ShowsNavigationUI> ya no invalida el diseño ni provoca otro cálculo de diseño. | Si espera que se provoque otro cálculo de diseño al cambiar <xref:System.Windows.Controls.Page.ShowsNavigationUI>, llame a <xref:System.Windows.UIElement.InvalidateVisual%2A> después de establecer la propiedad. |
| **Menús** | Para habilitar texto ClearType en menús emergentes, se han realizado modificaciones en la clase <xref:System.Windows.Controls.ControlTemplate> y en el control <xref:System.Windows.Controls.MenuItem> y en otros controles. | Las aplicaciones no deben depender de la estructura visual de las plantillas de control. Solo los elementos con nombre de <xref:System.Windows.Controls.ControlTemplate> forman parte del contrato público. Si una aplicación debe encontrar un objeto determinado en <xref:System.Windows.Controls.ControlTemplate>, busque en el árbol visual un tipo específico, en lugar de depender de una ubicación fija de un objeto en el árbol. |
| **Navegación** | Si <xref:System.Windows.Controls.Frame> navega directamente a una ubicación, la propiedad <xref:System.Windows.Navigation.NavigatingCancelEventArgs.IsNavigationInitiator> es `true` después de la navegación inicial. Este cambio impide que se produzcan eventos adicionales durante los escenarios de arranque. | Ninguno. |
| **Elementos emergentes** | Ahora se puede llamar al delegado <xref:System.Windows.Controls.Primitives.CustomPopupPlacementCallback> varias veces durante un cálculo de diseño, en lugar de una sola vez. | Si su delegado <xref:System.Windows.Controls.Primitives.CustomPopupPlacementCallback> calcula la posición de un elemento <xref:System.Windows.Controls.Primitives.Popup> en función de su posición anterior, vuelva a calcular la posición únicamente si los valores de los parámetros `popupSize`, `targetSize` o `offset` cambian. |
| **Valores de propiedades** | El método <xref:System.Windows.DependencyObject.SetCurrentValue%2A> ahora le permite establecer una propiedad en un valor efectivo, aunque sigue respetando todos los enlaces, estilos o desencadenadores que afecten a la propiedad. | Los autores de controles deben usar <xref:System.Windows.DependencyObject.SetCurrentValue%2A> siempre que el valor de propiedad cambie como efecto secundario de otra acción, incluida la manipulación por parte del usuario. |
| **Cuadros de texto** | Por motivos de seguridad, se produce un error de manera silenciosa en los métodos <xref:System.Windows.Forms.TextBoxBase.Copy%2A> y <xref:System.Windows.Forms.TextBoxBase.Cut%2A> cuando se les llama en confianza parcial.<br><br>Además, la ejecución mediante programación de la propiedad <xref:System.Windows.Input.ApplicationCommands.Copy> o <xref:System.Windows.Input.ApplicationCommands.Cut> en un control que herede de <xref:System.Windows.Controls.Primitives.TextBoxBase> se bloqueará en confianza parcial. Esto no impedirá que funcionen los comandos de copiar y cortar iniciados por el usuario, como hacer clic en un botón cuya propiedad <xref:System.Windows.Controls.Primitives.ButtonBase.Command> está enlazada a uno de estos comandos. La acción estándar de copiar y cortar mediante métodos abreviados de teclado y el menú contextual seguirá funcionando como antes en confianza parcial. | Enlace el comando <xref:System.Windows.Input.ApplicationCommands.Copy> o <xref:System.Windows.Input.ApplicationCommands.Cut> a una acción iniciada por el usuario, como hacer clic en un botón. |

### <a name="graphics"></a>Gráficos

Espacios de nombres: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>, <xref:System.Windows.Media.Effects>; ensamblados: PresentationFramework (en PresentationFramework.dll), PresentationCore (en PresentationCore.dll), WindowsBase (en WindowsBase.dll)

| Característica | Diferencias respecto a 3.5 SP1 | Cambios recomendados |
| ------- | ------------------------ | ------------------- |
| **Efectos de imagen** | Para mejorar el rendimiento, la clase <xref:System.Windows.Media.Effects.BitmapEffect> y las clases que heredan de la clase <xref:System.Windows.Media.Effects.BitmapEffect>, aunque siguen presentes, están deshabilitadas. El efecto se representará mediante el uso de la canalización de representación acelerada por hardware si se cumplen las condiciones siguientes:<br><br>* La aplicación usa una clase <xref:System.Windows.Media.Effects.DropShadowBitmapEffect> o <xref:System.Windows.Media.Effects.BlurBitmapEffect> que tenga una propiedad de radio establecida en menos de 100 DIU.<br>* La tarjeta de vídeo del equipo que ejecuta la aplicación es compatible con el sombreador de píxeles 2.0.<br><br>Si no se cumplen estas condiciones, los objetos <xref:System.Windows.Media.Effects.BitmapEffect> no tendrán ningún efecto.<br><br>Además, Visual Studio genera una advertencia del compilador cuando encuentra el objeto <xref:System.Windows.Media.Effects.BitmapEffect> o una subclase.<br><br>El método <xref:System.Windows.Media.DrawingContext.PushEffect%2A> está marcado como obsoleto. | Deje de usar el objeto <xref:System.Windows.Media.Effects.BitmapEffect> heredado y las clases derivadas y use en su lugar las nuevas clases derivadas de <xref:System.Windows.Media.Effects.Effect>: <xref:System.Windows.Media.Effects.BlurEffect>, <xref:System.Windows.Media.Effects.DropShadowEffect> y <xref:System.Windows.Media.Effects.ShaderEffect>.<br><br>También puede crear sus propios efectos. Para ello, herede de la clase <xref:System.Windows.Media.Effects.ShaderEffect>. |
| **Marcos de mapa de bits** | Los objetos <xref:System.Windows.Media.Imaging.BitmapFrame> clonados ahora reciben los eventos <xref:System.Windows.Media.Imaging.BitmapSource.DownloadProgress>, <xref:System.Windows.Media.Imaging.BitmapSource.DownloadCompleted> y <xref:System.Windows.Media.Imaging.BitmapSource.DownloadFailed>. Esto permite que las imágenes que se descargan de Internet y se aplican al control <xref:System.Windows.Controls.Image> mediante <xref:System.Windows.Style> funcionen correctamente.<br><br>Verá un cambio de comportamiento únicamente si se cumplen todas las instrucciones siguientes:<br><br>* Se suscribe al evento <xref:System.Windows.Media.Imaging.BitmapSource.DownloadProgress>, <xref:System.Windows.Media.Imaging.BitmapSource.DownloadCompleted> o <xref:System.Windows.Media.Imaging.BitmapSource.DownloadFailed>.<br>* El origen de <xref:System.Windows.Media.Imaging.BitmapFrame> está en Internet.<br>* <xref:System.Windows.Media.Imaging.BitmapFrame> se clona mientras la descarga aún está en curso. | Compruebe el remitente en el controlador de eventos y tome medidas solo si el remitente es el <xref:System.Windows.Media.Imaging.BitmapFrame> original. |
| **Descodificación de imágenes** | Para impedir que no se controle una <xref:System.IO.IOException> cuando las imágenes no se pueden descodificar, la clase <xref:System.Windows.Media.Imaging.BitmapSource> producirá el evento <xref:System.Windows.Media.Imaging.BitmapSource.DecodeFailed> cuando no descodifique una imagen. | Quite el control de excepciones de <xref:System.IO.IOException> y use el evento <xref:System.Windows.Media.Imaging.BitmapSource.DecodeFailed> para comprobar si se ha producido un error en la descodificación. |

### <a name="input"></a>Entrada

Espacios de nombres: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>; ensamblados: PresentationFramework (en PresentationFramework.dll), PresentationCore (en PresentationCore.dll), WindowsBase (en WindowsBase.dll)

| Característica | Diferencias respecto a 3.5 SP1 | Cambios recomendados |
| ------- | ------------------------ | ------------------- |
| **Enlazar instancias de comandos** | Para proporcionar un mecanismo para enlazar instancias de comandos basadas en el modelo de vista a gestos de entrada basados en vistas, la clase <xref:System.Windows.Input.InputBinding> ahora hereda de <xref:System.Windows.Freezable> en lugar de <xref:System.Windows.DependencyObject>. Ahora, las propiedades siguientes son propiedades de dependencia:<br><br>* <xref:System.Windows.Input.InputBinding.Command><br>* <xref:System.Windows.Input.InputBinding.CommandParameter><br>* <xref:System.Windows.Input.InputBinding.CommandTarget><br><br>Este cambio tiene como resultado lo siguiente:<br><br>* Los objetos <xref:System.Windows.Input.InputBinding> ahora se inmovilizan cuando se registran, en lugar de seguir siendo mutables.<br>* No se puede obtener acceso a objetos <xref:System.Windows.Input.InputBinding> de nivel de instancia desde varios subprocesos debido a las restricciones de la clase <xref:System.Windows.DependencyObject>.<br>* No se pueden modificar los enlaces de entrada de nivel de clase después de su registro debido a las restricciones de la clase <xref:System.Windows.Freezable>.<br>* No se pueden especificar enlaces de entrada en las instancias de comando que se crean en un modelo de vista. | Cree instancias independientes de una clase <xref:System.Windows.Input.InputBinding> en subprocesos independientes si los enlaces deben ser mutables. En caso contrario, inmovilícelos. No modifique una clase estática <xref:System.Windows.Input.InputBinding> de nivel de clase después de que se haya registrado. |
| **Aplicaciones de explorador** | Las aplicaciones de explorador WPF (.XBAP) ahora procesan los eventos clave exactamente igual que las aplicaciones de WPF independientes para que los objetos reciban los eventos clave enrutados en el orden correcto. | Ninguno. |
| **Combinaciones de teclas inactivas** | WPF ofusca las teclas inactivas, que no producen ningún carácter visible, pero indica que la tecla debe combinarse con la tecla de letra siguiente para generar un carácter. Los eventos de entrada de tecla, como el evento <xref:System.Windows.Input.Keyboard.KeyDownEvent>, notifican que una tecla es inactiva mediante el establecimiento de la propiedad <xref:System.Windows.Input.KeyEventArgs.Key> en el valor <xref:System.Windows.Input.Key>. Este suele ser el comportamiento esperado, ya que las aplicaciones normalmente no responden a la entrada de teclado que crea un carácter combinado. | Las aplicaciones que esperan leer teclas que formaban parte de caracteres combinados ahora pueden obtener la tecla ofuscada mediante la propiedad <xref:System.Windows.Input.KeyEventArgs.DeadCharProcessedKey>. |
| **Administrador de foco** | Cuando se pasa al método <xref:System.Windows.Input.FocusManager.GetFocusedElement(System.Windows.DependencyObject)?displayProperty=nameWithType> un elemento que tiene la propiedad adjunta [IsFocusScope](xref:System.Windows.Input.FocusManager.IsFocusScope%2A) establecida en `true`, el método devuelve un elemento que es el último elemento con el foco en el teclado dentro de ese ámbito del foco únicamente si el elemento devuelto pertenece al mismo objeto <xref:System.Windows.PresentationSource> que el elemento que se pasa al método. | Ninguno. |

### <a name="ui-automation"></a>Automatización de la interfaz de usuario

Espacios de nombres: <xref:System.Windows>, <xref:System.Windows.Automation.Peers>, <xref:System.Windows.Automation.Provider>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>; ensamblados: PresentationFramework (en PresentationFramework.dll), PresentationCore (en PresentationCore.dll), UIAutomationProvider (en UIAutomationProvider.dll), WindowsBase (en WindowsBase.dll)

| Característica | Diferencias respecto a 3.5 SP1 | Cambios recomendados |
| ------- | ------------------------ | ------------------- |
| **Jerarquía de clases de vistas** | Las clases <xref:System.Windows.Automation.Peers.TreeViewAutomationPeer> y <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer> heredan de <xref:System.Windows.Automation.Peers.ItemsControlAutomationPeer> en vez de <xref:System.Windows.Automation.Peers.FrameworkElementAutomationPeer>. | Si hereda de las clases <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer> e invalida el método <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer.GetChildrenCore%2A>, considere la posibilidad de devolver un objeto que herede de la nueva clase <xref:System.Windows.Automation.Peers.TreeViewDataItemAutomationPeer>. |
| **Contenedores fuera de la pantalla** | Para corregir un valor devuelto incorrecto, el método <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.IsOffscreenCore%2A> ahora devuelve correctamente `false` para los contenedores de elementos que se desplazan fuera de la vista. Además, el valor del método no se ve afectado por la oclusión por parte de otras ventanas o si el elemento está visible en un monitor específico. | Ninguno. |
| **Menús y objetos secundarios** | Para habilitar la automatización de la interfaz de usuario de los menús que contienen elementos secundarios distintos de objetos <xref:System.Windows.Controls.MenuItem>, el método <xref:System.Windows.Automation.Peers.MenuItemAutomationPeer.GetChildrenCore%2A> ahora devuelve el objeto <xref:System.Windows.Automation.Peers.AutomationPeer> de un elemento objeto secundario <xref:System.Windows.UIElement>, en lugar de un objeto <xref:System.Windows.Automation.Peers.MenuItemAutomationPeer>. | Ninguno. |
| **Nuevas Interfaces y ensamblado** | Para habilitar nuevas características para la automatización de la interfaz de usuario, se han agregado las interfaces siguientes:<br><br>* <xref:System.Windows.Automation.Provider.IItemContainerProvider><br>* <xref:System.Windows.Automation.Provider.ISynchronizedInputProvider><br>* <xref:System.Windows.Automation.Provider.IVirtualizedItemProvider> | Todos los proyectos que generan elementos de automatización de WPF del mismo nivel deben agregar una referencia explícita a UIAutomationProvider.dll. |
| **Controles** | El método <xref:System.Windows.Automation.Peers.ThumbAutomationPeer.GetClassNameCore%2A> devuelve un valor en lugar de NULL. Por lo tanto, los controles como <xref:System.Windows.Controls.GridSplitter> que heredan de la clase <xref:System.Windows.Controls.Primitives.Thumb> notificarán un nombre a la automatización de la interfaz de usuario. | Ninguno. |
| **Elementos virtualizados** | Para mejorar el rendimiento, el método <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetChildrenCore%2A> devuelve solo los objetos secundarios que se encuentran realmente en el árbol visual, en lugar de todos los objetos secundarios, independientemente de si están virtualizados. | Use <xref:System.Windows.Automation.ItemContainerPattern> para iterar en todos los elementos de <xref:System.Windows.Automation.Peers.ItemsControlAutomationPeer>. |

### <a name="xaml"></a>XAML

Espacios de nombres: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>, <xref:System.Windows.Markup>; ensamblados: PresentationFramework (en PresentationFramework.dll), PresentationCore (en PresentationCore.dll), WindowsBase (en WindowsBase.dll)

| Característica | Diferencias respecto a 3.5 SP1 | Cambios recomendados |
| ------- | ------------------------ | ------------------- |
| **Extensión de marcado** | WPF ahora usa siempre correctamente el valor del método <xref:System.Windows.Markup.MarkupExtension.ProvideValue%2A> en lugar de devolver el objeto <xref:System.Windows.Markup.MarkupExtension> en los casos en que se usa una extensión de marcado para establecer una propiedad o para crear un elemento en una colección. En algunos casos, una extensión de marcado podría devolverse a sí misma. | Si la aplicación tiene acceso a un recurso que devolvía un objeto <xref:System.Windows.Markup.MarkupExtension> en versiones anteriores, haga referencia al objeto que se devuelve desde <xref:System.Windows.Markup.MarkupExtension.ProvideValue%2A>, en lugar de al objeto <xref:System.Windows.Markup.MarkupExtension>. |
| **Análisis de atributos** | Los atributos en XAML ahora pueden tener un solo punto. Por ejemplo, lo siguiente es válido:<br><br>`<Button Background="Red"/>` (ningún punto)<br><br>`<Button Button.Background = "Red"/>` (un punto)<br><br>Lo siguiente ya no es válido:<br><br>`<Button Control.Button.Background = "Red"/>` (más de un punto) | Corrija los atributos XAML que tengan más de un punto. |

## <a name="xml"></a>XML

En las filas de esta tabla se describen las mejoras en las características que antes tenían limitaciones u otros problemas.

### <a name="schema-and-transforms"></a>Esquemas y transformaciones

Espacios de nombres: <xref:System.Xml.Linq>; <xref:System.Xml.Schema>, <xref:System.Xml.XPath>; ensamblados: System.Xml (en System.Xml.dll), System.Xml.Linq (en System.Xml.Linq.dll)

| Característica | Diferencias respecto a 3.5 SP1 |
| ------- | ------------------------ |
| **Esquemas camaleónicos** | Para evitar daños en los datos, los esquemas camaleónicos ahora se clonan correctamente cuando se incluyen con varios esquemas.<br><br>Los camaleónicos son aquellos que no tienen un espacio de nombres de destino y que, cuando se incluyen en otro esquema XSD, toman el espacio de nombres de destino del esquema de importación. A menudo se usan para incluir tipos comunes en un esquema. |
| **Funciones id** | La [función id](/sql/xquery/functions-on-sequences-id) de XSLT ahora devuelve el valor correcto en lugar de NULL cuando se pasa un objeto <xref:System.Xml.XmlReader> a una transformación XSLT.<br><br>Si el usuario creaba un objeto <xref:System.Xml.XmlReader> a partir de una clase LINQ to XML mediante el método <xref:System.Xml.Linq.XNode.CreateReader%2A> y dicho objeto <xref:System.Xml.XmlReader> se pasaba a una transformación XSLT, todas las instancias de la función `id` de la transformación XSLT anteriormente devolvían el valor NULL. Este valor devuelto no se permite para la función `id`. |
| **Atributo Namespace** | Para evitar daños en los datos, los objetos <xref:System.Xml.XPath.XPathNavigator> ahora devuelven correctamente el nombre local del atributo `x:xmlns`. |
| **Declaraciones de espacio de nombres** | Los objetos <xref:System.Xml.XmlReader> de un subárbol ya no crean declaraciones de espacio de nombres duplicadas en un elemento XML. |
| **Validación de esquemas** | Para evitar la validación de esquemas errónea, la clase <xref:System.Xml.Schema.XmlSchemaSet> permite que los esquemas XSD se compilen de forma correcta y coherente. Estos esquemas pueden incluir otros esquemas. Por ejemplo, `A.xsd` puede incluir `B.xsd`, que puede incluir `C.xsd`. La acción de compilar alguno de estos esquemas hace que se atraviese este gráfico de dependencias. |
| **Funciones de script** | La [función function-available](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms256124(v=vs.100)) ya no devuelve incorrectamente `false` cuando la función está realmente disponible. |
| **URI** | El método <xref:System.Xml.Linq.XElement.Load%2A> ahora devuelve el valor de BaseURI correcto en consultas LINQ. |

### <a name="validation"></a>Validación

Espacios de nombres: <xref:System.Xml.Linq>; <xref:System.Xml.Schema>, <xref:System.Xml.XPath>; ensamblados: System.Xml (en System.Xml.dll), System.Xml.Linq (en System.Xml.Linq.dll)

| Característica | Diferencias respecto a 3.5 SP1 |
| ------- | ------------------------ |
| **Resoluciones de espacio de nombres** | El método <xref:System.Xml.XmlReader.ReadContentAs%2A> ya no omite la resolución <xref:System.Xml.IXmlNamespaceResolver> que se le pasa.<br><br>En versiones anteriores, se omitía la resolución de espacio de nombres especificada y se usaba <xref:System.Xml.XmlReader> en su lugar. |
| **Espacio en blanco** | Para evitar la pérdida de datos al crear un lector, el método <xref:System.Xml.XmlReader.Create%2A> ya no descarta el espacio en blanco significativo.<br><br>La validación de XML reconoce el modo de contenido mixto, en el que el texto se puede combinar con marcado XML. En modo mixto, todo el espacio en blanco es significativo y se debe notificar. |

### <a name="writing"></a>Escritura

Espacios de nombres: <xref:System.Xml.Linq>; <xref:System.Xml.Schema>, <xref:System.Xml.XPath>; ensamblados: System.Xml (en System.Xml.dll), System.Xml.Linq (en System.Xml.Linq.dll)

| Característica | Diferencias respecto a 3.5 SP1 |
| ------- | ------------------------ |
| **Referencias a entidades** | Para evitar daños en los datos, ya no se crean dos entidades de las referencias a entidades en los atributos XML.<br><br>Si el usuario intentaba escribir una entidad en un atributo `xmlns` o en los atributos `xml:lang` o `xml:space` mediante el método <xref:System.Xml.XmlWriter.WriteEntityRef%2A>, se creaban dos entidades de la entidad en la salida, lo que dañaba los datos. |
| **Control de nueva línea** | Para evitar daños en los datos, los objetos <xref:System.Xml.XmlWriter> respetan la opción <xref:System.Xml.NewLineHandling>. |

## <a name="see-also"></a>Vea también

- [Nuevos tipos y miembros en .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ff641764%28v=vs.100%29)
- [Guía de migración para .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ff657133%28v=vs.100%29)
- [Novedades de .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms171868%28v=vs.100%29)
- [Compatibilidad de versiones en .NET Framework](version-compatibility.md)
- [Migrar soluciones de Office a .NET Framework 4](/visualstudio/vsto/migrating-office-solutions-to-the-dotnet-framework-4-or-later)
- [Lo obsoleto en la biblioteca de clases de .NET Framework](../whats-new/whats-obsolete.md)
