---
description: 'Más información acerca de: LINQ to SQL N niveles con servicios Web'
title: N niveles de LINQ to SQL con servicios Web
ms.date: 03/30/2017
ms.assetid: 9cb10eb8-957f-4beb-a271-5f682016fed2
ms.openlocfilehash: 7c97cc80f071ae964f329265f5c3d0e68e12b84f
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/06/2021
ms.locfileid: "99663110"
---
# <a name="linq-to-sql-n-tier-with-web-services"></a><span data-ttu-id="b22bb-103">N niveles de LINQ to SQL con servicios Web</span><span class="sxs-lookup"><span data-stu-id="b22bb-103">LINQ to SQL N-Tier with Web Services</span></span>

[!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] <span data-ttu-id="b22bb-104">está diseñado especialmente para su uso en el nivel intermedio en una capa de acceso a datos (DAL) de acoplamiento flexible, como un servicio Web.</span><span class="sxs-lookup"><span data-stu-id="b22bb-104">is designed especially for use on the middle tier in a loosely-coupled data access layer (DAL) such as a Web service.</span></span> <span data-ttu-id="b22bb-105">Si el nivel de presentación es una página web ASP.NET, el control de servidor web <xref:System.Web.UI.WebControls.LinqDataSource> se utiliza para controlar la transferencia de datos entre la interfaz de usuario y [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] en el de nivel intermedio.</span><span class="sxs-lookup"><span data-stu-id="b22bb-105">If the presentation tier is an ASP.NET Web page, then you use the <xref:System.Web.UI.WebControls.LinqDataSource> Web server control to manage the data transfer between the user interface and [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] on the middle-tier.</span></span> <span data-ttu-id="b22bb-106">Si el nivel de presentación no es una página ASP.NET, entonces el nivel intermedio y el nivel de presentación deben realizar un trabajo adicional para administrar la serialización y deserialización de datos.</span><span class="sxs-lookup"><span data-stu-id="b22bb-106">If the presentation tier is not an ASP.NET page, then both the middle-tier and the presentation tier must do some additional work to manage the serialization and deserialization of data.</span></span>  
  
## <a name="setting-up-linq-to-sql-on-the-middle-tier"></a><span data-ttu-id="b22bb-107">Establecer LINQ to SQL en el nivel intermedio</span><span class="sxs-lookup"><span data-stu-id="b22bb-107">Setting up LINQ to SQL on the Middle Tier</span></span>  

 <span data-ttu-id="b22bb-108">En un servicio Web o aplicación de n niveles, el nivel intermedio contiene el contexto de los datos y las clases de entidad.</span><span class="sxs-lookup"><span data-stu-id="b22bb-108">In a Web service or n-tier application, the middle tier contains the data context and the entity classes.</span></span> <span data-ttu-id="b22bb-109">Puede crear estas clases manualmente o mediante SQLMetal.exe o el Object Relational Designer tal y como se describe en otra parte de la documentación.</span><span class="sxs-lookup"><span data-stu-id="b22bb-109">You can create these classes manually, or by using either SQLMetal.exe or the Object Relational Designer as described elsewhere in the documentation.</span></span> <span data-ttu-id="b22bb-110">En tiempo de diseño, tiene la opción de hacer las clases de entidad serializables.</span><span class="sxs-lookup"><span data-stu-id="b22bb-110">At design time, you have the option to make the entity classes serializable.</span></span> <span data-ttu-id="b22bb-111">Para obtener más información, consulte [Cómo: hacer que las entidades sean serializables](how-to-make-entities-serializable.md).</span><span class="sxs-lookup"><span data-stu-id="b22bb-111">For more information, see [How to: Make Entities Serializable](how-to-make-entities-serializable.md).</span></span> <span data-ttu-id="b22bb-112">Otra opción consiste en crear un conjunto independiente de clases que encapsulan los datos que se van a serializar y, a continuación, proyectar en esos tipos serializables cuando se devuelvan datos en las consultas LINQ.</span><span class="sxs-lookup"><span data-stu-id="b22bb-112">Another option is to create a separate set of classes that encapsulate the data to be serialized, and then project into those serializable types when you return data in your LINQ queries.</span></span>  
  
 <span data-ttu-id="b22bb-113">A continuación, se define la interfaz con los métodos a los que los clientes llamarán para recuperar, insertar y actualizar datos.</span><span class="sxs-lookup"><span data-stu-id="b22bb-113">You then define the interface with the methods that the clients will call to retrieve, insert and update data.</span></span> <span data-ttu-id="b22bb-114">Los métodos de interfaz ajustan las consultas LINQ.</span><span class="sxs-lookup"><span data-stu-id="b22bb-114">The interface methods wrap your LINQ queries.</span></span> <span data-ttu-id="b22bb-115">Puede utilizar cualquier tipo de mecanismo de serialización para administrar las llamadas a métodos remotos y la serialización de datos.</span><span class="sxs-lookup"><span data-stu-id="b22bb-115">You can use any kind of serialization mechanism to handle the remote method calls and the serialization of data.</span></span> <span data-ttu-id="b22bb-116">El único requisito es que, si tiene relaciones cíclicas o bidireccionales en su modelo de objetos, como las que existen entre Clientes y Pedidos en el modelo de objetos estándar de Northwind, deberá utilizar un serializador que admita esa situación.</span><span class="sxs-lookup"><span data-stu-id="b22bb-116">The only requirement is that if you have cyclic or bi-directional relationships in your object model, such as that between Customers and Orders in the standard Northwind object model, then you must use a serializer that supports it.</span></span> <span data-ttu-id="b22bb-117">Windows Communication Foundation (WCF) <xref:System.Runtime.Serialization.DataContractSerializer> admite relaciones bidireccionales, pero no así el serializador XmlSerializer que se utiliza con servicios Web que no son de WCF.</span><span class="sxs-lookup"><span data-stu-id="b22bb-117">The Windows Communication Foundation (WCF) <xref:System.Runtime.Serialization.DataContractSerializer> supports bi-directional relationships but the XmlSerializer that is used with non-WCF Web services does not.</span></span> <span data-ttu-id="b22bb-118">Si selecciona el serializador XmlSerializer, deberá asegurarse de que su modelo de objetos no contenga relaciones cíclicas.</span><span class="sxs-lookup"><span data-stu-id="b22bb-118">If you select to use the XmlSerializer, then you must make sure that your object model has no cyclic relationships.</span></span>  
  
 <span data-ttu-id="b22bb-119">Para obtener más información sobre Windows Communication Foundation, consulte [Windows Communication Foundation Services y servicios de datos de WCF en Visual Studio](/visualstudio/data-tools/windows-communication-foundation-services-and-wcf-data-services-in-visual-studio).</span><span class="sxs-lookup"><span data-stu-id="b22bb-119">For more information about Windows Communication Foundation, see [Windows Communication Foundation Services and WCF Data Services in Visual Studio](/visualstudio/data-tools/windows-communication-foundation-services-and-wcf-data-services-in-visual-studio).</span></span>  
  
 <span data-ttu-id="b22bb-120">Implemente sus reglas de empresa u otra lógica específica del dominio utilizando las clases parciales y métodos de <xref:System.Data.Linq.DataContext> y las clases de entidad para conectar con eventos de tiempo de ejecución de  [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)].</span><span class="sxs-lookup"><span data-stu-id="b22bb-120">Implement your business rules or other domain-specific logic by using the partial classes and methods on the <xref:System.Data.Linq.DataContext> and entity classes to hook into [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] runtime events.</span></span> <span data-ttu-id="b22bb-121">Para obtener más información, consulte [implementación de la lógica de negocios de N niveles](implementing-business-logic-linq-to-sql.md).</span><span class="sxs-lookup"><span data-stu-id="b22bb-121">For more information, see [Implementing N-Tier Business Logic](implementing-business-logic-linq-to-sql.md).</span></span>  
  
## <a name="defining-the-serializable-types"></a><span data-ttu-id="b22bb-122">Definir los tipos serializables</span><span class="sxs-lookup"><span data-stu-id="b22bb-122">Defining the Serializable Types</span></span>  

 <span data-ttu-id="b22bb-123">El nivel de cliente o de presentación debe contar con las definiciones de tipo para las clases que recibirá desde el nivel intermedio.</span><span class="sxs-lookup"><span data-stu-id="b22bb-123">The client or presentation tier must have type definitions for the classes that it will be receiving from the middle tier.</span></span> <span data-ttu-id="b22bb-124">Esos tipos pueden ser clases de entidad propiamente dichas o clases especiales que envuelven sólo ciertos campos de las clases de entidad para la comunicación remota.</span><span class="sxs-lookup"><span data-stu-id="b22bb-124">Those types may be the entity classes themselves, or special classes that wrap only certain fields from the entity classes for remoting.</span></span> <span data-ttu-id="b22bb-125">En cualquier caso, [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] no se preocupe por completo el modo en que el nivel de presentación adquiere esas definiciones de tipo.</span><span class="sxs-lookup"><span data-stu-id="b22bb-125">In any case, [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] is completely unconcerned about how the presentation tier acquires those type definitions.</span></span> <span data-ttu-id="b22bb-126">Por ejemplo, el nivel de presentación podría utilizar WCF para generar los tipos automáticamente, o podría tener una copia de una DLL en la que se definen esos tipos, o simplemente podría definir sus propias versiones de los tipos.</span><span class="sxs-lookup"><span data-stu-id="b22bb-126">For example, the presentation tier could use WCF to generate the types automatically, or it could have a copy of a DLL in which those types are defined, or it could just define its own versions of the types.</span></span>  
  
## <a name="retrieving-and-inserting-data"></a><span data-ttu-id="b22bb-127">Recuperar e insertar datos</span><span class="sxs-lookup"><span data-stu-id="b22bb-127">Retrieving and Inserting Data</span></span>  

 <span data-ttu-id="b22bb-128">El nivel intermedio define una interfaz que especifica cómo el nivel de presentación obtiene acceso a los datos.</span><span class="sxs-lookup"><span data-stu-id="b22bb-128">The middle tier defines an interface that specifies how the presentation tier accesses the data.</span></span> <span data-ttu-id="b22bb-129">Por ejemplo, `GetProductByID(int productID)` o `GetCustomers()`.</span><span class="sxs-lookup"><span data-stu-id="b22bb-129">For example `GetProductByID(int productID)`, or `GetCustomers()`.</span></span> <span data-ttu-id="b22bb-130">En el nivel intermedio, el cuerpo del método crea generalmente una nueva instancia de <xref:System.Data.Linq.DataContext> y ejecuta una consulta contra una o más de su tabla.</span><span class="sxs-lookup"><span data-stu-id="b22bb-130">On the middle tier, the method body typically creates a new instance of the <xref:System.Data.Linq.DataContext>, executes a query against one or more of its table.</span></span> <span data-ttu-id="b22bb-131">A continuación, el nivel intermedio devuelve el resultado como un <xref:System.Collections.Generic.IEnumerable%601>, donde `T` es una clase de entidad u otro tipo que se utiliza para la serialización.</span><span class="sxs-lookup"><span data-stu-id="b22bb-131">The middle tier then returns the result as an <xref:System.Collections.Generic.IEnumerable%601>, where `T` is either an entity class or another type that is used for serialization.</span></span> <span data-ttu-id="b22bb-132">El nivel de presentación nunca envía o recibe directamente variables de consulta a o desde el nivel intermedio.</span><span class="sxs-lookup"><span data-stu-id="b22bb-132">The presentation tier never sends or receives query variables directly to or from the middle tier.</span></span> <span data-ttu-id="b22bb-133">Los dos niveles intercambian valores, objetos y colecciones de datos concretos.</span><span class="sxs-lookup"><span data-stu-id="b22bb-133">The two tiers exchange values, objects, and collections of concrete data.</span></span> <span data-ttu-id="b22bb-134">Una vez que haya recibido una colección, el nivel de presentación podrá usar LINQ to Objects para consultarla si es necesario.</span><span class="sxs-lookup"><span data-stu-id="b22bb-134">After it has received a collection, the presentation tier can use LINQ to Objects to query it if necessary.</span></span>  
  
 <span data-ttu-id="b22bb-135">Al insertar datos, el nivel de presentación puede construir un nuevo objeto y enviarlo al nivel intermedio, o puede hacer que el nivel intermedio construya el objeto en función de los valores que proporciona.</span><span class="sxs-lookup"><span data-stu-id="b22bb-135">When inserting data, the presentation tier can construct a new object and send it to the middle tier, or it can have the middle tier construct the object based on values that it provides.</span></span> <span data-ttu-id="b22bb-136">En general, la recuperación e inserción de datos en aplicaciones de n niveles no difiere mucho del proceso para aplicaciones de 2 niveles.</span><span class="sxs-lookup"><span data-stu-id="b22bb-136">In general, retrieving and inserting data in n-tier applications does not differ much from the process in 2-tier applications.</span></span> <span data-ttu-id="b22bb-137">Para obtener más información, vea [consultar la base](querying-the-database.md) de [datos y realizar y enviar cambios de datos](making-and-submitting-data-changes.md).</span><span class="sxs-lookup"><span data-stu-id="b22bb-137">For more information, see [Querying the Database](querying-the-database.md) and [Making and Submitting Data Changes](making-and-submitting-data-changes.md).</span></span>  
  
## <a name="tracking-changes-for-updates-and-deletes"></a><span data-ttu-id="b22bb-138">Seguimiento de cambios para actualizaciones y eliminaciones</span><span class="sxs-lookup"><span data-stu-id="b22bb-138">Tracking Changes for Updates and Deletes</span></span>  

 [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] <span data-ttu-id="b22bb-139">admite simultaneidad optimista basada en marcas de tiempo (también denominadas RowVersions) y en valores originales.</span><span class="sxs-lookup"><span data-stu-id="b22bb-139">supports optimistic concurrency based on timestamps (also named RowVersions) and on original values.</span></span> <span data-ttu-id="b22bb-140">Si las tablas de base de datos tienen marcas de tiempo, entonces las actualizaciones y eliminaciones requieren poco trabajo adicional en el nivel intermedio o en el nivel de presentación.</span><span class="sxs-lookup"><span data-stu-id="b22bb-140">If the database tables have timestamps, then updates and deletions require little extra work on either the middle-tier or presentation tier.</span></span> <span data-ttu-id="b22bb-141">Sin embargo, si debe utilizar valores originales para las comprobaciones de simultaneidad optimista, entonces el nivel de presentación es el responsable de realizar el seguimiento de esos valores y devolverlos cuando realiza las actualizaciones.</span><span class="sxs-lookup"><span data-stu-id="b22bb-141">However, if you must use original values for optimistic concurrency checks, then the presentation tier is responsible for tracking those values and sending them back when it makes updates.</span></span> <span data-ttu-id="b22bb-142">Esto es debido a que en el nivel intermedio no se hace un seguimiento de los cambios que se realizan en entidades en el nivel de presentación.</span><span class="sxs-lookup"><span data-stu-id="b22bb-142">This is because changes that were made to entities on the presentation tier are not tracked on the middle tier.</span></span> <span data-ttu-id="b22bb-143">De hecho, la recuperación original de una entidad y su posible actualización se realizan generalmente mediante dos instancias completamente independientes de <xref:System.Data.Linq.DataContext>.</span><span class="sxs-lookup"><span data-stu-id="b22bb-143">In fact, the original retrieval of an entity, and the eventual update made to it are typically performed by two completely separate instances of the <xref:System.Data.Linq.DataContext>.</span></span>  
  
 <span data-ttu-id="b22bb-144">Cuanto mayor es el número de cambios que realiza el nivel de presentación, más complejo se hace realizar el seguimiento de esos cambios y empaquetarlos de vuelta hacia el nivel intermedio.</span><span class="sxs-lookup"><span data-stu-id="b22bb-144">The greater the number of changes that the presentation tier makes, the more complex it becomes to track those changes and package them back to the middle tier.</span></span> <span data-ttu-id="b22bb-145">La implementación de un mecanismo para comunicar los cambios depende completamente de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="b22bb-145">The implementation of a mechanism for communicating changes is completely up to the application.</span></span> <span data-ttu-id="b22bb-146">El único requisito es que se deben dar a [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] aquellos valores originales que se requieren para las comprobaciones de la simultaneidad optimista.</span><span class="sxs-lookup"><span data-stu-id="b22bb-146">The only requirement is that [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] must be given those original values that are required for optimistic concurrency checks.</span></span>  
  
 <span data-ttu-id="b22bb-147">Para obtener más información, vea [operaciones de recuperación de datos y CUD en aplicaciones de N niveles (LINQ to SQL)](data-retrieval-and-cud-operations-in-n-tier-applications.md).</span><span class="sxs-lookup"><span data-stu-id="b22bb-147">For more information, see [Data Retrieval and CUD Operations in N-Tier Applications (LINQ to SQL)](data-retrieval-and-cud-operations-in-n-tier-applications.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b22bb-148">Vea también</span><span class="sxs-lookup"><span data-stu-id="b22bb-148">See also</span></span>

- [<span data-ttu-id="b22bb-149">Aplicaciones de N niveles y remotas con LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="b22bb-149">N-Tier and Remote Applications with LINQ to SQL</span></span>](n-tier-and-remote-applications-with-linq-to-sql.md)
- <span data-ttu-id="b22bb-150">[Información general sobre el control de servidor Web LinqDataSource](/previous-versions/aspnet/bb547113(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="b22bb-150">[LinqDataSource Web Server Control Overview](/previous-versions/aspnet/bb547113(v=vs.100))</span></span>
