---
title: Traza de datos en ADO.NET
ms.date: 03/30/2017
ms.assetid: a6a752a5-d2a9-4335-a382-b58690ccb79f
ms.openlocfilehash: f92a17374cf3df1281e51d54bae1a1dcf9e5ea03
ms.sourcegitcommit: 7e2128d4a4c45b4274bea3b8e5760d4694569ca1
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/14/2020
ms.locfileid: "75937629"
---
# <a name="data-tracing-in-adonet"></a><span data-ttu-id="51028-102">Traza de datos en ADO.NET</span><span class="sxs-lookup"><span data-stu-id="51028-102">Data Tracing in ADO.NET</span></span>

<span data-ttu-id="51028-103">ADO.NET incluye la funcionalidad de seguimiento de datos integrada que admiten los proveedores de datos de .NET para SQL Server, Oracle, OLE DB y ODBC, así como los <xref:System.Data.DataSet>de ADO.NET y los protocolos de red de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="51028-103">ADO.NET features built-in data tracing functionality that is supported by the .NET data providers for SQL Server, Oracle, OLE DB and ODBC, as well as the ADO.NET <xref:System.Data.DataSet>, and the SQL Server network protocols.</span></span>

<span data-ttu-id="51028-104">Las llamadas API de acceso a datos de traza ayudan a diagnosticar los siguientes problemas:</span><span class="sxs-lookup"><span data-stu-id="51028-104">Tracing data access API calls can help diagnose the following problems:</span></span>

- <span data-ttu-id="51028-105">Falta de coincidencia de esquemas entre el programa cliente y la base de datos.</span><span class="sxs-lookup"><span data-stu-id="51028-105">Schema mismatch between client program and the database.</span></span>

- <span data-ttu-id="51028-106">Inoperabilidad de la base de datos o problemas con las bibliotecas de red.</span><span class="sxs-lookup"><span data-stu-id="51028-106">Database unavailability or network library problems.</span></span>

- <span data-ttu-id="51028-107">SQL incorrecto, tanto si está incluido en el código como si lo ha generado una aplicación.</span><span class="sxs-lookup"><span data-stu-id="51028-107">Incorrect SQL whether hard coded or generated by an application.</span></span>

- <span data-ttu-id="51028-108">Lógica de programación incorrecta.</span><span class="sxs-lookup"><span data-stu-id="51028-108">Incorrect programming logic.</span></span>

- <span data-ttu-id="51028-109">Problemas derivados de la interacción entre varios componentes de ADO.NET o entre ADO.NET y sus propios componentes.</span><span class="sxs-lookup"><span data-stu-id="51028-109">Issues resulting from the interaction between multiple ADO.NET components or between ADO.NET and your own components.</span></span>

<span data-ttu-id="51028-110">Para garantizar la compatibilidad entre diferentes tecnologías de traza, éste es ampliable, de manera que un programador puede realizar un seguimiento de un problema en cualquier nivel de la pila de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="51028-110">To support different trace technologies, tracing is extensible, so a developer can trace a problem at any level of the application stack.</span></span> <span data-ttu-id="51028-111">A pesar de que el seguimiento no es una característica exclusiva de ADO.NET, los proveedores de Microsoft aprovechan la ventaja de el seguimiento generalizada y las API de instrumental.</span><span class="sxs-lookup"><span data-stu-id="51028-111">Although tracing is not an ADO.NET-only feature, Microsoft providers take advantage of generalized tracing and instrumentation APIs.</span></span>

<span data-ttu-id="51028-112">Para obtener más información sobre cómo establecer y configurar el seguimiento administrado en ADO.NET, vea [seguimiento de acceso a datos](https://docs.microsoft.com/previous-versions/sql/sql-server-2012/hh880086(v=msdn.10)).</span><span class="sxs-lookup"><span data-stu-id="51028-112">For more information about setting and configuring managed tracing in ADO.NET, see [Tracing Data Access](https://docs.microsoft.com/previous-versions/sql/sql-server-2012/hh880086(v=msdn.10)).</span></span>

## <a name="accessing-diagnostic-information-in-the-extended-events-log"></a><span data-ttu-id="51028-113">Tener acceso a información de diagnóstico en el registro de eventos extendidos</span><span class="sxs-lookup"><span data-stu-id="51028-113">Accessing Diagnostic Information in the Extended Events Log</span></span>

<span data-ttu-id="51028-114">En el proveedor de datos de .NET Framework para SQL Server, el seguimiento de acceso a datos ([seguimiento de acceso a datos](https://docs.microsoft.com/previous-versions/sql/sql-server-2012/hh880086(v=msdn.10))) se ha actualizado para facilitar la correlación de eventos de cliente con información de diagnóstico, como errores de conexión, desde el búfer de anillo de Conectividad del servidor y la información de rendimiento de la aplicación en el registro de eventos extendidos.</span><span class="sxs-lookup"><span data-stu-id="51028-114">In the .NET Framework Data Provider for SQL Server, data access tracing ([Data Access Tracing](https://docs.microsoft.com/previous-versions/sql/sql-server-2012/hh880086(v=msdn.10))) has been updated to make it easier to correlate client events with diagnostic information, such as connection failures, from the server's connectivity ring buffer and application performance information in the extended events log.</span></span> <span data-ttu-id="51028-115">Para obtener información sobre la lectura del registro de eventos extendidos, vea [Ver datos de sesión de evento](https://docs.microsoft.com/previous-versions/sql/sql-server-2012/hh710068(v=sql.110)).</span><span class="sxs-lookup"><span data-stu-id="51028-115">For information about reading the extended events log, see [View Event Session Data](https://docs.microsoft.com/previous-versions/sql/sql-server-2012/hh710068(v=sql.110)).</span></span>

<span data-ttu-id="51028-116">Para las operaciones de conexión, ADO.NET enviará un identificador de conexión de cliente.</span><span class="sxs-lookup"><span data-stu-id="51028-116">For connection operations, ADO.NET will send a client connection ID.</span></span> <span data-ttu-id="51028-117">Si se produce un error en la conexión, puede tener acceso al búfer de anillo de conectividad ([solución de problemas de conectividad en SQL Server 2008 con el búfer de anillo de conectividad](https://docs.microsoft.com/archive/blogs/sql_protocols/connectivity-troubleshooting-in-sql-server-2008-with-the-connectivity-ring-buffer)) y buscar el campo de `ClientConnectionID` y obtener información de diagnóstico sobre el error de conexión.</span><span class="sxs-lookup"><span data-stu-id="51028-117">If the connection fails, you can access the connectivity ring buffer ([Connectivity troubleshooting in SQL Server 2008 with the Connectivity Ring Buffer](https://docs.microsoft.com/archive/blogs/sql_protocols/connectivity-troubleshooting-in-sql-server-2008-with-the-connectivity-ring-buffer)) and find the `ClientConnectionID` field and get diagnostic information about the connection failure.</span></span> <span data-ttu-id="51028-118">Los identificadores de conexión de cliente inician sesión el búfer de anillo solo si se produce un error.</span><span class="sxs-lookup"><span data-stu-id="51028-118">Client connection IDs are logged in the ring buffer only if an error occurs.</span></span> <span data-ttu-id="51028-119">(Si se produce un error en una conexión antes de enviar el paquete de inicio de sesión previo, no se generará un identificador de conexión de cliente). El identificador de conexión de cliente es un GUID de 16 bytes.</span><span class="sxs-lookup"><span data-stu-id="51028-119">(If a connection fails before sending the prelogin packet, a client connection ID will not be generated.) The client connection ID is a 16-byte GUID.</span></span> <span data-ttu-id="51028-120">También puede buscar el identificador de la conexión de cliente en la salida de destino de los eventos extendidos si la acción `client_connection_id` se agregó a los eventos en una sesión de eventos extendidos.</span><span class="sxs-lookup"><span data-stu-id="51028-120">You can also find the client connection ID in the extended events target output, if the `client_connection_id` action is added to events in an extended events session.</span></span> <span data-ttu-id="51028-121">Puede habilitar el seguimiento de acceso a datos y volver a ejecutar el comando de conexión y observar el campo `ClientConnectionID` en el seguimiento de acceso a datos, si necesita ayuda adicional de diagnóstico del controlador del cliente.</span><span class="sxs-lookup"><span data-stu-id="51028-121">You can enable data access tracing and rerun the connection command and observe the `ClientConnectionID` field in the data access trace, if you need further client driver diagnostic assistance.</span></span>

<span data-ttu-id="51028-122">Puede obtener el identificador de la conexión de cliente mediante programación con la propiedad `SqlConnection.ClientConnectionID`.</span><span class="sxs-lookup"><span data-stu-id="51028-122">You can get the client connection ID programmatically by using the `SqlConnection.ClientConnectionID` property.</span></span>

<span data-ttu-id="51028-123">`ClientConnectionID` está disponible para un objeto <xref:System.Data.SqlClient.SqlConnection> que establezca correctamente una conexión.</span><span class="sxs-lookup"><span data-stu-id="51028-123">The `ClientConnectionID` is available for a <xref:System.Data.SqlClient.SqlConnection> object that successfully establishes  a connection.</span></span> <span data-ttu-id="51028-124">Si se produce un error en un intento de conexión, `ClientConnectionID` puede estar disponible a través de `SqlException.ToString`.</span><span class="sxs-lookup"><span data-stu-id="51028-124">If a connection attempt fails, `ClientConnectionID` may be available via `SqlException.ToString`.</span></span>

<span data-ttu-id="51028-125">ADO.NET también envía un identificador de actividad específico del subproceso</span><span class="sxs-lookup"><span data-stu-id="51028-125">ADO.NET also sends a thread-specific activity ID.</span></span> <span data-ttu-id="51028-126">El ID. de actividad se captura en las sesiones de eventos extendidos si las sesiones se inician con la opción de TRACK_CAUSALITY habilitada.</span><span class="sxs-lookup"><span data-stu-id="51028-126">The activity ID is captured in the extended events sessions if the sessions are started with the TRACK_CAUSALITY option enabled.</span></span> <span data-ttu-id="51028-127">Para los problemas de rendimiento con una conexión activa, puede obtener el identificador de actividad del seguimiento de acceso a datos del cliente (campo `ActivityID`) y después buscar el identificador de actividad en la salida de los eventos extendidos.</span><span class="sxs-lookup"><span data-stu-id="51028-127">For performance issues with an active connection, you can get the activity ID from the client's data access trace (`ActivityID` field) and then locate the activity ID in the extended events output.</span></span> <span data-ttu-id="51028-128">El identificador de actividad en los eventos extendidos es un GUID de 16 bytes (no es el mismo GUID que el identificador de conexión de cliente) anexado con un número de secuencia de cuatro bytes.</span><span class="sxs-lookup"><span data-stu-id="51028-128">The activity ID in extended events is a 16-byte GUID (not the same as the GUID for the client connection ID) appended with a four-byte sequence number.</span></span> <span data-ttu-id="51028-129">El número de secuencia representa el orden de una solicitud dentro de un subproceso e indica el orden relativo del lote y las instrucciones RPC para el subproceso.</span><span class="sxs-lookup"><span data-stu-id="51028-129">The sequence number represents the order of a request within a thread and indicates the relative ordering of batch and RPC statements for the thread.</span></span> <span data-ttu-id="51028-130">`ActivityID` se envía actualmente opcionalmente para instrucciones por lotes de SQL y solicitudes RPC cuando el seguimiento de acceso a datos está habilitado y el decimoctavo bit de la palabra de configuración de seguimiento de acceso a datos está activado.</span><span class="sxs-lookup"><span data-stu-id="51028-130">The `ActivityID` is currently optionally sent for SQL batch statements and RPC requests when data access tracing is enabled on and the 18th bit in the data access tracing configuration word is turned ON.</span></span>

<span data-ttu-id="51028-131">A continuación se muestra un ejemplo que utiliza Transact-SQL para iniciar una sesión de Extended Events que se almacenará en un búfer de anillo y registrará el ID. de actividad enviado desde un cliente en operaciones RPC y por lotes.</span><span class="sxs-lookup"><span data-stu-id="51028-131">The following is a sample that uses Transact-SQL to start an extended events session that will be stored in a ring buffer and will record the activity ID sent from a client on RPC and batch operations.</span></span>

```sql
create event session MySession on server
add event connectivity_ring_buffer_recorded,
add event sql_statement_starting (action (client_connection_id)),
add event sql_statement_completed (action (client_connection_id)),
add event rpc_starting (action (client_connection_id)),
add event rpc_completed (action (client_connection_id))
add target ring_buffer with (track_causality=on)
```

## <a name="see-also"></a><span data-ttu-id="51028-132">Vea también</span><span class="sxs-lookup"><span data-stu-id="51028-132">See also</span></span>

- [<span data-ttu-id="51028-133">Network Tracing in the .NET Framework (Seguimiento de red en .NET Framework)</span><span class="sxs-lookup"><span data-stu-id="51028-133">Network Tracing in the .NET Framework</span></span>](../../network-programming/network-tracing.md)
- [<span data-ttu-id="51028-134">Seguimiento e instrumentación de aplicaciones</span><span class="sxs-lookup"><span data-stu-id="51028-134">Tracing and Instrumenting Applications</span></span>](../../debug-trace-profile/tracing-and-instrumenting-applications.md)
- [<span data-ttu-id="51028-135">Información general sobre ADO.NET</span><span class="sxs-lookup"><span data-stu-id="51028-135">ADO.NET Overview</span></span>](ado-net-overview.md)
