---
description: 'Más información acerca de: transacciones distribuidas'
title: Transacciones distribuidas
ms.date: 03/30/2017
ms.assetid: 718b257c-bcb2-408e-b004-a7b0adb1c176
ms.openlocfilehash: 611fe4e2139e69e9501a3ea04a6aa62425e06728
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/06/2021
ms.locfileid: "99651124"
---
# <a name="distributed-transactions"></a><span data-ttu-id="d5dd6-103">Transacciones distribuidas</span><span class="sxs-lookup"><span data-stu-id="d5dd6-103">Distributed Transactions</span></span>

<span data-ttu-id="d5dd6-104">Entre otras cosas, una transacción es un conjunto de tareas relacionadas que se ejecutan correctamente (confirman) o dan error (anulan) como una unidad.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-104">A transaction is a set of related tasks that either succeeds (commit) or fails (abort) as a unit, among other things.</span></span> <span data-ttu-id="d5dd6-105">Una *transacción distribuida* es una transacción que afecta a varios recursos.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-105">A *distributed transaction* is a transaction that affects several resources.</span></span> <span data-ttu-id="d5dd6-106">Para que una transacción distribuida se confirme, todos los participantes deben garantizar que los cambios en los datos serán permanentes.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-106">For a distributed transaction to commit, all participants must guarantee that any change to data will be permanent.</span></span> <span data-ttu-id="d5dd6-107">Los cambios deben conservarse a pesar de bloqueos del sistema u otros eventos imprevistos.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-107">Changes must persist despite system crashes or other unforeseen events.</span></span> <span data-ttu-id="d5dd6-108">Si alguno de los participantes no cumple esta garantía, toda la transacción da error y se revertirán los cambios en los datos en el ámbito de la transacción.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-108">If even a single participant fails to make this guarantee, the entire transaction fails, and any changes to data within the scope of the transaction are rolled back.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="d5dd6-109">Si intenta confirmar o revertir una transacción al iniciar un `DataReader` mientras la transacción está activa, se produce una excepción.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-109">An exception will be thrown if you attempt to commit or roll back a transaction if a `DataReader` is started while the transaction is active.</span></span>  
  
## <a name="working-with-systemtransactions"></a><span data-ttu-id="d5dd6-110">Trabajo con System.Transactions</span><span class="sxs-lookup"><span data-stu-id="d5dd6-110">Working with System.Transactions</span></span>  

 <span data-ttu-id="d5dd6-111">En .NET Framework, las transacciones distribuidas se administran a través de la API del espacio de nombres <xref:System.Transactions>.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-111">In the .NET Framework, distributed transactions are managed through the API in the <xref:System.Transactions> namespace.</span></span> <span data-ttu-id="d5dd6-112">Cuando hay implicados varios administradores de recursos persistentes, la API <xref:System.Transactions> delegará el control de las transacciones distribuidas en un monitor de transacciones como el Coordinador de transacciones distribuidas de Microsoft (MS DTC).</span><span class="sxs-lookup"><span data-stu-id="d5dd6-112">The <xref:System.Transactions> API will delegate distributed transaction handling to a transaction monitor such as the Microsoft Distributed Transaction Coordinator (MS DTC) when multiple persistent resource managers are involved.</span></span> <span data-ttu-id="d5dd6-113">Para obtener más información, vea [Aspectos básicos de las transacciones](../transactions/transaction-fundamentals.md).</span><span class="sxs-lookup"><span data-stu-id="d5dd6-113">For more information, see [Transaction Fundamentals](../transactions/transaction-fundamentals.md).</span></span>  
  
 <span data-ttu-id="d5dd6-114">ADO.NET 2.0 incorporó la compatibilidad con la inscripción en una transacción distribuida mediante el método `EnlistTransaction`, que inscribe una conexión en una instancia de <xref:System.Transactions.Transaction>.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-114">ADO.NET 2.0 introduced support for enlisting in a distributed transaction using the `EnlistTransaction` method, which enlists a connection in a <xref:System.Transactions.Transaction> instance.</span></span> <span data-ttu-id="d5dd6-115">En las versiones anteriores de ADO.NET, la inscripción explícita en transacciones distribuidas se realizaba mediante el método `EnlistDistributedTransaction` de una conexión que inscribía ésta en una instancia <xref:System.EnterpriseServices.ITransaction>, en la que se permitía la compatibilidad con versiones anteriores.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-115">In previous versions of ADO.NET, explicit enlistment in distributed transactions was performed using the `EnlistDistributedTransaction` method of a connection to enlist a connection in a <xref:System.EnterpriseServices.ITransaction> instance, which is supported for backwards compatibility.</span></span> <span data-ttu-id="d5dd6-116">Para obtener más información sobre las transacciones de Enterprise Services, vea [Interoperabilidad con Enterprise Services y transacciones de COM+](../transactions/interoperability-with-enterprise-services-and-com-transactions.md).</span><span class="sxs-lookup"><span data-stu-id="d5dd6-116">For more information on Enterprise Services transactions, see [Interoperability with Enterprise Services and COM+ Transactions](../transactions/interoperability-with-enterprise-services-and-com-transactions.md).</span></span>  
  
 <span data-ttu-id="d5dd6-117">Cuando se usa una transacción <xref:System.Transactions> con el proveedor .NET Framework para SQL Server en una base de datos de SQL Server, se usará automáticamente un objeto <xref:System.Transactions.Transaction> ligero.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-117">When using a <xref:System.Transactions> transaction with the .NET Framework Provider for SQL Server against a SQL Server database, a lightweight <xref:System.Transactions.Transaction> will automatically be used.</span></span> <span data-ttu-id="d5dd6-118">A continuación, la transacción se puede promover a una transacción distribuida completa si es necesario.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-118">The transaction can then be promoted to a full distributed transaction on an as-needed basis.</span></span> <span data-ttu-id="d5dd6-119">Para obtener más información, vea [integración de System. Transactions con SQL Server](system-transactions-integration-with-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="d5dd6-119">For more information, see [System.Transactions Integration with SQL Server](system-transactions-integration-with-sql-server.md).</span></span>  
  
> [!NOTE]
> <span data-ttu-id="d5dd6-120">El número máximo de transacciones distribuidas en las que puede participar una base de datos de Oracle a la vez se establece de forma predeterminada en 10.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-120">The maximum number of distributed transactions that an Oracle database can participate in at one time is set to 10 by default.</span></span> <span data-ttu-id="d5dd6-121">Después de la décima transacción en una conexión a una base de datos de Oracle, se inicia una excepción.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-121">After the 10th transaction when connected to an Oracle database, an exception is thrown.</span></span> <span data-ttu-id="d5dd6-122">Oracle no admite `DDL` en las transacciones distribuidas.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-122">Oracle does not support `DDL` inside of a distributed transaction.</span></span>  
  
## <a name="automatically-enlisting-in-a-distributed-transaction"></a><span data-ttu-id="d5dd6-123">Inscripción automática en una transacción distribuida</span><span class="sxs-lookup"><span data-stu-id="d5dd6-123">Automatically Enlisting in a Distributed Transaction</span></span>  

 <span data-ttu-id="d5dd6-124">La inscripción automática es el método predeterminado (y preferido) de integrar conexiones ADO.NET con `System.Transactions`.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-124">Automatic enlistment is the default (and preferred) way of integrating ADO.NET connections with `System.Transactions`.</span></span> <span data-ttu-id="d5dd6-125">Un objeto de conexión se inscribirá automáticamente en una transacción distribuida existente si se determina que hay una transacción activa, que, en términos de `System.Transaction`, significa que `Transaction.Current` no es nula.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-125">A connection object will automatically enlist in an existing distributed transaction if it determines that a transaction is active, which, in `System.Transaction` terms, means that `Transaction.Current` is not null.</span></span> <span data-ttu-id="d5dd6-126">La inscripción automática en transacciones tiene lugar cuando se abre la conexión.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-126">Automatic transaction enlistment occurs when the connection is opened.</span></span> <span data-ttu-id="d5dd6-127">No ocurrirá después, incluso si se ejecuta un comando dentro del ámbito de una transacción.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-127">It will not happen after that even if a command is executed inside of a transaction scope.</span></span> <span data-ttu-id="d5dd6-128">Puede deshabilitar la inscripción automática en transacciones existentes si especifica `Enlist=false` como un parámetro de cadena de conexión para una <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A?displayProperty=nameWithType>, o `OLE DB Services=-7` como un parámetro de cadena de conexión para una <xref:System.Data.OleDb.OleDbConnection.ConnectionString%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-128">You can disable auto-enlistment in existing transactions by specifying `Enlist=false` as a connection string parameter for a <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A?displayProperty=nameWithType>, or `OLE DB Services=-7` as a connection string parameter for an <xref:System.Data.OleDb.OleDbConnection.ConnectionString%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="d5dd6-129">Para obtener más información acerca de los parámetros de cadena de conexión de Oracle y ODBC, vea <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A?displayProperty=nameWithType> y <xref:System.Data.Odbc.OdbcConnection.ConnectionString%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-129">For more information on Oracle and ODBC connection string parameters, see <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A?displayProperty=nameWithType> and <xref:System.Data.Odbc.OdbcConnection.ConnectionString%2A?displayProperty=nameWithType>.</span></span>  
  
## <a name="manually-enlisting-in-a-distributed-transaction"></a><span data-ttu-id="d5dd6-130">Inscripción manual en una transacción distribuida</span><span class="sxs-lookup"><span data-stu-id="d5dd6-130">Manually Enlisting in a Distributed Transaction</span></span>  

 <span data-ttu-id="d5dd6-131">Si la inscripción automática está deshabilitada o es necesario inscribir la conexión en una transacción que se ha iniciado después de abierta la conexión, puede inscribirla en una transacción distribuida existente mediante el método `EnlistTransaction` del objeto <xref:System.Data.Common.DbConnection> correspondiente al proveedor con el que esté trabajando.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-131">If auto-enlistment is disabled or you need to enlist a transaction that was started after the connection was opened, you can enlist in an existing distributed transaction using the `EnlistTransaction` method of the <xref:System.Data.Common.DbConnection> object for the provider you are working with.</span></span> <span data-ttu-id="d5dd6-132">La inscripción en una transacción distribuida existente garantiza que, si la transacción se confirma o revierte, también se confirmarán o revertirán las modificaciones realizadas por el código en el origen de datos.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-132">Enlisting in an existing distributed transaction ensures that, if the transaction is committed or rolled back, modifications made by the code at the data source will be committed or rolled back as well.</span></span>  
  
 <span data-ttu-id="d5dd6-133">La inscripción en transacciones distribuidas es especialmente conveniente al agrupar objetos empresariales.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-133">Enlisting in distributed transactions is particularly applicable when pooling business objects.</span></span> <span data-ttu-id="d5dd6-134">Si se agrupa un objeto empresarial con una conexión abierta, la inscripción automática en transacciones sólo se produce cuando se abre esa conexión.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-134">If a business object is pooled with an open connection, automatic transaction enlistment only occurs when that connection is opened.</span></span> <span data-ttu-id="d5dd6-135">Si se realizan varias transacciones con el objeto empresarial agrupado, la conexión abierta para ese objeto no se inscribirá automáticamente en las transacciones recién iniciadas.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-135">If multiple transactions are performed using the pooled business object, the open connection for that object will not automatically enlist in newly initiated transactions.</span></span> <span data-ttu-id="d5dd6-136">En este caso, puede deshabilitar la inscripción automática de la conexión en la transacción e inscribir la conexión en las transacciones mediante `EnlistTransaction`.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-136">In this case, you can disable automatic transaction enlistment for the connection and enlist the connection in transactions using `EnlistTransaction`.</span></span>  
  
 <span data-ttu-id="d5dd6-137">`EnlistTransaction` acepta un único argumento de tipo <xref:System.Transactions.Transaction> que es una referencia a la transacción existente.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-137">`EnlistTransaction` takes a single argument of type <xref:System.Transactions.Transaction> that is a reference to the existing transaction.</span></span> <span data-ttu-id="d5dd6-138">Después de llamar al método `EnlistTransaction` de la conexión, todas las modificaciones realizadas en el origen de datos mediante la conexión se incluyen en la transacción.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-138">After calling the connection's `EnlistTransaction` method, all modifications made at the data source using the connection are included in the transaction.</span></span> <span data-ttu-id="d5dd6-139">Si se pasa un valor nulo, se anula la inscripción de la conexión de su inscripción actual en transacciones distribuidas.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-139">Passing a null value unenlists the connection from its current distributed transaction enlistment.</span></span> <span data-ttu-id="d5dd6-140">Tenga en cuenta que la conexión se debe abrir antes de llamar a `EnlistTransaction`.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-140">Note that the connection must be opened before calling `EnlistTransaction`.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="d5dd6-141">Una vez que una conexión se inscribe explícitamente en una transacción, no se puede anular su inscripción ni inscribirse en otra transacción hasta que finaliza la primera transacción.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-141">Once a connection is explicitly enlisted on a transaction, it cannot be un-enlisted or enlisted in another transaction until the first transaction finishes.</span></span>  
  
> [!CAUTION]
> <span data-ttu-id="d5dd6-142">Si la conexión ya ha comenzado una transacción mediante el método `EnlistTransaction` de la conexión, <xref:System.Data.Common.DbConnection.BeginTransaction%2A> inicia una excepción.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-142">`EnlistTransaction` throws an exception if the connection has already begun a transaction using the connection's <xref:System.Data.Common.DbConnection.BeginTransaction%2A> method.</span></span> <span data-ttu-id="d5dd6-143">No obstante, si la transacción es una transacción local iniciada en el origen de datos (por ejemplo, al ejecutar la instrucción BEGIN TRANSACTION de forma explícita mediante un <xref:System.Data.SqlClient.SqlCommand>), `EnlistTransaction` la revertirá e inscribirá en la transacción distribuida existente como se ha solicitado.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-143">However, if the transaction is a local transaction started at the data source (for example, executing the BEGIN TRANSACTION statement explicitly using a <xref:System.Data.SqlClient.SqlCommand>), `EnlistTransaction` will roll back the local transaction and enlist in the existing distributed transaction as requested.</span></span> <span data-ttu-id="d5dd6-144">No recibirá aviso de que la transacción local se ha revertido y deberá administrar todas las transacciones locales no iniciadas mediante <xref:System.Data.Common.DbConnection.BeginTransaction%2A>.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-144">You will not receive notice that the local transaction was rolled back, and must manage any local transactions not started using <xref:System.Data.Common.DbConnection.BeginTransaction%2A>.</span></span> <span data-ttu-id="d5dd6-145">Si usa el proveedor de datos .NET Framework para SQL Server (`SqlClient`) con SQL Server, se producirá una excepción al intentar una inscripción.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-145">If you are using the .NET Framework Data Provider for SQL Server (`SqlClient`) with SQL Server, an attempt to enlist will throw an exception.</span></span> <span data-ttu-id="d5dd6-146">Todos los demás casos no se detectarán.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-146">All other cases will go undetected.</span></span>  
  
## <a name="promotable-transactions-in-sql-server"></a><span data-ttu-id="d5dd6-147">Transacciones que se pueden promover en SQL Server</span><span class="sxs-lookup"><span data-stu-id="d5dd6-147">Promotable Transactions in SQL Server</span></span>  

 <span data-ttu-id="d5dd6-148">SQL Server 2005 admite transacciones que se pueden promover en las que se pueda promover automáticamente una transacción ligera local a una transacción distribuida solamente cuando es necesario.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-148">SQL Server supports promotable transactions in which a local lightweight transaction can be automatically promoted to a distributed transaction only if it is required.</span></span> <span data-ttu-id="d5dd6-149">Las transacciones promovibles no invocan la sobrecarga adicional de las transacciones distribuidas a menos que sea necesario.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-149">A promotable transaction does not invoke the added overhead of a distributed transaction unless the added overhead is required.</span></span> <span data-ttu-id="d5dd6-150">Para obtener más información y un ejemplo de código, vea [integración de System. Transactions con SQL Server](system-transactions-integration-with-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="d5dd6-150">For more information and a code sample, see [System.Transactions Integration with SQL Server](system-transactions-integration-with-sql-server.md).</span></span>  
  
## <a name="configuring-distributed-transactions"></a><span data-ttu-id="d5dd6-151">Configuración de transacciones distribuidas</span><span class="sxs-lookup"><span data-stu-id="d5dd6-151">Configuring Distributed Transactions</span></span>  

 <span data-ttu-id="d5dd6-152">Puede que necesite habilitar MS DTC a través de la red para usar transacciones distribuidas.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-152">You may need to enable the MS DTC over the network in order to use distributed transactions.</span></span> <span data-ttu-id="d5dd6-153">Si tiene Firewall de Windows habilitado, debe permitir que el servicio MS DTC use la red o abrir el puerto MS DTC.</span><span class="sxs-lookup"><span data-stu-id="d5dd6-153">If have the Windows Firewall enabled, you must allow the MS DTC service to use the network or open the MS DTC port.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d5dd6-154">Consulte también</span><span class="sxs-lookup"><span data-stu-id="d5dd6-154">See also</span></span>

- [<span data-ttu-id="d5dd6-155">Transacciones y simultaneidad</span><span class="sxs-lookup"><span data-stu-id="d5dd6-155">Transactions and Concurrency</span></span>](transactions-and-concurrency.md)
- [<span data-ttu-id="d5dd6-156">Integración de System. Transactions con SQL Server</span><span class="sxs-lookup"><span data-stu-id="d5dd6-156">System.Transactions Integration with SQL Server</span></span>](system-transactions-integration-with-sql-server.md)
- [<span data-ttu-id="d5dd6-157">Información general de ADO.NET</span><span class="sxs-lookup"><span data-stu-id="d5dd6-157">ADO.NET Overview</span></span>](ado-net-overview.md)
