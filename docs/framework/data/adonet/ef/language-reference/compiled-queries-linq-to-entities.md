---
title: Consultas compiladas (LINQ to Entities)
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 8025ba1d-29c7-4407-841b-d5a3bed40b7a
ms.openlocfilehash: b4594932b6ed21de98faab57d80404a7b763067d
ms.sourcegitcommit: 488aced39b5f374bc0a139a4993616a54d15baf0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 05/12/2020
ms.locfileid: "83207915"
---
# <a name="compiled-queries--linq-to-entities"></a><span data-ttu-id="e5479-102">Consultas compiladas (LINQ to Entities)</span><span class="sxs-lookup"><span data-stu-id="e5479-102">Compiled queries  (LINQ to Entities)</span></span>

<span data-ttu-id="e5479-103">Cuando una aplicación ejecuta muchas veces consultas que tienen una estructura similar en Entity Framework, se suele mejorar el rendimiento si se compila la consulta una vez y se ejecuta varias veces con parámetros diferentes.</span><span class="sxs-lookup"><span data-stu-id="e5479-103">When you have an application that executes structurally similar queries many times in the Entity Framework, you can frequently increase performance by compiling the query one time and executing it several times with different parameters.</span></span> <span data-ttu-id="e5479-104">Por ejemplo, una aplicación puede tener que recuperar todos los clientes de una ciudad determinada; el usuario especifica en un formulario la ciudad en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="e5479-104">For example, an application might have to retrieve all the customers in a particular city; the city is specified at runtime by the user in a form.</span></span> <span data-ttu-id="e5479-105">LINQ to Entities admite el uso de consultas compiladas para este fin.</span><span class="sxs-lookup"><span data-stu-id="e5479-105">LINQ to Entities supports using compiled queries for this purpose.</span></span>  
  
 <span data-ttu-id="e5479-106">A partir de .NET Framework 4,5, las consultas LINQ se almacenan en caché automáticamente.</span><span class="sxs-lookup"><span data-stu-id="e5479-106">Starting with .NET Framework 4.5, LINQ queries are cached automatically.</span></span> <span data-ttu-id="e5479-107">Sin embargo, todavía puede usar consultas LINQ compiladas para reducir este costo en ejecuciones posteriores y las consultas compiladas pueden ser más eficaces que las consultas LINQ que se almacenan en memoria caché automáticamente.</span><span class="sxs-lookup"><span data-stu-id="e5479-107">However, you can still use compiled LINQ queries to reduce this cost in later executions and compiled queries can be more efficient than LINQ queries that are automatically cached.</span></span> <span data-ttu-id="e5479-108">LINQ to Entities consultas que aplican el `Enumerable.Contains` operador a colecciones en memoria no se almacenan en caché automáticamente.</span><span class="sxs-lookup"><span data-stu-id="e5479-108">LINQ to Entities queries that apply the `Enumerable.Contains` operator to in-memory collections are not automatically cached.</span></span> <span data-ttu-id="e5479-109">Además, no se permite la parametrización de colecciones en memoria en consultas LINQ compiladas.</span><span class="sxs-lookup"><span data-stu-id="e5479-109">Also, parameterizing in-memory collections in compiled LINQ queries is not allowed.</span></span>  
  
 <span data-ttu-id="e5479-110">La clase <xref:System.Data.Objects.CompiledQuery> permite la compilación y el almacenamiento en memoria caché de las consultas para volverlas a utilizar.</span><span class="sxs-lookup"><span data-stu-id="e5479-110">The <xref:System.Data.Objects.CompiledQuery> class provides compilation and caching of queries for reuse.</span></span> <span data-ttu-id="e5479-111">Desde un punto de vista conceptual, esta clase contiene un método <xref:System.Data.Objects.CompiledQuery> de `Compile` con varias sobrecargas.</span><span class="sxs-lookup"><span data-stu-id="e5479-111">Conceptually, this class contains a <xref:System.Data.Objects.CompiledQuery>'s `Compile` method with several overloads.</span></span> <span data-ttu-id="e5479-112">Llame al método `Compile` para crear un delegado nuevo que represente la consulta compilada.</span><span class="sxs-lookup"><span data-stu-id="e5479-112">Call the `Compile` method to create a new delegate to represent the compiled query.</span></span> <span data-ttu-id="e5479-113">Los métodos `Compile`, con <xref:System.Data.Objects.ObjectContext> y valores de parámetros, devuelven un delegado que produce algún resultado (por ejemplo, una instancia de <xref:System.Linq.IQueryable%601>).</span><span class="sxs-lookup"><span data-stu-id="e5479-113">The `Compile` methods, provided with a <xref:System.Data.Objects.ObjectContext> and parameter values, return a delegate that produces some result (such as an <xref:System.Linq.IQueryable%601> instance).</span></span> <span data-ttu-id="e5479-114">La consulta compila una vez solo durante la primera ejecución.</span><span class="sxs-lookup"><span data-stu-id="e5479-114">The query compiles once during only the first execution.</span></span> <span data-ttu-id="e5479-115">El conjunto de opciones de fusión mediante combinación de la consulta en el momento de la compilación no se puede cambiar posteriormente.</span><span class="sxs-lookup"><span data-stu-id="e5479-115">The merge options set for the query at the time of the compilation cannot be changed later.</span></span> <span data-ttu-id="e5479-116">Una vez compilada la consulta, solo se pueden proporcionar parámetros de tipo primitivo, pero no se pueden reemplazar partes de la consulta que cambien el SQL generado.</span><span class="sxs-lookup"><span data-stu-id="e5479-116">Once the query is compiled, you can only supply parameters of primitive type but you cannot replace parts of the query that would change the generated SQL.</span></span> <span data-ttu-id="e5479-117">Para obtener más información, vea [Opciones de combinación de EF y consultas compiladas](https://docs.microsoft.com/archive/blogs/dsimmons/ef-merge-options-and-compiled-queries).</span><span class="sxs-lookup"><span data-stu-id="e5479-117">For more information, see [EF Merge Options and Compiled Queries](https://docs.microsoft.com/archive/blogs/dsimmons/ef-merge-options-and-compiled-queries).</span></span>
  
 <span data-ttu-id="e5479-118">El LINQ to Entities expresión de consulta que <xref:System.Data.Objects.CompiledQuery> `Compile` compila el método de se representa mediante uno de los `Func` delegados genéricos, como <xref:System.Func%605> .</span><span class="sxs-lookup"><span data-stu-id="e5479-118">The LINQ to Entities query expression that the <xref:System.Data.Objects.CompiledQuery>'s `Compile` method compiles is represented by one of the generic `Func` delegates, such as <xref:System.Func%605>.</span></span> <span data-ttu-id="e5479-119">A lo sumo, la expresión de consulta puede encapsular un parámetro `ObjectContext`, un parámetro de retorno y 16 parámetros de consulta.</span><span class="sxs-lookup"><span data-stu-id="e5479-119">At most, the query expression can encapsulate an `ObjectContext` parameter, a return parameter, and 16 query parameters.</span></span> <span data-ttu-id="e5479-120">Si se requieren más de 16 parámetros de consulta, puede crear una estructura cuyas propiedades representan los parámetros de consulta.</span><span class="sxs-lookup"><span data-stu-id="e5479-120">If more than 16 query parameters are required, you can create a structure whose properties represent query parameters.</span></span> <span data-ttu-id="e5479-121">A continuación, puede utilizar las propiedades de la estructura de la expresión de consulta después de establecerlas.</span><span class="sxs-lookup"><span data-stu-id="e5479-121">You can then use the properties on the structure in the query expression after you set the properties.</span></span>  
  
## <a name="example-1"></a><span data-ttu-id="e5479-122">Ejemplo 1</span><span class="sxs-lookup"><span data-stu-id="e5479-122">Example 1</span></span>  
 <span data-ttu-id="e5479-123">En el ejemplo siguiente se compila y, a continuación, se llama a una consulta que acepta un parámetro de entrada <xref:System.Decimal> y devuelve una secuencia de pedidos cuyo importe total a pagar es mayor o igual que 200 $:</span><span class="sxs-lookup"><span data-stu-id="e5479-123">The following example compiles and then invokes a query that accepts a <xref:System.Decimal> input parameter and returns a sequence of orders where the total due is greater than or equal to $200.00:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query 2](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery2)]
 [!code-vb[DP L2E Conceptual Examples - compiled query2](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery2)]  
  
## <a name="example-2"></a><span data-ttu-id="e5479-124">Ejemplo 2</span><span class="sxs-lookup"><span data-stu-id="e5479-124">Example 2</span></span>  
 <span data-ttu-id="e5479-125">En el ejemplo siguiente se compila y, a continuación, se llama a una consulta que devuelve una instancia de <xref:System.Data.Objects.ObjectQuery%601>:</span><span class="sxs-lookup"><span data-stu-id="e5479-125">The following example compiles and then invokes a query that returns an <xref:System.Data.Objects.ObjectQuery%601> instance:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query1_MQ](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery1_mq)]
 [!code-vb[DP L2E Conceptual Examples - compiled query1_MQ](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery1_mq)]  
  
## <a name="example-3"></a><span data-ttu-id="e5479-126">Ejemplo 3</span><span class="sxs-lookup"><span data-stu-id="e5479-126">Example 3</span></span>  
 <span data-ttu-id="e5479-127">En el ejemplo siguiente se compila y, a continuación, se llama a una consulta que devuelve el promedio de los precios de venta de productos en forma de valor <xref:System.Decimal>:</span><span class="sxs-lookup"><span data-stu-id="e5479-127">The following example compiles and then invokes a query that returns the average of the product list prices as a <xref:System.Decimal> value:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query3_MQ](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery3_mq)]
 [!code-vb[DP L2E Conceptual Examples - compiled query3_MQ](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery3_mq)]  
  
## <a name="example-4"></a><span data-ttu-id="e5479-128">Ejemplo 4</span><span class="sxs-lookup"><span data-stu-id="e5479-128">Example 4</span></span>  
 <span data-ttu-id="e5479-129">En el ejemplo siguiente se compila y luego se llama a una consulta que acepta un <xref:System.String> parámetro de entrada y, a continuación, devuelve un `Contact` cuya dirección de correo electrónico comienza con la cadena especificada:</span><span class="sxs-lookup"><span data-stu-id="e5479-129">The following example compiles and then invokes a query that accepts a <xref:System.String> input parameter and then returns a `Contact` whose email address starts with the specified string:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query4_MQ](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery4_mq)]
 [!code-vb[DP L2E Conceptual Examples - compiled query4_MQ](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery4_mq)]  
  
## <a name="example-5"></a><span data-ttu-id="e5479-130">Ejemplo 5</span><span class="sxs-lookup"><span data-stu-id="e5479-130">Example 5</span></span>  
 <span data-ttu-id="e5479-131">En el ejemplo siguiente se compila y luego se llama a una consulta que acepta los parámetros de entrada <xref:System.DateTime> y <xref:System.Decimal> y, a continuación, devuelve una secuencia de pedidos cuya fecha es posterior al 8 de marzo de 2003 y cuyo importe total que pagar es inferior a 300 $:</span><span class="sxs-lookup"><span data-stu-id="e5479-131">The following example compiles and then invokes a query that accepts <xref:System.DateTime> and <xref:System.Decimal> input parameters and returns a sequence of orders where the order date is later than March 8, 2003, and the total due is less than $300.00:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query5](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery5)]
 [!code-vb[DP L2E Conceptual Examples - compiled query5](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery5)]  
  
## <a name="example-6"></a><span data-ttu-id="e5479-132">Ejemplo 6</span><span class="sxs-lookup"><span data-stu-id="e5479-132">Example 6</span></span>  
 <span data-ttu-id="e5479-133">En el ejemplo siguiente se compila y luego se llama a una consulta que acepta un parámetro de entrada <xref:System.DateTime> y, a continuación, devuelve una secuencia de pedidos cuya fecha es posterior al 8 de marzo de 2004.</span><span class="sxs-lookup"><span data-stu-id="e5479-133">The following example compiles and then invokes a query that accepts a <xref:System.DateTime> input parameter and returns a sequence of orders where the order date is later than March 8, 2004.</span></span> <span data-ttu-id="e5479-134">Esta consulta devuelve la información del pedido como una secuencia de tipos anónimos.</span><span class="sxs-lookup"><span data-stu-id="e5479-134">This query returns the order information as a sequence of anonymous types.</span></span> <span data-ttu-id="e5479-135">El compilador deduce los tipos anónimos, de modo que no se pueden especificar parámetros de tipo en el método <xref:System.Data.Objects.CompiledQuery> de `Compile` y el tipo se define en la propia consulta.</span><span class="sxs-lookup"><span data-stu-id="e5479-135">Anonymous types are inferred by the compiler, so you cannot specify type parameters in the <xref:System.Data.Objects.CompiledQuery>'s `Compile` method and the type is defined in the query itself.</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query6](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery6)]
 [!code-vb[DP L2E Conceptual Examples - compiled query6](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery6)]  
  
## <a name="example-7"></a><span data-ttu-id="e5479-136">Ejemplo 7</span><span class="sxs-lookup"><span data-stu-id="e5479-136">Example 7</span></span>  
 <span data-ttu-id="e5479-137">En el ejemplo siguiente se compila y luego se llama a una consulta que acepta un parámetro de entrada con una estructura definida por el usuario y, a continuación, devuelve una secuencia de pedidos.</span><span class="sxs-lookup"><span data-stu-id="e5479-137">The following example compiles and then invokes a query that accepts a user-defined structure input parameter and returns a sequence of orders.</span></span> <span data-ttu-id="e5479-138">La estructura define los parámetros de la consulta correspondientes a la fecha de inicio, la fecha de fin y la deuda total, y la consulta devuelve los pedidos distribuidos entre el 3 de marzo y el 8 de marzo de 2003 con un importe total mayor que 700,00$.</span><span class="sxs-lookup"><span data-stu-id="e5479-138">The structure defines start date, end date, and total due query parameters, and the query returns orders shipped between March 3 and March 8, 2003 with a total due greater than $700.00.</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query7](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery7)]
 [!code-vb[DP L2E Conceptual Examples - compiled query7](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery7)]  
  
 <span data-ttu-id="e5479-139">La estructura que define los parámetros de la consulta:</span><span class="sxs-lookup"><span data-stu-id="e5479-139">The structure that defines the query parameters:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - MyParamsStruct](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#myparamsstruct)]
 [!code-vb[DP L2E Conceptual Examples - MyParamsStruct](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#myparamsstruct)]  
  
## <a name="see-also"></a><span data-ttu-id="e5479-140">Consulte también</span><span class="sxs-lookup"><span data-stu-id="e5479-140">See also</span></span>

- [<span data-ttu-id="e5479-141">ADO.NET Entity Framework</span><span class="sxs-lookup"><span data-stu-id="e5479-141">ADO.NET Entity Framework</span></span>](../index.md)
- [<span data-ttu-id="e5479-142">LINQ to Entities</span><span class="sxs-lookup"><span data-stu-id="e5479-142">LINQ to Entities</span></span>](linq-to-entities.md)
- [<span data-ttu-id="e5479-143">Opciones de combinación de EF y consultas compiladas</span><span class="sxs-lookup"><span data-stu-id="e5479-143">EF Merge Options and Compiled Queries</span></span>](https://docs.microsoft.com/archive/blogs/dsimmons/ef-merge-options-and-compiled-queries)
