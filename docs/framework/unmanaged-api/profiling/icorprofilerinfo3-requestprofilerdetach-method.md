---
title: ICorProfilerInfo3::RequestProfilerDetach (Método)
ms.date: 03/30/2017
api_name:
- ICorProfilerInfo3.RequestProfilerDetach Method
api_location:
- mscorwks.dll
api_type:
- COM
f1_keywords:
- ICorProfilerInfo3::RequestProfilerDetach
helpviewer_keywords:
- RequestProfilerDetach method [.NET Framework profiling]
- ICorProfilerInfo3::RequestProfilerDetach method [.NET Framework profiling]
ms.assetid: ea102e62-0454-4477-bcf3-126773acd184
topic_type:
- apiref
ms.openlocfilehash: 226f24ad8f1636101b283c3cb6662905cbf7eebe
ms.sourcegitcommit: 7e2128d4a4c45b4274bea3b8e5760d4694569ca1
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/14/2020
ms.locfileid: "75938208"
---
# <a name="icorprofilerinfo3requestprofilerdetach-method"></a><span data-ttu-id="f0528-102">ICorProfilerInfo3::RequestProfilerDetach (Método)</span><span class="sxs-lookup"><span data-stu-id="f0528-102">ICorProfilerInfo3::RequestProfilerDetach Method</span></span>
<span data-ttu-id="f0528-103">Indica al CLR que desasocie el generador de perfiles.</span><span class="sxs-lookup"><span data-stu-id="f0528-103">Instructs the runtime to detach the profiler.</span></span>  
  
## <a name="syntax"></a><span data-ttu-id="f0528-104">Sintaxis</span><span class="sxs-lookup"><span data-stu-id="f0528-104">Syntax</span></span>  
  
```cpp  
HRESULT RequestProfilerDetach(  
   [in] DWORD    dwExpectedCompletionMilliseconds);  
```  
  
## <a name="parameters"></a><span data-ttu-id="f0528-105">Parameters</span><span class="sxs-lookup"><span data-stu-id="f0528-105">Parameters</span></span>  
 `dwExpectedCompletionMilliseconds`  
 <span data-ttu-id="f0528-106">[in] Período de tiempo, en milisegundos, que Common Language Runtime (CLR) debe esperar antes de comprobar si es seguro descargar el generador de perfiles.</span><span class="sxs-lookup"><span data-stu-id="f0528-106">[in] The length of time, in milliseconds, the common language runtime (CLR) should wait before checking to see whether it is safe to unload the profiler.</span></span>  
  
## <a name="return-value"></a><span data-ttu-id="f0528-107">Valor devuelto</span><span class="sxs-lookup"><span data-stu-id="f0528-107">Return Value</span></span>  
 <span data-ttu-id="f0528-108">Este método devuelve los siguientes HRESULT específicos y los errores HRESULT que indican un error del método.</span><span class="sxs-lookup"><span data-stu-id="f0528-108">This method returns the following specific HRESULTs as well as HRESULT errors that indicate method failure.</span></span>  
  
|<span data-ttu-id="f0528-109">HRESULT</span><span class="sxs-lookup"><span data-stu-id="f0528-109">HRESULT</span></span>|<span data-ttu-id="f0528-110">Descripción</span><span class="sxs-lookup"><span data-stu-id="f0528-110">Description</span></span>|  
|-------------|-----------------|  
|<span data-ttu-id="f0528-111">S_OK</span><span class="sxs-lookup"><span data-stu-id="f0528-111">S_OK</span></span>|<span data-ttu-id="f0528-112">La solicitud de desasociación es válida y el procedimiento de desasociación continuará ahora en otro subproceso.</span><span class="sxs-lookup"><span data-stu-id="f0528-112">The detach request is valid, and the detach procedure is now continuing on another thread.</span></span> <span data-ttu-id="f0528-113">Una vez completada totalmente la desasociación, se genera un evento `ProfilerDetachSucceeded`.</span><span class="sxs-lookup"><span data-stu-id="f0528-113">When the detach is fully complete, a `ProfilerDetachSucceeded` event is issued.</span></span>|  
|<span data-ttu-id="f0528-114">E_ CORPROF_E_CALLBACK3_REQUIRED</span><span class="sxs-lookup"><span data-stu-id="f0528-114">E_ CORPROF_E_CALLBACK3_REQUIRED</span></span>|<span data-ttu-id="f0528-115">Error del generador de perfiles en un intento [IUnknown:: QueryInterface](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) de la interfaz [ICorProfilerCallback3](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback3-interface.md) , que debe implementar para admitir la operación de desasociación.</span><span class="sxs-lookup"><span data-stu-id="f0528-115">The profiler failed an [IUnknown::QueryInterface](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) attempt for the [ICorProfilerCallback3](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback3-interface.md) interface, which it must implement to support the detach operation.</span></span> <span data-ttu-id="f0528-116">La desasociación no se intentó.</span><span class="sxs-lookup"><span data-stu-id="f0528-116">Detach was not attempted.</span></span>|  
|<span data-ttu-id="f0528-117">CORPROF_E_IMMUTABLE_FLAGS_SET</span><span class="sxs-lookup"><span data-stu-id="f0528-117">CORPROF_E_IMMUTABLE_FLAGS_SET</span></span>|<span data-ttu-id="f0528-118">No se puede realizar la desasociación porque el generador de perfiles establece marcas inmutables en el inicio.</span><span class="sxs-lookup"><span data-stu-id="f0528-118">Detachment is impossible because the profiler set immutable flags at startup.</span></span> <span data-ttu-id="f0528-119">No se intentó la desasociación; el generador de perfiles sigue totalmente asociado.</span><span class="sxs-lookup"><span data-stu-id="f0528-119">Detachment was not attempted; the profiler is still fully attached.</span></span>|  
|<span data-ttu-id="f0528-120">CORPROF_E_IRREVERSIBLE_INSTRUMENTATION_PRESENT</span><span class="sxs-lookup"><span data-stu-id="f0528-120">CORPROF_E_IRREVERSIBLE_INSTRUMENTATION_PRESENT</span></span>|<span data-ttu-id="f0528-121">No es posible la desasociación porque el generador de perfiles usó código del lenguaje intermedio de Microsoft (MSIL) o insertado `enter`/enlaces `leave`.</span><span class="sxs-lookup"><span data-stu-id="f0528-121">Detachment is impossible because the profiler used instrumented Microsoft intermediate language (MSIL) code, or inserted `enter`/`leave` hooks.</span></span> <span data-ttu-id="f0528-122">No se intentó la desasociación; el generador de perfiles sigue totalmente asociado.</span><span class="sxs-lookup"><span data-stu-id="f0528-122">Detachment was not attempted; the profiler is still fully attached.</span></span><br /><br /> <span data-ttu-id="f0528-123">**Nota:** MSIL instrumentado es el código que proporciona el generador de perfiles mediante el método [SetILFunctionBody (](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo-setilfunctionbody-method.md) .</span><span class="sxs-lookup"><span data-stu-id="f0528-123">**Note** Instrumented MSIL is code is code that is provided by the profiler using the [SetILFunctionBody](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo-setilfunctionbody-method.md) method.</span></span>|  
|<span data-ttu-id="f0528-124">CORPROF_E_RUNTIME_UNINITIALIZED</span><span class="sxs-lookup"><span data-stu-id="f0528-124">CORPROF_E_RUNTIME_UNINITIALIZED</span></span>|<span data-ttu-id="f0528-125">El tiempo de ejecución no se ha inicializado aún en la aplicación administrada.</span><span class="sxs-lookup"><span data-stu-id="f0528-125">The runtime has not been initialized yet in the managed application.</span></span> <span data-ttu-id="f0528-126">(Es decir, el tiempo de ejecución no se ha cargado completamente). Este código de error se puede devolver cuando se solicita la desasociación dentro del método [ICorProfilerCallback:: Initialize](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-initialize-method.md) de la devolución de llamada del generador de perfiles.</span><span class="sxs-lookup"><span data-stu-id="f0528-126">(That is, the runtime has not been fully loaded.) This error code may be returned when detachment is requested inside the profiler callback's [ICorProfilerCallback::Initialize](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-initialize-method.md) method.</span></span>|  
|<span data-ttu-id="f0528-127">CORPROF_E_UNSUPPORTED_CALL_SEQUENCE</span><span class="sxs-lookup"><span data-stu-id="f0528-127">CORPROF_E_UNSUPPORTED_CALL_SEQUENCE</span></span>|<span data-ttu-id="f0528-128">Se llamó a `RequestProfilerDetach` en un momento no permitido.</span><span class="sxs-lookup"><span data-stu-id="f0528-128">`RequestProfilerDetach` was called at an unsupported time.</span></span> <span data-ttu-id="f0528-129">Esto sucede si se llama al método en un subproceso administrado pero no desde dentro de un método [ICorProfilerCallback](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-interface.md) o desde un método [ICorProfilerCallback](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-interface.md) que no puede tolerar una recolección de elementos no utilizados.</span><span class="sxs-lookup"><span data-stu-id="f0528-129">This occurs if the method is called on a managed thread but not from within an [ICorProfilerCallback](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-interface.md) method or from within an [ICorProfilerCallback](../../../../docs/framework/unmanaged-api/profiling/icorprofilercallback-interface.md) method that cannot tolerate a garbage collection.</span></span> <span data-ttu-id="f0528-130">Para obtener más información, vea [CORPROF_E_UNSUPPORTED_CALL_SEQUENCE HRESULT](../../../../docs/framework/unmanaged-api/profiling/corprof-e-unsupported-call-sequence-hresult.md).</span><span class="sxs-lookup"><span data-stu-id="f0528-130">For more information, see [CORPROF_E_UNSUPPORTED_CALL_SEQUENCE HRESULT](../../../../docs/framework/unmanaged-api/profiling/corprof-e-unsupported-call-sequence-hresult.md).</span></span>|  
  
## <a name="remarks"></a><span data-ttu-id="f0528-131">Notas</span><span class="sxs-lookup"><span data-stu-id="f0528-131">Remarks</span></span>  
 <span data-ttu-id="f0528-132">Durante el procedimiento de desasociación, el subproceso de desasociación (el subproceso creado específicamente para desasociar el generador de perfiles) comprueba ocasionalmente si todos los subprocesos han salido del código del generador de perfiles.</span><span class="sxs-lookup"><span data-stu-id="f0528-132">During the detach procedure, the detach thread (the thread created specifically for detaching the profiler) occasionally checks whether all threads have exited the profiler’s code.</span></span> <span data-ttu-id="f0528-133">El generador de perfiles debe proporcionar una estimación de cuánto tiempo deben tardar usando para ello el parámetro `dwExpectedCompletionMilliseconds`.</span><span class="sxs-lookup"><span data-stu-id="f0528-133">The profiler should provide an estimate of how long this should take through the `dwExpectedCompletionMilliseconds` parameter.</span></span> <span data-ttu-id="f0528-134">Un valor adecuado es la cantidad de tiempo típica que el generador de perfiles invierte dentro de un método `ICorProfilerCallback*` cualquiera; este valor no debe ser menor que la mitad de la cantidad máxima de tiempo que el generador de perfiles espera invertir.</span><span class="sxs-lookup"><span data-stu-id="f0528-134">A good value to use is the typical amount of time the profiler spends inside any given `ICorProfilerCallback*` method; this value should not be less than half of the maximum amount of time the profiler expects to spend.</span></span>  
  
 <span data-ttu-id="f0528-135">El subproceso de desasociación usa `dwExpectedCompletionMilliseconds` para decidir cuánto tiempo debe esperar antes de comprobar si el código de devolución de llamada del generador de perfiles se ha extraído de todas las pilas.</span><span class="sxs-lookup"><span data-stu-id="f0528-135">The detach thread uses `dwExpectedCompletionMilliseconds` to decide how long to sleep before checking whether profiler callback code has been popped off all stacks.</span></span> <span data-ttu-id="f0528-136">Aunque los detalles del siguiente algoritmo pueden cambiar en futuras versiones del CLR, ilustra una forma de usar `dwExpectedCompletionMilliseconds` para determinar cuándo es seguro descargar el generador de perfiles.</span><span class="sxs-lookup"><span data-stu-id="f0528-136">Although the details of the following algorithm may change in future releases of the CLR, it illustrates one way `dwExpectedCompletionMilliseconds` can be used when determining when it is safe to unload the profiler.</span></span> <span data-ttu-id="f0528-137">El subproceso de desasociación espera primero `dwExpectedCompletionMilliseconds` milisegundos.</span><span class="sxs-lookup"><span data-stu-id="f0528-137">The detach thread first sleeps for `dwExpectedCompletionMilliseconds` milliseconds.</span></span> <span data-ttu-id="f0528-138">Si, después de la activación de la suspensión, el CLR encuentra que el código de devolución de llamada del generador de perfiles sigue presente, el subproceso de desasociación se vuelve a suspender, esta vez dos veces `dwExpectedCompletionMilliseconds` milisegundos.</span><span class="sxs-lookup"><span data-stu-id="f0528-138">If, after awakening from the sleep, the CLR finds that profiler callback code is still present, the detach thread sleeps again, this time for two times `dwExpectedCompletionMilliseconds` milliseconds.</span></span> <span data-ttu-id="f0528-139">Si después de volver de este segundo estado de suspensión, el subproceso de desasociación descubre que aún hay código de devolución de llamada del generador de perfiles, entra en suspensión durante 10 minutos antes de volver a comprobar.</span><span class="sxs-lookup"><span data-stu-id="f0528-139">If, after awakening from this second sleep, the detach thread finds that profiler callback code is still present, it sleeps for 10 minutes before checking again.</span></span> <span data-ttu-id="f0528-140">El subproceso de desasociación sigue realizando la comprobación cada 10 minutos.</span><span class="sxs-lookup"><span data-stu-id="f0528-140">The detach thread continues to recheck every 10 minutes.</span></span>  
  
 <span data-ttu-id="f0528-141">Si el generador de perfiles especifica `dwExpectedCompletionMilliseconds` como 0 (cero), el CLR usa un valor predeterminado de 5000, lo que significa que realizará una comprobación después de 5 segundos, otra vez después de 10 segundos y, a partir de entonces, cada 10 minutos.</span><span class="sxs-lookup"><span data-stu-id="f0528-141">If the profiler specifies `dwExpectedCompletionMilliseconds` as 0 (zero), the CLR uses a default value of 5000, which means that it will perform a check after 5 seconds, again after 10 seconds, and then every 10 minutes thereafter.</span></span>  
  
## <a name="requirements"></a><span data-ttu-id="f0528-142">Requisitos de</span><span class="sxs-lookup"><span data-stu-id="f0528-142">Requirements</span></span>  
 <span data-ttu-id="f0528-143">**Plataformas:** Vea [Requisitos de sistema](../../../../docs/framework/get-started/system-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="f0528-143">**Platforms:** See [System Requirements](../../../../docs/framework/get-started/system-requirements.md).</span></span>  
  
 <span data-ttu-id="f0528-144">**Encabezado:** CorProf.idl, CorProf.h</span><span class="sxs-lookup"><span data-stu-id="f0528-144">**Header:** CorProf.idl, CorProf.h</span></span>  
  
 <span data-ttu-id="f0528-145">**Biblioteca:** CorGuids.lib</span><span class="sxs-lookup"><span data-stu-id="f0528-145">**Library:** CorGuids.lib</span></span>  
  
 <span data-ttu-id="f0528-146">**.NET Framework versiones:** [!INCLUDE[net_current_v40plus](../../../../includes/net-current-v40plus-md.md)]</span><span class="sxs-lookup"><span data-stu-id="f0528-146">**.NET Framework Versions:** [!INCLUDE[net_current_v40plus](../../../../includes/net-current-v40plus-md.md)]</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f0528-147">Vea también</span><span class="sxs-lookup"><span data-stu-id="f0528-147">See also</span></span>

- [<span data-ttu-id="f0528-148">ICorProfilerInfo3 (interfaz)</span><span class="sxs-lookup"><span data-stu-id="f0528-148">ICorProfilerInfo3 Interface</span></span>](../../../../docs/framework/unmanaged-api/profiling/icorprofilerinfo3-interface.md)
- [<span data-ttu-id="f0528-149">Interfaces para generación de perfiles</span><span class="sxs-lookup"><span data-stu-id="f0528-149">Profiling Interfaces</span></span>](../../../../docs/framework/unmanaged-api/profiling/profiling-interfaces.md)
- [<span data-ttu-id="f0528-150">Generación de perfiles</span><span class="sxs-lookup"><span data-stu-id="f0528-150">Profiling</span></span>](../../../../docs/framework/unmanaged-api/profiling/index.md)
