---
title: UI Automation y ajuste de escala de la pantalla
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- scaling, screens
- screens, scaling
- UI (user interface), automation
- UI Automation
ms.assetid: 4380cad7-e509-448f-b9a5-6de042605fd4
ms.openlocfilehash: 645c44998812453008fc91d5cf4b8463c51bef9a
ms.sourcegitcommit: 9a97c76e141333394676bc5d264c6624b6f45bcf
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2020
ms.locfileid: "75741731"
---
# <a name="ui-automation-and-screen-scaling"></a><span data-ttu-id="76b76-102">UI Automation y ajuste de escala de la pantalla</span><span class="sxs-lookup"><span data-stu-id="76b76-102">UI Automation and Screen Scaling</span></span>
> [!NOTE]
> <span data-ttu-id="76b76-103">Esta documentación está dirigida a los desarrolladores de .NET Framework que quieran usar las clases [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] administradas definidas en el espacio de nombres <xref:System.Windows.Automation>.</span><span class="sxs-lookup"><span data-stu-id="76b76-103">This documentation is intended for .NET Framework developers who want to use the managed [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] classes defined in the <xref:System.Windows.Automation> namespace.</span></span> <span data-ttu-id="76b76-104">Para ver la información más reciente acerca de [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)], consulte [Windows Automation API: automatización de la interfaz de usuario](/windows/win32/winauto/entry-uiauto-win32).</span><span class="sxs-lookup"><span data-stu-id="76b76-104">For the latest information about [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)], see [Windows Automation API: UI Automation](/windows/win32/winauto/entry-uiauto-win32).</span></span>  
  
<span data-ttu-id="76b76-105">A partir de Windows Vista, Windows permite a los usuarios cambiar la configuración de puntos por pulgada (PPP) para que la mayoría de los elementos de la interfaz de usuario de la pantalla parezcan más grandes.</span><span class="sxs-lookup"><span data-stu-id="76b76-105">Starting with Windows Vista, Windows enables users to change the dots per inch (dpi) setting so that most user interface (UI) elements on the screen appear larger.</span></span> <span data-ttu-id="76b76-106">Aunque esta característica ha estado disponible durante mucho tiempo en Windows, en versiones anteriores, el escalado debía ser implementado por aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="76b76-106">Although this feature has long been available in Windows, in previous versions the scaling had to be implemented by applications.</span></span> <span data-ttu-id="76b76-107">A partir de Windows Vista, el Administrador de ventanas de escritorio realiza el escalado predeterminado para todas las aplicaciones que no controlan su propia escala.</span><span class="sxs-lookup"><span data-stu-id="76b76-107">Starting with Windows Vista, the Desktop Window Manager performs default scaling for all applications that do not handle their own scaling.</span></span> <span data-ttu-id="76b76-108">Las aplicaciones cliente de automatización de la interfaz de usuario deben tener en cuenta esta característica.</span><span class="sxs-lookup"><span data-stu-id="76b76-108">UI Automation client applications must take this feature into account.</span></span>  
  
<a name="Scaling_in_Windows_Vista"></a>   
## <a name="scaling-in-windows-vista"></a><span data-ttu-id="76b76-109">Escalado en Windows Vista</span><span class="sxs-lookup"><span data-stu-id="76b76-109">Scaling in Windows Vista</span></span>  
 <span data-ttu-id="76b76-110">La configuración de PPP predeterminada es 96, lo que significa que 96 píxeles ocupan el ancho o el alto de una pulgada teórica.</span><span class="sxs-lookup"><span data-stu-id="76b76-110">The default dpi setting is 96, which means that 96 pixels occupy a width or height of one notional inch.</span></span> <span data-ttu-id="76b76-111">La medida exacta de una "pulgada" depende del tamaño y de la resolución física del monitor.</span><span class="sxs-lookup"><span data-stu-id="76b76-111">The exact measure of an "inch" depends on the size and physical resolution of the monitor.</span></span> <span data-ttu-id="76b76-112">Por ejemplo, en un monitor de 12 pulgadas de ancho, con una resolución horizontal de 1280 píxeles, una línea horizontal de 96 píxeles se amplía aproximadamente 9/10 de una pulgada.</span><span class="sxs-lookup"><span data-stu-id="76b76-112">For example, on a monitor 12 inches wide, at a horizontal resolution of 1280 pixels, a horizontal line of 96 pixels extends about 9/10 of an inch.</span></span>  
  
 <span data-ttu-id="76b76-113">Cambiar la configuración de PPP no es lo mismo que cambiar la resolución de pantalla.</span><span class="sxs-lookup"><span data-stu-id="76b76-113">Changing the dpi setting is not the same as changing the screen resolution.</span></span> <span data-ttu-id="76b76-114">Con el ajuste de escala de PPP, el número de píxeles físicos de la pantalla sigue siendo el mismo.</span><span class="sxs-lookup"><span data-stu-id="76b76-114">With dpi scaling, the number of physical pixels on the screen remains the same.</span></span> <span data-ttu-id="76b76-115">Sin embargo, se aplica el ajuste de escala al tamaño y a la ubicación de los elementos [!INCLUDE[TLA2#tla_ui](../../../includes/tla2sharptla-ui-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="76b76-115">However, scaling is applied to the size and location of [!INCLUDE[TLA2#tla_ui](../../../includes/tla2sharptla-ui-md.md)] elements.</span></span> <span data-ttu-id="76b76-116">Este ajuste de escala se puede realizar automáticamente mediante el Administrador de ventanas de escritorio (DWM) para el escritorio y para las aplicaciones que no solicitan explícitamente para cambiar de escala.</span><span class="sxs-lookup"><span data-stu-id="76b76-116">This scaling can be performed automatically by the Desktop Window Manager (DWM) for the desktop and for applications that do not explicitly ask not to be scaled.</span></span>  
  
 <span data-ttu-id="76b76-117">En efecto, cuando el usuario establece el factor de escala en 120 ppp, una pulgada vertical u horizontal en la pantalla aumenta en un 25 por ciento.</span><span class="sxs-lookup"><span data-stu-id="76b76-117">In effect, when the user sets the scale factor to 120 dpi, a vertical or horizontal inch on the screen becomes bigger by 25 percent.</span></span> <span data-ttu-id="76b76-118">Todas las dimensiones se escalan en consecuencia.</span><span class="sxs-lookup"><span data-stu-id="76b76-118">All dimensions are scaled accordingly.</span></span> <span data-ttu-id="76b76-119">El desplazamiento de una ventana de aplicación desde los bordes superior e izquierdo de la pantalla aumenta en un 25 por ciento.</span><span class="sxs-lookup"><span data-stu-id="76b76-119">The offset of an application window from the top and left edges of the screen increases by 25 percent.</span></span> <span data-ttu-id="76b76-120">Si el ajuste de escala de aplicación está habilitado y la aplicación no es compatible con los PPP, el tamaño de la ventana aumenta en la misma proporción, junto con los desplazamientos y los tamaños de todos los elementos de [!INCLUDE[TLA2#tla_ui](../../../includes/tla2sharptla-ui-md.md)] que contiene.</span><span class="sxs-lookup"><span data-stu-id="76b76-120">If application scaling is enabled and the application is not dpi-aware, the size of the window increases in the same proportion, along with the offsets and sizes of all [!INCLUDE[TLA2#tla_ui](../../../includes/tla2sharptla-ui-md.md)] elements it contains.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="76b76-121">De forma predeterminada, el DWM no realiza el escalado para las aplicaciones no compatibles con PPP cuando el usuario establece el PPP en 120, pero lo realiza cuando el valor de PPP se establece en un valor personalizado de 144 o superior.</span><span class="sxs-lookup"><span data-stu-id="76b76-121">By default, the DWM does not perform scaling for non-dpi-aware applications when the user sets the dpi to 120, but does perform it when the dpi is set to a custom value of 144 or higher.</span></span> <span data-ttu-id="76b76-122">Sin embargo, el usuario puede invalidar el comportamiento predeterminado.</span><span class="sxs-lookup"><span data-stu-id="76b76-122">However, the user can override the default behavior.</span></span>  
  
 <span data-ttu-id="76b76-123">El escalado de pantalla crea nuevos desafíos para las aplicaciones a las que les preocupa de cualquier manera las coordenadas de pantalla.</span><span class="sxs-lookup"><span data-stu-id="76b76-123">Screen scaling creates new challenges for applications that are concerned in any way with screen coordinates.</span></span> <span data-ttu-id="76b76-124">La pantalla contiene ahora dos sistemas de coordenadas: físico y lógico.</span><span class="sxs-lookup"><span data-stu-id="76b76-124">The screen now contains two coordinate systems: physical and logical.</span></span> <span data-ttu-id="76b76-125">Las coordenadas físicas de un punto son el desplazamiento real en píxeles desde la parte superior izquierda del origen.</span><span class="sxs-lookup"><span data-stu-id="76b76-125">The physical coordinates of a point are the actual offset in pixels from the top left of the origin.</span></span> <span data-ttu-id="76b76-126">Las coordenadas lógicas son los desplazamientos de la manera que serían si se escalaran los propios píxeles.</span><span class="sxs-lookup"><span data-stu-id="76b76-126">The logical coordinates are the offsets as they would be if the pixels themselves were scaled.</span></span>  
  
 <span data-ttu-id="76b76-127">Supongamos que diseña un cuadro de diálogo con un botón en las coordenadas (100, 48).</span><span class="sxs-lookup"><span data-stu-id="76b76-127">Suppose you design a dialog box with a button at coordinates (100, 48).</span></span> <span data-ttu-id="76b76-128">Cuando se muestra este cuadro de diálogo con el valor predeterminado de 96 PPP, el botón se encuentra en las coordenadas físicas de (100, 48).</span><span class="sxs-lookup"><span data-stu-id="76b76-128">When this dialog box is displayed at the default 96 dpi, the button is located at physical coordinates of (100, 48).</span></span> <span data-ttu-id="76b76-129">En 120 ppp, se encuentra en las coordenadas físicas de (125, 60).</span><span class="sxs-lookup"><span data-stu-id="76b76-129">At 120 dpi, it is located at physical coordinates of (125, 60).</span></span> <span data-ttu-id="76b76-130">Sin embargo, las coordenadas lógicas son las mismas en cualquier configuración de PPP: (100, 48).</span><span class="sxs-lookup"><span data-stu-id="76b76-130">But the logical coordinates are the same at any dpi setting: (100, 48).</span></span>  
  
 <span data-ttu-id="76b76-131">Las coordenadas lógicas son importantes porque hacen que el comportamiento del sistema operativo y las aplicaciones sean coherentes, independientemente de la configuración de PPP.</span><span class="sxs-lookup"><span data-stu-id="76b76-131">Logical coordinates are important, because they make the behavior of the operating system and applications consistent regardless of the dpi setting.</span></span> <span data-ttu-id="76b76-132">Por ejemplo, <xref:System.Windows.Forms.Cursor.Position%2A?displayProperty=nameWithType> normalmente devuelve las coordenadas lógicas.</span><span class="sxs-lookup"><span data-stu-id="76b76-132">For example, <xref:System.Windows.Forms.Cursor.Position%2A?displayProperty=nameWithType> normally returns the logical coordinates.</span></span> <span data-ttu-id="76b76-133">Si mueve el cursor sobre un elemento en un cuadro de diálogo, se devuelven las mismas coordenadas independientemente del valor de PPP.</span><span class="sxs-lookup"><span data-stu-id="76b76-133">If you move the cursor over an element in a dialog box, the same coordinates are returned regardless of the dpi setting.</span></span> <span data-ttu-id="76b76-134">Si dibuja un control en (100, 100), se dibuja en esas coordenadas lógicas y ocupará la misma posición relativa en cualquier valor de PPP.</span><span class="sxs-lookup"><span data-stu-id="76b76-134">If you draw a control at (100, 100), it is drawn to those logical coordinates, and will occupy the same relative position at any dpi setting.</span></span>  
  
<a name="Scaling_in_UI_Automation_Clients"></a>   
## <a name="scaling-in-ui-automation-clients"></a><span data-ttu-id="76b76-135">Escalado en los clientes de automatización de la interfaz de usuario</span><span class="sxs-lookup"><span data-stu-id="76b76-135">Scaling in UI Automation Clients</span></span>  
 <span data-ttu-id="76b76-136">La API de [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] no usa coordenadas lógicas.</span><span class="sxs-lookup"><span data-stu-id="76b76-136">The [!INCLUDE[TLA2#tla_uiautomation](../../../includes/tla2sharptla-uiautomation-md.md)] API does not use logical coordinates.</span></span> <span data-ttu-id="76b76-137">Los siguientes métodos y propiedades devuelven coordenadas físicas o las toman como parámetros.</span><span class="sxs-lookup"><span data-stu-id="76b76-137">The following methods and properties either return physical coordinates or take them as parameters.</span></span>  
  
- <xref:System.Windows.Automation.AutomationElement.GetClickablePoint%2A>  
  
- <xref:System.Windows.Automation.AutomationElement.TryGetClickablePoint%2A>  
  
- <xref:System.Windows.Automation.AutomationElement.ClickablePointProperty>  
  
- <xref:System.Windows.Automation.AutomationElement.FromPoint%2A>  
  
- <xref:System.Windows.Automation.AutomationElement.AutomationElementInformation.BoundingRectangle%2A>  
  
 <span data-ttu-id="76b76-138">De forma predeterminada, una aplicación cliente de automatización de la interfaz de usuario que se ejecute en un entorno que no sea de 96 PPP no podrá obtener resultados correctos de estos métodos y propiedades.</span><span class="sxs-lookup"><span data-stu-id="76b76-138">By default, a UI Automation client application running in a non-96- dpi environment will not be able to obtain correct results from these methods and properties.</span></span> <span data-ttu-id="76b76-139">Por ejemplo, dado que la posición del cursor se encuentra en coordenadas lógicas, el cliente no podrá pasar simplemente estas coordenadas a <xref:System.Windows.Automation.AutomationElement.FromPoint%2A> para obtener el elemento que se encuentra debajo del cursor.</span><span class="sxs-lookup"><span data-stu-id="76b76-139">For example, because the cursor position is in logical coordinates, the client cannot simply pass these coordinates to <xref:System.Windows.Automation.AutomationElement.FromPoint%2A> to obtain the element that is under the cursor.</span></span> <span data-ttu-id="76b76-140">Además, la aplicación no podrá colocar correctamente ventanas fuera de su área de cliente.</span><span class="sxs-lookup"><span data-stu-id="76b76-140">In addition, the application will not be able to correctly place windows outside its client area.</span></span>  
  
 <span data-ttu-id="76b76-141">La solución consta de dos partes.</span><span class="sxs-lookup"><span data-stu-id="76b76-141">The solution is in two parts.</span></span>  
  
1. <span data-ttu-id="76b76-142">En primer lugar, haga que la aplicación cliente sea compatible con PPP.</span><span class="sxs-lookup"><span data-stu-id="76b76-142">First, make the client application dpi-aware.</span></span> <span data-ttu-id="76b76-143">Para ello, llame a la función de Win32 `SetProcessDPIAware` en el inicio.</span><span class="sxs-lookup"><span data-stu-id="76b76-143">To do this, call the Win32 function `SetProcessDPIAware` at startup.</span></span> <span data-ttu-id="76b76-144">En código administrado, la siguiente declaración hace que esta función esté disponible.</span><span class="sxs-lookup"><span data-stu-id="76b76-144">In managed code, the following declaration makes this function available.</span></span>  
  
     [!code-csharp[Highlighter#101](../../../samples/snippets/csharp/VS_Snippets_Wpf/Highlighter/CSharp/NativeMethods.cs#101)]
     [!code-vb[Highlighter#101](../../../samples/snippets/visualbasic/VS_Snippets_Wpf/Highlighter/VisualBasic/NativeMethods.vb#101)]  
  
     <span data-ttu-id="76b76-145">Esta función hace que todo el proceso sea compatible con PPP, lo que significa que todas las ventanas que pertenecen al proceso no se escalan.</span><span class="sxs-lookup"><span data-stu-id="76b76-145">This function makes the entire process dpi-aware, meaning that all windows that belong to the process are unscaled.</span></span> <span data-ttu-id="76b76-146">En el [ejemplo de marcador de resaltado](https://github.com/Microsoft/WPF-Samples/tree/master/Accessibility/Highlighter), por ejemplo, las cuatro ventanas que componen el rectángulo resaltado se encuentran en las coordenadas físicas obtenidas de la automatización de la interfaz de usuario, no en las coordenadas lógicas.</span><span class="sxs-lookup"><span data-stu-id="76b76-146">In the [Highlighter Sample](https://github.com/Microsoft/WPF-Samples/tree/master/Accessibility/Highlighter), for instance, the four windows that make up the highlight rectangle are located at the physical coordinates obtained from UI Automation, not the logical coordinates.</span></span> <span data-ttu-id="76b76-147">Si el ejemplo no tiene en cuenta el valor de PPP, el resaltado se dibujaría en las coordenadas lógicas del escritorio, lo que daría lugar a una ubicación incorrecta en un entorno que no es de 96 ppp.</span><span class="sxs-lookup"><span data-stu-id="76b76-147">If the sample were not dpi-aware, the highlight would be drawn at the logical coordinates on the desktop, which would result in incorrect placement in a non-96- dpi environment.</span></span>  
  
2. <span data-ttu-id="76b76-148">Para obtener las coordenadas de cursor, llame a la función de Win32 `GetPhysicalCursorPos`.</span><span class="sxs-lookup"><span data-stu-id="76b76-148">To get cursor coordinates, call the Win32 function `GetPhysicalCursorPos`.</span></span> <span data-ttu-id="76b76-149">En el ejemplo siguiente se muestra cómo declarar y usar esta función.</span><span class="sxs-lookup"><span data-stu-id="76b76-149">The following example shows how to declare and use this function.</span></span>  
  
     [!code-csharp[UIAClient_snip#185](../../../samples/snippets/csharp/VS_Snippets_Wpf/UIAClient_snip/CSharp/ClientForm.cs#185)]
     [!code-vb[UIAClient_snip#185](../../../samples/snippets/visualbasic/VS_Snippets_Wpf/UIAClient_snip/VisualBasic/ClientForm.vb#185)]  
  
> [!CAUTION]
> <span data-ttu-id="76b76-150">No use <xref:System.Windows.Forms.Cursor.Position%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="76b76-150">Do not use <xref:System.Windows.Forms.Cursor.Position%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="76b76-151">El comportamiento de esta propiedad fuera de las ventanas de cliente en un entorno de escala es indefinido.</span><span class="sxs-lookup"><span data-stu-id="76b76-151">The behavior of this property outside client windows in a scaled environment is undefined.</span></span>  
  
 <span data-ttu-id="76b76-152">Si la aplicación realiza una comunicación directa entre procesos con aplicaciones que no reconocen los valores de PPP, puede que tenga que convertir entre las coordenadas lógicas y físicas mediante las funciones de Win32 `PhysicalToLogicalPoint` y `LogicalToPhysicalPoint`.</span><span class="sxs-lookup"><span data-stu-id="76b76-152">If your application performs direct cross-process communication with non- dpi-aware applications, you may have convert between logical and physical coordinates by using the Win32 functions `PhysicalToLogicalPoint` and `LogicalToPhysicalPoint`.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="76b76-153">Vea también</span><span class="sxs-lookup"><span data-stu-id="76b76-153">See also</span></span>

- [<span data-ttu-id="76b76-154">Highlighter Sample</span><span class="sxs-lookup"><span data-stu-id="76b76-154">Highlighter Sample</span></span>](https://github.com/Microsoft/WPF-Samples/tree/master/Accessibility/Highlighter)
