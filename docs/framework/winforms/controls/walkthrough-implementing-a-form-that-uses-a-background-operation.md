---
title: 'Tutorial: Implementar un formulario que utiliza una operación en segundo plano'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
- cpp
helpviewer_keywords:
- threading [Windows Forms], forms
- BackgroundWorker component
- background tasks
- forms [Windows Forms], multithreading
- threading [Windows Forms], walkthroughs
- forms [Windows Forms], background operations
- threading [Windows Forms], background operations
- background operations
ms.assetid: 4691b796-9200-471a-89c3-ba4c7cc78c03
ms.openlocfilehash: 428dae2d10cd0f49a337c5b0439c5dcc72f83432
ms.sourcegitcommit: fe02afbc39e78afd78cc6050e4a9c12a75f579f8
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/30/2018
ms.locfileid: "43257388"
---
# <a name="walkthrough-implementing-a-form-that-uses-a-background-operation"></a><span data-ttu-id="c85b4-102">Tutorial: Implementar un formulario que utiliza una operación en segundo plano</span><span class="sxs-lookup"><span data-stu-id="c85b4-102">Walkthrough: Implementing a Form That Uses a Background Operation</span></span>
<span data-ttu-id="c85b4-103">Si tiene una operación que tarda mucho tiempo en completarse, y no desea la interfaz de usuario (UI) deje de responder o "bloquee", puede usar el <xref:System.ComponentModel.BackgroundWorker> clase para ejecutar la operación en otro subproceso.</span><span class="sxs-lookup"><span data-stu-id="c85b4-103">If you have an operation that will take a long time to complete, and you do not want your user interface (UI) to stop responding or "hang," you can use the <xref:System.ComponentModel.BackgroundWorker> class to execute the operation on another thread.</span></span>  
  
 <span data-ttu-id="c85b4-104">En este tutorial se muestra cómo utilizar el <xref:System.ComponentModel.BackgroundWorker> clase para realizar cálculos laboriosos "en"segundo plano, mientras que la interfaz de usuario sigue respondiendo.</span><span class="sxs-lookup"><span data-stu-id="c85b4-104">This walkthrough illustrates how to use the <xref:System.ComponentModel.BackgroundWorker> class to perform time-consuming computations "in the background," while the user interface remains responsive.</span></span>  <span data-ttu-id="c85b4-105">Cuando haya terminado, tendrá una aplicación que calcula de forma asincrónica los números de Fibonacci.</span><span class="sxs-lookup"><span data-stu-id="c85b4-105">When you are through, you will have an application that computes Fibonacci numbers asynchronously.</span></span> <span data-ttu-id="c85b4-106">Aunque se puede tardar un tiempo considerable en calcular un número de Fibonacci elevado, el subproceso de interfaz de usuario principal no se interrumpirá por este retraso, y el formulario seguirá respondiendo durante el cálculo.</span><span class="sxs-lookup"><span data-stu-id="c85b4-106">Even though computing a large Fibonacci number can take a noticeable amount of time, the main UI thread will not be interrupted by this delay, and the form will be responsive during the calculation.</span></span>  
  
 <span data-ttu-id="c85b4-107">Las tareas ilustradas en este tutorial incluyen:</span><span class="sxs-lookup"><span data-stu-id="c85b4-107">Tasks illustrated in this walkthrough include:</span></span>  
  
-   <span data-ttu-id="c85b4-108">Crear una aplicación basada en Windows</span><span class="sxs-lookup"><span data-stu-id="c85b4-108">Creating a Windows-based Application</span></span>  
  
-   <span data-ttu-id="c85b4-109">Creación de un <xref:System.ComponentModel.BackgroundWorker> en el formulario</span><span class="sxs-lookup"><span data-stu-id="c85b4-109">Creating a <xref:System.ComponentModel.BackgroundWorker> in Your Form</span></span>  
  
-   <span data-ttu-id="c85b4-110">Agregar controladores de eventos asincrónicos</span><span class="sxs-lookup"><span data-stu-id="c85b4-110">Adding Asynchronous Event Handlers</span></span>  
  
-   <span data-ttu-id="c85b4-111">Agregar informes de progreso y compatibilidad con la cancelación</span><span class="sxs-lookup"><span data-stu-id="c85b4-111">Adding Progress Reporting and Support for Cancellation</span></span>  
  
 <span data-ttu-id="c85b4-112">Para ver una lista completa del código utilizado en este ejemplo, consulte [Cómo: Implementar un formulario que utiliza una operación en segundo plano](../../../../docs/framework/winforms/controls/how-to-implement-a-form-that-uses-a-background-operation.md).</span><span class="sxs-lookup"><span data-stu-id="c85b4-112">For a complete listing of the code used in this example, see [How to: Implement a Form That Uses a Background Operation](../../../../docs/framework/winforms/controls/how-to-implement-a-form-that-uses-a-background-operation.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="c85b4-113">Los cuadros de diálogo y comandos de menú que se ven pueden diferir de los descritos en la Ayuda, en función de los valores de configuración o de edición activos.</span><span class="sxs-lookup"><span data-stu-id="c85b4-113">The dialog boxes and menu commands you see might differ from those described in Help depending on your active settings or edition.</span></span> <span data-ttu-id="c85b4-114">Para cambiar la configuración, elija la opción **Importar y exportar configuraciones** del menú **Herramientas** .</span><span class="sxs-lookup"><span data-stu-id="c85b4-114">To change your settings, choose **Import and Export Settings** on the **Tools** menu.</span></span> <span data-ttu-id="c85b4-115">Para más información, vea [Personalizar el IDE de Visual Studio](/visualstudio/ide/personalizing-the-visual-studio-ide).</span><span class="sxs-lookup"><span data-stu-id="c85b4-115">For more information, see [Personalize the Visual Studio IDE](/visualstudio/ide/personalizing-the-visual-studio-ide).</span></span>  
  
## <a name="creating-the-project"></a><span data-ttu-id="c85b4-116">Crear el proyecto</span><span class="sxs-lookup"><span data-stu-id="c85b4-116">Creating the Project</span></span>  
 <span data-ttu-id="c85b4-117">El primer paso es crear el proyecto y configurar el formulario.</span><span class="sxs-lookup"><span data-stu-id="c85b4-117">The first step is to create the project and to set up the form.</span></span>  
  
#### <a name="to-create-a-form-that-uses-a-background-operation"></a><span data-ttu-id="c85b4-118">Para crear un formulario que utilice una operación en segundo plano</span><span class="sxs-lookup"><span data-stu-id="c85b4-118">To create a form that uses a background operation</span></span>  
  
1.  <span data-ttu-id="c85b4-119">Cree un proyecto de aplicación basada en Windows llamado `BackgroundWorkerExample` (**archivo** > **New** > **proyecto**  >  **Visual C#** o **Visual Basic** > **escritorio clásico de** > **aplicación de Windows Forms**).</span><span class="sxs-lookup"><span data-stu-id="c85b4-119">Create a Windows-based application project called `BackgroundWorkerExample` (**File** > **New** > **Project** > **Visual C#** or **Visual Basic** > **Classic Desktop** > **Windows Forms Application**).</span></span>  
  
2.  <span data-ttu-id="c85b4-120">En el **Explorador de soluciones**, haga clic con el botón derecho en **Form1** y seleccione **Cambiar nombre** en el menú contextual.</span><span class="sxs-lookup"><span data-stu-id="c85b4-120">In **Solution Explorer**, right-click **Form1** and select **Rename** from the shortcut menu.</span></span> <span data-ttu-id="c85b4-121">Cambie el nombre del archivo a `FibonacciCalculator`.</span><span class="sxs-lookup"><span data-stu-id="c85b4-121">Change the file name to `FibonacciCalculator`.</span></span> <span data-ttu-id="c85b4-122">Haga clic en el botón **Sí** cuando se le pregunte si desea cambiar el nombre de todas las referencias al elemento de código "`Form1`".</span><span class="sxs-lookup"><span data-stu-id="c85b4-122">Click the **Yes** button when you are asked if you want to rename all references to the code element '`Form1`'.</span></span>  
  
3.  <span data-ttu-id="c85b4-123">Arrastre un <xref:System.Windows.Forms.NumericUpDown> controlar desde la **cuadro de herramientas** hasta el formulario.</span><span class="sxs-lookup"><span data-stu-id="c85b4-123">Drag a <xref:System.Windows.Forms.NumericUpDown> control from the **Toolbox** onto the form.</span></span> <span data-ttu-id="c85b4-124">Establecer el <xref:System.Windows.Forms.NumericUpDown.Minimum%2A> propiedad `1` y el <xref:System.Windows.Forms.NumericUpDown.Maximum%2A> propiedad `91`.</span><span class="sxs-lookup"><span data-stu-id="c85b4-124">Set the <xref:System.Windows.Forms.NumericUpDown.Minimum%2A> property to `1` and the <xref:System.Windows.Forms.NumericUpDown.Maximum%2A> property to `91`.</span></span>  
  
4.  <span data-ttu-id="c85b4-125">Agregue dos <xref:System.Windows.Forms.Button> controles al formulario.</span><span class="sxs-lookup"><span data-stu-id="c85b4-125">Add two <xref:System.Windows.Forms.Button> controls to the form.</span></span>  
  
5.  <span data-ttu-id="c85b4-126">Cambiar el nombre de la primera <xref:System.Windows.Forms.Button> control `startAsyncButton` y establezca el <xref:System.Windows.Forms.Control.Text%2A> propiedad `Start Async`.</span><span class="sxs-lookup"><span data-stu-id="c85b4-126">Rename the first <xref:System.Windows.Forms.Button> control `startAsyncButton` and set the <xref:System.Windows.Forms.Control.Text%2A> property to `Start Async`.</span></span> <span data-ttu-id="c85b4-127">Cambiar el nombre de la segunda <xref:System.Windows.Forms.Button> control `cancelAsyncButton`y establezca el <xref:System.Windows.Forms.Control.Text%2A> propiedad `Cancel Async`.</span><span class="sxs-lookup"><span data-stu-id="c85b4-127">Rename the second <xref:System.Windows.Forms.Button> control `cancelAsyncButton`, and set the <xref:System.Windows.Forms.Control.Text%2A> property to `Cancel Async`.</span></span> <span data-ttu-id="c85b4-128">Establezca su <xref:System.Windows.Forms.Control.Enabled%2A> propiedad `false`.</span><span class="sxs-lookup"><span data-stu-id="c85b4-128">Set its <xref:System.Windows.Forms.Control.Enabled%2A> property to `false`.</span></span>  
  
6.  <span data-ttu-id="c85b4-129">Crear un controlador de eventos para ambos el <xref:System.Windows.Forms.Button> los controles <xref:System.Windows.Forms.Control.Click> eventos.</span><span class="sxs-lookup"><span data-stu-id="c85b4-129">Create an event handler for both of the <xref:System.Windows.Forms.Button> controls' <xref:System.Windows.Forms.Control.Click> events.</span></span> <span data-ttu-id="c85b4-130">Para ver detalles, consulte [Cómo: Crear controladores de eventos mediante el diseñador](http://msdn.microsoft.com/library/8461e9b8-14e8-406f-936e-3726732b23d2).</span><span class="sxs-lookup"><span data-stu-id="c85b4-130">For details, see [How to: Create Event Handlers Using the Designer](http://msdn.microsoft.com/library/8461e9b8-14e8-406f-936e-3726732b23d2).</span></span>  
  
7.  <span data-ttu-id="c85b4-131">Arrastre un <xref:System.Windows.Forms.Label> controlar desde la **cuadro de herramientas** hasta el formulario y cambie su nombre `resultLabel`.</span><span class="sxs-lookup"><span data-stu-id="c85b4-131">Drag a <xref:System.Windows.Forms.Label> control from the **Toolbox** onto the form and rename it `resultLabel`.</span></span>  
  
8.  <span data-ttu-id="c85b4-132">Arrastre un <xref:System.Windows.Forms.ProgressBar> controlar desde la **cuadro de herramientas** hasta el formulario.</span><span class="sxs-lookup"><span data-stu-id="c85b4-132">Drag a <xref:System.Windows.Forms.ProgressBar> control from the **Toolbox** onto the form.</span></span>  
  
## <a name="creating-a-backgroundworker-in-your-form"></a><span data-ttu-id="c85b4-133">Crear un componente BackgroundWorker en el formulario</span><span class="sxs-lookup"><span data-stu-id="c85b4-133">Creating a BackgroundWorker in Your Form</span></span>  
 <span data-ttu-id="c85b4-134">Puede crear el <xref:System.ComponentModel.BackgroundWorker> para la operación asincrónica mediante el **Windows** **Diseñador de formularios**.</span><span class="sxs-lookup"><span data-stu-id="c85b4-134">You can create the <xref:System.ComponentModel.BackgroundWorker> for your asynchronous operation using the **Windows** **Forms Designer**.</span></span>  
  
#### <a name="to-create-a-backgroundworker-with-the-designer"></a><span data-ttu-id="c85b4-135">Para crear un componente BackgroundWorker con el diseñador</span><span class="sxs-lookup"><span data-stu-id="c85b4-135">To create a BackgroundWorker with the Designer</span></span>  
  
-   <span data-ttu-id="c85b4-136">Desde el **componentes** pestaña de la **cuadro de herramientas**, arrastre un <xref:System.ComponentModel.BackgroundWorker> hasta el formulario.</span><span class="sxs-lookup"><span data-stu-id="c85b4-136">From the **Components** tab of the **Toolbox**, drag a <xref:System.ComponentModel.BackgroundWorker> onto the form.</span></span>  
  
## <a name="adding-asynchronous-event-handlers"></a><span data-ttu-id="c85b4-137">Agregar controladores de eventos asincrónicos</span><span class="sxs-lookup"><span data-stu-id="c85b4-137">Adding Asynchronous Event Handlers</span></span>  
 <span data-ttu-id="c85b4-138">Ahora está listo para agregar controladores de eventos para el <xref:System.ComponentModel.BackgroundWorker> eventos asincrónicos del componente.</span><span class="sxs-lookup"><span data-stu-id="c85b4-138">You are now ready to add event handlers for the <xref:System.ComponentModel.BackgroundWorker> component's asynchronous events.</span></span> <span data-ttu-id="c85b4-139">Se llama a la laboriosa operación que se ejecutará en segundo plano, que calcula los números de Fibonacci, mediante uno de estos controladores de eventos.</span><span class="sxs-lookup"><span data-stu-id="c85b4-139">The time-consuming operation that will run in the background, which computes Fibonacci numbers, is called by one of these event handlers.</span></span>  
  
#### <a name="to-implement-asynchronous-event-handlers"></a><span data-ttu-id="c85b4-140">Para implementar controladores de eventos asincrónicos</span><span class="sxs-lookup"><span data-stu-id="c85b4-140">To implement asynchronous event handlers</span></span>  
  
1.  <span data-ttu-id="c85b4-141">En el **propiedades** ventana, con el <xref:System.ComponentModel.BackgroundWorker> componente aún seleccionado, haga clic en el **eventos** botón.</span><span class="sxs-lookup"><span data-stu-id="c85b4-141">In the **Properties** window, with the <xref:System.ComponentModel.BackgroundWorker> component still selected, click the **Events** button.</span></span> <span data-ttu-id="c85b4-142">Haga doble clic en el <xref:System.ComponentModel.BackgroundWorker.DoWork> y <xref:System.ComponentModel.BackgroundWorker.RunWorkerCompleted> eventos para crear controladores de eventos.</span><span class="sxs-lookup"><span data-stu-id="c85b4-142">Double-click the <xref:System.ComponentModel.BackgroundWorker.DoWork> and <xref:System.ComponentModel.BackgroundWorker.RunWorkerCompleted> events to create event handlers.</span></span> <span data-ttu-id="c85b4-143">Para más información sobre cómo utilizar controladores de eventos, consulte [Cómo: Crear controladores de eventos mediante el diseñador](http://msdn.microsoft.com/library/8461e9b8-14e8-406f-936e-3726732b23d2).</span><span class="sxs-lookup"><span data-stu-id="c85b4-143">For more information about how to use event handlers, see [How to: Create Event Handlers Using the Designer](http://msdn.microsoft.com/library/8461e9b8-14e8-406f-936e-3726732b23d2).</span></span>  
  
2.  <span data-ttu-id="c85b4-144">Cree un método llamado `ComputeFibonacci` en el formulario.</span><span class="sxs-lookup"><span data-stu-id="c85b4-144">Create a new method, called `ComputeFibonacci`, in your form.</span></span> <span data-ttu-id="c85b4-145">Este método realiza el trabajo en sí y se ejecutará en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="c85b4-145">This method does the actual work, and it will run in the background.</span></span> <span data-ttu-id="c85b4-146">Este código muestra la implementación recursiva del algoritmo de Fibonacci, que es notablemente ineficaz y tarda exponencialmente más tiempo en completarse para los números más elevados.</span><span class="sxs-lookup"><span data-stu-id="c85b4-146">This code demonstrates the recursive implementation of the Fibonacci algorithm, which is notably inefficient, taking exponentially longer time to complete for larger numbers.</span></span> <span data-ttu-id="c85b4-147">Se usa aquí a modo de ilustración, para mostrar una operación que puede suponer grandes retrasos en su aplicación.</span><span class="sxs-lookup"><span data-stu-id="c85b4-147">It is used here for illustrative purposes, to show an operation that can introduce long delays in your application.</span></span>  
  
     [!code-cpp[System.ComponentModel.BackgroundWorker#10](../../../../samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#10)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#10](../../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#10)]
     [!code-vb[System.ComponentModel.BackgroundWorker#10](../../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#10)]  
  
3.  <span data-ttu-id="c85b4-148">En el <xref:System.ComponentModel.BackgroundWorker.DoWork> controlador de eventos, agregue una llamada a la `ComputeFibonacci` método.</span><span class="sxs-lookup"><span data-stu-id="c85b4-148">In the <xref:System.ComponentModel.BackgroundWorker.DoWork> event handler, add a call to the `ComputeFibonacci` method.</span></span> <span data-ttu-id="c85b4-149">Tome el primer parámetro `ComputeFibonacci` desde el <xref:System.ComponentModel.DoWorkEventArgs.Argument%2A> propiedad de la <xref:System.ComponentModel.DoWorkEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="c85b4-149">Take the first parameter for `ComputeFibonacci` from the <xref:System.ComponentModel.DoWorkEventArgs.Argument%2A> property of the <xref:System.ComponentModel.DoWorkEventArgs>.</span></span> <span data-ttu-id="c85b4-150">El <xref:System.ComponentModel.BackgroundWorker> y <xref:System.ComponentModel.DoWorkEventArgs> parámetros se usará más adelante para informes de progreso y la cancelación admitir.</span><span class="sxs-lookup"><span data-stu-id="c85b4-150">The <xref:System.ComponentModel.BackgroundWorker> and <xref:System.ComponentModel.DoWorkEventArgs> parameters will be used later for progress reporting and cancellation support.</span></span> <span data-ttu-id="c85b4-151">Asigne el valor devuelto de `ComputeFibonacci` a la <xref:System.ComponentModel.DoWorkEventArgs.Result%2A> propiedad de la <xref:System.ComponentModel.DoWorkEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="c85b4-151">Assign the return value from `ComputeFibonacci` to the <xref:System.ComponentModel.DoWorkEventArgs.Result%2A> property of the <xref:System.ComponentModel.DoWorkEventArgs>.</span></span> <span data-ttu-id="c85b4-152">Este resultado estará disponible para el <xref:System.ComponentModel.BackgroundWorker.RunWorkerCompleted> controlador de eventos.</span><span class="sxs-lookup"><span data-stu-id="c85b4-152">This result will be available to the <xref:System.ComponentModel.BackgroundWorker.RunWorkerCompleted> event handler.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="c85b4-153">El <xref:System.ComponentModel.BackgroundWorker.DoWork> controlador de eventos no hace referencia el `backgroundWorker1` instancia variable directamente, ya que esto uniría este controlador de eventos a una instancia específica de <xref:System.ComponentModel.BackgroundWorker>.</span><span class="sxs-lookup"><span data-stu-id="c85b4-153">The <xref:System.ComponentModel.BackgroundWorker.DoWork> event handler does not reference the `backgroundWorker1` instance variable directly, as this would couple this event handler to a specific instance of <xref:System.ComponentModel.BackgroundWorker>.</span></span> <span data-ttu-id="c85b4-154">En su lugar, una referencia a la <xref:System.ComponentModel.BackgroundWorker> que provocó este evento, se recupera de la `sender` parámetro.</span><span class="sxs-lookup"><span data-stu-id="c85b4-154">Instead, a reference to the <xref:System.ComponentModel.BackgroundWorker> that raised this event is recovered from the `sender` parameter.</span></span> <span data-ttu-id="c85b4-155">Esto es importante cuando el formulario hospeda más de un <xref:System.ComponentModel.BackgroundWorker>.</span><span class="sxs-lookup"><span data-stu-id="c85b4-155">This is important when the form hosts more than one <xref:System.ComponentModel.BackgroundWorker>.</span></span> <span data-ttu-id="c85b4-156">También es importante no manipular ningún objeto de interfaz de usuario en su <xref:System.ComponentModel.BackgroundWorker.DoWork> controlador de eventos.</span><span class="sxs-lookup"><span data-stu-id="c85b4-156">It is also important not to manipulate any user-interface objects in your <xref:System.ComponentModel.BackgroundWorker.DoWork> event handler.</span></span> <span data-ttu-id="c85b4-157">En su lugar, se comunican con la interfaz de usuario a través de la <xref:System.ComponentModel.BackgroundWorker> eventos.</span><span class="sxs-lookup"><span data-stu-id="c85b4-157">Instead, communicate to the user interface through the <xref:System.ComponentModel.BackgroundWorker> events.</span></span>  
  
     [!code-cpp[System.ComponentModel.BackgroundWorker#5](../../../../samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#5)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#5](../../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#5)]
     [!code-vb[System.ComponentModel.BackgroundWorker#5](../../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#5)]  
  
4.  <span data-ttu-id="c85b4-158">En el `startAsyncButton` del control <xref:System.Windows.Forms.Control.Click> controlador de eventos, agregue el código que inicia la operación asincrónica.</span><span class="sxs-lookup"><span data-stu-id="c85b4-158">In the `startAsyncButton` control's <xref:System.Windows.Forms.Control.Click> event handler, add the code that starts the asynchronous operation.</span></span>  
  
     [!code-cpp[System.ComponentModel.BackgroundWorker#13](../../../../samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#13)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#13](../../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#13)]
     [!code-vb[System.ComponentModel.BackgroundWorker#13](../../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#13)]  
  
5.  <span data-ttu-id="c85b4-159">En el <xref:System.ComponentModel.BackgroundWorker.RunWorkerCompleted> controlador de eventos, asigne el resultado del cálculo a la `resultLabel` control.</span><span class="sxs-lookup"><span data-stu-id="c85b4-159">In the <xref:System.ComponentModel.BackgroundWorker.RunWorkerCompleted> event handler, assign the result of the calculation to the `resultLabel` control.</span></span>  
  
     [!code-cpp[System.ComponentModel.BackgroundWorker#6](../../../../samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#6)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#6](../../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#6)]
     [!code-vb[System.ComponentModel.BackgroundWorker#6](../../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#6)]  
  
## <a name="adding-progress-reporting-and-support-for-cancellation"></a><span data-ttu-id="c85b4-160">Agregar informes de progreso y compatibilidad con la cancelación</span><span class="sxs-lookup"><span data-stu-id="c85b4-160">Adding Progress Reporting and Support for Cancellation</span></span>  
 <span data-ttu-id="c85b4-161">Para las operaciones asincrónicas que vayan a tardar mucho tiempo, suele ser deseable informar sobre el progreso al usuario y permitir que cancele la operación.</span><span class="sxs-lookup"><span data-stu-id="c85b4-161">For asynchronous operations that will take a long time, it is often desirable to report progress to the user and to allow the user to cancel the operation.</span></span> <span data-ttu-id="c85b4-162">La <xref:System.ComponentModel.BackgroundWorker> clase proporciona un evento que le permite publicar progreso a medida que avanza la operación en segundo plano.</span><span class="sxs-lookup"><span data-stu-id="c85b4-162">The <xref:System.ComponentModel.BackgroundWorker> class provides an event that allows you to post progress as your background operation proceeds.</span></span> <span data-ttu-id="c85b4-163">También proporciona una marca que permite que el código de trabajo detectar una llamada a <xref:System.ComponentModel.BackgroundWorker.CancelAsync%2A> y se interrumpa.</span><span class="sxs-lookup"><span data-stu-id="c85b4-163">It also provides a flag that allows your worker code to detect a call to <xref:System.ComponentModel.BackgroundWorker.CancelAsync%2A> and interrupt itself.</span></span>  
  
#### <a name="to-implement-progress-reporting"></a><span data-ttu-id="c85b4-164">Para implementar los informes de progreso</span><span class="sxs-lookup"><span data-stu-id="c85b4-164">To implement progress reporting</span></span>  
  
1.  <span data-ttu-id="c85b4-165">En la ventana **Propiedades**, seleccione `backgroundWorker1`.</span><span class="sxs-lookup"><span data-stu-id="c85b4-165">In the **Properties**, window, select `backgroundWorker1`.</span></span> <span data-ttu-id="c85b4-166">Establezca las propiedades <xref:System.ComponentModel.BackgroundWorker.WorkerReportsProgress%2A> y <xref:System.ComponentModel.BackgroundWorker.WorkerSupportsCancellation%2A> en `true`.</span><span class="sxs-lookup"><span data-stu-id="c85b4-166">Set the <xref:System.ComponentModel.BackgroundWorker.WorkerReportsProgress%2A> and <xref:System.ComponentModel.BackgroundWorker.WorkerSupportsCancellation%2A> properties to `true`.</span></span>  
  
2.  <span data-ttu-id="c85b4-167">Declare dos variables en el formulario `FibonacciCalculator`.</span><span class="sxs-lookup"><span data-stu-id="c85b4-167">Declare two variables in the `FibonacciCalculator` form.</span></span> <span data-ttu-id="c85b4-168">Se utilizarán para realizar un seguimiento del progreso.</span><span class="sxs-lookup"><span data-stu-id="c85b4-168">These will be used to track progress.</span></span>  
  
     [!code-cpp[System.ComponentModel.BackgroundWorker#14](../../../../samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#14)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#14](../../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#14)]
     [!code-vb[System.ComponentModel.BackgroundWorker#14](../../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#14)]  
  
3.  <span data-ttu-id="c85b4-169">Agregue un controlador de eventos para el evento <xref:System.ComponentModel.BackgroundWorker.ProgressChanged>.</span><span class="sxs-lookup"><span data-stu-id="c85b4-169">Add an event handler for the <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> event.</span></span> <span data-ttu-id="c85b4-170">En el <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> controlador de eventos, actualice el <xref:System.Windows.Forms.ProgressBar> con el <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> propiedad de la <xref:System.ComponentModel.ProgressChangedEventArgs> parámetro.</span><span class="sxs-lookup"><span data-stu-id="c85b4-170">In the <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> event handler, update the <xref:System.Windows.Forms.ProgressBar> with the <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> property of the <xref:System.ComponentModel.ProgressChangedEventArgs> parameter.</span></span>  
  
     [!code-cpp[System.ComponentModel.BackgroundWorker#7](../../../../samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#7)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#7](../../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#7)]
     [!code-vb[System.ComponentModel.BackgroundWorker#7](../../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#7)]  
  
#### <a name="to-implement-support-for-cancellation"></a><span data-ttu-id="c85b4-171">Para implementar la compatibilidad con la cancelación</span><span class="sxs-lookup"><span data-stu-id="c85b4-171">To implement support for cancellation</span></span>  
  
1.  <span data-ttu-id="c85b4-172">En el `cancelAsyncButton` del control <xref:System.Windows.Forms.Control.Click> controlador de eventos, agregue el código que cancela la operación asincrónica.</span><span class="sxs-lookup"><span data-stu-id="c85b4-172">In the `cancelAsyncButton` control's <xref:System.Windows.Forms.Control.Click> event handler, add the code that cancels the asynchronous operation.</span></span>  
  
     [!code-cpp[System.ComponentModel.BackgroundWorker#4](../../../../samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#4)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#4](../../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#4)]
     [!code-vb[System.ComponentModel.BackgroundWorker#4](../../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#4)]  
  
2.  <span data-ttu-id="c85b4-173">Los siguientes fragmentos de código en el método `ComputeFibonacci` informan sobre el progreso y son compatibles con la cancelación.</span><span class="sxs-lookup"><span data-stu-id="c85b4-173">The following code fragments in the `ComputeFibonacci` method report progress and support cancellation.</span></span>  
  
     [!code-cpp[System.ComponentModel.BackgroundWorker#11](../../../../samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#11)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#11](../../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#11)]
     [!code-vb[System.ComponentModel.BackgroundWorker#11](../../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#11)]  
    [!code-cpp[System.ComponentModel.BackgroundWorker#12](../../../../samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#12)]
    [!code-csharp[System.ComponentModel.BackgroundWorker#12](../../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#12)]
    [!code-vb[System.ComponentModel.BackgroundWorker#12](../../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#12)]  
  
## <a name="checkpoint"></a><span data-ttu-id="c85b4-174">Punto de control</span><span class="sxs-lookup"><span data-stu-id="c85b4-174">Checkpoint</span></span>  
 <span data-ttu-id="c85b4-175">En este punto, puede compilar y ejecutar la aplicación de calculadora de Fibonacci.</span><span class="sxs-lookup"><span data-stu-id="c85b4-175">At this point, you can compile and run the Fibonacci Calculator application.</span></span>  
  
#### <a name="to-test-your-project"></a><span data-ttu-id="c85b4-176">Para probar el proyecto</span><span class="sxs-lookup"><span data-stu-id="c85b4-176">To test your project</span></span>  
  
-   <span data-ttu-id="c85b4-177">Presione F5 para compilar y ejecutar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c85b4-177">Press F5 to compile and run the application.</span></span>  
  
     <span data-ttu-id="c85b4-178">Mientras se ejecuta el cálculo en segundo plano, verá el <xref:System.Windows.Forms.ProgressBar> muestra el progreso del cálculo hacia su finalización.</span><span class="sxs-lookup"><span data-stu-id="c85b4-178">While the calculation is running in the background, you will see the <xref:System.Windows.Forms.ProgressBar> displaying the progress of the calculation toward completion.</span></span> <span data-ttu-id="c85b4-179">También puede cancelar la operación pendiente.</span><span class="sxs-lookup"><span data-stu-id="c85b4-179">You can also cancel the pending operation.</span></span>  
  
     <span data-ttu-id="c85b4-180">Para los números pequeños, el cálculo debería ser muy rápido pero, para los números mayores, debería darse un retraso notable.</span><span class="sxs-lookup"><span data-stu-id="c85b4-180">For small numbers, the calculation should be very fast, but for larger numbers, you should see a noticeable delay.</span></span> <span data-ttu-id="c85b4-181">Si escribe un valor de 30 o superior, debería ver un retraso de varios segundos, dependiendo de la velocidad del equipo.</span><span class="sxs-lookup"><span data-stu-id="c85b4-181">If you enter a value of 30 or greater, you should see a delay of several seconds, depending on the speed of your computer.</span></span> <span data-ttu-id="c85b4-182">Para los valores superiores a 40, se pueden tardar minutos u horas en finalizar el cálculo.</span><span class="sxs-lookup"><span data-stu-id="c85b4-182">For values greater than 40, it may take minutes or hours to finish the calculation.</span></span> <span data-ttu-id="c85b4-183">Mientras la calculadora está ocupada calculando un número de Fibonacci elevado, observe que tiene libertad para mover el formulario, minimizarlo, maximizarlo e incluso descartarlo.</span><span class="sxs-lookup"><span data-stu-id="c85b4-183">While the calculator is busy computing a large Fibonacci number, notice that you can freely move the form around, minimize, maximize, and even dismiss it.</span></span> <span data-ttu-id="c85b4-184">Esto se debe a que el subproceso de interfaz de usuario principal no está esperando a que finalice el cálculo.</span><span class="sxs-lookup"><span data-stu-id="c85b4-184">This is because the main UI thread is not waiting for the calculation to finish.</span></span>  
  
## <a name="next-steps"></a><span data-ttu-id="c85b4-185">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="c85b4-185">Next Steps</span></span>  
 <span data-ttu-id="c85b4-186">Ahora que ha implementado un formulario que utiliza un <xref:System.ComponentModel.BackgroundWorker> componente para ejecutar un cálculo en segundo plano, puede explorar otras posibilidades para las operaciones asincrónicas:</span><span class="sxs-lookup"><span data-stu-id="c85b4-186">Now that you have implemented a form that uses a <xref:System.ComponentModel.BackgroundWorker> component to execute a computation in the background, you can explore other possibilities for asynchronous operations:</span></span>  
  
-   <span data-ttu-id="c85b4-187">Usar varios <xref:System.ComponentModel.BackgroundWorker> objetos para varias operaciones simultáneas.</span><span class="sxs-lookup"><span data-stu-id="c85b4-187">Use multiple <xref:System.ComponentModel.BackgroundWorker> objects for several simultaneous operations.</span></span>  
  
-   <span data-ttu-id="c85b4-188">Para depurar su aplicación multiproceso, consulte [Cómo: Utilizar la ventana Subprocesos](/visualstudio/debugger/how-to-use-the-threads-window).</span><span class="sxs-lookup"><span data-stu-id="c85b4-188">To debug your multithreaded application, see [How to: Use the Threads Window](/visualstudio/debugger/how-to-use-the-threads-window).</span></span>  
  
-   <span data-ttu-id="c85b4-189">Implemente su propio componente que admita el modelo de programación asincrónica.</span><span class="sxs-lookup"><span data-stu-id="c85b4-189">Implement your own component that supports the asynchronous programming model.</span></span> <span data-ttu-id="c85b4-190">Para más información, consulte [Event-based Asynchronous Pattern Overview](../../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md) (Introducción al patrón asincrónico basado en eventos).</span><span class="sxs-lookup"><span data-stu-id="c85b4-190">For more information, see [Event-based Asynchronous Pattern Overview](../../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md).</span></span>  
  
    > [!CAUTION]
    >  <span data-ttu-id="c85b4-191">Cuando se usa multithreading de algún tipo, se expone a posibles errores muy graves y complejos.</span><span class="sxs-lookup"><span data-stu-id="c85b4-191">When using multithreading of any sort, you potentially expose yourself to very serious and complex bugs.</span></span> <span data-ttu-id="c85b4-192">Vea [Procedimientos recomendados para el subprocesamiento administrado](../../../../docs/standard/threading/managed-threading-best-practices.md) antes de implementar cualquier solución que utilice multithreading.</span><span class="sxs-lookup"><span data-stu-id="c85b4-192">Consult the [Managed Threading Best Practices](../../../../docs/standard/threading/managed-threading-best-practices.md) before implementing any solution that uses multithreading.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="c85b4-193">Vea también</span><span class="sxs-lookup"><span data-stu-id="c85b4-193">See Also</span></span>  
 <xref:System.ComponentModel.BackgroundWorker>  
 [<span data-ttu-id="c85b4-194">Procedimientos recomendados para el subprocesamiento administrado</span><span class="sxs-lookup"><span data-stu-id="c85b4-194">Managed Threading Best Practices</span></span>](../../../../docs/standard/threading/managed-threading-best-practices.md)  
 [<span data-ttu-id="c85b4-195">Subprocesamiento múltiple en componentes</span><span class="sxs-lookup"><span data-stu-id="c85b4-195">Multithreading in Components</span></span>](http://msdn.microsoft.com/library/2fc31e68-fb71-4544-b654-0ce720478779)  
 [<span data-ttu-id="c85b4-196">NO ESTÁ EN LA COMPILACIÓN: Multithreading en Visual Basic</span><span class="sxs-lookup"><span data-stu-id="c85b4-196">NOT IN BUILD: Multithreading in Visual Basic</span></span>](http://msdn.microsoft.com/library/c731a50c-09c1-4468-9646-54c86b75d269)  
 [<span data-ttu-id="c85b4-197">Cómo: Implementar un formulario que utiliza una operación en segundo plano</span><span class="sxs-lookup"><span data-stu-id="c85b4-197">How to: Implement a Form That Uses a Background Operation</span></span>](../../../../docs/framework/winforms/controls/how-to-implement-a-form-that-uses-a-background-operation.md)  
 [<span data-ttu-id="c85b4-198">Tutorial: Ejecutar una operación en segundo plano</span><span class="sxs-lookup"><span data-stu-id="c85b4-198">Walkthrough: Running an Operation in the Background</span></span>](../../../../docs/framework/winforms/controls/walkthrough-running-an-operation-in-the-background.md)  
 [<span data-ttu-id="c85b4-199">Componente BackgroundWorker</span><span class="sxs-lookup"><span data-stu-id="c85b4-199">BackgroundWorker Component</span></span>](../../../../docs/framework/winforms/controls/backgroundworker-component.md)
