---
title: "Instrucciones de programación segura para código sin administrar"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- code security, unmanaged code
- unmanaged code, securing
- security [.NET Framework], unmanaged code
- secure coding, unmanaged code
ms.assetid: a8d15139-d368-4c9c-a747-ba757781117c
caps.latest.revision: "13"
author: mairaw
ms.author: mairaw
manager: wpickett
ms.openlocfilehash: b6eec726342381f7e3ec71aeedd2ff012bc6c3e7
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/18/2017
---
# <a name="secure-coding-guidelines-for-unmanaged-code"></a><span data-ttu-id="3e896-102">Instrucciones de programación segura para código sin administrar</span><span class="sxs-lookup"><span data-stu-id="3e896-102">Secure Coding Guidelines for Unmanaged Code</span></span>
<span data-ttu-id="3e896-103">El código de algunas bibliotecas necesita llamar a código no administrado (por ejemplo, las API de código nativo, como Win32).</span><span class="sxs-lookup"><span data-stu-id="3e896-103">Some library code needs to call into unmanaged code (for example, native code APIs, such as Win32).</span></span> <span data-ttu-id="3e896-104">Como esto implica salir del perímetro de seguridad del código administrado, se requiere mucha precaución.</span><span class="sxs-lookup"><span data-stu-id="3e896-104">Because this means going outside the security perimeter for managed code, due caution is required.</span></span> <span data-ttu-id="3e896-105">Si el código es neutro en cuanto a seguridad, tanto su código como cualquier otro código que lo llame deberán tener permiso de código no administrado (<xref:System.Security.Permissions.SecurityPermission> con la marca <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> especificada).</span><span class="sxs-lookup"><span data-stu-id="3e896-105">If your code is security-neutral, both your code and any code that calls it must have unmanaged code permission (<xref:System.Security.Permissions.SecurityPermission> with the <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> flag specified).</span></span>  
  
 <span data-ttu-id="3e896-106">Sin embargo, a menudo sucede que es absurdo conceder al llamador permisos tan amplios.</span><span class="sxs-lookup"><span data-stu-id="3e896-106">However, it is often unreasonable for your caller to have such powerful permissions.</span></span> <span data-ttu-id="3e896-107">En esos casos, el código de confianza puede actuar como intermediario, de forma similar al contenedor administrado o el código de biblioteca que se describen en [Proteger código de contenedor](../../../docs/framework/misc/securing-wrapper-code.md).</span><span class="sxs-lookup"><span data-stu-id="3e896-107">In such cases, your trusted code can be the go-between, similar to the managed wrapper or library code described in [Securing Wrapper Code](../../../docs/framework/misc/securing-wrapper-code.md).</span></span> <span data-ttu-id="3e896-108">Si la funcionalidad del código no administrado subyacente es totalmente segura, se puede exponer directamente. Si no, es necesario realizar primero la comprobación (solicitud) de permisos correspondiente.</span><span class="sxs-lookup"><span data-stu-id="3e896-108">If the underlying unmanaged code functionality is totally safe, it can be directly exposed; otherwise, a suitable permission check (demand) is required first.</span></span>  
  
 <span data-ttu-id="3e896-109">Si su código llama a código no administrado, pero no quiere exigir que los llamadores tengan permiso para acceder a código no administrado, debe declarar este derecho con una aserción.</span><span class="sxs-lookup"><span data-stu-id="3e896-109">When your code calls into unmanaged code but you do not want to require your callers to have permission to access unmanaged code, you must assert that right.</span></span> <span data-ttu-id="3e896-110">Las aserciones bloquean el recorrido de la pila en su marco.</span><span class="sxs-lookup"><span data-stu-id="3e896-110">An assertion blocks the stack walk at your frame.</span></span> <span data-ttu-id="3e896-111">Debe tener cuidado de no crear una vulnerabilidad de seguridad en este proceso.</span><span class="sxs-lookup"><span data-stu-id="3e896-111">You must be careful that you do not create a security hole in this process.</span></span> <span data-ttu-id="3e896-112">Normalmente, para esto es necesario solicitar un permiso adecuado a los llamadores y, luego, utilizar código no administrado para realizar solamente lo que permite el permiso y nada más.</span><span class="sxs-lookup"><span data-stu-id="3e896-112">Usually, this means that you must demand a suitable permission of your callers and then use unmanaged code to perform only what that permission allows and no more.</span></span> <span data-ttu-id="3e896-113">En algunos casos (por ejemplo, una función get time-of-day), el código no administrado se puede exponer directamente a los llamadores sin ninguna comprobación de seguridad.</span><span class="sxs-lookup"><span data-stu-id="3e896-113">In some cases (for example, a get time-of-day function), unmanaged code can be directly exposed to callers without any security checks.</span></span> <span data-ttu-id="3e896-114">En cualquier caso, todo el código que se declare con aserciones debe asumir la responsabilidad de mantener la seguridad.</span><span class="sxs-lookup"><span data-stu-id="3e896-114">In any case, any code that asserts must take responsibility for security.</span></span>  
  
 <span data-ttu-id="3e896-115">Dado que cualquier código administrado que proporcione una ruta de acceso al código nativo es un posible objetivo de códigos malintencionados, deberá tener mucho cuidado cuando decida qué código no administrado se puede usar de forma segura y cómo se debe usar.</span><span class="sxs-lookup"><span data-stu-id="3e896-115">Because any managed code that provides a code path into native code is a potential target for malicious code, determining which unmanaged code can be safely used and how it must be used requires extreme care.</span></span> <span data-ttu-id="3e896-116">Por lo general, el código no administrado nunca debe exponerse directamente a llamadores de confianza parcial.</span><span class="sxs-lookup"><span data-stu-id="3e896-116">Generally, unmanaged code should never be directly exposed to partially trusted callers.</span></span> <span data-ttu-id="3e896-117">Al evaluar la seguridad del uso de código no administrado en las bibliotecas a las que puede llamar el código de confianza parcial, hay dos aspectos que se deben tener en cuenta:</span><span class="sxs-lookup"><span data-stu-id="3e896-117">There are two primary considerations in evaluating the safety of unmanaged code use in libraries that are callable by partially trusted code:</span></span>  
  
-   <span data-ttu-id="3e896-118">**Funcionalidad**.</span><span class="sxs-lookup"><span data-stu-id="3e896-118">**Functionality**.</span></span> <span data-ttu-id="3e896-119">¿La API no administrada proporciona funcionalidad que no permita a los llamadores realizar operaciones potencialmente peligrosas?</span><span class="sxs-lookup"><span data-stu-id="3e896-119">Does the unmanaged API provide functionality that does not allow callers to perform potentially dangerous operations?</span></span> <span data-ttu-id="3e896-120">La seguridad de acceso del código utiliza permisos para exigir el acceso a los recursos, por lo que debe tener en cuenta si la API utiliza archivos, una interfaz de usuario o subprocesos, o si expone información protegida.</span><span class="sxs-lookup"><span data-stu-id="3e896-120">Code access security uses permissions to enforce access to resources, so consider whether the API uses files, a user interface, or threading, or whether it exposes protected information.</span></span> <span data-ttu-id="3e896-121">Si es así, el ajuste del código administrado debe solicitar los permisos necesarios para poder escribir dicho código.</span><span class="sxs-lookup"><span data-stu-id="3e896-121">If it does, the managed code wrapping it must demand the necessary permissions before allowing it to be entered.</span></span> <span data-ttu-id="3e896-122">Además, aunque no esté protegido con un permiso, el acceso a la memoria debe limitarse a la seguridad de tipo estricto.</span><span class="sxs-lookup"><span data-stu-id="3e896-122">Additionally, while not protected by a permission, memory access must be confined to strict type safety.</span></span>  
  
-   <span data-ttu-id="3e896-123">**Comprobación de parámetros**.</span><span class="sxs-lookup"><span data-stu-id="3e896-123">**Parameter checking**.</span></span> <span data-ttu-id="3e896-124">Un ataque habitual consiste en pasar parámetros inesperados a métodos de la API de código no administrado que están expuestos, en un intento de hacer que funcionen de manera distinta a su especificación.</span><span class="sxs-lookup"><span data-stu-id="3e896-124">A common attack passes unexpected parameters to exposed unmanaged code API methods in an attempt to cause them to operate out of specification.</span></span> <span data-ttu-id="3e896-125">Las saturaciones del búfer con índices externos al intervalo o valores de desplazamiento son un ejemplo común de este tipo de ataque, al igual que los parámetros que podrían aprovechar un error en el código subyacente.</span><span class="sxs-lookup"><span data-stu-id="3e896-125">Buffer overruns using out-of-range index or offset values are one common example of this type of attack, as are any parameters that might exploit a bug in the underlying code.</span></span> <span data-ttu-id="3e896-126">Por lo tanto, aunque la API de código no administrado sea segura funcionalmente (después de las solicitudes necesarias) para los llamadores de confianza parcial, el código administrado también debe comprobar la validez de los parámetros de manera exhaustiva, para asegurarse de que el código malintencionado no pueda realizar llamadas no previstas con el nivel del contenedor de código administrado.</span><span class="sxs-lookup"><span data-stu-id="3e896-126">Thus, even if the unmanaged code API is functionally safe (after necessary demands) for partially trusted callers, managed code must also check parameter validity exhaustively to ensure that no unintended calls are possible from malicious code using the managed code wrapper layer.</span></span>  
  
## <a name="using-suppressunmanagedcodesecurityattribute"></a><span data-ttu-id="3e896-127">Utilizar SuppressUnmanagedCodeSecurityAttribute</span><span class="sxs-lookup"><span data-stu-id="3e896-127">Using SuppressUnmanagedCodeSecurityAttribute</span></span>  
 <span data-ttu-id="3e896-128">Hay un aspecto del rendimiento que está relacionado con la aserción y la posterior llamada a código no administrado.</span><span class="sxs-lookup"><span data-stu-id="3e896-128">There is a performance aspect to asserting and then calling unmanaged code.</span></span> <span data-ttu-id="3e896-129">Por cada llamada de este tipo, el sistema de seguridad solicita permiso automáticamente al código no administrado, lo que provoca un recorrido de la pila cada vez.</span><span class="sxs-lookup"><span data-stu-id="3e896-129">For every such call, the security system automatically demands unmanaged code permission, resulting in a stack walk each time.</span></span> <span data-ttu-id="3e896-130">Si declara una aserción y, justo después, llama a código no administrado, puede que el recorrido de la pila no tenga sentido: estará formado por su aserción y su llamada a código no administrado.</span><span class="sxs-lookup"><span data-stu-id="3e896-130">If you assert and immediately call unmanaged code, the stack walk can be meaningless: it consists of your assert and your unmanaged code call.</span></span>  
  
 <span data-ttu-id="3e896-131">Se puede aplicar un atributo personalizado denominado <xref:System.Security.SuppressUnmanagedCodeSecurityAttribute> a los puntos de entrada del código no administrado para deshabilitar la comprobación de seguridad normal que solicita <xref:System.Security.Permissions.SecurityPermission> con el permiso <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> especificado.</span><span class="sxs-lookup"><span data-stu-id="3e896-131">A custom attribute called <xref:System.Security.SuppressUnmanagedCodeSecurityAttribute> can be applied to unmanaged code entry points to disable the normal security check that demands <xref:System.Security.Permissions.SecurityPermission> with the <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> permission specified.</span></span> <span data-ttu-id="3e896-132">Es necesario extremar las precauciones siempre que se haga esto, porque esta acción abre la puerta al código no administrado sin comprobaciones de seguridad en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="3e896-132">Extreme caution must always be taken when doing this, because this action creates an open door into unmanaged code with no runtime security checks.</span></span> <span data-ttu-id="3e896-133">Se debe tener en cuenta que, incluso si se aplica **SuppressUnmanagedCodeSecurityAttribute** , hay una comprobación de seguridad que se realiza una sola vez durante la compilación Just-In-Time (JIT), con el fin de comprobar que el llamador inmediato tiene permiso para llamar a código no administrado.</span><span class="sxs-lookup"><span data-stu-id="3e896-133">It should be noted that even with **SuppressUnmanagedCodeSecurityAttribute** applied, there is a one-time security check that happens at just-in-time (JIT) compilation to ensure that the immediate caller has permission to call unmanaged code.</span></span>  
  
 <span data-ttu-id="3e896-134">Si utiliza el **SuppressUnmanagedCodeSecurityAttribute**, compruebe los puntos siguientes:</span><span class="sxs-lookup"><span data-stu-id="3e896-134">If you use the **SuppressUnmanagedCodeSecurityAttribute**, check the following points:</span></span>  
  
-   <span data-ttu-id="3e896-135">Haga que el punto de entrada al código no administrado sea interno o inaccesible fuera de su código.</span><span class="sxs-lookup"><span data-stu-id="3e896-135">Make the unmanaged code entry point internal or otherwise inaccessible outside your code.</span></span>  
  
-   <span data-ttu-id="3e896-136">Todas las llamadas a código no administrado son vulnerabilidades de seguridad potenciales.</span><span class="sxs-lookup"><span data-stu-id="3e896-136">Any call into unmanaged code is a potential security hole.</span></span> <span data-ttu-id="3e896-137">Asegúrese de que su código no sea una puerta de entrada que permita al código malintencionado llamar indirectamente a código no administrado y evitar comprobaciones de seguridad.</span><span class="sxs-lookup"><span data-stu-id="3e896-137">Make sure your code is not a portal for malicious code to indirectly call into unmanaged code and avoid a security check.</span></span> <span data-ttu-id="3e896-138">Solicite permisos, si es adecuado.</span><span class="sxs-lookup"><span data-stu-id="3e896-138">Demand permissions, if appropriate.</span></span>  
  
-   <span data-ttu-id="3e896-139">Use una convención de nomenclatura que identifique explícitamente el momento en el que crea una ruta de acceso peligrosa a código no administrado, como se describe en la siguiente sección.</span><span class="sxs-lookup"><span data-stu-id="3e896-139">Use a naming convention to explicitly identify when you are creating a dangerous path into unmanaged code, as described in the section below..</span></span>  
  
## <a name="naming-convention-for-unmanaged-code-methods"></a><span data-ttu-id="3e896-140">Convención de nomenclatura para métodos de código no administrado</span><span class="sxs-lookup"><span data-stu-id="3e896-140">Naming convention for unmanaged code methods</span></span>  
 <span data-ttu-id="3e896-141">Hay una convención establecida, útil y muy recomendada, para asignar nombres a los métodos de código no administrado.</span><span class="sxs-lookup"><span data-stu-id="3e896-141">A useful and highly recommended convention has been established for naming unmanaged code methods.</span></span> <span data-ttu-id="3e896-142">Todos los métodos de código no administrado se dividen en tres categorías: **safe**, **native**y **unsafe**.</span><span class="sxs-lookup"><span data-stu-id="3e896-142">All unmanaged code methods are separated into three categories: **safe**, **native**, and **unsafe**.</span></span> <span data-ttu-id="3e896-143">Estas palabras clave se pueden utilizar como nombres de clases, dentro de las cuales se definen los distintos tipos de puntos de entrada de código no administrado.</span><span class="sxs-lookup"><span data-stu-id="3e896-143">These keywords can be used as class names within which the various kinds of unmanaged code entry points are defined.</span></span> <span data-ttu-id="3e896-144">En el código fuente, estas palabras clave se deben agregar al nombre de la clase, como en `Safe.GetTimeOfDay`, `Native.Xyz`o `Unsafe.DangerousAPI`, por ejemplo.</span><span class="sxs-lookup"><span data-stu-id="3e896-144">In source code, these keywords should be added to the class name, as in `Safe.GetTimeOfDay`, `Native.Xyz`, or `Unsafe.DangerousAPI`, for example.</span></span> <span data-ttu-id="3e896-145">Cada una de estas palabras clave proporciona información de seguridad útil para los desarrolladores que utilizan esa clase, como se describe en la tabla siguiente.</span><span class="sxs-lookup"><span data-stu-id="3e896-145">Each of these keywords provides useful security information for developers using that class, as described in the following table.</span></span>  
  
|<span data-ttu-id="3e896-146">Palabra clave</span><span class="sxs-lookup"><span data-stu-id="3e896-146">Keyword</span></span>|<span data-ttu-id="3e896-147">Consideraciones de seguridad</span><span class="sxs-lookup"><span data-stu-id="3e896-147">Security considerations</span></span>|  
|-------------|-----------------------------|  
|<span data-ttu-id="3e896-148">**safe**</span><span class="sxs-lookup"><span data-stu-id="3e896-148">**safe**</span></span>|<span data-ttu-id="3e896-149">Totalmente inofensivo cuando lo llama cualquier código, aunque sea código malintencionado.</span><span class="sxs-lookup"><span data-stu-id="3e896-149">Completely harmless for any code, even malicious code, to call.</span></span> <span data-ttu-id="3e896-150">Se puede usar como cualquier otro código administrado.</span><span class="sxs-lookup"><span data-stu-id="3e896-150">Can be used just like other managed code.</span></span> <span data-ttu-id="3e896-151">Por ejemplo, las funciones que obtienen la hora del día suelen ser seguras.</span><span class="sxs-lookup"><span data-stu-id="3e896-151">For example, a function that gets the time of day is typically safe.</span></span>|  
|<span data-ttu-id="3e896-152">**native**</span><span class="sxs-lookup"><span data-stu-id="3e896-152">**native**</span></span>|<span data-ttu-id="3e896-153">Neutro en cuanto a seguridad: es decir, código no administrado que requiere permiso para llamar a código no administrado.</span><span class="sxs-lookup"><span data-stu-id="3e896-153">Security-neutral; that is, unmanaged code that requires unmanaged code permission to call.</span></span> <span data-ttu-id="3e896-154">Se comprueba la seguridad, lo que detiene a los llamadores no autorizados.</span><span class="sxs-lookup"><span data-stu-id="3e896-154">Security is checked, which stops an unauthorized caller.</span></span>|  
|<span data-ttu-id="3e896-155">**unsafe**</span><span class="sxs-lookup"><span data-stu-id="3e896-155">**unsafe**</span></span>|<span data-ttu-id="3e896-156">Punto de entrada de código no administrado potencialmente peligroso sin seguridad.</span><span class="sxs-lookup"><span data-stu-id="3e896-156">Potentially dangerous unmanaged code entry point with security suppressed.</span></span> <span data-ttu-id="3e896-157">Los desarrolladores deben extremar las precauciones cuando utilicen este tipo de código no administrado, y asegurarse de aplicar otras protecciones para evitar vulnerabilidades de seguridad.</span><span class="sxs-lookup"><span data-stu-id="3e896-157">Developers should use the greatest caution when using such unmanaged code, making sure that other protections are in place to prevent a security vulnerability.</span></span> <span data-ttu-id="3e896-158">Los desarrolladores deben actuar con responsabilidad, ya que esta palabra clave invalida el sistema de seguridad.</span><span class="sxs-lookup"><span data-stu-id="3e896-158">Developers must be responsible, as this keyword overrides the security system.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="3e896-159">Vea también</span><span class="sxs-lookup"><span data-stu-id="3e896-159">See Also</span></span>  
 [<span data-ttu-id="3e896-160">Instrucciones de codificación segura</span><span class="sxs-lookup"><span data-stu-id="3e896-160">Secure Coding Guidelines</span></span>](../../../docs/standard/security/secure-coding-guidelines.md)
