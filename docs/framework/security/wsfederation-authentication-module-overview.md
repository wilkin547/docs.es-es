---
title: Información general sobre el módulo de autenticación WSFederation
ms.date: 03/30/2017
ms.assetid: 02c4d5e8-f0a7-49ee-9cf5-3647578510ad
author: BrucePerlerMS
ms.openlocfilehash: bff3875b5f2f3ac187796d89fcd6da31ba911362
ms.sourcegitcommit: fb78d8abbdb87144a3872cf154930157090dd933
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/26/2018
ms.locfileid: "47216960"
---
# <a name="wsfederation-authentication-module-overview"></a><span data-ttu-id="d7c0b-102">Información general sobre el módulo de autenticación WSFederation</span><span class="sxs-lookup"><span data-stu-id="d7c0b-102">WSFederation Authentication Module Overview</span></span>
<span data-ttu-id="d7c0b-103">Windows Identity Foundation (WIF) es compatible con la autenticación federada en aplicaciones ASP.NET a través del Módulo de autenticación de WS-Federation (WS-FAM).</span><span class="sxs-lookup"><span data-stu-id="d7c0b-103">Windows Identity Foundation (WIF) includes support for federated authentication in ASP.NET applications through the WS-Federated Authentication Module (WS-FAM).</span></span> <span data-ttu-id="d7c0b-104">Este tema le ayudará a comprender cómo funciona la autenticación federada y cómo se utiliza.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-104">This topic will help you understand how federated authentication works and how to use it.</span></span>  
  
### <a name="overview-of-federated-authentication"></a><span data-ttu-id="d7c0b-105">Información general sobre la autenticación federada</span><span class="sxs-lookup"><span data-stu-id="d7c0b-105">Overview of Federated Authentication</span></span>  
 <span data-ttu-id="d7c0b-106">La autenticación federada permite al servicio de token de seguridad (STS) de un dominio de confianza proporcionar información de autenticación a un STS de otro dominio de confianza cuando hay una relación de confianza entre los dos dominios.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-106">Federated authentication allows a Security Token Service (STS) in one trust domain to provide authentication information to an STS in another trust domain when there is a trust relationship between the two domains.</span></span> <span data-ttu-id="d7c0b-107">En la siguiente ilustración se muestra un ejemplo de esto.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-107">An example of this is shown in the following illustration.</span></span>  
  
 <span data-ttu-id="d7c0b-108">![Escenario de autenticación de federación](../../../docs/framework/security/media/federatedauthentication.gif "FederatedAuthentication")</span><span class="sxs-lookup"><span data-stu-id="d7c0b-108">![Federation Authentication Scenario](../../../docs/framework/security/media/federatedauthentication.gif "FederatedAuthentication")</span></span>  
  
1.  <span data-ttu-id="d7c0b-109">Un cliente del dominio de confianza Fabrikam envía una solicitud a una aplicación de usuario de confianza (RP) del dominio de confianza Contoso.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-109">A client in the Fabrikam trust domain sends a request to a Relying Party (RP) application in the Contoso trust domain.</span></span>  
  
2.  <span data-ttu-id="d7c0b-110">El RP redirige al cliente a un STS del dominio de confianza Contoso.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-110">The RP redirects the client to an STS in the Contoso trust domain.</span></span> <span data-ttu-id="d7c0b-111">Este STS no conoce al cliente.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-111">This STS has no knowledge of the client.</span></span>  
  
3.  <span data-ttu-id="d7c0b-112">El STS de Contoso redirige al cliente a un STS del dominio de confianza Fabrikam, con el que el dominio de confianza Contoso tiene una relación de confianza.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-112">The Contoso STS redirects the client to an STS in the Fabrikam trust domain, with which the Contoso trust domain has a trust relationship.</span></span>  
  
4.  <span data-ttu-id="d7c0b-113">El STS de Fabrikam comprueba la identidad del cliente y emite un token de seguridad para el STS de Contoso.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-113">The Fabrikam STS verifies the client’s identity and issues a security token to the Contoso STS.</span></span>  
  
5.  <span data-ttu-id="d7c0b-114">El STS de Contoso utiliza el token de Fabrikam para crear su propio token que pueda utilizar el RP y lo envía al RP.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-114">The Contoso STS uses the Fabrikam token to create its own token that can be used by the RP and sends it to the RP.</span></span>  
  
6.  <span data-ttu-id="d7c0b-115">El RP extrae las notificaciones del cliente del token de seguridad y toma una decisión de autorización.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-115">The RP extracts the client’s claims from the security token and makes an authorization decision.</span></span>  
  
### <a name="using-the-federated-authentication-module-with-aspnet"></a><span data-ttu-id="d7c0b-116">Usar el módulo de autenticación federada con ASP.NET</span><span class="sxs-lookup"><span data-stu-id="d7c0b-116">Using the Federated Authentication Module with ASP.NET</span></span>  
 <span data-ttu-id="d7c0b-117"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule> (WS-FAM) es un módulo HTTP que le permite agregar la autenticación federada a una aplicación de [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d7c0b-117"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule> (WS-FAM) is an HTTP module that lets you add federated authentication to an [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] application.</span></span> <span data-ttu-id="d7c0b-118">La autenticación federada permite al STS controlar la lógica de autenticación y permite al usuario centrarse en la escritura de la lógica de negocios.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-118">Federated authentication lets authentication logic be handled by the STS and lets you focus on writing business logic.</span></span>  
  
 <span data-ttu-id="d7c0b-119">Configure WS-FAM para especificar el STS al que deben redirigirse las solicitudes no autenticadas.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-119">You configure the WS-FAM to specify the STS to which non-authenticated requests should be redirected.</span></span> <span data-ttu-id="d7c0b-120">WIF le permite autenticar a un usuario de dos maneras:</span><span class="sxs-lookup"><span data-stu-id="d7c0b-120">WIF lets you authenticate a user in two ways:</span></span>  
  
1.  <span data-ttu-id="d7c0b-121">Redirección pasiva: este es el enfoque correcto cuando un usuario no autenticado trata de obtener acceso a un recurso protegido y, simplemente, desea redirigirlo a un STS sin necesidad de una página de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-121">Passive redirect: When an unauthenticated user tries to access a protected resource, and you want to simply redirect them to an STS without requiring a login page, then this is the right approach.</span></span> <span data-ttu-id="d7c0b-122">El STS comprueba la identidad del usuario y emite un token de seguridad que contiene las notificaciones adecuadas para dicho usuario.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-122">The STS verifies the user’s identity, and issues a security token that contains the appropriate claims for that user.</span></span> <span data-ttu-id="d7c0b-123">Esta opción requiere que se agregue el WS-FAM a la canalización de módulos HTTP.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-123">This option requires the WS-FAM to be added in the HTTP Modules pipeline.</span></span> <span data-ttu-id="d7c0b-124">Puede utilizar la herramienta denominada Identity and Access Tool de Visual Studio 2012 para modificar el archivo de configuración de la aplicación de modo que use WS-FAM y se federe con un STS.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-124">You can use the Identity and Access Tool for Visual Studio 2012 to modify your application’s configuration file to use the WS-FAM and to federate with an STS.</span></span> <span data-ttu-id="d7c0b-125">Para más información, vea [Identity and Access Tool for Visual Studio 2012 (Herramienta de identidad y acceso para Visual Studio 2012)](../../../docs/framework/security/identity-and-access-tool-for-vs.md).</span><span class="sxs-lookup"><span data-stu-id="d7c0b-125">For more information, see [Identity and Access Tool for Visual Studio 2012](../../../docs/framework/security/identity-and-access-tool-for-vs.md).</span></span>  
  
2.  <span data-ttu-id="d7c0b-126">Puede llamar al método <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignIn%2A?displayProperty=nameWithType> o al método <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectToIdentityProvider%2A> desde el código subyacente para utilizar una página de inicio de sesión en su aplicación de RP.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-126">You can call the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignIn%2A?displayProperty=nameWithType> method or the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectToIdentityProvider%2A> method from the code-behind for a sign-in page in your RP application.</span></span>  
  
 <span data-ttu-id="d7c0b-127">En la redirección pasiva, toda la comunicación se lleva a cabo a través de la respuesta/redirección desde el cliente (normalmente, un explorador).</span><span class="sxs-lookup"><span data-stu-id="d7c0b-127">In passive redirect, all communication is performed through response/redirect from the client (typically a browser).</span></span> <span data-ttu-id="d7c0b-128">Puede agregar el WS-FAM a la canalización HTTP de la aplicación, donde está a la espera de solicitudes de usuario no autenticadas y redirige a los usuarios al STS especificado.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-128">You can add the WS-FAM to your application’s HTTP pipeline, where it watches for unauthenticated user requests and redirects users to the STS you specify.</span></span>  
  
 <span data-ttu-id="d7c0b-129">El WS-FAM también genera varios eventos que le permiten personalizar su funcionalidad en una aplicación de [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d7c0b-129">The WS-FAM also raises several events that let you customize its functionality in an [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] application.</span></span>  
  
### <a name="how-the-ws-fam-works"></a><span data-ttu-id="d7c0b-130">Cómo funciona el WS-FAM</span><span class="sxs-lookup"><span data-stu-id="d7c0b-130">How the WS-FAM Works</span></span>  
 <span data-ttu-id="d7c0b-131">El WS-FAM se implementa en la clase <xref:System.IdentityModel.Services.WSFederationAuthenticationModule>.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-131">The WS-FAM is implemented in the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> class.</span></span> <span data-ttu-id="d7c0b-132">Normalmente, agrega el WS-FAM a la canalización HTTP de la aplicación RP de [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d7c0b-132">Typically, you add the WS-FAM to the HTTP pipeline of your [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] RP application.</span></span> <span data-ttu-id="d7c0b-133">Cuando un usuario no autenticado intenta acceder a un recurso protegido, el RP devuelve una respuesta HTTP "401 Autorización denegada".</span><span class="sxs-lookup"><span data-stu-id="d7c0b-133">When an unauthenticated user tries to access a protected resource, the RP returns a "401 authorization denied" HTTP response.</span></span> <span data-ttu-id="d7c0b-134">El WS-FAM intercepta esta respuesta en lugar de permitir al cliente recibirla y, a continuación, redirige al usuario al STS especificado.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-134">The WS-FAM intercepts this response instead of allowing the client to receive it, then it redirects the user to the specified STS.</span></span> <span data-ttu-id="d7c0b-135">El STS emite un token de seguridad, que el WS-FAM intercepta de nuevo.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-135">The STS issues a security token, which the WS-FAM again intercepts.</span></span> <span data-ttu-id="d7c0b-136">El WS-FAM utiliza el token para crear una instancia de <xref:System.Security.Claims.ClaimsPrincipal> para el usuario autenticado, lo que permite a los mecanismos de autorización de [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] normales funcionar.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-136">The WS-FAM uses the token to create an instance of <xref:System.Security.Claims.ClaimsPrincipal> for the authenticated user, which enables regular [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] authorization mechanisms to function.</span></span>  
  
 <span data-ttu-id="d7c0b-137">Dado que el HTTP no tiene estado, necesitamos una manera de evitar repetir todo este proceso completo cada vez que el usuario trata de tener acceso a otro recurso protegido.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-137">Because HTTP is stateless, we need a way to avoid repeating this whole process every time that the user tries to access another protected resource.</span></span> <span data-ttu-id="d7c0b-138">Aquí es donde entra en juego el <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-138">This is where the <xref:System.IdentityModel.Services.SessionAuthenticationModule> comes in.</span></span> <span data-ttu-id="d7c0b-139">Cuando el STS emite un token de seguridad para el usuario, <xref:System.IdentityModel.Services.SessionAuthenticationModule> también crea un token de seguridad de la sesión para el usuario y lo coloca en una cookie.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-139">When the STS issues a security token for the user, <xref:System.IdentityModel.Services.SessionAuthenticationModule> also creates a session security token for the user and puts it in a cookie.</span></span> <span data-ttu-id="d7c0b-140">En solicitudes posteriores, <xref:System.IdentityModel.Services.SessionAuthenticationModule> intercepta esta cookie y la utiliza para reconstruir la <xref:System.Security.Claims.ClaimsPrincipal> del usuario.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-140">On subsequent requests, the <xref:System.IdentityModel.Services.SessionAuthenticationModule> intercepts this cookie and uses it to reconstruct the user’s <xref:System.Security.Claims.ClaimsPrincipal>.</span></span>  
  
 <span data-ttu-id="d7c0b-141">En el siguiente diagrama se muestra el flujo general de información en el caso de redirección pasiva.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-141">The following diagram shows the overall flow of information in the passive redirect case.</span></span> <span data-ttu-id="d7c0b-142">La solicitud se redirige de manera automática a través del STS para establecer credenciales sin una página de inicio de sesión:</span><span class="sxs-lookup"><span data-stu-id="d7c0b-142">The request is automatically redirected via the STS to establish credentials without a login page:</span></span>  
  
 <span data-ttu-id="d7c0b-143">![Diagrama de control de tiempo de inicio de sesión con redirección pasiva](../../../docs/framework/security/media/signinusingpassiveredirect.gif "SignInUsingPassiveRedirect")</span><span class="sxs-lookup"><span data-stu-id="d7c0b-143">![Timing diagram for sign&#45;in with passive redirect](../../../docs/framework/security/media/signinusingpassiveredirect.gif "SignInUsingPassiveRedirect")</span></span>  
  
 <span data-ttu-id="d7c0b-144">En el diagrama siguiente se muestra con mayor detalle lo que sucede cuando el usuario se ha autenticado en el STS y el <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> procesa sus tokens de seguridad:</span><span class="sxs-lookup"><span data-stu-id="d7c0b-144">The following diagram shows more detail on what happens when the user has authenticated to the STS and their security tokens are processed by the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule>:</span></span>  
  
 <span data-ttu-id="d7c0b-145">![Control de tiempo de procesamiento de tokens con redirección pasiva](../../../docs/framework/security/media/signinusingpassiveredirect-tokenprocessing.gif "SignInUsingPassiveRedirect_TokenProcessing")</span><span class="sxs-lookup"><span data-stu-id="d7c0b-145">![Timing for token processing with passive redirect](../../../docs/framework/security/media/signinusingpassiveredirect-tokenprocessing.gif "SignInUsingPassiveRedirect_TokenProcessing")</span></span>  
  
 <span data-ttu-id="d7c0b-146">En el siguiente diagrama se muestra con mayor detalle lo que sucede cuando se han serializado los tokens de seguridad del usuario en cookies y el <xref:System.IdentityModel.Services.SessionAuthenticationModule> los intercepta:</span><span class="sxs-lookup"><span data-stu-id="d7c0b-146">The following diagram shows more detail on what happens when the user’s security tokens have been serialized into cookies and are intercepted by the <xref:System.IdentityModel.Services.SessionAuthenticationModule>:</span></span>  
  
 <span data-ttu-id="d7c0b-147">![Diagrama de control de tiempo de SAM que muestra el inicio de sesión con controles](../../../docs/framework/security/media/signinusingconrols-sam.gif "SignInUsingConrols_SAM")</span><span class="sxs-lookup"><span data-stu-id="d7c0b-147">![SAM timing diagram showing sign&#45;in using controls](../../../docs/framework/security/media/signinusingconrols-sam.gif "SignInUsingConrols_SAM")</span></span>  
  
### <a name="events"></a><span data-ttu-id="d7c0b-148">Eventos</span><span class="sxs-lookup"><span data-stu-id="d7c0b-148">Events</span></span>  
 <span data-ttu-id="d7c0b-149"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule>, <xref:System.IdentityModel.Services.SessionAuthenticationModule>, y su clase primaria, <xref:System.IdentityModel.Services.HttpModuleBase>, generan eventos en las diferentes fases de procesamiento de una solicitud HTTP.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-149"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule>, <xref:System.IdentityModel.Services.SessionAuthenticationModule>, and their parent class, <xref:System.IdentityModel.Services.HttpModuleBase>, raise events at various stages of processing of an HTTP request.</span></span> <span data-ttu-id="d7c0b-150">Puede controlar estos eventos en el archivo `global.asax` de la aplicación [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d7c0b-150">You can handle these events in the `global.asax` file of your [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] application.</span></span>  
  
-   <span data-ttu-id="d7c0b-151">La infraestructura de ASP.NET invoca el método <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A> del módulo para inicializarlo.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-151">The ASP.NET infrastructure invokes the module’s <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A> method to initialize the module.</span></span>  
  
-   <span data-ttu-id="d7c0b-152">Se genera el evento <xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfigurationCreated?displayProperty=nameWithType> cuando la infraestructura de ASP.NET invoca el método <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A> por primera vez en uno de los módulos de la aplicación derivados de <xref:System.IdentityModel.Services.HttpModuleBase>.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-152">The <xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfigurationCreated?displayProperty=nameWithType> event is raised when the ASP.NET infrastructure invokes the <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A> method for the first time on one of the application’s modules that derive from <xref:System.IdentityModel.Services.HttpModuleBase>.</span></span> <span data-ttu-id="d7c0b-153">Este método obtiene acceso a la propiedad <xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfiguration%2A?displayProperty=nameWithType> estática, que hace que se cargue la configuración del archivo Web.config.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-153">This method accesses the static <xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfiguration%2A?displayProperty=nameWithType> property, which causes configuration to be loaded from the Web.config file.</span></span> <span data-ttu-id="d7c0b-154">Este evento solo se genera la primera vez que se accede a esta propiedad.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-154">This event is only raised the first time this property is accessed.</span></span> <span data-ttu-id="d7c0b-155">Al objeto <xref:System.IdentityModel.Services.Configuration.FederationConfiguration> que se inicializa desde la configuración se puede acceder mediante la propiedad <xref:System.IdentityModel.Services.Configuration.FederationConfigurationCreatedEventArgs.FederationConfiguration%2A?displayProperty=nameWithType> de un controlador de eventos.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-155">The <xref:System.IdentityModel.Services.Configuration.FederationConfiguration> object that is initialized from configuration can be accessed through the <xref:System.IdentityModel.Services.Configuration.FederationConfigurationCreatedEventArgs.FederationConfiguration%2A?displayProperty=nameWithType> property in an event handler.</span></span> <span data-ttu-id="d7c0b-156">Puede utilizar este evento para modificar la configuración antes de que se aplique a cualquier módulo.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-156">You can use this event to modify the configuration before it is applied to any modules.</span></span> <span data-ttu-id="d7c0b-157">Puede agregar un controlador para este evento en el método Application_Start:</span><span class="sxs-lookup"><span data-stu-id="d7c0b-157">You can add a handler for this event in the Application_Start method:</span></span>  
  
    ```  
    void Application_Start(object sender, EventArgs e)  
    {  
        FederatedAuthentication.FederationConfigurationCreated += new EventHandler<FederationConfigurationCreatedEventArgs>(FederatedAuthentication_FederationConfigurationCreated);  
    }  
    ```  
  
     <span data-ttu-id="d7c0b-158">Cada módulo invalida los métodos abstractos <xref:System.IdentityModel.Services.HttpModuleBase.InitializeModule%2A?displayProperty=nameWithType> y <xref:System.IdentityModel.Services.HttpModuleBase.InitializePropertiesFromConfiguration%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-158">Each module overrides the <xref:System.IdentityModel.Services.HttpModuleBase.InitializeModule%2A?displayProperty=nameWithType> and <xref:System.IdentityModel.Services.HttpModuleBase.InitializePropertiesFromConfiguration%2A?displayProperty=nameWithType> abstract methods.</span></span> <span data-ttu-id="d7c0b-159">El primero de estos métodos agrega controladores para los eventos de canalización de ASP.NET que son del interés del módulo.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-159">The first of these methods adds handlers for ASP.NET pipeline events that are of interest to the module.</span></span> <span data-ttu-id="d7c0b-160">En la mayoría de los casos, la implementación predeterminada del módulo será suficiente.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-160">In most cases the module’s default implementation will suffice.</span></span> <span data-ttu-id="d7c0b-161">El segundo de estos métodos inicializa las propiedades del módulo desde su propiedad <xref:System.IdentityModel.Services.HttpModuleBase.FederationConfiguration%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-161">The second of these methods initializes the module’s properties from its <xref:System.IdentityModel.Services.HttpModuleBase.FederationConfiguration%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="d7c0b-162">(Esta es una copia de la configuración que se cargó anteriormente). Puede que necesite invalidar este segundo método si desea admitir la inicialización de nuevas propiedades desde la configuración en clases derivadas de <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> o <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-162">(This is a copy of the configuration that was loaded previously.) You may need to override this second method if you want to support the initialization of new properties from configuration in classes that you derive from <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> or <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span></span> <span data-ttu-id="d7c0b-163">En casos como este, también necesitaría derivar desde los objetos de configuración adecuados para admitir las propiedades de configuración agregadas; por ejemplo, desde <xref:System.IdentityModel.Configuration.IdentityConfiguration>, <xref:System.IdentityModel.Services.Configuration.WsFederationConfiguration> o <xref:System.IdentityModel.Services.Configuration.FederationConfiguration>.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-163">In such cases you would also need to derive from the appropriate configuration objects to support the added configuration properties; for example, from <xref:System.IdentityModel.Configuration.IdentityConfiguration>, <xref:System.IdentityModel.Services.Configuration.WsFederationConfiguration>, or <xref:System.IdentityModel.Services.Configuration.FederationConfiguration>.</span></span>  
  
-   <span data-ttu-id="d7c0b-164">El WS-FAM genera el evento <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenReceived> cuando intercepta un token de seguridad que el STS ha emitido.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-164">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenReceived> event when it intercepts a security token that has been issued by the STS.</span></span>  
  
-   <span data-ttu-id="d7c0b-165">El WS-FAM genera el evento <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenValidated> después de validar el token.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-165">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenValidated> event after it has validated the token.</span></span>  
  
-   <span data-ttu-id="d7c0b-166">El <xref:System.IdentityModel.Services.SessionAuthenticationModule> genera el evento <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenCreated> cuando crea un token de seguridad de la sesión para el usuario.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-166">The <xref:System.IdentityModel.Services.SessionAuthenticationModule> raises the <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenCreated> event when it creates a session security token for the user.</span></span>  
  
-   <span data-ttu-id="d7c0b-167">El <xref:System.IdentityModel.Services.SessionAuthenticationModule> genera el evento <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenReceived> cuando intercepta las solicitudes posteriores con la cookie que contiene el token de seguridad de la sesión.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-167">The <xref:System.IdentityModel.Services.SessionAuthenticationModule> raises the <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenReceived> event when it intercepts subsequent requests with the cookie that contains the session security token.</span></span>  
  
-   <span data-ttu-id="d7c0b-168">Antes de que el WS-FAM redirija al usuario al emisor, genera el evento <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider>.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-168">Before the WS-FAM redirects the user to the issuer, it raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider> event.</span></span> <span data-ttu-id="d7c0b-169">La solicitud de inicio de sesión de WS-Federation está disponible mediante la propiedad <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs.SignInRequestMessage%2A> de los <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs> pasados en el evento.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-169">The WS-Federation sign-in request is available through the <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs.SignInRequestMessage%2A> property of the <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs> passed in the event.</span></span> <span data-ttu-id="d7c0b-170">Puede elegir modificar la solicitud antes de enviarlos al emisor.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-170">You may choose to modify the request before sending this out to the issuer.</span></span>  
  
-   <span data-ttu-id="d7c0b-171">El WS-FAM genera el evento <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignedIn> cuando la cookie se escribe correctamente y el usuario ha iniciado sesión.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-171">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignedIn> event when the cookie is successfully written and the user is signed in.</span></span>  
  
-   <span data-ttu-id="d7c0b-172">El WS-FAM genera el evento <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SigningOut> una vez por sesión cuando se cierra la sesión para cada usuario.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-172">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SigningOut> event one time per session as the session is being closed down for each user.</span></span> <span data-ttu-id="d7c0b-173">No se genera si la sesión se cierra en el lado del cliente (por ejemplo, eliminando la cookie de la sesión).</span><span class="sxs-lookup"><span data-stu-id="d7c0b-173">It is not raised if the session is closed down on the client-side (for example, by deleting the session cookie).</span></span> <span data-ttu-id="d7c0b-174">En un entorno de SSO, el IP-STS también puede solicitar a cada RP que cierre sesión.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-174">In an SSO environment, the IP-STS can request each RP to sign out, too.</span></span> <span data-ttu-id="d7c0b-175">Esto también generará este evento, con <xref:System.IdentityModel.Services.SigningOutEventArgs.IsIPInitiated%2A> establecido en `true`.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-175">This will also raise this event, with <xref:System.IdentityModel.Services.SigningOutEventArgs.IsIPInitiated%2A> set to `true`.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="d7c0b-176">No debe utilizar la propiedad <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> durante ningún evento generado por <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> o <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-176">You should not use the <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> property during any event raised by <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> or <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span></span> <span data-ttu-id="d7c0b-177">Esto se debe a que <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> se establece después del proceso de autenticación, mientras que los eventos se generan durante el proceso de autenticación.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-177">This is because <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> is set after the authentication process, while events are raised during the authentication process.</span></span>  
  
### <a name="configuration-of-federated-authentication"></a><span data-ttu-id="d7c0b-178">Configuración de la autenticación federada</span><span class="sxs-lookup"><span data-stu-id="d7c0b-178">Configuration of Federated Authentication</span></span>  
 <span data-ttu-id="d7c0b-179">WS-FAM y SAM se configuran mediante el elemento [\<federationConfiguration>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/federationconfiguration.md).</span><span class="sxs-lookup"><span data-stu-id="d7c0b-179">The WS-FAM and SAM are configured through the [\<federationConfiguration>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/federationconfiguration.md) element.</span></span> <span data-ttu-id="d7c0b-180">El elemento secundario [\<wsFederation>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/wsfederation.md) configura los valores predeterminados de las propiedades de WS-FAM, como la propiedad <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Issuer%2A> y la propiedad <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Realm%2A>.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-180">The [\<wsFederation>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/wsfederation.md) child element configures default values for the WS-FAM properties; such as the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Issuer%2A> property and the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Realm%2A> property.</span></span> <span data-ttu-id="d7c0b-181">(Estos valores se pueden cambiar en cada solicitud proporcionando controladores para algunos de los eventos de WS-FAM. Por ejemplo, <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider>). El controlador de cookies que usa SAM se configura mediante el elemento secundario [\<cookieHandler>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/cookiehandler.md).</span><span class="sxs-lookup"><span data-stu-id="d7c0b-181">(These values can be changed on a per request basis by providing handlers for some of the WS-FAM events; for example, <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider>.) The cookie handler that is used by the SAM is configured through the [\<cookieHandler>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/cookiehandler.md) child element.</span></span> <span data-ttu-id="d7c0b-182">WIF proporciona un controlador de cookies predeterminado implementado en la clase <xref:System.IdentityModel.Services.ChunkedCookieHandler> cuyo tamaño de fragmento se puede establecer mediante el elemento [\<chunkedCookieHandler>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/chunkedcookiehandler.md).</span><span class="sxs-lookup"><span data-stu-id="d7c0b-182">WIF provides a default cookie handler implemented in the <xref:System.IdentityModel.Services.ChunkedCookieHandler> class that can have its chunk size set through the [\<chunkedCookieHandler>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/chunkedcookiehandler.md) element.</span></span> <span data-ttu-id="d7c0b-183">El elemento `<federationConfiguration>` hace referencia a un <xref:System.IdentityModel.Configuration.IdentityConfiguration>, que proporciona la configuración para otros componentes de WIF utilizados en la aplicación, como <xref:System.Security.Claims.ClaimsAuthenticationManager> y <xref:System.Security.Claims.ClaimsAuthorizationManager>.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-183">The `<federationConfiguration>` element references an <xref:System.IdentityModel.Configuration.IdentityConfiguration>, which provides configuration for other WIF components used in the application, such as the <xref:System.Security.Claims.ClaimsAuthenticationManager> and the <xref:System.Security.Claims.ClaimsAuthorizationManager>.</span></span> <span data-ttu-id="d7c0b-184">Se puede hacer referencia de manera explícita a la configuración de identidad al especificar un elemento [\<identityConfiguration>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/identityconfiguration.md) con nombre en el atributo `identityConfigurationName` del elemento `<federationConfiguration>`.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-184">The identity configuration may be referenced explicitly by specifying a named [\<identityConfiguration>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/identityconfiguration.md) element in the `identityConfigurationName` attribute of the `<federationConfiguration>` element.</span></span> <span data-ttu-id="d7c0b-185">Si no se hace referencia a la configuración de identidad de manera explícita, se usará la configuración de identidad predeterminada.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-185">If the identity configuration is not referenced explicitly, the default identity configuration will be used.</span></span>  
  
 <span data-ttu-id="d7c0b-186">El código XML siguiente muestra una configuración de una aplicación de usuario de confianza (RP) de ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-186">The following XML shows a configuration of an ASP.NET relying party (RP) application.</span></span> <span data-ttu-id="d7c0b-187">Las secciones de configuración <xref:System.IdentityModel.Configuration.SystemIdentityModelSection> y <xref:System.IdentityModel.Services.Configuration.SystemIdentityModelServicesSection> se agregan bajo el elemento `<configSections>`.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-187">The <xref:System.IdentityModel.Configuration.SystemIdentityModelSection> and <xref:System.IdentityModel.Services.Configuration.SystemIdentityModelServicesSection> configuration sections are added under the `<configSections>` element.</span></span> <span data-ttu-id="d7c0b-188">SAM y WS-FAM se agregan a los módulos HTTP bajo el elemento `<system.webServer>`/`<modules>`.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-188">The SAM and WS-FAM are added to the HTTP Modules under the `<system.webServer>`/`<modules>` element.</span></span> <span data-ttu-id="d7c0b-189">Por último, los componentes de WIF se configuran bajo los elementos `<system.identityModel>`/`<identityConfiguration>` y `<system.identityModel.services>`/`<federationConfiguration>`.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-189">Finally the WIF components are configured under the `<system.identityModel>`/`<identityConfiguration>` and `<system.identityModel.services>`/`<federationConfiguration>` elements.</span></span> <span data-ttu-id="d7c0b-190">Esta configuración especifica el controlador de cookies fragmentado, ya que es el controlador de cookies predeterminado y no hay un tipo de controlador de cookies especificado en el elemento `<cookieHandler>`.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-190">This configuration specifies the chunked cookie handler as it is the default cookie handler and there is not a cookie handler type specified in the `<cookieHandler>` element.</span></span>  
  
> [!WARNING]
>  <span data-ttu-id="d7c0b-191">En el ejemplo siguiente, el atributo `requireHttps` del elemento `<wsFederation>` y el atributo `requireSsl` del elemento `<cookieHandler>` son `false`.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-191">In the following example, both the `requireHttps` attribute of the `<wsFederation>` element and the `requireSsl` attribute of the `<cookieHandler>` element are `false`.</span></span> <span data-ttu-id="d7c0b-192">Esto presenta una amenaza de seguridad potencial.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-192">This presents a potential security threat.</span></span> <span data-ttu-id="d7c0b-193">En producción, ambos valores se deben establecer en `true`.</span><span class="sxs-lookup"><span data-stu-id="d7c0b-193">In production, both these values should be set `true`.</span></span>  
  
```xml  
<configuration>  
  <configSections>  
    <section name="system.identityModel" type="System.IdentityModel.Configuration.SystemIdentityModelSection, System.IdentityModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089" />  
    <section name="system.identityModel.services" type="System.IdentityModel.Services.Configuration.SystemIdentityModelServicesSection, System.IdentityModel.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089" />  
  </configSections>  
  
  ...  
  
  <system.webServer>  
    <modules>  
      <add name="WSFederationAuthenticationModule" type="System.IdentityModel.Services.WSFederationAuthenticationModule, System.IdentityModel.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" preCondition="managedHandler" />  
      <add name="SessionAuthenticationModule" type="System.IdentityModel.Services.SessionAuthenticationModule, System.IdentityModel.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" preCondition="managedHandler" />  
    </modules>  
  </system.webServer>  
  
  <system.identityModel>  
    <identityConfiguration>  
      <audienceUris>  
        <add value="http://localhost:50969/" />  
      </audienceUris>  
      <certificateValidation certificateValidationMode="None" />  
      <issuerNameRegistry type="System.IdentityModel.Tokens.ConfigurationBasedIssuerNameRegistry, System.IdentityModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089">  
        <trustedIssuers>  
          <add thumbprint="9B74CB2F320F7AAFC156E1252270B1DC01EF40D0" name="LocalSTS" />  
        </trustedIssuers>  
      </issuerNameRegistry>  
    </identityConfiguration>  
  </system.identityModel>  
  <system.identityModel.services>  
    <federationConfiguration>  
      <wsFederation passiveRedirectEnabled="true" issuer="http://localhost:15839/wsFederationSTS/Issue" realm="http://localhost:50969/" reply="http://localhost:50969/" requireHttps="false" />  
      <cookieHandler requireSsl="false" />  
    </federationConfiguration>  
  </system.identityModel.services>  
</configuration>  
```  
  
## <a name="see-also"></a><span data-ttu-id="d7c0b-194">Vea también</span><span class="sxs-lookup"><span data-stu-id="d7c0b-194">See Also</span></span>  
 <xref:System.IdentityModel.Services.SessionAuthenticationModule>  
 <xref:System.IdentityModel.Services.WSFederationAuthenticationModule>  
 [<span data-ttu-id="d7c0b-195">\<federationConfiguration></span><span class="sxs-lookup"><span data-stu-id="d7c0b-195">\<federationConfiguration></span></span>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/federationconfiguration.md)
