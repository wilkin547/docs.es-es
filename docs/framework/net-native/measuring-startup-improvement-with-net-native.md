---
description: Más información sobre cómo medir la mejora del inicio con .NET Native
title: Medir la mejora del inicio con .NET Native
ms.date: 03/30/2017
ms.assetid: c4d25b24-9c1a-4b3e-9705-97ba0d6c0289
ms.openlocfilehash: ef3245811f79475fc7c267e7376f6140e8686724
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/06/2021
ms.locfileid: "99747600"
---
# <a name="measuring-startup-improvement-with-net-native"></a><span data-ttu-id="023b8-103">Medir la mejora del inicio con .NET Native</span><span class="sxs-lookup"><span data-stu-id="023b8-103">Measuring Startup Improvement with .NET Native</span></span>

<span data-ttu-id="023b8-104">.NET Native mejora significativamente el tiempo de inicio de las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="023b8-104">.NET Native significantly improves the launch time of apps.</span></span> <span data-ttu-id="023b8-105">Esta mejora es especialmente palpable en los dispositivos portátiles de baja potencia y con aplicaciones complejas.</span><span class="sxs-lookup"><span data-stu-id="023b8-105">This improvement is particularly noticeable on portable, low-powered devices and with complex apps.</span></span> <span data-ttu-id="023b8-106">Este tema sirve de introducción a la instrumentación básica necesaria para medir esta mejora de inicio.</span><span class="sxs-lookup"><span data-stu-id="023b8-106">This topic helps you get started with the basic instrumentation needed to measure this startup improvement.</span></span>  
  
 <span data-ttu-id="023b8-107">Para facilitar las investigaciones de rendimiento, .NET Framework y Windows usan un marco de trabajo de eventos llamado Seguimiento de eventos para Windows (ETW), que permite que la aplicación avise a las herramientas cuando se produzcan eventos.</span><span class="sxs-lookup"><span data-stu-id="023b8-107">To facilitate performance investigations, the .NET Framework and Windows use an event framework called Event Tracing for Windows (ETW) that allows your app to notify tooling when events happen.</span></span> <span data-ttu-id="023b8-108">Luego, puede usar una herramienta denominada PerfView para ver y analizar los eventos ETW fácilmente.</span><span class="sxs-lookup"><span data-stu-id="023b8-108">You can then use a tool called PerfView to easily view and analyze of ETW events.</span></span> <span data-ttu-id="023b8-109">En este tema se explican los procedimientos para:</span><span class="sxs-lookup"><span data-stu-id="023b8-109">This topic explains how to:</span></span>  
  
- <span data-ttu-id="023b8-110">Usar la clase <xref:System.Diagnostics.Tracing.EventSource> para emitir eventos.</span><span class="sxs-lookup"><span data-stu-id="023b8-110">Use the <xref:System.Diagnostics.Tracing.EventSource> class to emit events.</span></span>  
  
- <span data-ttu-id="023b8-111">Usar PerfView para recopilar esos eventos.</span><span class="sxs-lookup"><span data-stu-id="023b8-111">Use PerfView to gather those events.</span></span>  
  
- <span data-ttu-id="023b8-112">Usar PerfView para mostrar esos eventos.</span><span class="sxs-lookup"><span data-stu-id="023b8-112">Use PerfView to display those events.</span></span>  
  
## <a name="using-eventsource-to-emit-events"></a><span data-ttu-id="023b8-113">Usar EventSource para emitir eventos</span><span class="sxs-lookup"><span data-stu-id="023b8-113">Using EventSource to emit events</span></span>  

 <span data-ttu-id="023b8-114"><xref:System.Diagnostics.Tracing.EventSource> proporciona una clase base desde la que se puede crear un proveedor de eventos personalizado.</span><span class="sxs-lookup"><span data-stu-id="023b8-114"><xref:System.Diagnostics.Tracing.EventSource> provides a base class from which to create a custom event provider.</span></span> <span data-ttu-id="023b8-115">Generalmente, se crea una subclase de <xref:System.Diagnostics.Tracing.EventSource> y se ajustan los métodos `Write*` con los métodos de evento propios.</span><span class="sxs-lookup"><span data-stu-id="023b8-115">Generally, you create a subclass of <xref:System.Diagnostics.Tracing.EventSource> and wrap the `Write*` methods with your own event methods.</span></span> <span data-ttu-id="023b8-116">Se suele usar un patrón singleton para cada <xref:System.Diagnostics.Tracing.EventSource>.</span><span class="sxs-lookup"><span data-stu-id="023b8-116">A singleton pattern is generally used for each <xref:System.Diagnostics.Tracing.EventSource>.</span></span>  
  
 <span data-ttu-id="023b8-117">Por ejemplo, la clase en el siguiente ejemplo se puede usar para medir dos características de rendimiento:</span><span class="sxs-lookup"><span data-stu-id="023b8-117">For example, the class in the following example can be used to measure two performance characteristics:</span></span>  
  
- <span data-ttu-id="023b8-118">El tiempo transcurrido hasta que se llamó al constructor de clase `App`.</span><span class="sxs-lookup"><span data-stu-id="023b8-118">The time until the `App` class constructor was called.</span></span>  
  
- <span data-ttu-id="023b8-119">El tiempo transcurrido hasta que se llamó al constructor `MainPage`.</span><span class="sxs-lookup"><span data-stu-id="023b8-119">The time until the `MainPage` constructor was called.</span></span>  
  
 [!code-csharp[ProjectN_ETW#1](../../../samples/snippets/csharp/VS_Snippets_CLR/projectn_etw/cs/etw1.cs#1)]  
  
 <span data-ttu-id="023b8-120">Hay algunos aspectos que debemos tener en cuenta aquí.</span><span class="sxs-lookup"><span data-stu-id="023b8-120">There are a few things to notice here.</span></span> <span data-ttu-id="023b8-121">En primer lugar, un singleton se crea en `AppEventSource.Log`.</span><span class="sxs-lookup"><span data-stu-id="023b8-121">First, a singleton is created in `AppEventSource.Log`.</span></span> <span data-ttu-id="023b8-122">Esa instancia se utilizará para todos los registros.</span><span class="sxs-lookup"><span data-stu-id="023b8-122">That instance will be used for all logging.</span></span> <span data-ttu-id="023b8-123">En segundo lugar, cada método de evento tiene un <xref:System.Diagnostics.Tracing.EventAttribute>.</span><span class="sxs-lookup"><span data-stu-id="023b8-123">Second, each event method has an <xref:System.Diagnostics.Tracing.EventAttribute>.</span></span> <span data-ttu-id="023b8-124">Esto ayuda a las herramientas a asociar el índice del método <xref:System.Diagnostics.Tracing.EventSource.WriteEvent%2A> con el método al que se llamó en `AppEventSource`.</span><span class="sxs-lookup"><span data-stu-id="023b8-124">This helps tooling associate the index of the <xref:System.Diagnostics.Tracing.EventSource.WriteEvent%2A> method with the method that was called on `AppEventSource`.</span></span>  
  
 <span data-ttu-id="023b8-125">Observe que estos eventos son solamente ilustrativos.</span><span class="sxs-lookup"><span data-stu-id="023b8-125">Note that these events are purely illustrative.</span></span> <span data-ttu-id="023b8-126">La mayor parte del código de la aplicación se ejecutará después de estos eventos.</span><span class="sxs-lookup"><span data-stu-id="023b8-126">Most app code will run after these events.</span></span> <span data-ttu-id="023b8-127">Conviene saber qué eventos en el código se corresponden con las interacciones de usuario, medirlos y mejorar dichas referencias.</span><span class="sxs-lookup"><span data-stu-id="023b8-127">You should understand which events in code correspond to user interactions, measure those, and improve those benchmarks.</span></span> <span data-ttu-id="023b8-128">Además, los eventos en sí registran una sola instancia en el tiempo.</span><span class="sxs-lookup"><span data-stu-id="023b8-128">Also, the events themselves log only a single instance in time.</span></span> <span data-ttu-id="023b8-129">A menudo resulta útil tener emparejados eventos de inicio y detención para cada operación.</span><span class="sxs-lookup"><span data-stu-id="023b8-129">It’s often useful to have paired start and stop events for every operation.</span></span> <span data-ttu-id="023b8-130">Al examinar el inicio de la aplicación, el evento de inicio suele ser el evento "Procesar/Iniciar" que el sistema operativo emite.</span><span class="sxs-lookup"><span data-stu-id="023b8-130">When examining app startup, the start event is generally the "Process/Start" event that the operating system emits.</span></span>  
  
 <span data-ttu-id="023b8-131">Por ejemplo, supongamos que va a crear un lector RSS.</span><span class="sxs-lookup"><span data-stu-id="023b8-131">For example, suppose you are creating an RSS reader.</span></span> <span data-ttu-id="023b8-132">Algunas ubicaciones interesantes donde registrar un evento son las siguientes:</span><span class="sxs-lookup"><span data-stu-id="023b8-132">A few interesting locations to log an event are:</span></span>  
  
- <span data-ttu-id="023b8-133">Cuando la página principal se representa por primera vez.</span><span class="sxs-lookup"><span data-stu-id="023b8-133">When the main page is first rendered.</span></span>  
  
- <span data-ttu-id="023b8-134">Cuando se deserializan casos de RSS antiguos del almacenamiento local.</span><span class="sxs-lookup"><span data-stu-id="023b8-134">When old RSS stories are deserialized from local storage.</span></span>  
  
- <span data-ttu-id="023b8-135">Cuando la aplicación empieza a sincronizar nuevos casos.</span><span class="sxs-lookup"><span data-stu-id="023b8-135">When your app begins syncing new stories.</span></span>  
  
- <span data-ttu-id="023b8-136">Cuando la aplicación ha terminado de sincronizar nuevos casos.</span><span class="sxs-lookup"><span data-stu-id="023b8-136">When your app has finished syncing new stories.</span></span>  
  
 <span data-ttu-id="023b8-137">Instrumentar una aplicación es sencillo: basta con llamar al método apropiado en la clase derivada.</span><span class="sxs-lookup"><span data-stu-id="023b8-137">Instrumenting an app is straightforward: Just call the appropriate method on the derived class.</span></span> <span data-ttu-id="023b8-138">Usando `AppEventSource` del ejemplo anterior, una aplicación se puede instrumentar del siguiente modo:</span><span class="sxs-lookup"><span data-stu-id="023b8-138">Using `AppEventSource` from the previous example, you can instrument an app as follows:</span></span>  
  
 [!code-csharp[ProjectN_ETW#2](../../../samples/snippets/csharp/VS_Snippets_CLR/projectn_etw/cs/etw2.cs#2)]  
  
 <span data-ttu-id="023b8-139">Cuando la aplicación esté instrumentada, estará listo para recopilar eventos.</span><span class="sxs-lookup"><span data-stu-id="023b8-139">When the app is instrumented, you’re ready to gather events.</span></span>  
  
## <a name="gathering-events-with-perfview"></a><span data-ttu-id="023b8-140">Recopilación de eventos con PerfView</span><span class="sxs-lookup"><span data-stu-id="023b8-140">Gathering events with PerfView</span></span>  

 <span data-ttu-id="023b8-141">PerfView usa eventos ETW para ayudarle a realizar todo tipo de investigaciones de rendimiento en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="023b8-141">PerfView uses ETW events to help you do all sorts of performance investigations on your app.</span></span> <span data-ttu-id="023b8-142">También incluye una GUI de configuración que permite activar o desactivar el registro de diferentes tipos de eventos.</span><span class="sxs-lookup"><span data-stu-id="023b8-142">It also includes a configuration GUI that lets you turn logging for different types of events on or off.</span></span> <span data-ttu-id="023b8-143">PerfView es una herramienta gratuita y se puede descargar desde el [Centro de descarga de Microsoft](https://www.microsoft.com/download/details.aspx?id=28567).</span><span class="sxs-lookup"><span data-stu-id="023b8-143">PerfView is a free tool and can be downloaded from the [Microsoft Download Center](https://www.microsoft.com/download/details.aspx?id=28567).</span></span> <span data-ttu-id="023b8-144">Para obtener más información, vea los [vídeos tutoriales de PerfView](https://channel9.msdn.com/Series/PerfView-Tutorial).</span><span class="sxs-lookup"><span data-stu-id="023b8-144">For more information, watch the [PerfView tutorial videos](https://channel9.msdn.com/Series/PerfView-Tutorial).</span></span>  
  
> [!NOTE]
> <span data-ttu-id="023b8-145">PerfView no se puede usar para recopilar eventos en sistemas ARM.</span><span class="sxs-lookup"><span data-stu-id="023b8-145">PerfView cannot be used to collect events on ARM systems.</span></span> <span data-ttu-id="023b8-146">Para recopilar eventos en sistemas ARM, use Windows Performance Recorder (WPR).</span><span class="sxs-lookup"><span data-stu-id="023b8-146">To collect events on ARM systems, use Windows Performance Recorder (WPR).</span></span> <span data-ttu-id="023b8-147">Para obtener más información, vea la [entrada de blog de Vance Morrison](/archive/blogs/vancem/collecting-etwperfview-data-on-an-windows-rt-winrt-arm-surface-device).</span><span class="sxs-lookup"><span data-stu-id="023b8-147">For more information, see [Vance Morrison's blog post](/archive/blogs/vancem/collecting-etwperfview-data-on-an-windows-rt-winrt-arm-surface-device).</span></span>  
  
 <span data-ttu-id="023b8-148">PerfView también se puede invocar desde la línea de comandos.</span><span class="sxs-lookup"><span data-stu-id="023b8-148">You can also invoke PerfView from the command line.</span></span> <span data-ttu-id="023b8-149">Para registrar solo los eventos de su proveedor, abra una ventana de símbolo del sistema y escriba el comando:</span><span class="sxs-lookup"><span data-stu-id="023b8-149">To log only the events from your provider, open the Command Prompt window and enter the command:</span></span>  
  
```console
perfview -KernelEvents:Process -OnlyProviders:*MyCompany-MyApp collect outputFile
```  
  
 <span data-ttu-id="023b8-150">donde:</span><span class="sxs-lookup"><span data-stu-id="023b8-150">where:</span></span>  
  
 `-KernelEvents:Process`  
 <span data-ttu-id="023b8-151">Indica que quiere saber cuándo se inicia y detiene el proceso.</span><span class="sxs-lookup"><span data-stu-id="023b8-151">Indicates that you want to know when the process starts and stops.</span></span> <span data-ttu-id="023b8-152">Necesita el evento Procesar/Iniciar de la aplicación para que se pueda restar de otros tiempos de evento.</span><span class="sxs-lookup"><span data-stu-id="023b8-152">You need the Process/Start event for your app so it can be subtracted from other event times.</span></span>  
  
 `-OnlyProviders:*MyCompany-MyApp`  
 <span data-ttu-id="023b8-153">Desactiva otros proveedores que PerfView activa de forma predeterminada y activa el proveedor MyCompany-MyApp</span><span class="sxs-lookup"><span data-stu-id="023b8-153">Turns off other providers that PerfView turns on by default, and turns on the MyCompany-MyApp provider.</span></span>  <span data-ttu-id="023b8-154">(el asterisco indica que se trata de un <xref:System.Diagnostics.Tracing.EventSource>).</span><span class="sxs-lookup"><span data-stu-id="023b8-154">(The asterisk indicates that it is an <xref:System.Diagnostics.Tracing.EventSource>.)</span></span>  
  
 `collect outputFile`  
 <span data-ttu-id="023b8-155">Indica que quiere iniciar la recopilación y guardar los datos en outputFile.etl.zip.</span><span class="sxs-lookup"><span data-stu-id="023b8-155">Indicates that you want to start collection and save the data to outputFile.etl.zip.</span></span>  
  
 <span data-ttu-id="023b8-156">Ejecute la aplicación después de iniciar PerfView.</span><span class="sxs-lookup"><span data-stu-id="023b8-156">Run your app after starting PerfView.</span></span> <span data-ttu-id="023b8-157">Hay algunas cosas que recordar cuando se ejecuta la aplicación:</span><span class="sxs-lookup"><span data-stu-id="023b8-157">There are a few things to remember when running your app:</span></span>  
  
- <span data-ttu-id="023b8-158">Utilice una versión de lanzamiento, no una versión de depuración.</span><span class="sxs-lookup"><span data-stu-id="023b8-158">Use a release build, not a debug build.</span></span> <span data-ttu-id="023b8-159">Las versiones de depuración suelen contener código extra de tratamiento y comprobación de errores que puede hacer que la aplicación se ejecute más despacio de lo previsto.</span><span class="sxs-lookup"><span data-stu-id="023b8-159">Debug builds often contain extra error checking and error handling code that can cause your app to run slower than expected.</span></span>  
  
- <span data-ttu-id="023b8-160">La ejecución de una aplicación con un depurador adjunto influye en el rendimiento de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="023b8-160">Running your app with a debugger attached affects the performance of your app.</span></span>  
  
- <span data-ttu-id="023b8-161">Windows usa diversas estrategias de almacenamiento en caché para acelerar los tiempos de inicio de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="023b8-161">Windows uses multiple caching strategies to speed up app launch times.</span></span> <span data-ttu-id="023b8-162">Si la aplicación está almacenada actualmente en caché y no tiene que cargarse desde el disco, se iniciará más rápido.</span><span class="sxs-lookup"><span data-stu-id="023b8-162">If your app is currently cached in memory and doesn't have to be loaded from disk, it will start faster.</span></span> <span data-ttu-id="023b8-163">Para garantizar la coherencia, inicie y cierre la aplicación varias veces antes de medirla.</span><span class="sxs-lookup"><span data-stu-id="023b8-163">To ensure consistency, start and close your app a few times before measuring it.</span></span>  
  
 <span data-ttu-id="023b8-164">Cuando haya ejecutado la aplicación para que PerfView pueda recopilar los eventos emitidos, seleccione el botón **Detener colección**.</span><span class="sxs-lookup"><span data-stu-id="023b8-164">When you’ve run your app so that PerfView can collect emitted events, choose the **Stop Collection** button.</span></span> <span data-ttu-id="023b8-165">En general, la colección se debe detener antes de cerrar la aplicación para, así, no obtener eventos extraños.</span><span class="sxs-lookup"><span data-stu-id="023b8-165">Generally, you should stop collection before closing your app so you don’t get extraneous events.</span></span> <span data-ttu-id="023b8-166">Sin embargo, si se mide el rendimiento de suspensión o de apagado, conviene continuar con la colección.</span><span class="sxs-lookup"><span data-stu-id="023b8-166">However, if you’re measuring shutdown or suspension performance, you’ll want to continue collection.</span></span>  
  
## <a name="displaying-the-events"></a><span data-ttu-id="023b8-167">Visualización de eventos</span><span class="sxs-lookup"><span data-stu-id="023b8-167">Displaying the events</span></span>  

 <span data-ttu-id="023b8-168">Para ver los eventos que ya se han recopilado, use PerfView para abrir el archivo .etl o .etl.zip que ha creado y seleccione **Eventos**.</span><span class="sxs-lookup"><span data-stu-id="023b8-168">To view the events that have already been collected, use PerfView to open the .etl or .etl.zip file you created and choose **Events**.</span></span> <span data-ttu-id="023b8-169">ETW habrá recopilado información acerca de un gran número de eventos, incluidos los eventos de otros procesos.</span><span class="sxs-lookup"><span data-stu-id="023b8-169">ETW will have collected information about a large number of events, including events from other processes.</span></span> <span data-ttu-id="023b8-170">Para acotar la investigación, rellene los siguientes cuadros de texto en la vista de eventos:</span><span class="sxs-lookup"><span data-stu-id="023b8-170">To focus your investigation, complete the following text boxes in the events view:</span></span>  
  
- <span data-ttu-id="023b8-171">En el cuadro **Process Filter** (Filtro de proceso), escriba el nombre de la aplicación (sin ".exe").</span><span class="sxs-lookup"><span data-stu-id="023b8-171">In the **Process Filter** box, specify your app name (without ".exe").</span></span>  
  
- <span data-ttu-id="023b8-172">En el cuadro **Event Types Filter** (Filtro de tipos de evento), especifique `Process/Start | MyCompany-MyApp`.</span><span class="sxs-lookup"><span data-stu-id="023b8-172">In the **Event Types Filter** box, specify `Process/Start | MyCompany-MyApp`.</span></span> <span data-ttu-id="023b8-173">Esto establece un filtro para los eventos de MyCompany-MyApp y el evento Windows Kernel/Process/Start.</span><span class="sxs-lookup"><span data-stu-id="023b8-173">This sets a filter for events from MyCompany-MyApp and the Windows Kernel/Process/Start event.</span></span>  
  
 <span data-ttu-id="023b8-174">Seleccione todos los eventos que se muestran en el panel izquierdo (Ctrl+A) y presione la tecla **ENTRAR**.</span><span class="sxs-lookup"><span data-stu-id="023b8-174">Select all the events listed in the left pane (Ctrl-A) and choose the **Enter** key.</span></span> <span data-ttu-id="023b8-175">Ahora, debería poder ver las marcas de tiempo de cada evento.</span><span class="sxs-lookup"><span data-stu-id="023b8-175">Now, you should be able to see the timestamps from each event.</span></span> <span data-ttu-id="023b8-176">Estas marcas hacen referencia al inicio del seguimiento, por lo que debe restar la hora de cada evento de la hora de inicio del proceso para averiguar el tiempo transcurrido desde el inicio.</span><span class="sxs-lookup"><span data-stu-id="023b8-176">These timestamps are relative to the start of the trace, so you have to subtract the time of each event from the start time of the process to identify the elapsed time since startup.</span></span> <span data-ttu-id="023b8-177">Si usa Ctrl+clic para seleccionar dos marcas de tiempo, verá la diferencia entre ambas en la barra de estado de la parte inferior de la página.</span><span class="sxs-lookup"><span data-stu-id="023b8-177">If you use Ctrl+Click to select two timestamps, you'll see the difference between them displayed in the status bar at the bottom of the page.</span></span> <span data-ttu-id="023b8-178">Esto hace que sea muy sencillo ver en pantalla el tiempo transcurrido entre dos eventos (incluido el inicio del proceso).</span><span class="sxs-lookup"><span data-stu-id="023b8-178">This makes it easy to see the elapsed time between any two events in the display (including process start).</span></span> <span data-ttu-id="023b8-179">Puede abrir el menú contextual de la vista y seleccionar diversas opciones de gran utilidad, como exportar a un archivo CSV o abrir Microsoft Excel para guardar o procesar los datos.</span><span class="sxs-lookup"><span data-stu-id="023b8-179">You can open the shortcut menu for the view and select from a number of useful options, like exporting to CSV files or opening Microsoft Excel to save or process the data.</span></span>  
  
 <span data-ttu-id="023b8-180">Al repetir el procedimiento para la aplicación original y la versión que creó mediante la cadena de herramientas de .NET Native, puede comparar la diferencia de rendimiento.</span><span class="sxs-lookup"><span data-stu-id="023b8-180">By repeating the procedure for both your original app and the version you built by using the .NET Native tool chain, you can compare the difference in performance.</span></span>   <span data-ttu-id="023b8-181">Normalmente, las aplicaciones .NET Native se inician más rápido que las aplicaciones nativas de non-.NET.</span><span class="sxs-lookup"><span data-stu-id="023b8-181">.NET Native apps generally start faster than non-.NET Native apps.</span></span> <span data-ttu-id="023b8-182">Si le interesa seguir ahondando en este asunto, PerfView también es capaz identificar las partes del código que consumen más tiempo.</span><span class="sxs-lookup"><span data-stu-id="023b8-182">If you’re interested in digging deeper, PerfView can also identify the parts of your code that are taking the most time.</span></span> <span data-ttu-id="023b8-183">Para obtener más información, vea los [tutoriales de PerfView](https://channel9.msdn.com/Series/PerfView-Tutorial) o lea la [entrada de blog de Vance Morrison](/archive/blogs/vancem/publication-of-the-perfview-performance-analysis-tool).</span><span class="sxs-lookup"><span data-stu-id="023b8-183">For more information, watch the [PerfView tutorials](https://channel9.msdn.com/Series/PerfView-Tutorial) or read [Vance Morrison’s blog entry](/archive/blogs/vancem/publication-of-the-perfview-performance-analysis-tool).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="023b8-184">Vea también</span><span class="sxs-lookup"><span data-stu-id="023b8-184">See also</span></span>

- <xref:System.Diagnostics.Tracing.EventSource>
