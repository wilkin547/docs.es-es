---
title: Consideraciones de rendimiento para la interoperabilidad entre Direct3D9 y WPF
ms.date: 03/30/2017
helpviewer_keywords:
- WPF [WPF], Direct3D9 interop performance
- Direct3D9 [WPF interoperability], performance
ms.assetid: ea8baf91-12fe-4b44-ac4d-477110ab14dd
ms.openlocfilehash: f595e75c90ebef480200e9210a57087eb4d20e87
ms.sourcegitcommit: 6b308cf6d627d78ee36dbbae8972a310ac7fd6c8
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/23/2019
ms.locfileid: "54608867"
---
# <a name="performance-considerations-for-direct3d9-and-wpf-interoperability"></a><span data-ttu-id="c3698-102">Consideraciones de rendimiento para la interoperabilidad entre Direct3D9 y WPF</span><span class="sxs-lookup"><span data-stu-id="c3698-102">Performance Considerations for Direct3D9 and WPF Interoperability</span></span>
<span data-ttu-id="c3698-103">Puede hospedar contenido Direct3D9 mediante la <xref:System.Windows.Interop.D3DImage> clase.</span><span class="sxs-lookup"><span data-stu-id="c3698-103">You can host Direct3D9 content by using the <xref:System.Windows.Interop.D3DImage> class.</span></span> <span data-ttu-id="c3698-104">Hospedar contenido Direct3D9 puede afectar al rendimiento de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="c3698-104">Hosting Direct3D9 content can affect the performance of your application.</span></span> <span data-ttu-id="c3698-105">En este tema se describe los procedimientos recomendados para optimizar el rendimiento al hospedar contenido Direct3D9 en una aplicación de Windows Presentation Foundation (WPF).</span><span class="sxs-lookup"><span data-stu-id="c3698-105">This topic describes best practices to optimize performance when hosting Direct3D9 content in a Windows Presentation Foundation (WPF) application.</span></span> <span data-ttu-id="c3698-106">Estas recomendaciones incluyen cómo usar <xref:System.Windows.Interop.D3DImage> y procedimientos recomendados cuando usa Windows Vista, Windows XP, y se muestran varios monitores.</span><span class="sxs-lookup"><span data-stu-id="c3698-106">These best practices include how to use <xref:System.Windows.Interop.D3DImage> and best practices when you are using Windows Vista, Windows XP, and multi-monitor displays.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="c3698-107">Para obtener ejemplos de código que muestran estos procedimientos recomendados, consulte [interoperabilidad entre Direct3D9 y WPF](../../../../docs/framework/wpf/advanced/wpf-and-direct3d9-interoperation.md).</span><span class="sxs-lookup"><span data-stu-id="c3698-107">For code examples that demonstrate these best practices, see [WPF and Direct3D9 Interoperation](../../../../docs/framework/wpf/advanced/wpf-and-direct3d9-interoperation.md).</span></span>  
  
## <a name="use-d3dimage-sparingly"></a><span data-ttu-id="c3698-108">Utilice con moderación D3DImage</span><span class="sxs-lookup"><span data-stu-id="c3698-108">Use D3DImage Sparingly</span></span>  
 <span data-ttu-id="c3698-109">Contenido Direct3D9 hospedado en un <xref:System.Windows.Interop.D3DImage> instancia no se representará tan rápido como en una aplicación de Direct3D pura.</span><span class="sxs-lookup"><span data-stu-id="c3698-109">Direct3D9 content hosted in a <xref:System.Windows.Interop.D3DImage> instance does not render as fast as in a pure Direct3D application.</span></span> <span data-ttu-id="c3698-110">Copiar en la superficie y vaciar el búfer de comandos pueden ser operaciones costosas.</span><span class="sxs-lookup"><span data-stu-id="c3698-110">Copying the surface and flushing the command buffer can be costly operations.</span></span> <span data-ttu-id="c3698-111">Como el número de <xref:System.Windows.Interop.D3DImage> aumenta las instancias, más el vaciado se produce y degrada el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="c3698-111">As the number of <xref:System.Windows.Interop.D3DImage> instances increases, more flushing occurs, and performance degrades.</span></span> <span data-ttu-id="c3698-112">Por lo tanto, debe usar <xref:System.Windows.Interop.D3DImage> con moderación.</span><span class="sxs-lookup"><span data-stu-id="c3698-112">Therefore, you should use <xref:System.Windows.Interop.D3DImage> sparingly.</span></span>  
  
## <a name="best-practices-on-windows-vista"></a><span data-ttu-id="c3698-113">Procedimientos recomendados en Windows Vista</span><span class="sxs-lookup"><span data-stu-id="c3698-113">Best Practices on Windows Vista</span></span>  
 <span data-ttu-id="c3698-114">Para optimizar el rendimiento de Windows Vista con una visualización que está configurado para usar el modelo de controladores de pantalla de Windows (WDDM), cree la superficie de Direct3D9 en un `IDirect3DDevice9Ex` dispositivo.</span><span class="sxs-lookup"><span data-stu-id="c3698-114">For best performance on Windows Vista with a display that is configured to use the Windows Display Driver Model (WDDM), create your Direct3D9 surface on an `IDirect3DDevice9Ex` device.</span></span> <span data-ttu-id="c3698-115">Esto permite el uso compartido de superficie.</span><span class="sxs-lookup"><span data-stu-id="c3698-115">This enables surface sharing.</span></span> <span data-ttu-id="c3698-116">La tarjeta de vídeo debe admitir la `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` y `D3DCAPS2_CANSHARERESOURCE` funciones del controlador en Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="c3698-116">The video card must support the `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` and `D3DCAPS2_CANSHARERESOURCE` driver capabilities on Windows Vista.</span></span> <span data-ttu-id="c3698-117">Cualquier otra configuración hará que la superficie que se va a copiar a través de software, lo que reduce significativamente el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="c3698-117">Any other settings cause the surface to be copied through software, which reduces performance significantly.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="c3698-118">Si Windows Vista tiene una presentación que está configurada para usar el Windows XP Mostrar controladores modelo (XDDM), la superficie siempre se copia a través de software, independientemente de la configuración.</span><span class="sxs-lookup"><span data-stu-id="c3698-118">If Windows Vista has a display that is configured to use the Windows XP Display Driver Model (XDDM), the surface is always copied through software, regardless of settings.</span></span> <span data-ttu-id="c3698-119">Con las opciones adecuadas y la tarjeta de vídeo, verá un mejor rendimiento en Windows Vista cuando se usa el WDDM porque se realizan copias de superficie en hardware.</span><span class="sxs-lookup"><span data-stu-id="c3698-119">With the proper settings and video card, you will see better performance on Windows Vista when you use the WDDM because surface copies are performed in hardware.</span></span>  
  
## <a name="best-practices-on-windows-xp"></a><span data-ttu-id="c3698-120">Procedimientos recomendados en Windows XP</span><span class="sxs-lookup"><span data-stu-id="c3698-120">Best Practices on Windows XP</span></span>  
 <span data-ttu-id="c3698-121">Para obtener el mejor rendimiento en Windows XP, que usa el modelo de controladores de pantalla de Windows XP (XDDM), cree una superficie bloqueable que se comporta correctamente cuando el `IDirect3DSurface9::GetDC` se llama al método.</span><span class="sxs-lookup"><span data-stu-id="c3698-121">For best performance on Windows XP, which uses the Windows XP Display Driver Model (XDDM), create a lockable surface that behaves correctly when the `IDirect3DSurface9::GetDC` method is called.</span></span> <span data-ttu-id="c3698-122">Internamente, el `BitBlt` método transfiere la superficie en dispositivos de hardware.</span><span class="sxs-lookup"><span data-stu-id="c3698-122">Internally, the `BitBlt` method transfers the surface across devices in hardware.</span></span> <span data-ttu-id="c3698-123">El `GetDC` método siempre funciona en las superficies XRGB.</span><span class="sxs-lookup"><span data-stu-id="c3698-123">The `GetDC` method always works on XRGB surfaces.</span></span> <span data-ttu-id="c3698-124">Sin embargo, si el equipo cliente ejecuta Windows XP con SP3 o SP2, y si el cliente también tiene la revisión de la característica de ventana por capas, este método solo funciona en las superficies ARGB.</span><span class="sxs-lookup"><span data-stu-id="c3698-124">However, if the client computer is running Windows XP with SP3 or SP2, and if the client also has the hotfix for the layered-window feature, this method only works on ARGB surfaces.</span></span> <span data-ttu-id="c3698-125">La tarjeta de vídeo debe admitir la `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` funcionalidad del controlador.</span><span class="sxs-lookup"><span data-stu-id="c3698-125">The video card must support the `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` driver capability.</span></span>  
  
 <span data-ttu-id="c3698-126">Una profundidad de la pantalla del escritorio de 16 bits puede reducir significativamente el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="c3698-126">A 16-bit desktop display depth can significantly reduce performance.</span></span> <span data-ttu-id="c3698-127">Se recomienda un escritorio de 32 bits.</span><span class="sxs-lookup"><span data-stu-id="c3698-127">A 32-bit desktop is recommended.</span></span>  
  
 <span data-ttu-id="c3698-128">Si está desarrollando para Windows Vista y Windows XP, pruebe el rendimiento de Windows XP.</span><span class="sxs-lookup"><span data-stu-id="c3698-128">If you are developing for Windows Vista and Windows XP, test the performance on Windows XP.</span></span> <span data-ttu-id="c3698-129">Quedarse sin memoria de vídeo en Windows XP es una preocupación.</span><span class="sxs-lookup"><span data-stu-id="c3698-129">Running out of video memory on Windows XP is a concern.</span></span> <span data-ttu-id="c3698-130">Además, <xref:System.Windows.Interop.D3DImage> en Windows XP usa más memoria de vídeo y ancho de banda que Windows Vista WDDM, debido a una copia en memoria de vídeo adicionales necesarios.</span><span class="sxs-lookup"><span data-stu-id="c3698-130">In addition, <xref:System.Windows.Interop.D3DImage> on Windows XP uses more video memory and bandwidth than Windows Vista WDDM, due to a necessary extra video memory copy.</span></span> <span data-ttu-id="c3698-131">Por lo tanto, puede esperar un rendimiento peor en Windows XP que en Windows Vista sea el mismo hardware de vídeo.</span><span class="sxs-lookup"><span data-stu-id="c3698-131">Therefore, you can expect performance to be worse on Windows XP than on Windows Vista for the same video hardware.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="c3698-132">XDDM está disponible en Windows XP y Windows Vista; Sin embargo, WDDM solo está disponible en Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="c3698-132">XDDM is available on both Windows XP and Windows Vista; however, WDDM is available only on Windows Vista.</span></span>  
  
## <a name="general-best-practices"></a><span data-ttu-id="c3698-133">Procedimientos recomendados generales</span><span class="sxs-lookup"><span data-stu-id="c3698-133">General Best Practices</span></span>  
 <span data-ttu-id="c3698-134">Cuando se crea el dispositivo, use el `D3DCREATE_MULTITHREADED` indicador de creación.</span><span class="sxs-lookup"><span data-stu-id="c3698-134">When you create the device, use the `D3DCREATE_MULTITHREADED` creation flag.</span></span> <span data-ttu-id="c3698-135">Esto reduce el rendimiento, pero el sistema de representación de WPF llama a métodos en este dispositivo desde otro subproceso.</span><span class="sxs-lookup"><span data-stu-id="c3698-135">This reduces performance, but the WPF rendering system calls methods on this device from another thread.</span></span> <span data-ttu-id="c3698-136">Asegúrese de seguir correctamente, el protocolo de bloqueo para que no haya dos subprocesos acceda al dispositivo al mismo tiempo.</span><span class="sxs-lookup"><span data-stu-id="c3698-136">Be sure to follow the locking protocol correctly, so that no two threads access the device at the same time.</span></span>  
  
 <span data-ttu-id="c3698-137">Si la representación se realiza en un subproceso administrado de WPF, se recomienda encarecidamente que cree el dispositivo con el `D3DCREATE_FPU_PRESERVE` indicador de creación.</span><span class="sxs-lookup"><span data-stu-id="c3698-137">If your rendering is performed on a WPF managed thread, it is strongly recommended that you create the device with the `D3DCREATE_FPU_PRESERVE` creation flag.</span></span> <span data-ttu-id="c3698-138">Sin esta configuración, la representación D3D puede reducir la precisión de las operaciones de doble precisión WPF y presentar problemas de representación.</span><span class="sxs-lookup"><span data-stu-id="c3698-138">Without this setting, the D3D rendering can reduce the accuracy of WPF double-precision operations and introduce rendering issues.</span></span>  
  
 <span data-ttu-id="c3698-139">Disposición en mosaico una <xref:System.Windows.Interop.D3DImage> es rápido, a menos que se coloca en mosaico una superficie no pow2 sin compatibilidad de hardware, o si coloca en mosaico una <xref:System.Windows.Media.DrawingBrush> o <xref:System.Windows.Media.VisualBrush> que contiene un <xref:System.Windows.Interop.D3DImage>.</span><span class="sxs-lookup"><span data-stu-id="c3698-139">Tiling a <xref:System.Windows.Interop.D3DImage> is fast, unless you tile a non-pow2 surface without hardware support, or if you tile a <xref:System.Windows.Media.DrawingBrush> or <xref:System.Windows.Media.VisualBrush> that contains a <xref:System.Windows.Interop.D3DImage>.</span></span>  
  
## <a name="best-practices-for-multi-monitor-displays"></a><span data-ttu-id="c3698-140">Procedimientos recomendados para las pantallas de varios monitores</span><span class="sxs-lookup"><span data-stu-id="c3698-140">Best Practices for Multi-Monitor Displays</span></span>  
 <span data-ttu-id="c3698-141">Si usas un equipo que tiene varios monitores, debe seguir los procedimientos recomendados descritos anteriormente.</span><span class="sxs-lookup"><span data-stu-id="c3698-141">If you are using a computer that has multiple monitors, you should follow the previously described best practices.</span></span> <span data-ttu-id="c3698-142">También hay algunas consideraciones de rendimiento adicionales para una configuración de varios monitor.</span><span class="sxs-lookup"><span data-stu-id="c3698-142">There are also some additional performance considerations for a multi-monitor configuration.</span></span>  
  
 <span data-ttu-id="c3698-143">Al crear el búfer de reserva, se crea en un dispositivo específico y el adaptador pero WPF puede mostrar el búfer frontal en ningún adaptador.</span><span class="sxs-lookup"><span data-stu-id="c3698-143">When you create the back buffer, it is created on a specific device and adapter, but WPF may display the front buffer on any adapter.</span></span> <span data-ttu-id="c3698-144">Copiar en todos los adaptadores para actualizar el búfer frontal puede resultar muy caro.</span><span class="sxs-lookup"><span data-stu-id="c3698-144">Copying across adapters to update the front buffer can be very expensive.</span></span> <span data-ttu-id="c3698-145">En Windows Vista que está configurado para utilizar el WDDM con varias tarjetas de vídeo y con un `IDirect3DDevice9Ex` dispositivo, si el búfer frontal es en un adaptador diferente pero la misma tarjeta de vídeo, no hay ninguna reducción del rendimiento.</span><span class="sxs-lookup"><span data-stu-id="c3698-145">On Windows Vista that is configured to use the WDDM with multiple video cards and with an `IDirect3DDevice9Ex` device, if the front buffer is on a different adapter but still the same video card, there is no performance penalty.</span></span> <span data-ttu-id="c3698-146">Sin embargo, en Windows XP y el XDDM con varias tarjetas de vídeo, hay una importante penalización del rendimiento cuando el búfer frontal se muestra en un adaptador distinto al búfer de reserva.</span><span class="sxs-lookup"><span data-stu-id="c3698-146">However, on Windows XP and the XDDM with multiple video cards, there is a significant performance penalty when the front buffer is displayed on a different adapter than the back buffer.</span></span> <span data-ttu-id="c3698-147">Para obtener más información, consulte [interoperabilidad entre Direct3D9 y WPF](../../../../docs/framework/wpf/advanced/wpf-and-direct3d9-interoperation.md).</span><span class="sxs-lookup"><span data-stu-id="c3698-147">For more information, see [WPF and Direct3D9 Interoperation](../../../../docs/framework/wpf/advanced/wpf-and-direct3d9-interoperation.md).</span></span>  
  
## <a name="performance-summary"></a><span data-ttu-id="c3698-148">Resumen de rendimiento</span><span class="sxs-lookup"><span data-stu-id="c3698-148">Performance Summary</span></span>  
 <span data-ttu-id="c3698-149">En la tabla siguiente se muestra el rendimiento de la actualización de búfer frontal como una función de sistema operativo, el formato de píxel y posibilidad de bloqueo de superficie.</span><span class="sxs-lookup"><span data-stu-id="c3698-149">The following table shows performance of the front buffer update as a function of operating system, pixel format, and surface lockability.</span></span> <span data-ttu-id="c3698-150">El búfer frontal y el búfer de reserva se supone que en el mismo adaptador.</span><span class="sxs-lookup"><span data-stu-id="c3698-150">The front buffer and back buffer are assumed to be on the same adapter.</span></span> <span data-ttu-id="c3698-151">Dependiendo de la configuración del adaptador, las actualizaciones de hardware son generalmente mucho más rápidas que las actualizaciones de software.</span><span class="sxs-lookup"><span data-stu-id="c3698-151">Depending on the adapter configuration, hardware updates are generally much faster than software updates.</span></span>  
  
|<span data-ttu-id="c3698-152">Formato de píxel de la superficie</span><span class="sxs-lookup"><span data-stu-id="c3698-152">Surface pixel format</span></span>|<span data-ttu-id="c3698-153">Windows Vista, WDDM y 9Ex</span><span class="sxs-lookup"><span data-stu-id="c3698-153">Windows Vista, WDDM and 9Ex</span></span>|<span data-ttu-id="c3698-154">Otras configuraciones de Windows Vista</span><span class="sxs-lookup"><span data-stu-id="c3698-154">Other Windows Vista configurations</span></span>|<span data-ttu-id="c3698-155">Windows XP SP3 o SP2 con la revisión</span><span class="sxs-lookup"><span data-stu-id="c3698-155">Windows XP SP3 or SP2 w/ hotfix</span></span>|<span data-ttu-id="c3698-156">Windows XP SP2</span><span class="sxs-lookup"><span data-stu-id="c3698-156">Windows XP SP2</span></span>|  
|--------------------------|---------------------------------|----------------------------------------|--------------------------------------|--------------------|  
|<span data-ttu-id="c3698-157">D3DFMT_X8R8G8B8 (no bloqueable)</span><span class="sxs-lookup"><span data-stu-id="c3698-157">D3DFMT_X8R8G8B8 (not lockable)</span></span>|<span data-ttu-id="c3698-158">**Actualización de hardware**</span><span class="sxs-lookup"><span data-stu-id="c3698-158">**Hardware Update**</span></span>|<span data-ttu-id="c3698-159">Actualización de software</span><span class="sxs-lookup"><span data-stu-id="c3698-159">Software Update</span></span>|<span data-ttu-id="c3698-160">Actualización de software</span><span class="sxs-lookup"><span data-stu-id="c3698-160">Software Update</span></span>|<span data-ttu-id="c3698-161">Actualización de software</span><span class="sxs-lookup"><span data-stu-id="c3698-161">Software Update</span></span>|  
|<span data-ttu-id="c3698-162">D3DFMT_X8R8G8B8 (bloqueable)</span><span class="sxs-lookup"><span data-stu-id="c3698-162">D3DFMT_X8R8G8B8 (lockable)</span></span>|<span data-ttu-id="c3698-163">**Actualización de hardware**</span><span class="sxs-lookup"><span data-stu-id="c3698-163">**Hardware Update**</span></span>|<span data-ttu-id="c3698-164">Actualización de software</span><span class="sxs-lookup"><span data-stu-id="c3698-164">Software Update</span></span>|<span data-ttu-id="c3698-165">**Actualización de hardware**</span><span class="sxs-lookup"><span data-stu-id="c3698-165">**Hardware Update**</span></span>|<span data-ttu-id="c3698-166">**Actualización de hardware**</span><span class="sxs-lookup"><span data-stu-id="c3698-166">**Hardware Update**</span></span>|  
|<span data-ttu-id="c3698-167">D3DFMT_A8R8G8B8 (no bloqueable)</span><span class="sxs-lookup"><span data-stu-id="c3698-167">D3DFMT_A8R8G8B8 (not lockable)</span></span>|<span data-ttu-id="c3698-168">**Actualización de hardware**</span><span class="sxs-lookup"><span data-stu-id="c3698-168">**Hardware Update**</span></span>|<span data-ttu-id="c3698-169">Actualización de software</span><span class="sxs-lookup"><span data-stu-id="c3698-169">Software Update</span></span>|<span data-ttu-id="c3698-170">Actualización de software</span><span class="sxs-lookup"><span data-stu-id="c3698-170">Software Update</span></span>|<span data-ttu-id="c3698-171">Actualización de software</span><span class="sxs-lookup"><span data-stu-id="c3698-171">Software Update</span></span>|  
|<span data-ttu-id="c3698-172">D3DFMT_A8R8G8B8 (bloqueable)</span><span class="sxs-lookup"><span data-stu-id="c3698-172">D3DFMT_A8R8G8B8 (lockable)</span></span>|<span data-ttu-id="c3698-173">**Actualización de hardware**</span><span class="sxs-lookup"><span data-stu-id="c3698-173">**Hardware Update**</span></span>|<span data-ttu-id="c3698-174">Actualización de software</span><span class="sxs-lookup"><span data-stu-id="c3698-174">Software Update</span></span>|<span data-ttu-id="c3698-175">**Actualización de hardware**</span><span class="sxs-lookup"><span data-stu-id="c3698-175">**Hardware Update**</span></span>|<span data-ttu-id="c3698-176">Actualización de software</span><span class="sxs-lookup"><span data-stu-id="c3698-176">Software Update</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="c3698-177">Vea también</span><span class="sxs-lookup"><span data-stu-id="c3698-177">See also</span></span>
- <xref:System.Windows.Interop.D3DImage>
- [<span data-ttu-id="c3698-178">Interoperabilidad entre WPF y Direct3D9</span><span class="sxs-lookup"><span data-stu-id="c3698-178">WPF and Direct3D9 Interoperation</span></span>](../../../../docs/framework/wpf/advanced/wpf-and-direct3d9-interoperation.md)
- [<span data-ttu-id="c3698-179">Tutorial: Crear contenido Direct3D9 para hospedarlo en WPF</span><span class="sxs-lookup"><span data-stu-id="c3698-179">Walkthrough: Creating Direct3D9 Content for Hosting in WPF</span></span>](../../../../docs/framework/wpf/advanced/walkthrough-creating-direct3d9-content-for-hosting-in-wpf.md)
- [<span data-ttu-id="c3698-180">Tutorial: Hospedar contenido Direct3D9 en WPF</span><span class="sxs-lookup"><span data-stu-id="c3698-180">Walkthrough: Hosting Direct3D9 Content in WPF</span></span>](../../../../docs/framework/wpf/advanced/walkthrough-hosting-direct3d9-content-in-wpf.md)
