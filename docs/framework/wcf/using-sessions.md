---
description: 'Más información acerca de: uso de sesiones'
title: Uso de sesiones
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- sessions [WCF]
ms.assetid: 864ba12f-3331-4359-a359-6d6d387f1035
ms.openlocfilehash: bd5fc82af9b613566885bcf27e659edc4ba0e579
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/06/2021
ms.locfileid: "99778170"
---
# <a name="using-sessions"></a><span data-ttu-id="a8fa5-103">Uso de sesiones</span><span class="sxs-lookup"><span data-stu-id="a8fa5-103">Using Sessions</span></span>

<span data-ttu-id="a8fa5-104">En las aplicaciones Windows Communication Foundation (WCF), una *sesión* correlaciona un grupo de mensajes en una conversación.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-104">In Windows Communication Foundation (WCF) applications, a *session* correlates a group of messages into a conversation.</span></span> <span data-ttu-id="a8fa5-105">Las sesiones de WCF son diferentes del objeto de sesión disponible en las aplicaciones de ASP.NET, admiten diferentes comportamientos y se controlan de maneras diferentes.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-105">WCF sessions are different than the session object available in ASP.NET applications, support different behaviors, and are controlled in different ways.</span></span> <span data-ttu-id="a8fa5-106">En este tema se describen las características que habilitan las sesiones en las aplicaciones WCF y cómo usarlas.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-106">This topic describes the features that sessions enable in WCF applications and how to use them.</span></span>  
  
## <a name="sessions-in-windows-communication-foundation-applications"></a><span data-ttu-id="a8fa5-107">Sesiones en aplicaciones de Windows Communication Foundation</span><span class="sxs-lookup"><span data-stu-id="a8fa5-107">Sessions in Windows Communication Foundation Applications</span></span>  

 <span data-ttu-id="a8fa5-108">Cuando un contrato de servicio especifica que requiere una sesión, ese contrato está especificando que todas las llamadas (es decir, los intercambios de mensajes subyacentes que admiten las llamadas) deben formar parte de la misma conversación.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-108">When a service contract specifies that it requires a session, that contract is specifying that all calls (that is, the underlying message exchanges that support the calls) must be part of the same conversation.</span></span> <span data-ttu-id="a8fa5-109">Si un contrato especifica que admite sesiones pero no requiere una, los clientes pueden conectarse y establecer o no una sesión.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-109">If a contract specifies that it allows sessions but does not require one, clients can connect and either establish a session or not establish a session.</span></span> <span data-ttu-id="a8fa5-110">Si la sesión finaliza y se envía un mensaje se envía a través del mismo canal, se produce una excepción.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-110">If the session ends and a message is sent through the same channel an exception is thrown.</span></span>  
  
 <span data-ttu-id="a8fa5-111">Las sesiones de WCF tienen las siguientes características conceptuales principales:</span><span class="sxs-lookup"><span data-stu-id="a8fa5-111">WCF sessions have the following main conceptual features:</span></span>  
  
- <span data-ttu-id="a8fa5-112">La aplicación (el cliente WCF) que realiza la llamada inicia y finaliza explícitamente las sesiones.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-112">They are explicitly initiated and terminated by the calling application (the WCF client).</span></span>  
  
- <span data-ttu-id="a8fa5-113">Los mensajes entregados durante una sesión se procesan en el orden de recepción.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-113">Messages delivered during a session are processed in the order in which they are received.</span></span>  
  
- <span data-ttu-id="a8fa5-114">Las sesiones correlacionan un grupo de mensajes en una conversación.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-114">Sessions correlate a group of messages into a conversation.</span></span> <span data-ttu-id="a8fa5-115">Son posibles distintos tipos de correlaciones.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-115">Different types of correlation are possible.</span></span> <span data-ttu-id="a8fa5-116">Por ejemplo, un canal basado en sesión puede correlacionar mensajes basados en una conexión de red compartida, mientras que otro canal basado en sesión puede correlacionar mensajes basados en una etiqueta compartida en el cuerpo del mensaje.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-116">For instance, one session-based channel may correlate messages based on a shared network connection while another session-based channel may correlate messages based on a shared tag in the message body.</span></span> <span data-ttu-id="a8fa5-117">Las características que se pueden derivar a partir de la sesión dependen de la naturaleza de la correlación.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-117">The features that can be derived from the session depend on the nature of the correlation.</span></span>  
  
- <span data-ttu-id="a8fa5-118">No hay ningún almacén de datos general asociado a una sesión de WCF.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-118">There is no general data store associated with a WCF session.</span></span>  
  
 <span data-ttu-id="a8fa5-119">Si está familiarizado con la <xref:System.Web.SessionState.HttpSessionState?displayProperty=nameWithType> clase en las aplicaciones de ASP.net y la funcionalidad que proporciona, podría observar las siguientes diferencias entre ese tipo de sesión y las sesiones de WCF:</span><span class="sxs-lookup"><span data-stu-id="a8fa5-119">If you are familiar with the <xref:System.Web.SessionState.HttpSessionState?displayProperty=nameWithType> class in ASP.NET applications and the functionality it provides, you might notice the following differences between that kind of session and WCF sessions:</span></span>  
  
- <span data-ttu-id="a8fa5-120">Las sesiones de ASP.NET siempre se inician en el servidor.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-120">ASP.NET sessions are always server-initiated.</span></span>  
  
- <span data-ttu-id="a8fa5-121">Las sesiones de ASP.NET no están ordenadas de forma implícita.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-121">ASP.NET sessions are implicitly unordered.</span></span>  
  
- <span data-ttu-id="a8fa5-122">Las sesiones de ASP.NET proporcionan un mecanismo de almacenamiento de datos general entre las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-122">ASP.NET sessions provide a general data storage mechanism across requests.</span></span>  
  
 <span data-ttu-id="a8fa5-123">En este tema se describe:</span><span class="sxs-lookup"><span data-stu-id="a8fa5-123">This topic describes:</span></span>  
  
- <span data-ttu-id="a8fa5-124">El comportamiento de ejecución predeterminado al utilizar enlaces basados en sesión en el nivel de modelo de servicio.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-124">The default execution behavior when using session-based bindings in the service model layer.</span></span>  
  
- <span data-ttu-id="a8fa5-125">Los tipos de características que proporcionan los enlaces basados en sesión WCF y proporcionados por el sistema.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-125">The types of features that the WCF session-based, system-provided bindings provide.</span></span>  
  
- <span data-ttu-id="a8fa5-126">Cómo crear un contrato que declare un requisito de sesión.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-126">How to create a contract that declares a session requirement.</span></span>  
  
- <span data-ttu-id="a8fa5-127">Cómo entender y controlar la creación y finalización de la sesión y la relación de la sesión con la instancia del servicio.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-127">How to understand and control the creation and termination of the session and the relationship of the session to the service instance.</span></span>  
  
## <a name="default-execution-behavior-using-sessions"></a><span data-ttu-id="a8fa5-128">Comportamiento de ejecución predeterminado mediante sesiones</span><span class="sxs-lookup"><span data-stu-id="a8fa5-128">Default Execution Behavior Using Sessions</span></span>  

 <span data-ttu-id="a8fa5-129">Un enlace que intenta iniciar una sesión se denomina enlace *basado en sesión* .</span><span class="sxs-lookup"><span data-stu-id="a8fa5-129">A binding that attempts to initiate a session is called a *session-based* binding.</span></span> <span data-ttu-id="a8fa5-130">Los contratos de servicio especifican que requieren, permiten o rechazan enlaces basados en sesión estableciendo la propiedad <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> en la interfaz (o clase) del contrato de servicio en uno de los valores de enumeración del <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="a8fa5-130">Service contracts specify that they require, permit, or refuse session-based bindings by setting the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property on the service contract interface (or class) to one of the <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> enumeration values.</span></span> <span data-ttu-id="a8fa5-131">De forma predeterminada, el valor de esta propiedad es <xref:System.ServiceModel.SessionMode.Allowed> , lo que significa que si un cliente utiliza un enlace basado en sesión con una implementación de servicio WCF, el servicio establece y utiliza la sesión proporcionada.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-131">By default, the value of this property is <xref:System.ServiceModel.SessionMode.Allowed>, which means that if a client uses a session-based binding with a WCF service implementation, the service establishes and uses the session provided.</span></span>  
  
 <span data-ttu-id="a8fa5-132">Cuando un servicio WCF acepta una sesión de cliente, las características siguientes están habilitadas de forma predeterminada:</span><span class="sxs-lookup"><span data-stu-id="a8fa5-132">When a WCF service accepts a client session, the following features are enabled by default:</span></span>  
  
1. <span data-ttu-id="a8fa5-133">Todas las llamadas entre un objeto de cliente de WCF se administran mediante la misma instancia de servicio.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-133">All calls between a WCF client object are handled by the same service instance.</span></span>  
  
2. <span data-ttu-id="a8fa5-134">Los distintos enlaces basados en sesión proporcionan características adicionales.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-134">Different session-based bindings provide additional features.</span></span>  
  
## <a name="system-provided-session-types"></a><span data-ttu-id="a8fa5-135">Tipos de sesión proporcionados por el sistema</span><span class="sxs-lookup"><span data-stu-id="a8fa5-135">System-Provided Session Types</span></span>  

 <span data-ttu-id="a8fa5-136">Un enlace basado en sesión admite la asociación predeterminada de una instancia de servicio con una sesión determinada.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-136">A session-based binding supports the default association of a service instance with a particular session.</span></span> <span data-ttu-id="a8fa5-137">Sin embargo, diferentes enlaces basados en sesión admiten distintas características además de habilitar el control de creación de instancias basadas en sesión descrito anteriormente.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-137">However, different session-based bindings support different features in addition to enabling the session-based instancing control previously described.</span></span>  
  
 <span data-ttu-id="a8fa5-138">WCF proporciona los siguientes tipos de comportamiento de la aplicación basada en sesión:</span><span class="sxs-lookup"><span data-stu-id="a8fa5-138">WCF provides the following types of session-based application behavior:</span></span>  
  
- <span data-ttu-id="a8fa5-139">El <xref:System.ServiceModel.Channels.SecurityBindingElement?displayProperty=nameWithType> admite sesiones basadas en seguridad, en las que ambos extremos de la comunicación han acordado una conversación segura concreta.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-139">The <xref:System.ServiceModel.Channels.SecurityBindingElement?displayProperty=nameWithType> supports security-based sessions, in which both ends of communication have agreed upon a specific secure conversation.</span></span> <span data-ttu-id="a8fa5-140">Para obtener más información, vea [proteger los servicios](securing-services.md).</span><span class="sxs-lookup"><span data-stu-id="a8fa5-140">For more information, see [Securing Services](securing-services.md).</span></span> <span data-ttu-id="a8fa5-141">Por ejemplo, el enlace <xref:System.ServiceModel.WSHttpBinding?displayProperty=nameWithType> , que admite sesiones de seguridad y sesiones confiables, solo utiliza de forma predeterminada una sesión segura que cifra y firma digitalmente los mensajes.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-141">For example, the <xref:System.ServiceModel.WSHttpBinding?displayProperty=nameWithType> binding, which contains support for both security sessions and reliable sessions, by default uses only a secure session that encrypts and digitally signs messages.</span></span>  
  
- <span data-ttu-id="a8fa5-142">El enlace <xref:System.ServiceModel.NetTcpBinding?displayProperty=nameWithType> admite las sesiones basadas en TCP/IP para asegurarse de que todos los mensajes están correlacionados por la conexión en el nivel de socket.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-142">The <xref:System.ServiceModel.NetTcpBinding?displayProperty=nameWithType> binding supports TCP/IP-based sessions to ensure that all messages are correlated by the connection at the socket level.</span></span>  
  
- <span data-ttu-id="a8fa5-143">El elemento <xref:System.ServiceModel.Channels.ReliableSessionBindingElement?displayProperty=nameWithType> , que implementa la especificación de WS-ReliableMessaging, proporciona la compatibilidad para las sesiones confiables en las que los mensajes se pueden configurar para que se entreguen en orden y solo una vez, asegurando que los mensajes se reciban aunque estos viajen por varios nodos durante la conversación.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-143">The <xref:System.ServiceModel.Channels.ReliableSessionBindingElement?displayProperty=nameWithType> element, which implements the WS-ReliableMessaging specification, provides support for reliable sessions in which messages can be configured to be delivered in order and exactly once, ensuring messages are received even when messages travel across multiple nodes during the conversation.</span></span> <span data-ttu-id="a8fa5-144">Para obtener más información, vea [sesiones confiables](./feature-details/reliable-sessions.md).</span><span class="sxs-lookup"><span data-stu-id="a8fa5-144">For more information, see [Reliable Sessions](./feature-details/reliable-sessions.md).</span></span>  
  
- <span data-ttu-id="a8fa5-145">El enlace <xref:System.ServiceModel.NetMsmqBinding?displayProperty=nameWithType> proporciona sesiones de datagrama de MSMQ.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-145">The <xref:System.ServiceModel.NetMsmqBinding?displayProperty=nameWithType> binding provides MSMQ datagram sessions.</span></span> <span data-ttu-id="a8fa5-146">Para obtener más información, vea [colas en WCF](./feature-details/queues-in-wcf.md).</span><span class="sxs-lookup"><span data-stu-id="a8fa5-146">For more information, see [Queues in WCF](./feature-details/queues-in-wcf.md).</span></span>  
  
 <span data-ttu-id="a8fa5-147">Establecer la propiedad <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> no especifica el tipo de sesión que el contrato requiere, solo que requiere uno.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-147">Setting the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> property does not specify the type of session the contract requires, only that it requires one.</span></span>  
  
## <a name="creating-a-contract-that-requires-a-session"></a><span data-ttu-id="a8fa5-148">Creación de un contrato que requiere una sesión</span><span class="sxs-lookup"><span data-stu-id="a8fa5-148">Creating a Contract That Requires a Session</span></span>  

 <span data-ttu-id="a8fa5-149">La creación de un contrato que requiere una sesión hace que el grupo de operaciones que declara el contrato de servicio deba ejecutarse dentro de la misma sesión y que los mensajes deban entregarse en orden.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-149">Creating a contract that requires a session states that the group of operations that the service contract declares must all be executed within the same session and that messages must be delivered in order.</span></span> <span data-ttu-id="a8fa5-150">Para validar el nivel de compatibilidad de la sesión que requiere un contrato de servicio, establezca la propiedad <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> de su clase o interfaz de contrato de servicio en el valor de la enumeración <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> para especificar si el contrato:</span><span class="sxs-lookup"><span data-stu-id="a8fa5-150">To assert the level of session support that a service contract requires, set the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property on your service contract interface or class to the value of the <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> enumeration to specify whether the contract:</span></span>  
  
- <span data-ttu-id="a8fa5-151">Requiere una sesión.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-151">Requires a session.</span></span>  
  
- <span data-ttu-id="a8fa5-152">Permite a un cliente establecer una sesión.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-152">Allows a client to establish a session.</span></span>  
  
- <span data-ttu-id="a8fa5-153">Prohíbe una sesión.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-153">Prohibits a session.</span></span>  
  
 <span data-ttu-id="a8fa5-154">Establecer la propiedad <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> no especifica, sin embargo, el tipo de comportamiento basado en sesión que requiere el contrato.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-154">Setting the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> property does not, however, specify the type of session-based behavior the contract requires.</span></span> <span data-ttu-id="a8fa5-155">Indica a WCF que confirme en tiempo de ejecución que el enlace configurado (que crea el canal de comunicación) para el servicio, no o puede establecer una sesión al implementar un servicio.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-155">It instructs WCF to confirm at runtime that the configured binding (which creates the communication channel) for the service does, does not, or can establish a session when implementing a service.</span></span> <span data-ttu-id="a8fa5-156">De nuevo, el enlace puede satisfacer ese requisito con cualquier tipo de comportamiento basado en sesión que elija: seguridad, transporte, confiable o alguna combinación.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-156">Again, the binding can satisfy that requirement with any type of session-based behavior it chooses—security, transport, reliable, or some combination.</span></span> <span data-ttu-id="a8fa5-157">El comportamiento exacto depende del valor de la enumeración <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> seleccionada.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-157">The exact behavior depends on the <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> value selected.</span></span> <span data-ttu-id="a8fa5-158">Si el enlace configurado del servicio no cumple con el valor de <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A>, se produce una excepción.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-158">If the configured binding of the service does not conform to the value of <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A>, an exception is thrown.</span></span> <span data-ttu-id="a8fa5-159">Los enlaces, y los canales que esos enlaces crean, que admiten sesiones se dice que son basados en sesión.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-159">Bindings and the channels they create that support sessions are said to be session-based.</span></span>  
  
 <span data-ttu-id="a8fa5-160">El siguiente contrato de servicio especifica que todas las operaciones de la `ICalculatorSession` se deben intercambiar dentro de una sesión.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-160">The following service contract specifies that all operations in the `ICalculatorSession` must be exchanged within a session.</span></span> <span data-ttu-id="a8fa5-161">Ninguna de las operaciones devuelve un valor al llamador, salvo el método `Equals` .</span><span class="sxs-lookup"><span data-stu-id="a8fa5-161">None of the operations returns a value to the caller except the `Equals` method.</span></span> <span data-ttu-id="a8fa5-162">Sin embargo, el método `Equals` no toma ningún parámetro y, por consiguiente, solo puede devolver un valor distinto de cero dentro de una sesión en la que los datos ya se han pasado a otras operaciones.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-162">However, the `Equals` method takes no parameters and, therefore, can only return a non-zero value inside a session in which data has already been passed to the other operations.</span></span> <span data-ttu-id="a8fa5-163">Este contrato requiere que una sesión funcione correctamente.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-163">This contract requires a session to function properly.</span></span> <span data-ttu-id="a8fa5-164">Si no hay una sesión asociada a un cliente concreto, la instancia del servicio no tiene forma de saber qué datos anteriores ha enviado este cliente.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-164">Without a session associated with a specific client, the service instance has no way of knowing what previous data this client has sent.</span></span>  
  
 [!code-csharp[S_Service_Session#1](../../../samples/snippets/csharp/VS_Snippets_CFX/s_service_session/cs/service.cs#1)]
 [!code-vb[S_Service_Session#1](../../../samples/snippets/visualbasic/VS_Snippets_CFX/s_service_session/vb/service.vb#1)]  
  
 <span data-ttu-id="a8fa5-165">Si un servicio permite una sesión, se establece una sesión y se utiliza si el cliente inicia una; de lo contrario, no se establece ninguna sesión.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-165">If a service allows a session, then a session is established and used if the client initiates one; otherwise, no session is established.</span></span>  
  
## <a name="sessions-and-service-instances"></a><span data-ttu-id="a8fa5-166">Sesiones e instancias de servicios</span><span class="sxs-lookup"><span data-stu-id="a8fa5-166">Sessions and Service Instances</span></span>  

 <span data-ttu-id="a8fa5-167">Si utiliza el comportamiento de creación de instancias predeterminado en WCF, la misma instancia de servicio administra todas las llamadas entre un objeto de cliente de WCF.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-167">If you use the default instancing behavior in WCF, all calls between a WCF client object are handled by the same service instance.</span></span> <span data-ttu-id="a8fa5-168">Por consiguiente, en el nivel de aplicación, puede considerar una sesión como la habilitación de un comportamiento de aplicación similar al comportamiento de la llamada local.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-168">Therefore, at the application level, you can think of a session as enabling application behavior similar to local call behavior.</span></span> <span data-ttu-id="a8fa5-169">Por ejemplo, al crear un objeto local:</span><span class="sxs-lookup"><span data-stu-id="a8fa5-169">For example, when you create a local object:</span></span>  
  
- <span data-ttu-id="a8fa5-170">Se llama a un constructor.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-170">A constructor is called.</span></span>  
  
- <span data-ttu-id="a8fa5-171">La misma instancia de objeto procesa todas las llamadas subsiguientes realizadas a la referencia de objeto de cliente de WCF.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-171">All subsequent calls made to the WCF client object reference are processed by the same object instance.</span></span>  
  
- <span data-ttu-id="a8fa5-172">Se llama a un destructor cuando se destruye la referencia del objeto.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-172">A destructor is called when the object reference is destroyed.</span></span>  
  
 <span data-ttu-id="a8fa5-173">Las sesiones habilitan un comportamiento similar entre clientes y servicios, siempre que se utilice el comportamiento de instancia de servicio predeterminado.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-173">Sessions enable a similar behavior between clients and services as long as the default service instance behavior is used.</span></span> <span data-ttu-id="a8fa5-174">Si un contrato de servicio requiere o admite sesiones, se pueden marcar una o más operaciones del contrato como que inician o finalizan una sesión estableciendo las propiedades <xref:System.ServiceModel.OperationContractAttribute.IsInitiating%2A> y <xref:System.ServiceModel.OperationContractAttribute.IsTerminating%2A> .</span><span class="sxs-lookup"><span data-stu-id="a8fa5-174">If a service contract requires or supports sessions, one or more contract operations can be marked as initiating or terminating a session by setting the <xref:System.ServiceModel.OperationContractAttribute.IsInitiating%2A> and <xref:System.ServiceModel.OperationContractAttribute.IsTerminating%2A> properties.</span></span>  
  
 <span data-ttu-id="a8fa5-175">Las *operaciones de inicio* son aquellas que deben llamarse como la primera operación de una nueva sesión.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-175">*Initiating operations* are those that must be called as the first operation of a new session.</span></span> <span data-ttu-id="a8fa5-176">Las operaciones que no son de inicio sólo pueden llamarse después de que se haya llamado, al menos, a una operación de inicio.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-176">Non-initiating operations can be called only after at least one initiating operation has been called.</span></span> <span data-ttu-id="a8fa5-177">Puede crear, por consiguiente, un tipo de constructor de sesión para su servicio mediante la declaración de operaciones de inicio diseñadas para tomar entradas de clientes apropiadas para el inicio de la instancia de servicio.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-177">You can therefore create a kind of session constructor for your service by declaring initiating operations designed to take input from clients appropriate to the beginning of the service instance.</span></span> <span data-ttu-id="a8fa5-178">(Sin embargo, el estado se asocia a la sesión, y no el objeto de servicio).</span><span class="sxs-lookup"><span data-stu-id="a8fa5-178">(The state is associated with the session, however, and not the service object.)</span></span>  
  
 <span data-ttu-id="a8fa5-179">Las *operaciones de finalización*, por el contrario, son aquellas a las que se debe llamar como el último mensaje de una sesión existente.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-179">*Terminating operations*, conversely, are those that must be called as the last message in an existing session.</span></span> <span data-ttu-id="a8fa5-180">En el caso predeterminado, WCF recicla el objeto de servicio y su contexto después de que se cierre la sesión a la que se asoció el servicio.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-180">In the default case, WCF recycles the service object and its context after the session with which the service was associated is closed.</span></span> <span data-ttu-id="a8fa5-181">Por consiguiente, puede crear un tipo de destructor declarando operaciones de finalización diseñadas para realizar una función adecuada al final de la instancia de servicio.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-181">You can, therefore, create a kind of destructor by declaring terminating operations designed to perform a function appropriate to the end of the service instance.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="a8fa5-182">Aunque el comportamiento predeterminado se parece algo a los constructores y destructores locales, solo es eso, un parecido.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-182">Although the default behavior bears a resemblance to local constructors and destructors, it is only a resemblance.</span></span> <span data-ttu-id="a8fa5-183">Cualquier operación de servicio de WCF puede ser una operación de inicio o de finalización, o ambas al mismo tiempo.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-183">Any WCF service operation can be an initiating or terminating operation, or both at the same time.</span></span> <span data-ttu-id="a8fa5-184">Además, en el caso predeterminado, las operaciones de inicio pueden llamarse cualquier número de veces en cualquier orden; no se crean sesiones adicionales una vez que se establezca la sesión y se asocie a una instancia, a menos que controle explícitamente la duración de la instancia del servicio (manipulando el objeto <xref:System.ServiceModel.InstanceContext?displayProperty=nameWithType> ).</span><span class="sxs-lookup"><span data-stu-id="a8fa5-184">In addition, in the default case, initiating operations can be called any number of times in any order; no additional sessions are created once the session is established and associated with an instance unless you explicitly control the lifetime of the service instance (by manipulating the <xref:System.ServiceModel.InstanceContext?displayProperty=nameWithType> object).</span></span> <span data-ttu-id="a8fa5-185">Finalmente, el estado se asocia a la sesión y no al objeto de servicio.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-185">Finally, the state is associated with the session and not the service object.</span></span>  
  
 <span data-ttu-id="a8fa5-186">Por ejemplo, el `ICalculatorSession` contrato utilizado en el ejemplo anterior requiere que el objeto de cliente de WCF llame primero `Clear` a la operación antes que a cualquier otra operación y que la sesión con este objeto de cliente de WCF debe finalizar cuando llame a la `Equals` operación.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-186">For example, the `ICalculatorSession` contract used in the preceding example requires that the WCF client object first call the `Clear` operation prior to any other operation and that the session with this WCF client object should terminate when it calls the `Equals` operation.</span></span> <span data-ttu-id="a8fa5-187">El ejemplo de código siguiente muestra un contrato que aplica estos requisitos.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-187">The following code example shows a contract that enforces these requirements.</span></span> <span data-ttu-id="a8fa5-188">Se debe llamar primero a`Clear` para iniciar una sesión y esa sesión finaliza cuando se llama a `Equals` .</span><span class="sxs-lookup"><span data-stu-id="a8fa5-188">`Clear` must be called first to initiate a session, and that session ends when `Equals` is called.</span></span>  
  
 [!code-csharp[SCA.IsInitiatingIsTerminating#1](../../../samples/snippets/csharp/VS_Snippets_CFX/sca.isinitiatingisterminating/cs/service.cs#1)]
 [!code-vb[SCA.IsInitiatingIsTerminating#1](../../../samples/snippets/visualbasic/VS_Snippets_CFX/sca.isinitiatingisterminating/vb/service.vb#1)]  
  
 <span data-ttu-id="a8fa5-189">Los servicios no inician sesiones con clientes.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-189">Services do not start sessions with clients.</span></span> <span data-ttu-id="a8fa5-190">En las aplicaciones cliente de WCF, existe una relación directa entre la duración del canal basado en sesión y la duración de la propia sesión.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-190">In WCF client applications, a direct relationship exists between the lifetime of the session-based channel and the lifetime of the session itself.</span></span> <span data-ttu-id="a8fa5-191">Como tal, los clientes crean nuevas sesiones creando nuevos canales basados en sesión y acaban con las sesiones existentes cerrando correctamente los canales basados en sesión.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-191">As such, clients create new sessions by creating new session-based channels and tear down existing sessions by closing session-based channels gracefully.</span></span> <span data-ttu-id="a8fa5-192">Un cliente inicia una sesión con un extremo de servicio llamando a uno de los siguientes métodos:</span><span class="sxs-lookup"><span data-stu-id="a8fa5-192">A client starts a session with a service endpoint by calling one of the following:</span></span>  
  
- <span data-ttu-id="a8fa5-193"><xref:System.ServiceModel.ICommunicationObject.Open%2A?displayProperty=nameWithType> en el canal devuelto por una llamada a <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-193"><xref:System.ServiceModel.ICommunicationObject.Open%2A?displayProperty=nameWithType> on the channel returned by a call to <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span></span>  
  
- <span data-ttu-id="a8fa5-194"><xref:System.ServiceModel.ClientBase%601.Open%2A?displayProperty=nameWithType> en el objeto de cliente de WCF generado por la [herramienta de utilidad de metadatos de ServiceModel (Svcutil.exe)](servicemodel-metadata-utility-tool-svcutil-exe.md).</span><span class="sxs-lookup"><span data-stu-id="a8fa5-194"><xref:System.ServiceModel.ClientBase%601.Open%2A?displayProperty=nameWithType> on the WCF client object generated by the [ServiceModel Metadata Utility Tool (Svcutil.exe)](servicemodel-metadata-utility-tool-svcutil-exe.md).</span></span>  
  
- <span data-ttu-id="a8fa5-195">Una operación de inicio en cualquier tipo de objeto de cliente de WCF (de forma predeterminada, todas las operaciones se están iniciando).</span><span class="sxs-lookup"><span data-stu-id="a8fa5-195">An initiating operation on either type of WCF client object (by default, all operations are initiating).</span></span> <span data-ttu-id="a8fa5-196">Cuando se llama a la primera operación, el objeto de cliente de WCF abre automáticamente el canal e inicia una sesión.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-196">When the first operation is called, the WCF client object automatically opens the channel and initiates a session.</span></span>  
  
 <span data-ttu-id="a8fa5-197">Por lo general, un cliente finaliza una sesión con un extremo de servicio llamando a uno de los siguientes métodos:</span><span class="sxs-lookup"><span data-stu-id="a8fa5-197">Typically a client ends a session with a service endpoint by calling one of the following:</span></span>  
  
- <span data-ttu-id="a8fa5-198"><xref:System.ServiceModel.ICommunicationObject.Close%2A?displayProperty=nameWithType> en el canal devuelto por una llamada a <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-198"><xref:System.ServiceModel.ICommunicationObject.Close%2A?displayProperty=nameWithType> on the channel returned by a call to <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span></span>  
  
- <span data-ttu-id="a8fa5-199"><xref:System.ServiceModel.ClientBase%601.Close%2A?displayProperty=nameWithType> en el objeto de cliente de WCF generado por Svcutil.exe.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-199"><xref:System.ServiceModel.ClientBase%601.Close%2A?displayProperty=nameWithType> on the WCF client object generated by Svcutil.exe.</span></span>  
  
- <span data-ttu-id="a8fa5-200">Una operación de finalización en cualquier tipo de objeto de cliente de WCF (de forma predeterminada, no se terminan las operaciones; el contrato debe especificar explícitamente una operación de finalización).</span><span class="sxs-lookup"><span data-stu-id="a8fa5-200">A terminating operation on either type of WCF client object (by default, no operations are terminating; the contract must explicitly specify a terminating operation).</span></span> <span data-ttu-id="a8fa5-201">Cuando se llama a la primera operación, el objeto de cliente de WCF abre automáticamente el canal e inicia una sesión.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-201">When the first operation is called, the WCF client object automatically opens the channel and initiates a session.</span></span>  
  
 <span data-ttu-id="a8fa5-202">Para obtener ejemplos, consulte [How to: Create a Service That Requires Sessions](./feature-details/how-to-create-a-service-that-requires-sessions.md) , así como los ejemplos de [Default Service Behavior](./samples/default-service-behavior.md) y [Instancing](./samples/instancing.md) .</span><span class="sxs-lookup"><span data-stu-id="a8fa5-202">For examples, see [How to: Create a Service That Requires Sessions](./feature-details/how-to-create-a-service-that-requires-sessions.md) as well as the [Default Service Behavior](./samples/default-service-behavior.md) and [Instancing](./samples/instancing.md) samples.</span></span>  
  
 <span data-ttu-id="a8fa5-203">Para obtener más información acerca de los clientes y las sesiones, consulte [acceso a servicios mediante un cliente WCF](./feature-details/accessing-services-using-a-client.md).</span><span class="sxs-lookup"><span data-stu-id="a8fa5-203">For more information about clients and sessions, see [Accessing Services Using a WCF Client](./feature-details/accessing-services-using-a-client.md).</span></span>  
  
## <a name="sessions-interact-with-instancecontext-settings"></a><span data-ttu-id="a8fa5-204">Las sesiones interactúan con la configuración de InstanceContext</span><span class="sxs-lookup"><span data-stu-id="a8fa5-204">Sessions Interact with InstanceContext Settings</span></span>  

 <span data-ttu-id="a8fa5-205">Hay una interacción entre la enumeración de <xref:System.ServiceModel.SessionMode> en un contrato y la propiedad <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> , que controla la asociación entre canales y objetos de servicio concretos.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-205">There is an interaction between the <xref:System.ServiceModel.SessionMode> enumeration in a contract and the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property, which controls the association between channels and specific service objects.</span></span> <span data-ttu-id="a8fa5-206">Para obtener más información, vea [sesiones, creación de instancias y simultaneidad](./feature-details/sessions-instancing-and-concurrency.md).</span><span class="sxs-lookup"><span data-stu-id="a8fa5-206">For more information, see [Sessions, Instancing, and Concurrency](./feature-details/sessions-instancing-and-concurrency.md).</span></span>  
  
### <a name="sharing-instancecontext-objects"></a><span data-ttu-id="a8fa5-207">Uso compartido de objetos InstanceContext</span><span class="sxs-lookup"><span data-stu-id="a8fa5-207">Sharing InstanceContext Objects</span></span>  

 <span data-ttu-id="a8fa5-208">También puede controlar qué canal basado en sesión o llamada se asocia a qué objeto <xref:System.ServiceModel.InstanceContext> realizando esa asociación usted mismo.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-208">You can also control which session-based channel or call is associated with which <xref:System.ServiceModel.InstanceContext> object by performing that association yourself.</span></span>
  
## <a name="sessions-and-streaming"></a><span data-ttu-id="a8fa5-209">Sesiones y transmisión por secuencias</span><span class="sxs-lookup"><span data-stu-id="a8fa5-209">Sessions and Streaming</span></span>  

 <span data-ttu-id="a8fa5-210">Si tiene una gran cantidad de datos para transferir, el modo de transferencia de streaming en WCF es una alternativa factible al comportamiento predeterminado de almacenar en búfer y procesar los mensajes en memoria en su totalidad.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-210">When you have a large amount of data to transfer, the streaming transfer mode in WCF is a feasible alternative to the default behavior of buffering and processing messages in memory in their entirety.</span></span> <span data-ttu-id="a8fa5-211">Puede obtener un comportamiento inesperado al transmitir mediante secuencias las llamadas con un enlace basado en sesión.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-211">You may get unexpected behavior when streaming calls with a session-based binding.</span></span> <span data-ttu-id="a8fa5-212">Todas las llamadas de transferencias por secuencias se realizan a través de un canal único (el canal del datagrama) que no admite sesiones incluso si el enlace utilizado esté configurado para utilizar sesiones.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-212">All streaming calls are made through a single channel (the datagram channel) that does not support sessions even if the binding being used is configured to use sessions.</span></span> <span data-ttu-id="a8fa5-213">Si varios clientes realizan llamadas de transferencias por secuencias al mismo objeto de servicio sobre un enlace basado en sesión y el modo de simultaneidad del objeto de servicio se ha establecido como Single y su modo de contexto de instancia está establecido en `PerSession`, todas las llamadas deben pasar por el canal de datagrama y, por lo tanto, solo se procesa una llamada al mismo tiempo.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-213">If multiple clients make streaming calls to the same service object over a session-based binding, and the service object's concurrency mode is set to single and its instance context mode is set to `PerSession`, all calls must go through the datagram channel and so only one call is processed at a time.</span></span> <span data-ttu-id="a8fa5-214">Uno o más clientes pueden agotar el tiempo de espera. Puede solucionar este problema estableciendo el objeto de servicio `InstanceContextMode` en `PerCall` o la simultaneidad en múltiple.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-214">One or more clients may then time out. You can work around this issue by either setting the service object's `InstanceContextMode` to `PerCall` or Concurrency to multiple.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="a8fa5-215">MaxConcurrentSessions no influye en este caso porque solo hay una "sesión" disponible.</span><span class="sxs-lookup"><span data-stu-id="a8fa5-215">MaxConcurrentSessions have no effect in this case because there is only one "session" available.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a8fa5-216">Vea también</span><span class="sxs-lookup"><span data-stu-id="a8fa5-216">See also</span></span>

- <xref:System.ServiceModel.OperationContractAttribute.IsInitiating%2A>
- <xref:System.ServiceModel.OperationContractAttribute.IsTerminating%2A>
