---
description: Más información acerca de cómo especificar y controlar errores en contratos y servicios
title: Especificación y administración de errores en contratos y servicios
ms.date: 03/30/2017
helpviewer_keywords:
- handling faults [WCF]
ms.assetid: a9696563-d404-4905-942d-1e0834c26dea
ms.openlocfilehash: 32a1c795d2be964ff5da259b70a5695ddedfadb2
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/06/2021
ms.locfileid: "99676396"
---
# <a name="specifying-and-handling-faults-in-contracts-and-services"></a><span data-ttu-id="6da7e-103">Especificación y administración de errores en contratos y servicios</span><span class="sxs-lookup"><span data-stu-id="6da7e-103">Specifying and Handling Faults in Contracts and Services</span></span>

<span data-ttu-id="6da7e-104">Las aplicaciones de Windows Communication Foundation (WCF) controlan las situaciones de error mediante la asignación de objetos de excepción administrados a objetos de error de SOAP y objetos de error de SOAP a objetos de excepción administrados.</span><span class="sxs-lookup"><span data-stu-id="6da7e-104">Windows Communication Foundation (WCF) applications handle error situations by mapping managed exception objects to SOAP fault objects and SOAP fault objects to managed exception objects.</span></span> <span data-ttu-id="6da7e-105">Los temas de esta sección describen cómo diseñar contratos para exponer condiciones de error como errores de SOAP personalizados, cómo devolver tales errores como parte de la implementación del servicio y cómo los clientes detectan tales errores.</span><span class="sxs-lookup"><span data-stu-id="6da7e-105">The topics in this section discuss how to design contracts to expose error conditions as custom SOAP faults, how to return such faults as part of service implementation, and how clients catch such faults.</span></span>

## <a name="error-handling-overview"></a><span data-ttu-id="6da7e-106">Información general sobre control de errores</span><span class="sxs-lookup"><span data-stu-id="6da7e-106">Error Handling Overview</span></span>

<span data-ttu-id="6da7e-107">En todas las aplicaciones administradas, los errores de procesamiento están representados mediante objetos <xref:System.Exception>.</span><span class="sxs-lookup"><span data-stu-id="6da7e-107">In all managed applications, processing errors are represented by <xref:System.Exception> objects.</span></span> <span data-ttu-id="6da7e-108">En aplicaciones basadas en SOAP, como las aplicaciones WCF, los métodos de servicio comunican la información de errores de procesamiento mediante mensajes de error SOAP.</span><span class="sxs-lookup"><span data-stu-id="6da7e-108">In SOAP-based applications such as WCF applications, service methods communicate processing error information using SOAP fault messages.</span></span> <span data-ttu-id="6da7e-109">Los errores SOAP son tipos de mensaje que se incluyen en los metadatos de una operación de servicio y, por consiguiente, crean un contrato de error que los clientes pueden utilizar para que su operación sea más sólida o interactiva.</span><span class="sxs-lookup"><span data-stu-id="6da7e-109">SOAP faults are message types that are included in the metadata for a service operation and therefore create a fault contract that clients can use to make their operation more robust or interactive.</span></span> <span data-ttu-id="6da7e-110">Además, dado que los errores de SOAP se expresan en los clientes en formato XML, es un sistema de tipos altamente interoperable que los clientes de cualquier plataforma SOAP pueden utilizar, lo que aumenta el alcance de la aplicación WCF.</span><span class="sxs-lookup"><span data-stu-id="6da7e-110">In addition, because SOAP faults are expressed to clients in XML form, it is a highly interoperable type system that clients on any SOAP platform can use, increasing the reach of your WCF application.</span></span>

<span data-ttu-id="6da7e-111">Dado que las aplicaciones WCF se ejecutan en ambos tipos de sistemas de error, cualquier información de excepción administrada que se envíe al cliente debe convertirse de excepciones a errores de SOAP en el servicio, enviarse y convertirse de errores de SOAP a excepciones de error en clientes de WCF.</span><span class="sxs-lookup"><span data-stu-id="6da7e-111">Because WCF applications run under both types of error systems, any managed exception information that is sent to the client must be converted from exceptions into SOAP faults on the service, sent, and converted from SOAP faults to fault exceptions in WCF clients.</span></span> <span data-ttu-id="6da7e-112">En el caso de los clientes dúplex, los contratos de cliente también pueden devolver errores SOAP a un servicio.</span><span class="sxs-lookup"><span data-stu-id="6da7e-112">In the case of duplex clients, client contracts can also send SOAP faults back to a service.</span></span> <span data-ttu-id="6da7e-113">En cualquier caso, puede usar los comportamientos de excepción de servicio predeterminados o controlar explícitamente si (y cómo) se asignan las excepciones a los mensajes de error.</span><span class="sxs-lookup"><span data-stu-id="6da7e-113">In either case, you can use the default service exception behaviors, or you can explicitly control whether—and how—exceptions are mapped to fault messages.</span></span>

<span data-ttu-id="6da7e-114">Se pueden enviar dos tipos de errores de SOAP: *declarados* y no *declarados*.</span><span class="sxs-lookup"><span data-stu-id="6da7e-114">Two types of SOAP faults can be sent: *declared* and *undeclared*.</span></span> <span data-ttu-id="6da7e-115">Los errores SOAP declarados son aquéllos en los que una operación tiene un atributo <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType> que especifica un tipo de error SOAP personalizado.</span><span class="sxs-lookup"><span data-stu-id="6da7e-115">Declared SOAP faults are those in which an operation has a <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType> attribute that specifies a custom SOAP fault type.</span></span> <span data-ttu-id="6da7e-116">No *declarado* Los errores de SOAP no se especifican en el contrato de una operación.</span><span class="sxs-lookup"><span data-stu-id="6da7e-116">*Undeclared* SOAP faults are not specified in the contract for an operation.</span></span>

<span data-ttu-id="6da7e-117">Se recomienda encarecidamente que las operaciones de servicio declaren sus errores mediante el atributo <xref:System.ServiceModel.FaultContractAttribute> para especificar formalmente todos los errores de SOAP que un cliente puede esperar recibir en el curso normal de una operación.</span><span class="sxs-lookup"><span data-stu-id="6da7e-117">It is strongly recommended that service operations declare their faults by using the <xref:System.ServiceModel.FaultContractAttribute> attribute to formally specify all SOAP faults that a client can expect to receive in the normal course of an operation.</span></span> <span data-ttu-id="6da7e-118">Además, se recomienda que solo devuelva en un error SOAP la información que un cliente deba conocer para minimizar la divulgación de información.</span><span class="sxs-lookup"><span data-stu-id="6da7e-118">It is also recommended that you return in a SOAP fault only the information that a client must know to minimize information disclosure.</span></span>

<span data-ttu-id="6da7e-119">Normalmente, los servicios (y los clientes dúplex) dan los siguientes pasos para integrar correctamente el control de errores en sus aplicaciones:</span><span class="sxs-lookup"><span data-stu-id="6da7e-119">Typically, services (and duplex clients) take the following steps to successfully integrate error handling into their applications:</span></span>

- <span data-ttu-id="6da7e-120">Asignación de condiciones de excepción a errores SOAP personalizados.</span><span class="sxs-lookup"><span data-stu-id="6da7e-120">Map exception conditions to custom SOAP faults.</span></span>

- <span data-ttu-id="6da7e-121">Los clientes y servicios envían y reciben errores SOAP como excepciones.</span><span class="sxs-lookup"><span data-stu-id="6da7e-121">Clients and services send and receive SOAP faults as exceptions.</span></span>

<span data-ttu-id="6da7e-122">Además, los clientes y servicios de WCF pueden usar errores de SOAP no declarados con fines de depuración y pueden extender el comportamiento de error predeterminado.</span><span class="sxs-lookup"><span data-stu-id="6da7e-122">In addition, WCF clients and services can use undeclared soap faults for debugging purposes and can extend the default error behavior.</span></span> <span data-ttu-id="6da7e-123">Las secciones siguientes tratan estas tareas y conceptos.</span><span class="sxs-lookup"><span data-stu-id="6da7e-123">The following sections discuss these tasks and concepts.</span></span>

## <a name="map-exceptions-to-soap-faults"></a><span data-ttu-id="6da7e-124">Asignación de excepciones a errores SOAP</span><span class="sxs-lookup"><span data-stu-id="6da7e-124">Map Exceptions to SOAP Faults</span></span>

<span data-ttu-id="6da7e-125">El primer paso para crear una operación que administra condiciones de error es decidir bajo qué condiciones una aplicación de cliente debería informar sobre errores.</span><span class="sxs-lookup"><span data-stu-id="6da7e-125">The first step in creating an operation that handles error conditions is to decide under what conditions a client application should be informed about errors.</span></span> <span data-ttu-id="6da7e-126">Algunas operaciones tienen condiciones de error específicas de su funcionalidad.</span><span class="sxs-lookup"><span data-stu-id="6da7e-126">Some operations have error conditions specific to their functionality.</span></span> <span data-ttu-id="6da7e-127">Por ejemplo, una operación `PurchaseOrder` podría devolver la información concreta a los clientes a los que ya no se les permite iniciar una orden de compra.</span><span class="sxs-lookup"><span data-stu-id="6da7e-127">For example, a `PurchaseOrder` operation might return specific information to customers who are no longer permitted to initiate a purchase order.</span></span> <span data-ttu-id="6da7e-128">En otros casos, como un servicio `Calculator`, un error de SOAP `MathFault` más general puede ser capaz de describir todas las condiciones de error en un servicio completo.</span><span class="sxs-lookup"><span data-stu-id="6da7e-128">In other cases, such as a `Calculator` service, a more general `MathFault` SOAP fault may be able to describe all error conditions across an entire service.</span></span> <span data-ttu-id="6da7e-129">Una vez que se identifican las condiciones de error de los clientes del servicio, se puede construir un error SOAP personalizado y la operación se puede marcar para que devuelva ese error SOAP cuando se produzca la condición de error correspondiente.</span><span class="sxs-lookup"><span data-stu-id="6da7e-129">Once the error conditions of clients of your service are identified, a custom SOAP fault can be constructed and the operation can be marked as returning that SOAP fault when its corresponding error condition arises.</span></span>

<span data-ttu-id="6da7e-130">Para obtener más información sobre este paso del desarrollo de un servicio o cliente, vea [definir y especificar errores](defining-and-specifying-faults.md).</span><span class="sxs-lookup"><span data-stu-id="6da7e-130">For more information about this step of developing your service or client, see [Defining and Specifying Faults](defining-and-specifying-faults.md).</span></span>

## <a name="clients-and-services-handle-soap-faults-as-exceptions"></a><span data-ttu-id="6da7e-131">Los clientes y servicios administran los errores SOAP como excepciones</span><span class="sxs-lookup"><span data-stu-id="6da7e-131">Clients and Services Handle SOAP Faults as Exceptions</span></span>

<span data-ttu-id="6da7e-132">La identificación de condiciones de error de operación, la definición de errores de SOAP personalizados y el marcado de esas operaciones como la devolución de estos errores son los primeros pasos en el control de errores correcto en las aplicaciones WCF.</span><span class="sxs-lookup"><span data-stu-id="6da7e-132">Identifying operation error conditions, defining custom SOAP faults, and marking those operations as returning those faults are the first steps in successful error handling in WCF applications.</span></span> <span data-ttu-id="6da7e-133">El siguiente paso es implementar correctamente el envío y la recepción de estos errores.</span><span class="sxs-lookup"><span data-stu-id="6da7e-133">The next step is to properly implement the sending and receiving of these faults.</span></span> <span data-ttu-id="6da7e-134">Normalmente, los servicios envían errores para informar a las aplicaciones de cliente sobre las condiciones de error, pero los clientes dúplex también pueden enviar errores SOAP a los servicios.</span><span class="sxs-lookup"><span data-stu-id="6da7e-134">Typically services send faults to inform client applications about error conditions, but duplex clients can also send SOAP faults to services.</span></span>

<span data-ttu-id="6da7e-135">Para obtener más información, consulte [envío y recepción de errores](sending-and-receiving-faults.md).</span><span class="sxs-lookup"><span data-stu-id="6da7e-135">For more information, see [Sending and Receiving Faults](sending-and-receiving-faults.md).</span></span>

## <a name="undeclared-soap-faults-and-debugging"></a><span data-ttu-id="6da7e-136">Errores de SOAP no declarados y depuración</span><span class="sxs-lookup"><span data-stu-id="6da7e-136">Undeclared SOAP Faults and Debugging</span></span>

<span data-ttu-id="6da7e-137">Los errores de SOAP declarados son sumamente útiles para crear aplicaciones robustas, interoperables y distribuidas.</span><span class="sxs-lookup"><span data-stu-id="6da7e-137">Declared SOAP faults are extremely useful for building robust, interoperable, distributed applications.</span></span> <span data-ttu-id="6da7e-138">Sin embargo, en algunos casos es útil para un servicio (o cliente dúplex) enviar un error SOAP no declarado, uno que no se menciona en el Lenguaje de descripción de servicios Web (WSDL) para esa operación.</span><span class="sxs-lookup"><span data-stu-id="6da7e-138">However, in some cases it is useful for a service (or duplex client) to send an undeclared SOAP fault, one that is not mentioned in the Web Services Description Language (WSDL) for that operation.</span></span> <span data-ttu-id="6da7e-139">Por ejemplo, al desarrollar un servicio, pueden producirse situaciones inesperadas en las que es útil enviar información de vuelta al cliente para la depuración.</span><span class="sxs-lookup"><span data-stu-id="6da7e-139">For example, when developing a service, unexpected situations can occur in which it is useful for debugging purposes to send information back to the client.</span></span> <span data-ttu-id="6da7e-140">Además, puede establecer la <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> propiedad o la <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> propiedad en `true` para permitir que los clientes de WCF obtengan información sobre las excepciones de operación de servicio internas.</span><span class="sxs-lookup"><span data-stu-id="6da7e-140">In addition, you can set the <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> property or the <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> property to `true` to permit WCF clients to obtain information about internal service operation exceptions.</span></span> <span data-ttu-id="6da7e-141">El envío de errores individuales y el establecimiento de las propiedades de comportamiento de depuración se describen en [envío y recepción de errores](sending-and-receiving-faults.md).</span><span class="sxs-lookup"><span data-stu-id="6da7e-141">Both sending individual faults and setting the debugging behavior properties are described in [Sending and Receiving Faults](sending-and-receiving-faults.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="6da7e-142">Dado que las excepciones administradas pueden exponer información interna de la aplicación, establecer <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> o <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> en `true` puede permitir que los clientes de WCF obtengan información sobre las excepciones de operaciones de servicio internas, incluida la información de identificación personal u otra información confidencial.</span><span class="sxs-lookup"><span data-stu-id="6da7e-142">Because managed exceptions can expose internal application information, setting <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> to `true` can permit WCF clients to obtain information about internal service operation exceptions, including personally identifiable or other sensitive information.</span></span>
>
> <span data-ttu-id="6da7e-143">Por consiguiente, establecer <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> o <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> en `true` solo se recomienda como una manera de depurar temporalmente una aplicación de servicio.</span><span class="sxs-lookup"><span data-stu-id="6da7e-143">Therefore, setting <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> to `true` is recommended only as a way to temporarily debug a service application.</span></span> <span data-ttu-id="6da7e-144">Además, el WSDL de un método que devuelve excepciones administradas no controladas de esta manera no contiene el contrato para la <xref:System.ServiceModel.FaultException%601> de tipo <xref:System.ServiceModel.ExceptionDetail>.</span><span class="sxs-lookup"><span data-stu-id="6da7e-144">In addition, the WSDL for a method that returns unhandled managed exceptions in this way does not contain the contract for the <xref:System.ServiceModel.FaultException%601> of type <xref:System.ServiceModel.ExceptionDetail>.</span></span> <span data-ttu-id="6da7e-145">Los clientes deben esperar la posibilidad de un error de SOAP desconocido (devuelto a los clientes de WCF como <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> objetos) para obtener la información de depuración correctamente.</span><span class="sxs-lookup"><span data-stu-id="6da7e-145">Clients must expect the possibility of an unknown SOAP fault (returned to WCF clients as <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> objects) to obtain the debugging information properly.</span></span>

## <a name="customizing-error-handling-with-ierrorhandler"></a><span data-ttu-id="6da7e-146">Personalización del control de errores con IErrorHandler</span><span class="sxs-lookup"><span data-stu-id="6da7e-146">Customizing Error Handling with IErrorHandler</span></span>

<span data-ttu-id="6da7e-147">Si tiene requisitos especiales para personalizar el mensaje de respuesta al cliente cuando se produzca una excepción en el nivel de aplicación o para realizar algún procesamiento personalizado una vez devuelto el mensaje de respuesta, implemente la interfaz  <xref:System.ServiceModel.Dispatcher.IErrorHandler?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="6da7e-147">If you have special requirements to either customize the response message to the client when an application-level exception happens or perform some custom processing after the response message is returned, implement the <xref:System.ServiceModel.Dispatcher.IErrorHandler?displayProperty=nameWithType> interface.</span></span>

## <a name="fault-serialization-issues"></a><span data-ttu-id="6da7e-148">Problemas de serialización de error</span><span class="sxs-lookup"><span data-stu-id="6da7e-148">Fault Serialization Issues</span></span>

<span data-ttu-id="6da7e-149">Cuando se deserializa un contrato de error, primero WCF intenta hacer coincidir el nombre del contrato de error del mensaje SOAP con el tipo de contrato de error.</span><span class="sxs-lookup"><span data-stu-id="6da7e-149">When deserializing a fault contract, WCF first attempts to match the fault contract name in the SOAP message with the fault contract type.</span></span> <span data-ttu-id="6da7e-150">Si no puede encontrar una coincidencia exacta, buscará en orden alfabético un tipo compatible en la lista de contratos de error disponibles.</span><span class="sxs-lookup"><span data-stu-id="6da7e-150">If it cannot find an exact match it will then search the list of available fault contracts in alphabetical order for a compatible type.</span></span> <span data-ttu-id="6da7e-151">Si dos contratos de error tienen tipos compatibles (uno es una subclase del otro, por ejemplo), se puede usar el tipo incorrecto para deserializar el error.</span><span class="sxs-lookup"><span data-stu-id="6da7e-151">If two fault contracts are compatible types (one is a subclass of another, for example) the wrong type may be used to de-serialize the fault.</span></span> <span data-ttu-id="6da7e-152">Esto solo ocurre si el contrato de error no especifica ningún nombre, espacio de nombres ni acción.</span><span class="sxs-lookup"><span data-stu-id="6da7e-152">This only occurs if the fault contract does not specify a name, namespace, and action.</span></span> <span data-ttu-id="6da7e-153">Para evitar que se produzca este problema, califique siempre completamente los contratos de error especificando los atributos de nombre, espacio de nombres y acción.</span><span class="sxs-lookup"><span data-stu-id="6da7e-153">To prevent this issue from occurring, always fully qualify fault contracts by specifying the name, namespace, and action attributes.</span></span> <span data-ttu-id="6da7e-154">Además, si ha definido muchos contratos de error relacionados derivados de una clase base compartida, asegúrese de marcar todos los miembros nuevos con `[DataMember(IsRequired=true)]`.</span><span class="sxs-lookup"><span data-stu-id="6da7e-154">Additionally if you have defined a number of related fault contracts derived from a shared base class, make sure to mark any new members with `[DataMember(IsRequired=true)]`.</span></span> <span data-ttu-id="6da7e-155">Para obtener más información sobre este atributo `IsRequired`, vea <xref:System.Runtime.Serialization.DataMemberAttribute>.</span><span class="sxs-lookup"><span data-stu-id="6da7e-155">For more information on this `IsRequired` attribute see, <xref:System.Runtime.Serialization.DataMemberAttribute>.</span></span> <span data-ttu-id="6da7e-156">De esta forma, se evitará que una clase base sea de un tipo compatible y forzará la deserialización del error en el tipo derivado correcto.</span><span class="sxs-lookup"><span data-stu-id="6da7e-156">This will prevent a base class from being a compatible type and force the fault to be deserialized into the correct derived type.</span></span>

## <a name="see-also"></a><span data-ttu-id="6da7e-157">Vea también</span><span class="sxs-lookup"><span data-stu-id="6da7e-157">See also</span></span>

- <xref:System.ServiceModel.FaultException>
- <xref:System.ServiceModel.FaultContractAttribute>
- <xref:System.ServiceModel.FaultException>
- <xref:System.Xml.Serialization.XmlSerializer>
- <xref:System.ServiceModel.XmlSerializerFormatAttribute>
- <xref:System.ServiceModel.FaultContractAttribute>
- <xref:System.ServiceModel.CommunicationException>
- <xref:System.ServiceModel.FaultContractAttribute.Action%2A>
- <xref:System.ServiceModel.FaultException.Code%2A>
- <xref:System.ServiceModel.FaultException.Reason%2A>
- <xref:System.ServiceModel.FaultCode.SubCode%2A>
- <xref:System.ServiceModel.OperationContractAttribute.IsOneWay%2A>
- [<span data-ttu-id="6da7e-158">Definición y especificación de errores</span><span class="sxs-lookup"><span data-stu-id="6da7e-158">Defining and Specifying Faults</span></span>](defining-and-specifying-faults.md)
