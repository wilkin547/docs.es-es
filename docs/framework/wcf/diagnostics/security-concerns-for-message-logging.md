---
title: Riesgos de seguridad relativos al registro de mensajes
ms.date: 03/30/2017
ms.assetid: 21f513f2-815b-47f3-85a6-03c008510038
ms.openlocfilehash: 679975be44244f10232b805a6cc2776b48ed6058
ms.sourcegitcommit: 7e2128d4a4c45b4274bea3b8e5760d4694569ca1
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/14/2020
ms.locfileid: "75935766"
---
# <a name="security-concerns-for-message-logging"></a><span data-ttu-id="40cee-102">Riesgos de seguridad relativos al registro de mensajes</span><span class="sxs-lookup"><span data-stu-id="40cee-102">Security Concerns for Message Logging</span></span>
<span data-ttu-id="40cee-103">En este tema se describe cómo puede proteger los datos confidenciales para que no se expongan en registros de mensajes, así como los eventos generados por el registro de mensajes.</span><span class="sxs-lookup"><span data-stu-id="40cee-103">This topic describes how you can protect sensitive data from being exposed in message logs, as well as events generated by message logging.</span></span>  
  
## <a name="security-concerns"></a><span data-ttu-id="40cee-104">Cuestiones de seguridad</span><span class="sxs-lookup"><span data-stu-id="40cee-104">Security Concerns</span></span>  
  
### <a name="logging-sensitive-information"></a><span data-ttu-id="40cee-105">Registrar información confidencial</span><span class="sxs-lookup"><span data-stu-id="40cee-105">Logging Sensitive Information</span></span>  
 <span data-ttu-id="40cee-106">Windows Communication Foundation (WCF) no modifica ningún dato en los encabezados y el cuerpo específicos de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="40cee-106">Windows Communication Foundation (WCF) does not modify any data in application-specific headers and body.</span></span> <span data-ttu-id="40cee-107">WCF tampoco realiza un seguimiento de la información personal en encabezados específicos de la aplicación o en datos de cuerpo.</span><span class="sxs-lookup"><span data-stu-id="40cee-107">WCF also does not track personal information in application-specific headers or body data.</span></span>  
  
 <span data-ttu-id="40cee-108">Cuando el registro de mensajes está habilitado, la información personal en encabezados específicos de la aplicación, como una cadena de consulta; e información del cuerpo, como un número de tarjeta de crédito, se puede volver visible en los registros.</span><span class="sxs-lookup"><span data-stu-id="40cee-108">When message logging is enabled, personal information in application-specific headers, such as, a query string; and body information, such as, a credit card number, can become visible in the logs.</span></span> <span data-ttu-id="40cee-109">El implementador de la aplicación es el responsable de exigir el control de acceso en los archivos de registro y configuración.</span><span class="sxs-lookup"><span data-stu-id="40cee-109">The application deployer is responsible for enforcing access control on the configuration and log files.</span></span> <span data-ttu-id="40cee-110">Si no desea que este tipo de información sea visible, debería deshabilitar el registro o filtrar parte de los datos si desea compartir los registros.</span><span class="sxs-lookup"><span data-stu-id="40cee-110">If you do not want this kind of information to be visible, you should disable logging, or filter out part of the data if you want to share the logs.</span></span>  
  
 <span data-ttu-id="40cee-111">Las sugerencias siguientes pueden ayudarle a evitar que se exponga el contenido de un archivo de registro involuntariamente:</span><span class="sxs-lookup"><span data-stu-id="40cee-111">The following tips can help you to prevent the content of a log file from being exposed unintentionally:</span></span>  
  
- <span data-ttu-id="40cee-112">Asegúrese de que los archivos de registro estén protegidos mediante listas de control de acceso (ACL) tanto en host de web y como en escenarios de host propio.</span><span class="sxs-lookup"><span data-stu-id="40cee-112">Ensure that the log files are protected by Access Control Lists (ACL) both in Web-host and self-host scenarios.</span></span>  
  
- <span data-ttu-id="40cee-113">Elija una extensión de archivo que no se pueda servir fácilmente utilizando una solicitud web.</span><span class="sxs-lookup"><span data-stu-id="40cee-113">Choose a file extension that cannot be easily served using a Web request.</span></span> <span data-ttu-id="40cee-114">Por ejemplo, la extensión de archivo .xml no es una opción segura.</span><span class="sxs-lookup"><span data-stu-id="40cee-114">For example, the .xml file extension is not a safe choice.</span></span> <span data-ttu-id="40cee-115">Puede comprobar la guía de administración de Internet Information Services (IIS) para ver una lista de extensiones que se pueden servir.</span><span class="sxs-lookup"><span data-stu-id="40cee-115">You can check the Internet Information Services (IIS) administration guide to see a list of extensions that can be served.</span></span>  
  
- <span data-ttu-id="40cee-116">Especifique una ruta de acceso absoluta para la ubicación del archivo de registro, que debería estar fuera del directorio público raíz de Web host para evitar que una parte externa obtenga acceso utilizando un explorador web.</span><span class="sxs-lookup"><span data-stu-id="40cee-116">Specify an absolute path for the log file location, which should be outside of the Web host vroot public directory to prevent it from being accessed by an external party using a Web browser.</span></span>  
  
 <span data-ttu-id="40cee-117">De forma predeterminada, las claves e información personal identificable (PII) como nombre de usuario y contraseña no están registradas en trazas y los mensajes registrados.</span><span class="sxs-lookup"><span data-stu-id="40cee-117">By default, keys and personally identifiable information (PII) such as username and password are not logged in traces and logged messages.</span></span> <span data-ttu-id="40cee-118">Sin embargo, un administrador del equipo puede utilizar el atributo `enableLoggingKnownPII` en el elemento `machineSettings` del archivo Machine.config para permitir que las aplicaciones que se ejecutan en el equipo registren información personal identificable (PII) conocida.</span><span class="sxs-lookup"><span data-stu-id="40cee-118">A machine administrator, however, can use the `enableLoggingKnownPII` attribute in the `machineSettings` element of the Machine.config file to permit applications running on the machine to log known personally identifiable information (PII).</span></span> <span data-ttu-id="40cee-119">La siguiente configuración muestra cómo realizar esto:</span><span class="sxs-lookup"><span data-stu-id="40cee-119">The following configuration demonstrates how to do this:</span></span>  
  
```xml  
<configuration>  
   <system.serviceModel>  
      <machineSettings enableLoggingKnownPii="true"/>  
   </system.serviceModel>  
</configuration>   
```  
  
 <span data-ttu-id="40cee-120">Un implementador de aplicación puede utilizar el atributo `logKnownPii` en el archivo App.config o Web.config para permitir que PII se registre como sigue:</span><span class="sxs-lookup"><span data-stu-id="40cee-120">An application deployer can then use the `logKnownPii` attribute in either the App.config or Web.config file to enable PII logging as follows:</span></span>  
  
```xml  
<system.diagnostics>  
  <sources>  
      <source name="System.ServiceModel.MessageLogging"  
        logKnownPii="true">  
        <listeners>  
                 <add name="messages"  
                 type="System.Diagnostics.XmlWriterTraceListener"  
                 initializeData="c:\logs\messages.svclog" />  
          </listeners>  
      </source>  
    </sources>  
</system.diagnostics>  
```  
  
 <span data-ttu-id="40cee-121">Solo cuando ambos valores son `true` está habilitado el registro de PII.</span><span class="sxs-lookup"><span data-stu-id="40cee-121">Only when both settings are `true` is PII logging enabled.</span></span> <span data-ttu-id="40cee-122">La combinación de dos modificadores permite la flexibilidad de registrar la PII conocida para cada aplicación.</span><span class="sxs-lookup"><span data-stu-id="40cee-122">The combination of two switches allows the flexibility to log known PII for each application.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="40cee-123">En [!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)] las marcas `logEntireMessage` y `logKnownPii` también se deben establecer en `true` en el archivo Web.config o en el archivo App.config para habilitar el registro de PII, como se muestra en el siguiente ejemplo `<system.serviceModel><messageLogging logEntireMessage="true" logKnownPii="true" …`.</span><span class="sxs-lookup"><span data-stu-id="40cee-123">In [!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)] the `logEntireMessage` and `logKnownPii` flags must also be set to `true` in the Web.config file or the App.config file to enable PII logging, as show in the following example `<system.serviceModel><messageLogging logEntireMessage="true" logKnownPii="true" …`.</span></span>  
  
 <span data-ttu-id="40cee-124">Debe ser consciente de que si especifica dos o más orígenes personalizados en un archivo de configuración, solo se leen los atributos del primer origen.</span><span class="sxs-lookup"><span data-stu-id="40cee-124">You should be aware that if you specify two or more custom sources in a configuration file, only the attributes of the first source are read.</span></span> <span data-ttu-id="40cee-125">Los otros se ignoran.</span><span class="sxs-lookup"><span data-stu-id="40cee-125">The others are ignored.</span></span> <span data-ttu-id="40cee-126">Esto significa que, para el archivo App.config siguiente, PII no se registra para ambos orígenes incluso aunque el registro de PII esté explícitamente habilitado para el segundo origen.</span><span class="sxs-lookup"><span data-stu-id="40cee-126">This means that, for the following App.config, file, PII is not logged for both sources even though PII logging is explicitly enabled for the second source.</span></span>  
  
```xml  
<system.diagnostics>  
   <sources>  
      <source name="System.ServiceModel.MessageLogging"  
              logKnownPii="false">  
              <listeners>  
                 <add name="messages"  
                      type="System.Diagnostics.XmlWriterTraceListener"  
                      initializeData="c:\logs\messages.svclog" />  
              </listeners>  
            </source>  
      <source name="System.ServiceModel"   
              logKnownPii="true">  
              <listeners>  
                 <add name="traces"  
                      type="System.Diagnostics.XmlWriterTraceListener"  
                      initializeData="c:\logs\traces.svclog" />  
              </listeners>  
      </source>  
   </sources>  
</system.diagnostics>  
```  
  
 <span data-ttu-id="40cee-127">Si el elemento `<machineSettings enableLoggingKnownPii="Boolean"/>`<xref:System.Configuration.ConfigurationErrorsException> existe fuera del archivo Machine.config, el sistema inicia.</span><span class="sxs-lookup"><span data-stu-id="40cee-127">If the `<machineSettings enableLoggingKnownPii="Boolean"/>` element exists outside the Machine.config file, the system throws a <xref:System.Configuration.ConfigurationErrorsException>.</span></span>  
  
 <span data-ttu-id="40cee-128">Los cambios solo son efectivos cuando la aplicación se inicia o reinicia.</span><span class="sxs-lookup"><span data-stu-id="40cee-128">The changes are effective only when the application starts or restarts.</span></span> <span data-ttu-id="40cee-129">Un evento está registrado en el inicio cuando ambos atributos están establecidos en `true`.</span><span class="sxs-lookup"><span data-stu-id="40cee-129">An event is logged at startup when both attributes are set to `true`.</span></span> <span data-ttu-id="40cee-130">Un evento también está registrado si `logKnownPii` está establecido en `true` pero `enableLoggingKnownPii` es `false`.</span><span class="sxs-lookup"><span data-stu-id="40cee-130">An event is also logged if `logKnownPii` is set to `true` but `enableLoggingKnownPii` is `false`.</span></span>  
  
 <span data-ttu-id="40cee-131">El administrador del equipo e implementador de la aplicación debería ejercer una precaución extrema al utilizar estos dos modificadores.</span><span class="sxs-lookup"><span data-stu-id="40cee-131">The machine administrator and application deployer should exercise extreme caution when using these two switches.</span></span> <span data-ttu-id="40cee-132">Si el registro de PII está habilitado, las claves de seguridad y PII están registradas.</span><span class="sxs-lookup"><span data-stu-id="40cee-132">If PII logging is enabled, security keys and PII are logged.</span></span> <span data-ttu-id="40cee-133">Si está deshabilitado, los datos sensibles y específicos de la aplicación todavía están registrados en encabezados del mensaje y cuerpos.</span><span class="sxs-lookup"><span data-stu-id="40cee-133">If it is disabled, sensitive and application-specific data is still logged in message headers and bodies.</span></span> <span data-ttu-id="40cee-134">Para obtener una explicación más detallada sobre la privacidad y la protección de PII, vea privacidad de los [usuarios](https://docs.microsoft.com/previous-versions/dotnet/articles/aa480490(v=msdn.10)).</span><span class="sxs-lookup"><span data-stu-id="40cee-134">For a more thorough discussion about privacy and protecting PII from being exposed, see [User Privacy](https://docs.microsoft.com/previous-versions/dotnet/articles/aa480490(v=msdn.10)).</span></span>  
  
> [!CAUTION]
> <span data-ttu-id="40cee-135">PII no se oculta en mensajes incorrectos.</span><span class="sxs-lookup"><span data-stu-id="40cee-135">PII is not hidden in malformed messages.</span></span> <span data-ttu-id="40cee-136">Tales mensajes se registran tal cual sin ninguna modificación.</span><span class="sxs-lookup"><span data-stu-id="40cee-136">Such messaged are logged as-is without any modification.</span></span> <span data-ttu-id="40cee-137">Los atributos mencionados previamente no tienen ningún efecto sobre esto.</span><span class="sxs-lookup"><span data-stu-id="40cee-137">Attributes mentioned previously have no effect on this.</span></span>  
  
### <a name="custom-trace-listener"></a><span data-ttu-id="40cee-138">Agente de escucha de traza personalizado</span><span class="sxs-lookup"><span data-stu-id="40cee-138">Custom Trace Listener</span></span>  
 <span data-ttu-id="40cee-139">Agregar un agente de escucha de traza personalizado en el origen de traza del registro de mensajes es un privilegio que debe estar restringido al administrador.</span><span class="sxs-lookup"><span data-stu-id="40cee-139">Adding a custom trace listener on the Message Logging trace source is a privilege that should be restricted to the administrator.</span></span> <span data-ttu-id="40cee-140">Esto se debe a que los agentes de escucha personalizados malintencionados se pueden configurar para enviar mensajes remotamente, lo que conduce a la divulgación de información confidencial.</span><span class="sxs-lookup"><span data-stu-id="40cee-140">This is because malicious custom listeners can be configured to send messages remotely, which leads to sensitive information disclosure.</span></span> <span data-ttu-id="40cee-141">Además, si configura un agente de escucha personalizado para enviar mensajes en la conexión, como, por ejemplo, a una base de datos remota, debería exigir un control de acceso apropiado en los registros de mensajes en el equipo remoto.</span><span class="sxs-lookup"><span data-stu-id="40cee-141">In addition, if you configure a custom listener to send messages on the wire, such as, to a remote database, you should enforce proper access control on the message logs in the remote machine.</span></span>  
  
## <a name="events-triggered-by-message-logging"></a><span data-ttu-id="40cee-142">Eventos activados mediante el registro de mensajes</span><span class="sxs-lookup"><span data-stu-id="40cee-142">Events Triggered by Message Logging</span></span>  
 <span data-ttu-id="40cee-143">La siguiente es una lista de todos los eventos emitidos por el registro de mensajes.</span><span class="sxs-lookup"><span data-stu-id="40cee-143">The following lists all the events emitted by message logging.</span></span>  
  
- <span data-ttu-id="40cee-144">Registro de mensajes activado: se emite este evento cuando el registro de mensajes está habilitado en la configuración o a través de WMI.</span><span class="sxs-lookup"><span data-stu-id="40cee-144">Message logging on: This event is emitted when message logging is enabled in configuration, or through WMI.</span></span> <span data-ttu-id="40cee-145">El contenido del evento es “Se ha activado el registro de mensajes.</span><span class="sxs-lookup"><span data-stu-id="40cee-145">The content of the event is "Message logging has been turned on.</span></span> <span data-ttu-id="40cee-146">Puede que se registre información confidencial en texto no cifrado, incluso aunque estuviesen cifrados en la conexión, por ejemplo, los cuerpos de mensajes”.</span><span class="sxs-lookup"><span data-stu-id="40cee-146">Sensitive information may be logged in clear text, even if they were encrypted on the wire, for example, message bodies."</span></span>  
  
- <span data-ttu-id="40cee-147">Registro de mensajes desactivado: se emite este evento cuando el registro de mensajes se deshabilita a través de WMI.</span><span class="sxs-lookup"><span data-stu-id="40cee-147">Message logging off: This event is emitted when message logging is disabled through WMI.</span></span> <span data-ttu-id="40cee-148">El contenido del evento es “Se ha desactivado el registro de mensajes”.</span><span class="sxs-lookup"><span data-stu-id="40cee-148">The content of the event is "Message logging has been turned off."</span></span>  
  
- <span data-ttu-id="40cee-149">Registro PII conocido activado: se emite este evento cuando el registro de PII conocido está habilitado.</span><span class="sxs-lookup"><span data-stu-id="40cee-149">Log Known PII On: This event is emitted when logging of known PII is enabled.</span></span> <span data-ttu-id="40cee-150">Esto sucede cuando el atributo `enableLoggingKnownPii` del elemento `machineSettings` del archivo Machine. config se establece en `true`y el atributo `logKnownPii` del elemento `source` en el archivo app. config o Web. config se establece en `true`.</span><span class="sxs-lookup"><span data-stu-id="40cee-150">This happens when the `enableLoggingKnownPii` attribute in the `machineSettings` element of the Machine.config file is set to `true`, and the `logKnownPii` attribute of the `source` element in either the App.config or Web.config file is set to `true`.</span></span>  
  
- <span data-ttu-id="40cee-151">Registro de PII conocido no permitido: se emite este evento cuando no se permite el registro de PII conocido.</span><span class="sxs-lookup"><span data-stu-id="40cee-151">Log Known PII Not Allowed: This event is emitted when logging of known PII is not allowed.</span></span> <span data-ttu-id="40cee-152">Esto sucede cuando el atributo `logKnownPii` del elemento `source` en el archivo app. config o Web. config está establecido en `true`, pero el atributo `enableLoggingKnownPii` del elemento `machineSettings` del archivo Machine. config se establece en `false`.</span><span class="sxs-lookup"><span data-stu-id="40cee-152">This happens when the `logKnownPii` attribute of the `source` element in either the App.config or Web.config file is set to `true`, but the `enableLoggingKnownPii` attribute in the `machineSettings` element of the Machine.config file is set to `false`.</span></span> <span data-ttu-id="40cee-153">No se inicia ninguna excepción.</span><span class="sxs-lookup"><span data-stu-id="40cee-153">No exception is thrown.</span></span>  
  
 <span data-ttu-id="40cee-154">Estos eventos se pueden ver en la herramienta Visor de eventos que viene con Windows.</span><span class="sxs-lookup"><span data-stu-id="40cee-154">These events can be viewed in the Event Viewer tool that comes with Windows.</span></span> <span data-ttu-id="40cee-155">Para obtener más información sobre esto, vea [registro de eventos](./event-logging/index.md).</span><span class="sxs-lookup"><span data-stu-id="40cee-155">For more information on this, see [Event Logging](./event-logging/index.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="40cee-156">Vea también</span><span class="sxs-lookup"><span data-stu-id="40cee-156">See also</span></span>

- [<span data-ttu-id="40cee-157">Registro de mensajes</span><span class="sxs-lookup"><span data-stu-id="40cee-157">Message Logging</span></span>](message-logging.md)
- [<span data-ttu-id="40cee-158">Riesgos de seguridad y sugerencias útiles para el seguimiento</span><span class="sxs-lookup"><span data-stu-id="40cee-158">Security Concerns and Useful Tips for Tracing</span></span>](./tracing/security-concerns-and-useful-tips-for-tracing.md)
