---
description: 'Más información acerca de: actualizaciones de secuencias personalizadas'
title: Actualizaciones personalizadas de secuencias
ms.date: 03/30/2017
ms.assetid: e3da85c8-57f3-4e32-a4cb-50123f30fea6
ms.openlocfilehash: fe52b99de382d5a5d5b41a0bff2c4a9a7698f6f5
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/06/2021
ms.locfileid: "99735249"
---
# <a name="custom-stream-upgrades"></a><span data-ttu-id="cabeb-103">Actualizaciones personalizadas de secuencias</span><span class="sxs-lookup"><span data-stu-id="cabeb-103">Custom Stream Upgrades</span></span>

<span data-ttu-id="cabeb-104">Los transportes orientados a secuencia como TCP y las canalizaciones con nombre funcionan en una secuencia continua de bytes entre el cliente y servidor.</span><span class="sxs-lookup"><span data-stu-id="cabeb-104">Stream-oriented transports such as TCP and Named Pipes operate on a continuous stream of bytes between the client and server.</span></span> <span data-ttu-id="cabeb-105">Esta secuencia la realiza un objeto <xref:System.IO.Stream>.</span><span class="sxs-lookup"><span data-stu-id="cabeb-105">This stream is realized by a  <xref:System.IO.Stream> object.</span></span> <span data-ttu-id="cabeb-106">En una actualización de secuencia, el cliente desea agregar una capa de protocolo opcional a la pila del canal y pide al otro lado del canal de comunicación que lo haga.</span><span class="sxs-lookup"><span data-stu-id="cabeb-106">In a stream upgrade, the client wants to add an optional protocol layer to the channel stack, and asks the other end of the communication channel to do so.</span></span> <span data-ttu-id="cabeb-107">La actualización de secuencia consiste en reemplazar el objeto <xref:System.IO.Stream> original con uno actualizado.</span><span class="sxs-lookup"><span data-stu-id="cabeb-107">The stream upgrade consists in replacing the original <xref:System.IO.Stream> object with an upgraded one.</span></span>  
  
 <span data-ttu-id="cabeb-108">Por ejemplo, puede crear directamente una secuencia de compresión encima de la secuencia de transporte.</span><span class="sxs-lookup"><span data-stu-id="cabeb-108">For example, you can build a compression stream directly on top of the transport stream.</span></span> <span data-ttu-id="cabeb-109">En este caso, el transporte <xref:System.IO.Stream> original se reemplaza con uno que encapsula la compresión <xref:System.IO.Stream> alrededor del original.</span><span class="sxs-lookup"><span data-stu-id="cabeb-109">In this case the original transport <xref:System.IO.Stream> is replaced with one that wraps the compression <xref:System.IO.Stream> around the original one.</span></span>  
  
 <span data-ttu-id="cabeb-110">Puede aplicar varias actualizaciones de secuencia, cada una que encapsule a la precedente.</span><span class="sxs-lookup"><span data-stu-id="cabeb-110">You can apply multiple stream upgrades, each wrapping the preceding one.</span></span>  
  
## <a name="how-stream-upgrades-work"></a><span data-ttu-id="cabeb-111">Cómo funcionan las actualizaciones de secuencia</span><span class="sxs-lookup"><span data-stu-id="cabeb-111">How Stream Upgrades Work</span></span>  

 <span data-ttu-id="cabeb-112">Hay cuatro componentes en el proceso de actualización de secuencia.</span><span class="sxs-lookup"><span data-stu-id="cabeb-112">There are four components to the stream upgrade process.</span></span>  
  
1. <span data-ttu-id="cabeb-113">Un *iniciador* de flujo de actualización comienza el proceso: en tiempo de ejecución puede iniciar una solicitud al otro extremo de su conexión para actualizar la capa de transporte del canal.</span><span class="sxs-lookup"><span data-stu-id="cabeb-113">An upgrade stream *Initiator* begins the process: at run-time it can initiate a request to the other end of its connection to upgrade the channel transport layer.</span></span>  
  
2. <span data-ttu-id="cabeb-114">Un *aceptador* de flujos de actualización lleva a cabo la actualización: en tiempo de ejecución recibe la solicitud de actualización desde el otro equipo y, si es posible, acepta la actualización.</span><span class="sxs-lookup"><span data-stu-id="cabeb-114">An upgrade stream *Acceptor* carries out the upgrade: at run-time it receives the upgrade request from the other machine, and if possible, accepts the upgrade.</span></span>  
  
3. <span data-ttu-id="cabeb-115">Un *proveedor* de actualización crea el *iniciador* en el cliente y el *aceptador* en el servidor.</span><span class="sxs-lookup"><span data-stu-id="cabeb-115">An upgrade *Provider* creates the *Initiator* on the client and the *Acceptor* on the server.</span></span>  
  
4. <span data-ttu-id="cabeb-116">Se agrega un *elemento de enlace* de actualización de secuencia a los enlaces en el servicio y el cliente, y se crea el proveedor en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="cabeb-116">A stream upgrade *Binding Element* is added to the bindings on the service and the client, and creates the provider at runtime.</span></span>  
  
 <span data-ttu-id="cabeb-117">Observe que en el caso de varias actualizaciones, el iniciador y aceptador encapsulan las máquinas de estado para exigir qué transiciones de actualización son válidas para cada iniciación.</span><span class="sxs-lookup"><span data-stu-id="cabeb-117">Note that in the case of multiple upgrades, the Initiator and Acceptor encapsulate state machines to enforce which upgrade transitions are valid for each Initiation.</span></span>  
  
## <a name="how-to-implement-a-stream-upgrade"></a><span data-ttu-id="cabeb-118">Cómo implementar una actualización de secuencia</span><span class="sxs-lookup"><span data-stu-id="cabeb-118">How to Implement a Stream Upgrade</span></span>  

 <span data-ttu-id="cabeb-119">Windows Communication Foundation (WCF) proporciona cuatro `abstract` clases que se pueden implementar:</span><span class="sxs-lookup"><span data-stu-id="cabeb-119">Windows Communication Foundation (WCF) provides four `abstract` classes that you can implement:</span></span>  
  
- <xref:System.ServiceModel.Channels.StreamUpgradeInitiator?displayProperty=nameWithType>  
  
- <xref:System.ServiceModel.Channels.StreamUpgradeAcceptor?displayProperty=nameWithType>  
  
- <xref:System.ServiceModel.Channels.StreamUpgradeProvider?displayProperty=nameWithType>  
  
- <xref:System.ServiceModel.Channels.StreamUpgradeBindingElement?displayProperty=nameWithType>  
  
 <span data-ttu-id="cabeb-120">Para implementar una actualización de secuencia personalizada, haga lo siguiente.</span><span class="sxs-lookup"><span data-stu-id="cabeb-120">To implement a custom stream upgrade, do the following.</span></span> <span data-ttu-id="cabeb-121">Este procedimiento implementa un proceso de actualización de secuencia mínimo en los equipos del servidor y del cliente.</span><span class="sxs-lookup"><span data-stu-id="cabeb-121">This procedure implements a minimal stream upgrade process on both the client and server machines.</span></span>  
  
1. <span data-ttu-id="cabeb-122">Cree una clase que implemente <xref:System.ServiceModel.Channels.StreamUpgradeInitiator>.</span><span class="sxs-lookup"><span data-stu-id="cabeb-122">Create a class that implements <xref:System.ServiceModel.Channels.StreamUpgradeInitiator>.</span></span>  
  
    1. <span data-ttu-id="cabeb-123">Invalide el método <xref:System.ServiceModel.Channels.StreamUpgradeInitiator.InitiateUpgrade%2A> para tomar la secuencia que se va a actualizar y devuelva la secuencia actualizada.</span><span class="sxs-lookup"><span data-stu-id="cabeb-123">Override the <xref:System.ServiceModel.Channels.StreamUpgradeInitiator.InitiateUpgrade%2A> method to take in the stream to be upgraded, and return the upgraded stream.</span></span> <span data-ttu-id="cabeb-124">Este método funciona sincrónicamente; hay métodos análogos para iniciar de forma asincrónica la actualización.</span><span class="sxs-lookup"><span data-stu-id="cabeb-124">This method works synchronously; there are analogous methods to initiate the upgrade asynchronously.</span></span>  
  
    2. <span data-ttu-id="cabeb-125">Invalide el método <xref:System.ServiceModel.Channels.StreamUpgradeInitiator.GetNextUpgrade%2A> para comprobar las actualizaciones adicionales.</span><span class="sxs-lookup"><span data-stu-id="cabeb-125">Override the <xref:System.ServiceModel.Channels.StreamUpgradeInitiator.GetNextUpgrade%2A> method to check for additional upgrades.</span></span>  
  
2. <span data-ttu-id="cabeb-126">Cree una clase que implemente <xref:System.ServiceModel.Channels.StreamUpgradeAcceptor>.</span><span class="sxs-lookup"><span data-stu-id="cabeb-126">Create a class that implements <xref:System.ServiceModel.Channels.StreamUpgradeAcceptor>.</span></span>  
  
    1. <span data-ttu-id="cabeb-127">Invalide el método <xref:System.ServiceModel.Channels.StreamUpgradeAcceptor.AcceptUpgrade%2A> para tomar la secuencia que se va a actualizar y devuelva la secuencia actualizada.</span><span class="sxs-lookup"><span data-stu-id="cabeb-127">Override the <xref:System.ServiceModel.Channels.StreamUpgradeAcceptor.AcceptUpgrade%2A> method to take in the stream to be upgraded, and return the upgraded stream.</span></span> <span data-ttu-id="cabeb-128">Este método funciona sincrónicamente; hay métodos análogos para aceptar de forma asincrónica la actualización.</span><span class="sxs-lookup"><span data-stu-id="cabeb-128">This method works synchronously; there are analogous methods to accept the upgrade asynchronously.</span></span>  
  
    2. <span data-ttu-id="cabeb-129">Invalide el método <xref:System.ServiceModel.Channels.StreamUpgradeAcceptor.CanUpgrade%2A> para determinar si este aceptador de actualización admite la actualización solicitada en el proceso de actualización.</span><span class="sxs-lookup"><span data-stu-id="cabeb-129">Override the <xref:System.ServiceModel.Channels.StreamUpgradeAcceptor.CanUpgrade%2A> method to determine if the upgrade requested is supported by this upgrade acceptor at this point in the upgrade process.</span></span>  
  
3. <span data-ttu-id="cabeb-130">Cree una clase que implemente <xref:System.ServiceModel.Channels.StreamUpgradeProvider>.</span><span class="sxs-lookup"><span data-stu-id="cabeb-130">Create a class the implements <xref:System.ServiceModel.Channels.StreamUpgradeProvider>.</span></span> <span data-ttu-id="cabeb-131">Invalide los métodos <xref:System.ServiceModel.Channels.StreamUpgradeProvider.CreateUpgradeAcceptor%2A> y <xref:System.ServiceModel.Channels.StreamUpgradeProvider.CreateUpgradeInitiator%2A> para devolver las instancias del aceptador e iniciador definidas en los pasos 2 y 1.</span><span class="sxs-lookup"><span data-stu-id="cabeb-131">Override the <xref:System.ServiceModel.Channels.StreamUpgradeProvider.CreateUpgradeAcceptor%2A> and the <xref:System.ServiceModel.Channels.StreamUpgradeProvider.CreateUpgradeInitiator%2A> methods to return instances of the acceptor and initiator defined in steps 2 and 1.</span></span>  
  
4. <span data-ttu-id="cabeb-132">Cree una clase que implemente <xref:System.ServiceModel.Channels.StreamUpgradeBindingElement>.</span><span class="sxs-lookup"><span data-stu-id="cabeb-132">Create a class that implements <xref:System.ServiceModel.Channels.StreamUpgradeBindingElement>.</span></span>  
  
    1. <span data-ttu-id="cabeb-133">Invalide el método <xref:System.ServiceModel.Channels.StreamUpgradeBindingElement.BuildClientStreamUpgradeProvider%2A> en el cliente y el método <xref:System.ServiceModel.Channels.StreamUpgradeBindingElement.BuildServerStreamUpgradeProvider%2A> en el servicio.</span><span class="sxs-lookup"><span data-stu-id="cabeb-133">Override the <xref:System.ServiceModel.Channels.StreamUpgradeBindingElement.BuildClientStreamUpgradeProvider%2A> method on the client and the <xref:System.ServiceModel.Channels.StreamUpgradeBindingElement.BuildServerStreamUpgradeProvider%2A> method on the service.</span></span>  
  
    2. <span data-ttu-id="cabeb-134">Invalide el método <xref:System.ServiceModel.Channels.BindingElement.BuildChannelFactory%2A> en el cliente y el método <xref:System.ServiceModel.Channels.BindingElement.BuildChannelListener%2A> en el servicio para agregar la actualización Elemento de enlace a <xref:System.ServiceModel.Channels.BindingContext.BindingParameters%2A>.</span><span class="sxs-lookup"><span data-stu-id="cabeb-134">Override the <xref:System.ServiceModel.Channels.BindingElement.BuildChannelFactory%2A> method on the client and the <xref:System.ServiceModel.Channels.BindingElement.BuildChannelListener%2A> method on the service to add the upgrade Binding Element to <xref:System.ServiceModel.Channels.BindingContext.BindingParameters%2A>.</span></span>  
  
5. <span data-ttu-id="cabeb-135">Agregue el nuevo elemento de enlace de actualización de secuencia a los enlaces en los equipos del cliente y del servidor.</span><span class="sxs-lookup"><span data-stu-id="cabeb-135">Add the new stream upgrade binding element to bindings on the server and client machines.</span></span>  
  
## <a name="security-upgrades"></a><span data-ttu-id="cabeb-136">Actualizaciones de seguridad</span><span class="sxs-lookup"><span data-stu-id="cabeb-136">Security Upgrades</span></span>  

 <span data-ttu-id="cabeb-137">Agregar una actualización de seguridad es una versión especializada del proceso de actualización de secuencia general.</span><span class="sxs-lookup"><span data-stu-id="cabeb-137">Adding a security upgrade is a specialized version of the general stream upgrade process.</span></span>  
  
 <span data-ttu-id="cabeb-138">WCF ya proporciona dos elementos de enlace para actualizar la seguridad de la secuencia.</span><span class="sxs-lookup"><span data-stu-id="cabeb-138">WCF already provides two binding elements for upgrading stream security.</span></span> <span data-ttu-id="cabeb-139">La configuración de la seguridad de nivel de transporte la encapsula <xref:System.ServiceModel.Channels.WindowsStreamSecurityBindingElement> y <xref:System.ServiceModel.Channels.SslStreamSecurityBindingElement>, que se pueden configurar y agregar a un enlace personalizado.</span><span class="sxs-lookup"><span data-stu-id="cabeb-139">The configuration of transport-level security is encapsulated by the <xref:System.ServiceModel.Channels.WindowsStreamSecurityBindingElement> and the <xref:System.ServiceModel.Channels.SslStreamSecurityBindingElement> which can be configured and added to a custom binding.</span></span> <span data-ttu-id="cabeb-140">Estos elementos de enlace extienden la clase <xref:System.ServiceModel.Channels.StreamUpgradeBindingElement> que crea los proveedores de actualización de secuencia del cliente y el servidor.</span><span class="sxs-lookup"><span data-stu-id="cabeb-140">These binding elements extend the <xref:System.ServiceModel.Channels.StreamUpgradeBindingElement> class that builds the client and server stream upgrade providers.</span></span> <span data-ttu-id="cabeb-141">Estos elementos de enlace tienen métodos que crean las clases de proveedor de actualización de secuencia de seguridad especializadas, que no son `public`, por lo que para estos dos casos solamente se necesita agregar el elemento de enlace a este enlace.</span><span class="sxs-lookup"><span data-stu-id="cabeb-141">These binding elements have methods that create the specialized security stream upgrade provider classes, which are not `public`, so for these two cases all you need to do is to add the binding element to the binding.</span></span>  
  
 <span data-ttu-id="cabeb-142">Para los escenarios de seguridad que no se incluyan en los dos elementos de enlace anteriores, tres clases `abstract` relacionadas con seguridad se derivan de las clases base de iniciador, aceptador y proveedor anteriores:</span><span class="sxs-lookup"><span data-stu-id="cabeb-142">For security scenarios not met by the above two binding elements, three security-related `abstract` classes are derived from the above initiator, acceptor and provider base classes:</span></span>  
  
1. <xref:System.ServiceModel.Channels.StreamSecurityUpgradeInitiator?displayProperty=nameWithType>  
  
2. <xref:System.ServiceModel.Channels.StreamSecurityUpgradeAcceptor?displayProperty=nameWithType>  
  
3. <xref:System.ServiceModel.Channels.StreamSecurityUpgradeProvider?displayProperty=nameWithType>  
  
 <span data-ttu-id="cabeb-143">El proceso de implementar una actualización de secuencia de seguridad es igual que antes, con la diferencia de que derivaría de estas tres clases.</span><span class="sxs-lookup"><span data-stu-id="cabeb-143">The process of implementing a security stream upgrade is the same as before, with the difference that you would derive from these three classes.</span></span> <span data-ttu-id="cabeb-144">Invalide las propiedades adicionales en estas clases para proporcionar información de seguridad al tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="cabeb-144">Override the additional properties in these classes to supply security information to the runtime.</span></span>  
  
## <a name="multiple-upgrades"></a><span data-ttu-id="cabeb-145">Varias actualizaciones</span><span class="sxs-lookup"><span data-stu-id="cabeb-145">Multiple Upgrades</span></span>  

 <span data-ttu-id="cabeb-146">Para crear solicitudes de actualización adicionales, repita el proceso arriba mencionado: cree extensiones adicionales de <xref:System.ServiceModel.Channels.StreamUpgradeProvider> y elementos de enlace.</span><span class="sxs-lookup"><span data-stu-id="cabeb-146">To create additional upgrade requests repeat the above process: create additional extensions of <xref:System.ServiceModel.Channels.StreamUpgradeProvider> and binding elements.</span></span> <span data-ttu-id="cabeb-147">Agregue los elementos de enlace al enlace.</span><span class="sxs-lookup"><span data-stu-id="cabeb-147">Add the binding elements to the binding.</span></span> <span data-ttu-id="cabeb-148">Se procesan los elementos de enlace adicionales secuencialmente, empezando por el primer elemento de enlace agregado al enlace.</span><span class="sxs-lookup"><span data-stu-id="cabeb-148">The additional binding elements are processed sequentially, starting with the first binding element added to the binding.</span></span> <span data-ttu-id="cabeb-149">En <xref:System.ServiceModel.Channels.BindingElement.BuildChannelFactory%2A> y <xref:System.ServiceModel.Channels.BindingElement.BuildChannelListener%2A> cada proveedor de actualización puede determinar cómo disponerse en capas en cualquiera de los parámetros de enlace de actualización ya existentes.</span><span class="sxs-lookup"><span data-stu-id="cabeb-149">In <xref:System.ServiceModel.Channels.BindingElement.BuildChannelFactory%2A> and <xref:System.ServiceModel.Channels.BindingElement.BuildChannelListener%2A> each upgrade provider can determine how to layer itself on any pre-existing upgrade binding parameters.</span></span> <span data-ttu-id="cabeb-150">Debería reemplazar a continuación el parámetro de enlace de actualización existente con un nuevo parámetro de enlace de actualización compuesta.</span><span class="sxs-lookup"><span data-stu-id="cabeb-150">It should then replace the existing upgrade binding parameter with a new composite upgrade binding parameter.</span></span>  
  
 <span data-ttu-id="cabeb-151">Alternativamente, un proveedor de actualización puede admitir varias actualizaciones.</span><span class="sxs-lookup"><span data-stu-id="cabeb-151">Alternatively, one upgrade provider can support multiple upgrades.</span></span> <span data-ttu-id="cabeb-152">Por ejemplo, podría desear implementar un proveedor de actualización de secuencia personalizado que admita seguridad y compresión.</span><span class="sxs-lookup"><span data-stu-id="cabeb-152">For example, you might want to implement a custom stream upgrade provider that supports both security and compression.</span></span> <span data-ttu-id="cabeb-153">Siga estos pasos:</span><span class="sxs-lookup"><span data-stu-id="cabeb-153">Do the following steps:</span></span>  
  
1. <span data-ttu-id="cabeb-154"><xref:System.ServiceModel.Channels.StreamSecurityUpgradeProvider> subclase para escribir la clase de proveedor que crea el iniciador y el aceptador.</span><span class="sxs-lookup"><span data-stu-id="cabeb-154">Subclass <xref:System.ServiceModel.Channels.StreamSecurityUpgradeProvider> to write the provider class that creates the Initiator and Acceptor.</span></span>  
  
2. <span data-ttu-id="cabeb-155">Cree subclase de <xref:System.ServiceModel.Channels.StreamSecurityUpgradeInitiator> asegurándose de invalidar el método <xref:System.ServiceModel.Channels.StreamUpgradeInitiator.GetNextUpgrade%2A> para devolver los tipos de contenido para la secuencia de compresión y la secuencia segura en orden.</span><span class="sxs-lookup"><span data-stu-id="cabeb-155">Subclass the <xref:System.ServiceModel.Channels.StreamSecurityUpgradeInitiator> making sure to override the <xref:System.ServiceModel.Channels.StreamUpgradeInitiator.GetNextUpgrade%2A> method to return the content types for the compression stream and the secure stream in order.</span></span>  
  
3. <span data-ttu-id="cabeb-156">Cree subclase de <xref:System.ServiceModel.Channels.StreamSecurityUpgradeAcceptor> que entienda los tipos de contenido personalizados en su método <xref:System.ServiceModel.Channels.StreamUpgradeAcceptor.CanUpgrade%2A>.</span><span class="sxs-lookup"><span data-stu-id="cabeb-156">Subclass the <xref:System.ServiceModel.Channels.StreamSecurityUpgradeAcceptor> that understands the custom content types in its <xref:System.ServiceModel.Channels.StreamUpgradeAcceptor.CanUpgrade%2A> method.</span></span>  
  
4. <span data-ttu-id="cabeb-157">La secuencia se actualizará después de cada llamada a <xref:System.ServiceModel.Channels.StreamUpgradeInitiator.GetNextUpgrade%2A> y <xref:System.ServiceModel.Channels.StreamUpgradeAcceptor.CanUpgrade%2A>.</span><span class="sxs-lookup"><span data-stu-id="cabeb-157">The stream will be upgraded after each call to <xref:System.ServiceModel.Channels.StreamUpgradeInitiator.GetNextUpgrade%2A> and <xref:System.ServiceModel.Channels.StreamUpgradeAcceptor.CanUpgrade%2A>.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="cabeb-158">Vea también</span><span class="sxs-lookup"><span data-stu-id="cabeb-158">See also</span></span>

- <xref:System.ServiceModel.Channels.StreamUpgradeInitiator>
- <xref:System.ServiceModel.Channels.StreamSecurityUpgradeInitiator>
- <xref:System.ServiceModel.Channels.StreamUpgradeAcceptor>
- <xref:System.ServiceModel.Channels.StreamSecurityUpgradeAcceptor>
- <xref:System.ServiceModel.Channels.StreamUpgradeProvider>
- <xref:System.ServiceModel.Channels.StreamSecurityUpgradeProvider>
- <xref:System.ServiceModel.Channels.StreamUpgradeBindingElement>
- <xref:System.ServiceModel.Channels.SslStreamSecurityBindingElement>
- <xref:System.ServiceModel.Channels.WindowsStreamSecurityBindingElement>
