---
title: 'Cómo: crear un autenticador de token de seguridad personalizado'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, authentication
ms.assetid: 10e245f7-d31e-42e7-82a2-d5780325d372
ms.openlocfilehash: 7bbe59958f59f76046c0a112463cfa64d09c14d3
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/12/2020
ms.locfileid: "79185588"
---
# <a name="how-to-create-a-custom-security-token-authenticator"></a><span data-ttu-id="b46b0-102">Cómo: crear un autenticador de token de seguridad personalizado</span><span class="sxs-lookup"><span data-stu-id="b46b0-102">How to: create a custom security token authenticator</span></span>
<span data-ttu-id="b46b0-103">En este tema se muestra cómo crear un autenticador de tokens de seguridad personalizado y cómo integrarlo con un administrador de tokens de seguridad personalizado.</span><span class="sxs-lookup"><span data-stu-id="b46b0-103">This topic shows how to create a custom security token authenticator and how to integrate it with a custom security token manager.</span></span> <span data-ttu-id="b46b0-104">Un autenticador de tokens de seguridad valida el contenido de un token de seguridad proporcionado con un mensaje entrante.</span><span class="sxs-lookup"><span data-stu-id="b46b0-104">A security token authenticator validates the content of a security token provided with an incoming message.</span></span> <span data-ttu-id="b46b0-105">Si la validación es correcta, el autenticador devuelve una colección de instancias <xref:System.IdentityModel.Policy.IAuthorizationPolicy> que, cuando se evalúa, devuelve un conjunto de notificaciones.</span><span class="sxs-lookup"><span data-stu-id="b46b0-105">If the validation succeeds, the authenticator returns a collection of <xref:System.IdentityModel.Policy.IAuthorizationPolicy> instances that, when evaluated, returns a set of claims.</span></span>  
  
 <span data-ttu-id="b46b0-106">Para usar un autenticador de token de seguridad personalizado en Windows Communication Foundation (WCF), primero debe crear credenciales personalizadas e implementaciones del administrador de tokens de seguridad.</span><span class="sxs-lookup"><span data-stu-id="b46b0-106">To use a custom security token authenticator in Windows Communication Foundation (WCF), you must first create custom credentials and security token manager implementations.</span></span> <span data-ttu-id="b46b0-107">Para obtener más información acerca de la creación de credenciales personalizadas y un administrador de tokens de seguridad, vea Tutorial: Creación de credenciales de [cliente y servicio personalizadas](walkthrough-creating-custom-client-and-service-credentials.md).</span><span class="sxs-lookup"><span data-stu-id="b46b0-107">For more information about creating custom credentials and a security token manager, see [Walkthrough: Creating Custom Client and Service Credentials](walkthrough-creating-custom-client-and-service-credentials.md).</span></span>
  
## <a name="procedures"></a><span data-ttu-id="b46b0-108">Procedimientos</span><span class="sxs-lookup"><span data-stu-id="b46b0-108">Procedures</span></span>  
  
#### <a name="to-create-a-custom-security-token-authenticator"></a><span data-ttu-id="b46b0-109">Para crear un autenticador de token de seguridad personalizado</span><span class="sxs-lookup"><span data-stu-id="b46b0-109">To create a custom security token authenticator</span></span>  
  
1. <span data-ttu-id="b46b0-110">Defina una clase nueva derivada de la clase <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator>.</span><span class="sxs-lookup"><span data-stu-id="b46b0-110">Define a new class derived from the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> class.</span></span>  
  
2. <span data-ttu-id="b46b0-111">Invalide el método <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateTokenCore%2A> .</span><span class="sxs-lookup"><span data-stu-id="b46b0-111">Override the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateTokenCore%2A> method.</span></span> <span data-ttu-id="b46b0-112">El método devuelve `true` o `false` en función de si el autenticador personalizado puede validar el tipo de token entrante o no.</span><span class="sxs-lookup"><span data-stu-id="b46b0-112">The method returns `true` or `false` depending on whether the custom authenticator can validate the incoming token type or not.</span></span>  
  
3. <span data-ttu-id="b46b0-113">Invalide el método <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.ValidateTokenCore%2A> .</span><span class="sxs-lookup"><span data-stu-id="b46b0-113">Override the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.ValidateTokenCore%2A> method.</span></span> <span data-ttu-id="b46b0-114">Este método necesita validar adecuadamente el contenido del token.</span><span class="sxs-lookup"><span data-stu-id="b46b0-114">This method needs to validate the token contents appropriately.</span></span> <span data-ttu-id="b46b0-115">Si el token pasa la fase de la validación, devuelve una colección de instancias <xref:System.IdentityModel.Policy.IAuthorizationPolicy>.</span><span class="sxs-lookup"><span data-stu-id="b46b0-115">If the token passes the validation step, it returns a collection of <xref:System.IdentityModel.Policy.IAuthorizationPolicy> instances.</span></span> <span data-ttu-id="b46b0-116">El ejemplo siguiente utiliza una implementación de la directiva de autorización personalizada que se creará en el procedimiento siguiente.</span><span class="sxs-lookup"><span data-stu-id="b46b0-116">The following example uses a custom authorization policy implementation that will be created in the next procedure.</span></span>  
  
     [!code-csharp[C_CustomTokenAuthenticator#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#1)]
     [!code-vb[C_CustomTokenAuthenticator#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#1)]  
  
 <span data-ttu-id="b46b0-117">El código anterior devuelve una colección de directivas de autorización en el método <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateToken%28System.IdentityModel.Tokens.SecurityToken%29>.</span><span class="sxs-lookup"><span data-stu-id="b46b0-117">The previous code returns a collection of authorization policies in the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateToken%28System.IdentityModel.Tokens.SecurityToken%29> method.</span></span> <span data-ttu-id="b46b0-118">WCF no proporciona una implementación pública de esta interfaz.</span><span class="sxs-lookup"><span data-stu-id="b46b0-118">WCF does not provide a public implementation of this interface.</span></span> <span data-ttu-id="b46b0-119">El procedimiento siguiente muestra cómo hacer esto para sus propios requisitos.</span><span class="sxs-lookup"><span data-stu-id="b46b0-119">The following procedure shows how to do so for your own requirements.</span></span>  
  
#### <a name="to-create-a-custom-authorization-policy"></a><span data-ttu-id="b46b0-120">Para crear una directiva de autorización personalizada</span><span class="sxs-lookup"><span data-stu-id="b46b0-120">To create a custom authorization policy</span></span>  
  
1. <span data-ttu-id="b46b0-121">Defina una nueva clase que implementa la interfaz <xref:System.IdentityModel.Policy.IAuthorizationPolicy>.</span><span class="sxs-lookup"><span data-stu-id="b46b0-121">Define a new class implementing the <xref:System.IdentityModel.Policy.IAuthorizationPolicy> interface.</span></span>  
  
2. <span data-ttu-id="b46b0-122">Implemente la propiedad de solo lectura <xref:System.IdentityModel.Policy.IAuthorizationComponent.Id%2A>.</span><span class="sxs-lookup"><span data-stu-id="b46b0-122">Implement the <xref:System.IdentityModel.Policy.IAuthorizationComponent.Id%2A> read-only property.</span></span> <span data-ttu-id="b46b0-123">Una manera de implementar esta propiedad es generar un identificador único global (GUID) en el constructor de clase y devolverlo cada vez que se solicita el valor para esta propiedad.</span><span class="sxs-lookup"><span data-stu-id="b46b0-123">One way to implement this property is to generate a globally unique identifier (GUID) in the class constructor and return it every time the value for this property is requested.</span></span>  
  
3. <span data-ttu-id="b46b0-124">Implemente la propiedad de solo lectura <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Issuer%2A>.</span><span class="sxs-lookup"><span data-stu-id="b46b0-124">Implement the <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Issuer%2A> read-only property.</span></span> <span data-ttu-id="b46b0-125">Esta propiedad necesita devolver un emisor de los conjuntos de notificaciones que se obtienen del token.</span><span class="sxs-lookup"><span data-stu-id="b46b0-125">This property needs to return an issuer of the claim sets that are obtained from the token.</span></span> <span data-ttu-id="b46b0-126">Este emisor debería corresponderse con el emisor del token o con una autoridad que sea responsable de validar el contenido del token.</span><span class="sxs-lookup"><span data-stu-id="b46b0-126">This issuer should correspond to the issuer of the token or an authority that is responsible for validating the token contents.</span></span> <span data-ttu-id="b46b0-127">El ejemplo siguiente utiliza la notificación del emisor que se pasó a esta clase desde el autenticador de tokens de seguridad personalizado creado en el procedimiento anterior.</span><span class="sxs-lookup"><span data-stu-id="b46b0-127">The following example uses the issuer claim that passed to this class from the custom security token authenticator created in the previous procedure.</span></span> <span data-ttu-id="b46b0-128">El autenticador de tokens de seguridad personalizado utiliza el conjunto de notificaciones proporcionado por el sistema (devuelto por la propiedad <xref:System.IdentityModel.Claims.ClaimSet.System%2A>) para representar el emisor del token del nombre de usuario.</span><span class="sxs-lookup"><span data-stu-id="b46b0-128">The custom security token authenticator uses the system-provided claim set (returned by the <xref:System.IdentityModel.Claims.ClaimSet.System%2A> property) to represent the issuer of the username token.</span></span>  
  
4. <span data-ttu-id="b46b0-129">Implemente el método <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Evaluate%2A>.</span><span class="sxs-lookup"><span data-stu-id="b46b0-129">Implement the <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Evaluate%2A> method.</span></span> <span data-ttu-id="b46b0-130">Este método rellena una instancia de la clase <xref:System.IdentityModel.Policy.EvaluationContext> (pasadas como argumento) con notificaciones basadas en el contenido del token de seguridad entrante.</span><span class="sxs-lookup"><span data-stu-id="b46b0-130">This method populates an instance of the <xref:System.IdentityModel.Policy.EvaluationContext> class (passed in as an argument) with claims that are based on the incoming security token content.</span></span> <span data-ttu-id="b46b0-131">El método devuelve `true` cuando se hace con la evaluación.</span><span class="sxs-lookup"><span data-stu-id="b46b0-131">The method returns `true` when it is done with the evaluation.</span></span> <span data-ttu-id="b46b0-132">En los casos en los que la implementación confía en la presencia de otras directivas de autorización que proporcionan información adicional al contexto de la evaluación, este método puede devolver `false` si la información necesaria no se encuentra todavía en el contexto de la evaluación.</span><span class="sxs-lookup"><span data-stu-id="b46b0-132">In cases when the implementation relies on the presence of other authorization policies that provide additional information to the evaluation context, this method can return `false` if the required information is not present yet in the evaluation context.</span></span> <span data-ttu-id="b46b0-133">En ese caso, WCF volverá a llamar al método después de evaluar todas las demás directivas de autorización generadas para el mensaje entrante si al menos una de esas directivas de autorización modificó el contexto de evaluación.</span><span class="sxs-lookup"><span data-stu-id="b46b0-133">In that case, WCF will call the method again after evaluating all other authorization policies generated for the incoming message if at least one of those authorization policies modified the evaluation context.</span></span>  
  
     [!code-csharp[c_CustomTokenAuthenticator#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#3)]
     [!code-vb[c_CustomTokenAuthenticator#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#3)]  

 <span data-ttu-id="b46b0-134">[Tutorial: Crear credenciales](walkthrough-creating-custom-client-and-service-credentials.md) de cliente y servicio personalizadas describe cómo crear credenciales personalizadas y un administrador de tokens de seguridad personalizado.</span><span class="sxs-lookup"><span data-stu-id="b46b0-134">[Walkthrough: Creating Custom Client and Service Credentials](walkthrough-creating-custom-client-and-service-credentials.md) describes how to create custom credentials and a custom security token manager.</span></span> <span data-ttu-id="b46b0-135">Para utilizar el autenticador de tokens de seguridad personalizado creado aquí, se modificará una implementación del administrador de tokens de seguridad para devolver el autenticador personalizado desde el método <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A>.</span><span class="sxs-lookup"><span data-stu-id="b46b0-135">To use the custom security token authenticator created here, an implementation of the security token manager is modified to return the custom authenticator from the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> method.</span></span> <span data-ttu-id="b46b0-136">El método devuelve un autenticador cuando se pasa un requisito de token de seguridad adecuado.</span><span class="sxs-lookup"><span data-stu-id="b46b0-136">The method returns an authenticator when an appropriate security token requirement is passed in.</span></span>  
  
#### <a name="to-integrate-a-custom-security-token-authenticator-with-a-custom-security-token-manager"></a><span data-ttu-id="b46b0-137">Para integrar un autenticador de tokens de seguridad personalizado con un administrador de tokens de seguridad personalizado</span><span class="sxs-lookup"><span data-stu-id="b46b0-137">To integrate a custom security token authenticator with a custom security token manager</span></span>  
  
1. <span data-ttu-id="b46b0-138">Invalide el método <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> en la implementación del administrador de tokens de seguridad personalizada.</span><span class="sxs-lookup"><span data-stu-id="b46b0-138">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> method in your custom security token manager implementation.</span></span>  
  
2. <span data-ttu-id="b46b0-139">Agregue la lógica al método para habilitarlo con objeto de devolver su autenticador de tokens de seguridad personalizado basado en el parámetro <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>.</span><span class="sxs-lookup"><span data-stu-id="b46b0-139">Add logic to the method to enable it to return your custom security token authenticator based on the <xref:System.IdentityModel.Selectors.SecurityTokenRequirement> parameter.</span></span> <span data-ttu-id="b46b0-140">El ejemplo siguiente devuelve un autenticador de tokens de seguridad personalizado si el tipo de token de requisitos de token es un nombre de usuario (representado por la propiedad <xref:System.IdentityModel.Tokens.SecurityTokenTypes.UserName%2A>) y la dirección del mensaje para la que se solicita el autenticador de tokens de seguridad es la entrada (representada por el campo <xref:System.ServiceModel.Description.MessageDirection.Input>).</span><span class="sxs-lookup"><span data-stu-id="b46b0-140">The following example returns a custom security token authenticator if the token requirements token type is a user name (represented by the <xref:System.IdentityModel.Tokens.SecurityTokenTypes.UserName%2A> property) and the message direction for which the security token authenticator is being requested is input (represented by the <xref:System.ServiceModel.Description.MessageDirection.Input> field).</span></span>  
  
     [!code-csharp[c_CustomTokenAuthenticator#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#2)]
     [!code-vb[c_CustomTokenAuthenticator#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#2)]  

## <a name="see-also"></a><span data-ttu-id="b46b0-141">Consulte también</span><span class="sxs-lookup"><span data-stu-id="b46b0-141">See also</span></span>

- <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator>
- <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>
- <xref:System.IdentityModel.Selectors.SecurityTokenManager>
- <xref:System.IdentityModel.Tokens.UserNameSecurityToken>
- [<span data-ttu-id="b46b0-142">Tutorial: Crear credenciales de cliente y servicio personalizadas</span><span class="sxs-lookup"><span data-stu-id="b46b0-142">Walkthrough: Creating Custom Client and Service Credentials</span></span>](walkthrough-creating-custom-client-and-service-credentials.md)
- [<span data-ttu-id="b46b0-143">Cómo crear un proveedor de tokens de seguridad personalizado</span><span class="sxs-lookup"><span data-stu-id="b46b0-143">How to: Create a Custom Security Token Provider</span></span>](how-to-create-a-custom-security-token-provider.md)
