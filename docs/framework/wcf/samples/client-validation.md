---
title: Validación de cliente
ms.date: 03/30/2017
ms.assetid: f0c1f805-1a81-4d0d-a112-bf5e2e87a631
ms.openlocfilehash: dce11ec2e3ef552c0c53e1faf89a12bc13b66ae0
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 06/09/2020
ms.locfileid: "84585329"
---
# <a name="client-validation"></a><span data-ttu-id="82aba-102">Validación de cliente</span><span class="sxs-lookup"><span data-stu-id="82aba-102">Client Validation</span></span>
<span data-ttu-id="82aba-103">Los servicios publican frecuentemente los metadatos para habilitar la generación automática y la configuración de tipos de proxy de cliente.</span><span class="sxs-lookup"><span data-stu-id="82aba-103">Services frequently publish metadata to enable automatic generation and configuration of client proxy types.</span></span> <span data-ttu-id="82aba-104">Cuando no se confía en el servicio, las aplicaciones cliente deberían comprobar y validar que los metadatos cumplen con la directiva de la aplicación cliente con respecto a la seguridad, transacciones, el tipo de contrato de servicios etc.</span><span class="sxs-lookup"><span data-stu-id="82aba-104">When the service is not trusted, client applications should validate that the metadata conforms to the client application's policy regarding security, transactions, the type of service contract and so on.</span></span> <span data-ttu-id="82aba-105">El siguiente ejemplo muestra cómo escribir un comportamiento de punto de conexión de cliente que valide el punto de conexión de servicio para asegurarse de que el punto de conexión de servicio puede utilizarse con seguridad.</span><span class="sxs-lookup"><span data-stu-id="82aba-105">The following sample demonstrates how to write a client endpoint behavior that validates the service endpoint to ensure that service endpoint is safe to use.</span></span>  
  
 <span data-ttu-id="82aba-106">El servicio expone cuatro puntos de conexión de servicio.</span><span class="sxs-lookup"><span data-stu-id="82aba-106">The service exposes four service endpoints.</span></span> <span data-ttu-id="82aba-107">El primer punto de conexión utiliza WSDualHttpBinding, el segundo punto de conexión utiliza la autenticación NTLM, el tercer punto de conexión habilita el flujo de la transacción y el cuarto punto de conexión utiliza la autenticación basada en certificados.</span><span class="sxs-lookup"><span data-stu-id="82aba-107">The first endpoint uses the WSDualHttpBinding, the second endpoint uses NTLM authentication, the third endpoint enables transaction flow, and the fourth endpoint uses certificate-based authentication.</span></span>  
  
 <span data-ttu-id="82aba-108">El cliente utiliza la clase <xref:System.ServiceModel.Description.MetadataResolver> para recuperar los metadatos para el servicio.</span><span class="sxs-lookup"><span data-stu-id="82aba-108">The client uses the <xref:System.ServiceModel.Description.MetadataResolver> class to retrieve the metadata for the service.</span></span> <span data-ttu-id="82aba-109">El cliente exige una directiva que prohíba los enlaces dúplex, la autenticación NTLM y el flujo de la transacción mediante un comportamiento que se encargue de validar.</span><span class="sxs-lookup"><span data-stu-id="82aba-109">The client enforces a policy of prohibiting duplex bindings, NTLM authentication, and transaction flow using a validating behavior.</span></span> <span data-ttu-id="82aba-110">Para cada <xref:System.ServiceModel.Description.ServiceEndpoint> instancia importada de los metadatos del servicio, la aplicación cliente agrega una instancia del `InternetClientValidatorBehavior` comportamiento del extremo a <xref:System.ServiceModel.Description.ServiceEndpoint> antes de intentar utilizar un cliente de Windows Communication Foundation (WCF) para conectarse al punto de conexión.</span><span class="sxs-lookup"><span data-stu-id="82aba-110">For each <xref:System.ServiceModel.Description.ServiceEndpoint> instance imported from the service's metadata, the client application adds an instance of the `InternetClientValidatorBehavior` endpoint behavior to the <xref:System.ServiceModel.Description.ServiceEndpoint> before attempting to use a Windows Communication Foundation (WCF) client to connect to the endpoint.</span></span> <span data-ttu-id="82aba-111">El método `Validate` de comportamiento se ejecuta antes de llamar cualquier operación en el servicio y exige la directiva del cliente iniciando `InvalidOperationExceptions`.</span><span class="sxs-lookup"><span data-stu-id="82aba-111">The behavior's `Validate` method runs before any operations on the service are called and enforces the client's policy by throwing `InvalidOperationExceptions`.</span></span>  
  
### <a name="to-build-the-sample"></a><span data-ttu-id="82aba-112">Para compilar el ejemplo</span><span class="sxs-lookup"><span data-stu-id="82aba-112">To build the sample</span></span>  
  
1. <span data-ttu-id="82aba-113">Para compilar la solución, siga las instrucciones de [creación de los ejemplos de Windows Communication Foundation](building-the-samples.md).</span><span class="sxs-lookup"><span data-stu-id="82aba-113">To build the solution, follow the instructions in [Building the Windows Communication Foundation Samples](building-the-samples.md).</span></span>  
  
### <a name="to-run-the-sample-on-the-same-computer"></a><span data-ttu-id="82aba-114">Para ejecutar el ejemplo en el mismo equipo</span><span class="sxs-lookup"><span data-stu-id="82aba-114">To run the sample on the same computer</span></span>  
  
1. <span data-ttu-id="82aba-115">Abra una Símbolo del sistema para desarrolladores para Visual Studio con privilegios de administrador y ejecute setup. bat desde la carpeta de instalación de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="82aba-115">Open a Developer Command Prompt for Visual Studio with administrator privileges and run Setup.bat from the sample install folder.</span></span> <span data-ttu-id="82aba-116">De esta forma, se instalan todos los certificados necesarios para ejecutar el ejemplo.</span><span class="sxs-lookup"><span data-stu-id="82aba-116">This installs all the certificates required for running the sample.</span></span>  
  
2. <span data-ttu-id="82aba-117">Ejecute la aplicación de servicio desde \service\ Debug.</span><span class="sxs-lookup"><span data-stu-id="82aba-117">Run the service application from \service\bin\Debug.</span></span>  
  
3. <span data-ttu-id="82aba-118">Ejecute la aplicación cliente desde \client\ Debug.</span><span class="sxs-lookup"><span data-stu-id="82aba-118">Run the client application from \client\bin\Debug.</span></span> <span data-ttu-id="82aba-119">La actividad del cliente se muestra en la aplicación de consola del cliente.</span><span class="sxs-lookup"><span data-stu-id="82aba-119">Client activity is displayed on the client console application.</span></span>  
  
4. <span data-ttu-id="82aba-120">Si el cliente y el servicio no pueden comunicarse, vea [sugerencias para la solución de problemas de ejemplos de WCF](https://docs.microsoft.com/previous-versions/dotnet/netframework-3.5/ms751511(v=vs.90)).</span><span class="sxs-lookup"><span data-stu-id="82aba-120">If the client and service are not able to communicate, see [Troubleshooting Tips for WCF Samples](https://docs.microsoft.com/previous-versions/dotnet/netframework-3.5/ms751511(v=vs.90)).</span></span>  
  
5. <span data-ttu-id="82aba-121">Quite los certificados ejecutando Cleanup.bat cuando haya finalizado con el ejemplo.</span><span class="sxs-lookup"><span data-stu-id="82aba-121">Remove the certificates by running Cleanup.bat when you have finished with the sample.</span></span> <span data-ttu-id="82aba-122">Otros ejemplos de seguridad usan los mismos certificados.</span><span class="sxs-lookup"><span data-stu-id="82aba-122">Other security samples use the same certificates.</span></span>  
  
### <a name="to-run-the-sample-across-computers"></a><span data-ttu-id="82aba-123">Para ejecutar el ejemplo en varios equipos</span><span class="sxs-lookup"><span data-stu-id="82aba-123">To run the sample across computers</span></span>  
  
1. <span data-ttu-id="82aba-124">En el servidor, en una Símbolo del sistema para desarrolladores para que Visual Studio se ejecute con privilegios de administrador, escriba `setup.bat service` .</span><span class="sxs-lookup"><span data-stu-id="82aba-124">On the server, in a Developer Command Prompt for Visual Studio run with administrator privileges, type `setup.bat service`.</span></span> <span data-ttu-id="82aba-125">`setup.bat`Al ejecutar con el `service` argumento se crea un certificado de servicio con el nombre de dominio completo del equipo y se exporta el certificado del servicio a un archivo denominado Service. cer.</span><span class="sxs-lookup"><span data-stu-id="82aba-125">Running `setup.bat` with the `service` argument creates a service certificate with the fully-qualified domain name of the computer and exports the service certificate to a file named Service.cer.</span></span>  
  
2. <span data-ttu-id="82aba-126">En el servidor, edite App.config para reflejar el nuevo nombre del certificado.</span><span class="sxs-lookup"><span data-stu-id="82aba-126">On the server, edit App.config to reflect the new certificate name.</span></span> <span data-ttu-id="82aba-127">Es decir, cambie el `findValue` atributo del [\<serviceCertificate>](../../configure-apps/file-schema/wcf/servicecertificate-of-clientcredentials-element.md) elemento al nombre de dominio completo del equipo.</span><span class="sxs-lookup"><span data-stu-id="82aba-127">That is, change the `findValue` attribute in the [\<serviceCertificate>](../../configure-apps/file-schema/wcf/servicecertificate-of-clientcredentials-element.md) element to the fully-qualified domain name of the computer.</span></span>  
  
3. <span data-ttu-id="82aba-128">Copie el archivo Service.cer del directorio de servicio al directorio del cliente en el equipo cliente.</span><span class="sxs-lookup"><span data-stu-id="82aba-128">Copy the Service.cer file from the service directory to the client directory on the client computer.</span></span>  
  
4. <span data-ttu-id="82aba-129">En el cliente, abra una Símbolo del sistema para desarrolladores para Visual Studio con privilegios de administrador y escriba `setup.bat client` .</span><span class="sxs-lookup"><span data-stu-id="82aba-129">On the client, open a Developer Command Prompt for Visual Studio with administrator privileges, and type `setup.bat client`.</span></span> <span data-ttu-id="82aba-130">Al ejecutar `setup.bat` con el `client` argumento se crea un certificado de cliente denominado Client.com y se exporta el certificado de cliente a un archivo denominado Client. cer.</span><span class="sxs-lookup"><span data-stu-id="82aba-130">Running `setup.bat` with the `client` argument creates a client certificate named Client.com and exports the client certificate to a file named Client.cer.</span></span>  
  
5. <span data-ttu-id="82aba-131">En el archivo de client.cs cambie el valor de dirección del punto de conexión MEX y `findValue` para establecer el certificado de servidor predeterminado para que coincida con la nueva dirección de su servicio.</span><span class="sxs-lookup"><span data-stu-id="82aba-131">In the client.cs file change the address value of the MEX endpoint and the `findValue` for setting the default server certificate to match the new address of your service.</span></span> <span data-ttu-id="82aba-132">Para hacerlo, reemplace el host local con el nombre de dominio completo del servidor.</span><span class="sxs-lookup"><span data-stu-id="82aba-132">You do this by replacing localhost with the fully-qualified domain name of the server.</span></span> <span data-ttu-id="82aba-133">Rebuild</span><span class="sxs-lookup"><span data-stu-id="82aba-133">Rebuild.</span></span>  
  
6. <span data-ttu-id="82aba-134">Copie el archivo Client.cer del directorio del cliente en el directorio del servicio en el servidor.</span><span class="sxs-lookup"><span data-stu-id="82aba-134">Copy the Client.cer file from the client directory to the service directory on the server.</span></span>  
  
7. <span data-ttu-id="82aba-135">En el cliente, ejecute ImportServiceCert. bat en un Símbolo del sistema para desarrolladores para Visual Studio abierto con privilegios de administrador.</span><span class="sxs-lookup"><span data-stu-id="82aba-135">On the client, run ImportServiceCert.bat in a Developer Command Prompt for Visual Studio opened with administrator privileges.</span></span> <span data-ttu-id="82aba-136">Así se importa el certificado del servicio del archivo Service.cer en el almacén CurrentUser - TrustedPeople.</span><span class="sxs-lookup"><span data-stu-id="82aba-136">This imports the service certificate from the Service.cer file into the CurrentUser - TrustedPeople store.</span></span>  
  
8. <span data-ttu-id="82aba-137">En el servidor, ejecute ImportClientCert. bat en un Símbolo del sistema para desarrolladores para Visual Studio abierto con privilegios de administrador.</span><span class="sxs-lookup"><span data-stu-id="82aba-137">On the server, run ImportClientCert.bat in a Developer Command Prompt for Visual Studio opened with administrator privileges.</span></span> <span data-ttu-id="82aba-138">De esta forma se importa el certificado del cliente desde el archivo Client.cer al almacén LocalMachine - TrustedPeople.</span><span class="sxs-lookup"><span data-stu-id="82aba-138">This imports the client certificate from the Client.cer file into the LocalMachine - TrustedPeople store.</span></span>  
  
9. <span data-ttu-id="82aba-139">En el equipo del servicio, compile el proyecto de servicio en Visual Studio y ejecute service.exe.</span><span class="sxs-lookup"><span data-stu-id="82aba-139">On the service computer, build the service project in Visual Studio and run service.exe.</span></span>  
  
10. <span data-ttu-id="82aba-140">En el equipo cliente, ejecute client.exe.</span><span class="sxs-lookup"><span data-stu-id="82aba-140">On the client computer, run client.exe.</span></span>  
  
    1. <span data-ttu-id="82aba-141">Si el cliente y el servicio no pueden comunicarse, vea [sugerencias para la solución de problemas de ejemplos de WCF](https://docs.microsoft.com/previous-versions/dotnet/netframework-3.5/ms751511(v=vs.90)).</span><span class="sxs-lookup"><span data-stu-id="82aba-141">If the client and service are not able to communicate, see [Troubleshooting Tips for WCF Samples](https://docs.microsoft.com/previous-versions/dotnet/netframework-3.5/ms751511(v=vs.90)).</span></span>  
  
### <a name="to-clean-up-after-the-sample"></a><span data-ttu-id="82aba-142">Para realizar una limpieza después de ejecutar el ejemplo</span><span class="sxs-lookup"><span data-stu-id="82aba-142">To clean up after the sample</span></span>  
  
- <span data-ttu-id="82aba-143">Ejecute Cleanup.bat en la carpeta de ejemplos cuando haya terminado de ejecutar el ejemplo.</span><span class="sxs-lookup"><span data-stu-id="82aba-143">Run Cleanup.bat in the samples folder once you have finished running the sample.</span></span>  
  
    > [!NOTE]
    > <span data-ttu-id="82aba-144">Este script no quita los certificados del servicio en un cliente cuando el ejemplo se ejecuta en varios equipos.</span><span class="sxs-lookup"><span data-stu-id="82aba-144">This script does not remove service certificates on a client when running this sample across computers.</span></span> <span data-ttu-id="82aba-145">Si ha ejecutado ejemplos de WCF que usan certificados entre equipos, asegúrese de borrar los certificados de servicio que se han instalado en el almacén CurrentUser-TrustedPeople.</span><span class="sxs-lookup"><span data-stu-id="82aba-145">If you have run WCF samples that use certificates across computers, be sure to clear the service certificates that have been installed in the CurrentUser - TrustedPeople store.</span></span> <span data-ttu-id="82aba-146">Para ello, utilice el siguiente comando: `certmgr -del -r CurrentUser -s TrustedPeople -c -n <Fully Qualified Server Machine Name>. For example: certmgr -del -r CurrentUser -s TrustedPeople -c -n server1.contoso.com`.</span><span class="sxs-lookup"><span data-stu-id="82aba-146">To do this, use the following command: `certmgr -del -r CurrentUser -s TrustedPeople -c -n <Fully Qualified Server Machine Name>. For example: certmgr -del -r CurrentUser -s TrustedPeople -c -n server1.contoso.com`.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="82aba-147">Vea también</span><span class="sxs-lookup"><span data-stu-id="82aba-147">See also</span></span>

- [<span data-ttu-id="82aba-148">Utilización de los metadatos</span><span class="sxs-lookup"><span data-stu-id="82aba-148">Using Metadata</span></span>](../feature-details/using-metadata.md)
