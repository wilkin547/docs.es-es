---
title: Varios puntos de conexión en un ListenUri único
ms.date: 03/30/2017
ms.assetid: 911ffad4-4d47-4430-b7c2-79192ce6bcbd
ms.openlocfilehash: 09696ec8170915f29dae7510f8953565bcc67436
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 11/26/2020
ms.locfileid: "96260193"
---
# <a name="multiple-endpoints-at-a-single-listenuri"></a><span data-ttu-id="f706a-102">Varios puntos de conexión en un ListenUri único</span><span class="sxs-lookup"><span data-stu-id="f706a-102">Multiple Endpoints at a Single ListenUri</span></span>

<span data-ttu-id="f706a-103">Este ejemplo muestra un servicio que hospeda varios puntos de conexión en un `ListenUri`único.</span><span class="sxs-lookup"><span data-stu-id="f706a-103">This sample demonstrates a service that hosts multiple endpoints at a single `ListenUri`.</span></span> <span data-ttu-id="f706a-104">Este ejemplo se basa en el [Introducción](getting-started-sample.md) que implementa un servicio de calculadora.</span><span class="sxs-lookup"><span data-stu-id="f706a-104">This sample is based on the [Getting Started](getting-started-sample.md) that implements a calculator service.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="f706a-105">El procedimiento de instalación y las instrucciones de compilación de este ejemplo se encuentran al final de este tema.</span><span class="sxs-lookup"><span data-stu-id="f706a-105">The setup procedure and build instructions for this sample are located at the end of this topic.</span></span>  
  
 <span data-ttu-id="f706a-106">Como se muestra en el ejemplo de [varios puntos de conexión](multiple-endpoints.md) , un servicio puede hospedar varios puntos de conexión, cada uno con direcciones diferentes y posiblemente también distintos enlaces.</span><span class="sxs-lookup"><span data-stu-id="f706a-106">As demonstrated in the [Multiple Endpoints](multiple-endpoints.md) sample, a service can host multiple endpoints, each with different addresses and possibly also different bindings.</span></span> <span data-ttu-id="f706a-107">Este ejemplo muestra que es posible hospedar varios extremos en la misma dirección.</span><span class="sxs-lookup"><span data-stu-id="f706a-107">This sample shows that it is possible to host multiple endpoints at the same address.</span></span> <span data-ttu-id="f706a-108">Este ejemplo también muestra las diferencias entre los dos tipos de direcciones que un extremo de servicio tiene: `EndpointAddress` y `ListenUri`.</span><span class="sxs-lookup"><span data-stu-id="f706a-108">This sample also demonstrates the differences between the two kinds of addresses that a service endpoint has: `EndpointAddress` and `ListenUri`.</span></span>  
  
 <span data-ttu-id="f706a-109">`EndpointAddress` es la dirección lógica de un servicio.</span><span class="sxs-lookup"><span data-stu-id="f706a-109">The `EndpointAddress` is the logical address of a service.</span></span> <span data-ttu-id="f706a-110">Es la dirección a la que se direccionan los mensajes SOAP.</span><span class="sxs-lookup"><span data-stu-id="f706a-110">It is the address that SOAP messages are addressed to.</span></span> <span data-ttu-id="f706a-111">`ListenUri` es la dirección física del servicio.</span><span class="sxs-lookup"><span data-stu-id="f706a-111">The `ListenUri` is the physical address of the service.</span></span> <span data-ttu-id="f706a-112">Tiene el puerto y direcciona la información hacia donde el punto de conexión del servicio realmente realiza escuchas para los mensajes en el equipo actual.</span><span class="sxs-lookup"><span data-stu-id="f706a-112">It has the port and address information where the service endpoint actually listens for messages on the current machine.</span></span> <span data-ttu-id="f706a-113">En la mayoría de los casos, no es necesario que estas direcciones difieran; cuando no se especifica `ListenUri` explícitamente, tiene como valor predeterminado el URI de `EndpointAddress` del punto de conexión.</span><span class="sxs-lookup"><span data-stu-id="f706a-113">In most cases, there is no need for these addresses to differ; when a `ListenUri` is not explicitly specified, it defaults to the URI of the `EndpointAddress` of the endpoint.</span></span> <span data-ttu-id="f706a-114">En unos casos, es útil para distinguirlos, como al configurar un enrutador, que podría aceptar los mensajes enviado a varios servicios diferentes.</span><span class="sxs-lookup"><span data-stu-id="f706a-114">In a few cases, it is useful to distinguish them, such as when configuring a router, which might accept messages addressed to a number of different services.</span></span>  
  
## <a name="service"></a><span data-ttu-id="f706a-115">Servicio</span><span class="sxs-lookup"><span data-stu-id="f706a-115">Service</span></span>  

 <span data-ttu-id="f706a-116">El servicio en este ejemplo tiene dos contratos, `ICalculator` e `IEcho`.</span><span class="sxs-lookup"><span data-stu-id="f706a-116">The service in this sample has two contracts, `ICalculator` and `IEcho`.</span></span> <span data-ttu-id="f706a-117">Además del punto de conexión `IMetadataExchange` de costumbre, hay tres puntos de conexión de la aplicación, tal y como se muestra en el código siguiente.</span><span class="sxs-lookup"><span data-stu-id="f706a-117">In addition to the customary `IMetadataExchange` endpoint, there are three application endpoints, as shown in the following code.</span></span>  
  
```xml  
<endpoint address="urn:Stuff"  
        binding="wsHttpBinding"  
        contract="Microsoft.ServiceModel.Samples.ICalculator"
        listenUri="http://localhost/servicemodelsamples/service.svc" />  
<endpoint address="urn:Stuff"  
        binding="wsHttpBinding"  
        contract="Microsoft.ServiceModel.Samples.IEcho"
        listenUri="http://localhost/servicemodelsamples/service.svc" />  
<endpoint address="urn:OtherEcho"  
        binding="wsHttpBinding"  
        contract="Microsoft.ServiceModel.Samples.IEcho"
        listenUri="http://localhost/servicemodelsamples/service.svc" />  
```  
  
 <span data-ttu-id="f706a-118">Los tres extremos se hospedan en el mismo `ListenUri` y utilizan el mismo `binding`, los extremos en el mismo `ListenUri` deben tener el mismo enlace, porque están compartiendo una pila de canal única que realiza escuchas para los mensajes en esa dirección física en el equipo.</span><span class="sxs-lookup"><span data-stu-id="f706a-118">All three endpoints are hosted at the same `ListenUri` and use the same `binding` - endpoints at the same `ListenUri` must have the same binding, because they are sharing a single channel stack that listens for messages at that physical address on the machine.</span></span> <span data-ttu-id="f706a-119">La`address` de cada punto de conexión es un URN; aunque normalmente las direcciones representan las ubicaciones físicas, de hecho la dirección puede ser cualquier tipo de URI, porque la dirección se utiliza para coincidir y filtrar los propósitos como se muestra en este ejemplo.</span><span class="sxs-lookup"><span data-stu-id="f706a-119">The `address` of each endpoint is a URN; though typically addresses represent physical locations, in fact the address can be any kind of URI, because the address is used for matching and filtering purposes as is demonstrated in this sample.</span></span>  
  
 <span data-ttu-id="f706a-120">Dado que los tres puntos de conexión comparten el mismo `ListenUri` , cuando un mensaje llega allí, Windows Communication Foundation (WCF) debe decidir a qué punto de conexión se destina el mensaje.</span><span class="sxs-lookup"><span data-stu-id="f706a-120">Because all three endpoints share the same `ListenUri`, when a message arrives there, Windows Communication Foundation (WCF) must decide which endpoint the message is destined for.</span></span> <span data-ttu-id="f706a-121">Cada punto de conexión tiene un filtro de mensajes que se compone de dos partes: el filtro de la dirección y el filtro del contrato.</span><span class="sxs-lookup"><span data-stu-id="f706a-121">Each endpoint has a message filter that is comprised of two parts: the address filter and the contract filter.</span></span> <span data-ttu-id="f706a-122">El filtro de la dirección coincide con `To` del mensaje SOAP a la dirección del punto de conexión de servicio.</span><span class="sxs-lookup"><span data-stu-id="f706a-122">The address filter matches the `To` of the SOAP message to the address of the service endpoint.</span></span> <span data-ttu-id="f706a-123">Por ejemplo, solo los mensajes direccionados `To "Urn:OtherEcho"` son candidatos para el tercer punto de conexión de este servicio.</span><span class="sxs-lookup"><span data-stu-id="f706a-123">For example, only messages addressed `To "Urn:OtherEcho"` are candidates for the third endpoint of this service.</span></span> <span data-ttu-id="f706a-124">El filtro del contrato coincide con las Acciones asociadas a las operaciones de un contrato determinado.</span><span class="sxs-lookup"><span data-stu-id="f706a-124">The contract filter matches the Actions associated with the operations of a particular contract.</span></span> <span data-ttu-id="f706a-125">Por ejemplo, los mensajes con la acción de `IEcho`.</span><span class="sxs-lookup"><span data-stu-id="f706a-125">For example, messages with the action of `IEcho`.</span></span> <span data-ttu-id="f706a-126">`Echo` coincide con los filtros de contrato del segundo y tercer extremos de este servicio, porque ambos de esos extremos hospedan el contrato `IEcho`.</span><span class="sxs-lookup"><span data-stu-id="f706a-126">`Echo` matches the contract filters of both the second and third endpoints of this service, because both of those endpoints host the `IEcho` contract.</span></span>  
  
 <span data-ttu-id="f706a-127">Así la combinación de filtro de la dirección y filtro del contrato permite enrutar cada mensaje que llega al`ListenUri` de este servicio al extremo correcto.</span><span class="sxs-lookup"><span data-stu-id="f706a-127">Thus the combination of address filter and contract filter makes it possible to route each message that arrives at this service's `ListenUri` to the correct endpoint.</span></span> <span data-ttu-id="f706a-128">El tercer punto de conexión se diferencia de los otros dos porque aceptan mensajes enviados a una dirección diferente de los otros puntos de conexión.</span><span class="sxs-lookup"><span data-stu-id="f706a-128">The third endpoint is differentiated from the other two because it accepts messages sent to a different address from the other endpoints.</span></span> <span data-ttu-id="f706a-129">Los primeros y segundos puntos de conexión se diferencian entre sí basándose en sus contratos (la acción del mensaje entrante).</span><span class="sxs-lookup"><span data-stu-id="f706a-129">The first and second endpoints are differentiated from each other based on their contracts (the Action of the incoming message).</span></span>  
  
## <a name="client"></a><span data-ttu-id="f706a-130">Cliente</span><span class="sxs-lookup"><span data-stu-id="f706a-130">Client</span></span>  

 <span data-ttu-id="f706a-131">Así como los puntos de conexión en el servidor tienen dos direcciones diferentes, los puntos de conexión del cliente también tienen dos direcciones.</span><span class="sxs-lookup"><span data-stu-id="f706a-131">Just as endpoints on the server have two different addresses, client endpoints also have two addresses.</span></span> <span data-ttu-id="f706a-132">En el servidor y el cliente, la dirección lógica se denomina `EndpointAddress`.</span><span class="sxs-lookup"><span data-stu-id="f706a-132">On both server and client, the logical address is called the `EndpointAddress`.</span></span> <span data-ttu-id="f706a-133">Pero mientras que la dirección física se denomina `ListenUri` en el servidor, en el cliente, la dirección física se denomina `Via`.</span><span class="sxs-lookup"><span data-stu-id="f706a-133">But whereas the physical address is called the `ListenUri` on the server, on the client, the physical address is called the `Via`.</span></span>  
  
 <span data-ttu-id="f706a-134">Como en el servidor, de forma predeterminada, estas dos direcciones son las mismas.</span><span class="sxs-lookup"><span data-stu-id="f706a-134">As on the server, by default, these two addresses are the same.</span></span> <span data-ttu-id="f706a-135">Para especificar una`Via` en el cliente que sea diferente de la dirección del extremo, `ClientViaBehavior` se utiliza:</span><span class="sxs-lookup"><span data-stu-id="f706a-135">To specify a `Via` on the client that is different from the endpoint's address, `ClientViaBehavior` is used:</span></span>  
  
```csharp  
Uri via = new Uri("http://localhost/ServiceModelSamples/service.svc");  
CalculatorClient calcClient = new CalculatorClient();  
calcClient.ChannelFactory.Endpoint.Behaviors.Add(  
        new ClientViaBehavior(via));  
```  
  
 <span data-ttu-id="f706a-136">Como de costumbre, la dirección procede del archivo de configuración del cliente, que fue generado por Svcutil.exe.</span><span class="sxs-lookup"><span data-stu-id="f706a-136">As usual, the address comes from the client configuration file, which was generated by Svcutil.exe.</span></span> <span data-ttu-id="f706a-137">`Via` (Qué corresponde a `ListenUri` del servicio) no aparece en los metadatos del servicio y así esta información se debe comunicar al cliente fuera de banda (simplemente como la dirección de los metadatos del servicio).</span><span class="sxs-lookup"><span data-stu-id="f706a-137">The `Via` (which corresponds to the `ListenUri` of the service) does not appear in the service's metadata and so this information must be communicated to the client out-of-band (just like the service's metadata address).</span></span>  
  
 <span data-ttu-id="f706a-138">El cliente en este ejemplo envía los mensajes a cada uno de los tres puntos de conexión de la aplicación del servidor, para mostrar que puede comunicarse con (y diferenciar) los tres puntos de conexión, aunque ellos todos tienen el mismo `Via`.</span><span class="sxs-lookup"><span data-stu-id="f706a-138">The client in this sample sends messages to each of the server's three application endpoints, to demonstrate that it can communicate with (and differentiate) all three endpoints, even though they all have the same `Via`.</span></span>  
  
#### <a name="to-set-up-build-and-run-the-sample"></a><span data-ttu-id="f706a-139">Configurar, compilar y ejecutar el ejemplo</span><span class="sxs-lookup"><span data-stu-id="f706a-139">To set up, build, and run the sample</span></span>  
  
1. <span data-ttu-id="f706a-140">Asegúrese de que ha realizado el [procedimiento de instalación única para los ejemplos de Windows Communication Foundation](one-time-setup-procedure-for-the-wcf-samples.md).</span><span class="sxs-lookup"><span data-stu-id="f706a-140">Ensure that you have performed the [One-Time Setup Procedure for the Windows Communication Foundation Samples](one-time-setup-procedure-for-the-wcf-samples.md).</span></span>  
  
2. <span data-ttu-id="f706a-141">Para compilar el código C# o Visual Basic .NET Edition de la solución, siga las instrucciones de [Building the Windows Communication Foundation Samples](building-the-samples.md).</span><span class="sxs-lookup"><span data-stu-id="f706a-141">To build the C# or Visual Basic .NET edition of the solution, follow the instructions in [Building the Windows Communication Foundation Samples](building-the-samples.md).</span></span>  
  
3. <span data-ttu-id="f706a-142">Para ejecutar el ejemplo en una configuración de equipos única o cruzada, siga las instrucciones de [ejecución de los ejemplos de Windows Communication Foundation](running-the-samples.md).</span><span class="sxs-lookup"><span data-stu-id="f706a-142">To run the sample in a single- or cross-machine configuration, follow the instructions in [Running the Windows Communication Foundation Samples](running-the-samples.md).</span></span>  
  
    > [!NOTE]
    > <span data-ttu-id="f706a-143">Para el equipo de cruce, debe reemplazar el localhost en el archivo Client.cs con el nombre del equipo del servicio.</span><span class="sxs-lookup"><span data-stu-id="f706a-143">For cross-machine, you must replace localhost in the Client.cs file with the name of the service machine.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="f706a-144">Puede que los ejemplos ya estén instalados en su equipo.</span><span class="sxs-lookup"><span data-stu-id="f706a-144">The samples may already be installed on your machine.</span></span> <span data-ttu-id="f706a-145">Compruebe el siguiente directorio (predeterminado) antes de continuar.</span><span class="sxs-lookup"><span data-stu-id="f706a-145">Check for the following (default) directory before continuing.</span></span>  
>
> `<InstallDrive>:\WF_WCF_Samples`  
>
> <span data-ttu-id="f706a-146">Si este directorio no existe, vaya a [ejemplos de Windows Communication Foundation (WCF) y Windows Workflow Foundation (WF) para .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) para descargar todos los Windows Communication Foundation (WCF) y [!INCLUDE[wf1](../../../../includes/wf1-md.md)] ejemplos.</span><span class="sxs-lookup"><span data-stu-id="f706a-146">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="f706a-147">Este ejemplo se encuentra en el siguiente directorio.</span><span class="sxs-lookup"><span data-stu-id="f706a-147">This sample is located in the following directory.</span></span>  
>
> `<InstallDrive>:\WF_WCF_Samples\WCF\Basic\Services\MultipleEndpointsSingleUri`  
