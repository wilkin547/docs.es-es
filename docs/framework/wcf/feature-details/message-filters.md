---
title: Filtros de mensajes
ms.date: 03/30/2017
helpviewer_keywords:
- routing [WCF], message filters
ms.assetid: cb33ba49-8b1f-4099-8acb-240404a46d9a
ms.openlocfilehash: a0cc4663b9a3044d0ab80f03479a024acba50a3f
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 11/26/2020
ms.locfileid: "96279784"
---
# <a name="message-filters"></a><span data-ttu-id="e8d78-102">Filtros de mensajes</span><span class="sxs-lookup"><span data-stu-id="e8d78-102">Message Filters</span></span>

<span data-ttu-id="e8d78-103">Para implementar el enrutamiento basado en contenido, el servicio de enrutamiento usa implementaciones de <xref:System.ServiceModel.Dispatcher.MessageFilter> que inspeccionan secciones concretas de un mensaje, como la dirección, el nombre del extremo o una instrucción Xpath concreta.</span><span class="sxs-lookup"><span data-stu-id="e8d78-103">To implement content-based routing, the Routing Service uses <xref:System.ServiceModel.Dispatcher.MessageFilter> implementations that inspect specific sections of a message, such as the address, endpoint name, or a specific XPath statement.</span></span> <span data-ttu-id="e8d78-104">Si ninguno de los filtros de mensajes proporcionados con [!INCLUDE[netfx_current_short](../../../../includes/netfx-current-short-md.md)] satisface sus necesidades, puede crear un filtro personalizado creando una nueva implementación de la clase base <xref:System.ServiceModel.Dispatcher.MessageFilter>.</span><span class="sxs-lookup"><span data-stu-id="e8d78-104">If none of the message filters provided with [!INCLUDE[netfx_current_short](../../../../includes/netfx-current-short-md.md)] meet your needs, you can create a custom filter by creating a new implementation of the base <xref:System.ServiceModel.Dispatcher.MessageFilter> class.</span></span>  
  
 <span data-ttu-id="e8d78-105">Al configurar el servicio de enrutamiento, debe definir los elementos de filtro ( <xref:System.ServiceModel.Routing.Configuration.FilterElement> objetos) que describen el tipo de **MessageFilter** y los datos auxiliares necesarios para crear el filtro, como los valores de cadena específicos que se van a buscar en el mensaje.</span><span class="sxs-lookup"><span data-stu-id="e8d78-105">When configuring the Routing Service, you must define filter elements (<xref:System.ServiceModel.Routing.Configuration.FilterElement> objects) that describe the type of **MessageFilter** and any supporting data required to create the filter, such as specific string values to search for within the message.</span></span> <span data-ttu-id="e8d78-106">Tenga en cuenta que, al crear los elementos del filtro, solo se definen los filtros de mensajes individuales; para usar los filtros para evaluar y enrutar mensajes, también deberá definir una tabla de filtros (<xref:System.ServiceModel.Routing.Configuration.FilterTableEntryCollection>).</span><span class="sxs-lookup"><span data-stu-id="e8d78-106">Note that creating the filter elements only defines the individual message filters; to use the filters to evaluate and route messages you must also define a filter table (<xref:System.ServiceModel.Routing.Configuration.FilterTableEntryCollection>).</span></span>  
  
 <span data-ttu-id="e8d78-107">Cada entrada de la tabla de filtros hace referencia a un elemento del filtro y especifica el extremo de cliente al que se enrutará un mensaje si éste coincide con el filtro.</span><span class="sxs-lookup"><span data-stu-id="e8d78-107">Each entry in the filter table references a filter element and specifies the client endpoint that a message will be routed to if the message matches the filter.</span></span> <span data-ttu-id="e8d78-108">Las entradas de la tabla de filtros también le permiten especificar una recopilación de puntos de conexión de reserva (<xref:System.ServiceModel.Routing.Configuration.BackupEndpointCollection>), que definen una lista de puntos de conexión a los que se transmitirá el mensaje en caso de fallo de transmisión al realizar un envío al punto de conexión primario.</span><span class="sxs-lookup"><span data-stu-id="e8d78-108">The filter table entries also allow you to specify a collection of backup endpoints (<xref:System.ServiceModel.Routing.Configuration.BackupEndpointCollection>), which defines a list of endpoints that the message will be transmitted to in the event of a transmission failure when sending to the primary endpoint.</span></span> <span data-ttu-id="e8d78-109">Estos puntos de conexión se probarán en el orden especificado hasta que uno se realice correctamente.</span><span class="sxs-lookup"><span data-stu-id="e8d78-109">These endpoints will be tried in the order specified until one succeeds.</span></span>  
  
## <a name="message-filters"></a><span data-ttu-id="e8d78-110">Filtros de mensajes</span><span class="sxs-lookup"><span data-stu-id="e8d78-110">Message Filters</span></span>  

 <span data-ttu-id="e8d78-111">Los filtros de mensajes usados por el servicio de enrutamiento proporcionan una funcionalidad de selección de mensaje común, como evaluar el nombre del extremo al que se ha enviado un mensaje, la acción SOAP, o la dirección o prefijo de dirección al que se ha enviado el mensaje.</span><span class="sxs-lookup"><span data-stu-id="e8d78-111">The message filters used by the Routing Service provide common message selection functionality, such as evaluating the name of the endpoint that a message was sent to, the SOAP action, or the address or address prefix that the message was sent to.</span></span> <span data-ttu-id="e8d78-112">Los filtros también pueden estar unidos a una condición `AND`, de manera que los mensajes solo se enruten a un extremo si el mensaje coincide con ambos filtros.</span><span class="sxs-lookup"><span data-stu-id="e8d78-112">Filters can also be joined with an `AND` condition, so that messages will only be routed to an endpoint if the message matches both filters.</span></span> <span data-ttu-id="e8d78-113">También puede crear filtros personalizados creando su propia implementación de <xref:System.ServiceModel.Dispatcher.MessageFilter>.</span><span class="sxs-lookup"><span data-stu-id="e8d78-113">You can also create custom filters by creating your own implementation of <xref:System.ServiceModel.Dispatcher.MessageFilter>.</span></span>  
  
 <span data-ttu-id="e8d78-114">La siguiente tabla muestra la enumeración <xref:System.ServiceModel.Routing.Configuration.FilterType> usada por el servicio de enrutamiento, la clase que implementa el filtro de mensajes concreto, así como los parámetros <xref:System.ServiceModel.Routing.Configuration.FilterElement.FilterData%2A> necesarios.</span><span class="sxs-lookup"><span data-stu-id="e8d78-114">The following table lists the <xref:System.ServiceModel.Routing.Configuration.FilterType> used by the Routing Service, the class that implements the specific message filter, and the required <xref:System.ServiceModel.Routing.Configuration.FilterElement.FilterData%2A> parameters.</span></span>  
  
|<span data-ttu-id="e8d78-115">Tipo de filtro</span><span class="sxs-lookup"><span data-stu-id="e8d78-115">Filter  Type</span></span>|<span data-ttu-id="e8d78-116">Descripción</span><span class="sxs-lookup"><span data-stu-id="e8d78-116">Description</span></span>|<span data-ttu-id="e8d78-117">Significado de datos del filtro</span><span class="sxs-lookup"><span data-stu-id="e8d78-117">Filter Data Meaning</span></span>|<span data-ttu-id="e8d78-118">Ejemplo de filtro</span><span class="sxs-lookup"><span data-stu-id="e8d78-118">Example Filter</span></span>|  
|------------------|-----------------|-------------------------|--------------------|  
|<span data-ttu-id="e8d78-119">Acción</span><span class="sxs-lookup"><span data-stu-id="e8d78-119">Action</span></span>|<span data-ttu-id="e8d78-120">Utiliza la clase <xref:System.ServiceModel.Dispatcher.ActionMessageFilter> para coincidir con mensajes que contienen una acción concreta.</span><span class="sxs-lookup"><span data-stu-id="e8d78-120">Uses the <xref:System.ServiceModel.Dispatcher.ActionMessageFilter> class to match messages containing a specific action.</span></span>|<span data-ttu-id="e8d78-121">La acción según la cual se va a filtrar.</span><span class="sxs-lookup"><span data-stu-id="e8d78-121">The action to filter upon.</span></span>|\<filter name="action1" filterType="Action" filterData="http://namespace/contract/operation" />|  
|<span data-ttu-id="e8d78-122">EndpointAddress</span><span class="sxs-lookup"><span data-stu-id="e8d78-122">EndpointAddress</span></span>|<span data-ttu-id="e8d78-123">Usa la <xref:System.ServiceModel.Dispatcher.EndpointAddressMessageFilter> clase con <xref:System.ServiceModel.Dispatcher.EndpointAddressMessageFilter.IncludeHostNameInComparison%2A>  ==  `true` para buscar coincidencias con mensajes que contienen una dirección específica.</span><span class="sxs-lookup"><span data-stu-id="e8d78-123">Uses the <xref:System.ServiceModel.Dispatcher.EndpointAddressMessageFilter> class, with <xref:System.ServiceModel.Dispatcher.EndpointAddressMessageFilter.IncludeHostNameInComparison%2A> == `true` to match messages containing a specific address.</span></span>|<span data-ttu-id="e8d78-124">La dirección según la cual se va a filtrar (en el encabezado To).</span><span class="sxs-lookup"><span data-stu-id="e8d78-124">The address to filter upon (in the To header).</span></span>|\<filter name="address1" filterType="EndpointAddress" filterData="http://host/vdir/s.svc/b"  />|  
|<span data-ttu-id="e8d78-125">EndpointAddressPrefix</span><span class="sxs-lookup"><span data-stu-id="e8d78-125">EndpointAddressPrefix</span></span>|<span data-ttu-id="e8d78-126">Usa la <xref:System.ServiceModel.Dispatcher.PrefixEndpointAddressMessageFilter> clase con <xref:System.ServiceModel.Dispatcher.PrefixEndpointAddressMessageFilter.IncludeHostNameInComparison%2A>  ==  `true` para hacer coincidir los mensajes que contienen un prefijo de dirección específico.</span><span class="sxs-lookup"><span data-stu-id="e8d78-126">Uses the <xref:System.ServiceModel.Dispatcher.PrefixEndpointAddressMessageFilter> class, with <xref:System.ServiceModel.Dispatcher.PrefixEndpointAddressMessageFilter.IncludeHostNameInComparison%2A> == `true` to match messages containing a specific address prefix.</span></span>|<span data-ttu-id="e8d78-127">La dirección según la cual se va a filtrar que usa la coincidencia de prefijo más larga.</span><span class="sxs-lookup"><span data-stu-id="e8d78-127">The address to filter upon using longest prefix matching.</span></span>|\<filter name="prefix1" filterType="EndpointAddressPrefix" filterData="http://host/" />|  
|<span data-ttu-id="e8d78-128">y</span><span class="sxs-lookup"><span data-stu-id="e8d78-128">And</span></span>|<span data-ttu-id="e8d78-129">Utiliza la clase <xref:System.ServiceModel.Dispatcher.StrictAndMessageFilter>, que siempre evalúa ambas condiciones antes de realizar la devolución.</span><span class="sxs-lookup"><span data-stu-id="e8d78-129">Uses the <xref:System.ServiceModel.Dispatcher.StrictAndMessageFilter> class that always evaluates both conditions before returning.</span></span>|<span data-ttu-id="e8d78-130">no se usa filterData. en su lugar, Filter1 y filter2 tienen los nombres de los filtros de mensajes correspondientes (también en la tabla), que deben ser **y** Ed juntos.</span><span class="sxs-lookup"><span data-stu-id="e8d78-130">filterData is not used; instead filter1 and filter2 have the names of the corresponding message filters (also in the table), which should be **AND** ed together.</span></span>|\<filter name="and1" filterType="And" filter1="address1" filter2="action1" />|  
|<span data-ttu-id="e8d78-131">Personalizados</span><span class="sxs-lookup"><span data-stu-id="e8d78-131">Custom</span></span>|<span data-ttu-id="e8d78-132">Tipo definido por el usuario que extiende la clase <xref:System.ServiceModel.Dispatcher.MessageFilter> y tiene un constructor que toma una cadena.</span><span class="sxs-lookup"><span data-stu-id="e8d78-132">A user-defined type that extends the <xref:System.ServiceModel.Dispatcher.MessageFilter> class and has a constructor taking a string.</span></span>|<span data-ttu-id="e8d78-133">El atributo customType es el nombre del tipo completo de la clase que se va a crear; filterData es la cadena que se va a pasar al constructor al crear el filtro.</span><span class="sxs-lookup"><span data-stu-id="e8d78-133">The customType attribute is the fully qualified type name of the class to create; filterData is the string to pass to the constructor when creating the filter.</span></span>|\<filter name="custom1" filterType="Custom" customType="CustomAssembly.CustomMsgFilter, CustomAssembly" filterData="Custom Data" />|  
|<span data-ttu-id="e8d78-134">EndpointName</span><span class="sxs-lookup"><span data-stu-id="e8d78-134">EndpointName</span></span>|<span data-ttu-id="e8d78-135">Utiliza la clase <xref:System.ServiceModel.Dispatcher.EndpointNameMessageFilter> para coincidir con mensajes en función del nombre del punto de conexión de servicio al que llegaron.</span><span class="sxs-lookup"><span data-stu-id="e8d78-135">Uses the <xref:System.ServiceModel.Dispatcher.EndpointNameMessageFilter> class to match messages based on the name of the service endpoint they arrived on.</span></span>|<span data-ttu-id="e8d78-136">Nombre del punto de conexión de servicio, por ejemplo: "serviceEndpoint1".</span><span class="sxs-lookup"><span data-stu-id="e8d78-136">The name of the service endpoint, for example: "serviceEndpoint1".</span></span>  <span data-ttu-id="e8d78-137">Debería ser uno de los extremos expuestos en el servicio de enrutamiento.</span><span class="sxs-lookup"><span data-stu-id="e8d78-137">This should be one of the endpoints exposed on the Routing Service.</span></span>|\<filter name="stock1" filterType="Endpoint" filterData="SvcEndpoint" />|  
|<span data-ttu-id="e8d78-138">MatchAll</span><span class="sxs-lookup"><span data-stu-id="e8d78-138">MatchAll</span></span>|<span data-ttu-id="e8d78-139">Utiliza la clase <xref:System.ServiceModel.Dispatcher.MatchAllMessageFilter>.</span><span class="sxs-lookup"><span data-stu-id="e8d78-139">Uses the <xref:System.ServiceModel.Dispatcher.MatchAllMessageFilter> class.</span></span> <span data-ttu-id="e8d78-140">Este filtro coincide con todos los mensajes entrantes.</span><span class="sxs-lookup"><span data-stu-id="e8d78-140">This filter matches all arriving messages.</span></span>|<span data-ttu-id="e8d78-141">No se usa filterData.</span><span class="sxs-lookup"><span data-stu-id="e8d78-141">filterData is not used.</span></span> <span data-ttu-id="e8d78-142">Este filtro siempre coincide con todos los mensajes.</span><span class="sxs-lookup"><span data-stu-id="e8d78-142">This filter will always match all messages.</span></span>|\<filter name="matchAll1" filterType="MatchAll" />|  
|<span data-ttu-id="e8d78-143">XPath</span><span class="sxs-lookup"><span data-stu-id="e8d78-143">XPath</span></span>|<span data-ttu-id="e8d78-144">Utiliza la clase <xref:System.ServiceModel.Dispatcher.XPathMessageFilter> para coincidir con consultas XPath concretas dentro del mensaje.</span><span class="sxs-lookup"><span data-stu-id="e8d78-144">Uses the <xref:System.ServiceModel.Dispatcher.XPathMessageFilter> class to match specific XPath queries within the message.</span></span>|<span data-ttu-id="e8d78-145">Consulta XPath que se va a usar al realizar la coincidencia de mensajes.</span><span class="sxs-lookup"><span data-stu-id="e8d78-145">The XPath query to use when matching messages.</span></span>|\<filter name="XPath1" filterType="XPath" filterData="//ns:element" />|  
  
 <span data-ttu-id="e8d78-146">En el siguiente ejemplo, se definen entradas de filtro que usan los filtros de mensajes XPath, EndpointName y PrefixEndpointAddress.</span><span class="sxs-lookup"><span data-stu-id="e8d78-146">The following example defines filter entries that use the XPath, EndpointName, and PrefixEndpointAddress message filters.</span></span> <span data-ttu-id="e8d78-147">Este ejemplo también muestra cómo utilizar un filtro personalizado para las entradas de RoundRobinFilter1 y RoundRobinFilter2.</span><span class="sxs-lookup"><span data-stu-id="e8d78-147">This example also demonstrates using a custom filter for the RoundRobinFilter1 and RoundRobinFilter2 entries.</span></span>  
  
```xml  
<filters>  
     <filter name="XPathFilter" filterType="XPath"
             filterData="/s12:Envelope/s12:Header/custom:RoundingCalculator = 1"/>  
     <filter name="EndpointNameFilter" filterType="EndpointName"
             filterData="calculatorEndpoint"/>  
     <filter name="PrefixAddressFilter" filterType="PrefixEndpointAddress"
             filterData="http://localhost/routingservice/router/rounding/"/>  
     <filter name="RoundRobinFilter1" filterType="Custom"
             customType="RoutingServiceFilters.RoundRobinMessageFilter,
             RoutingService" filterData="group1"/>  
     <filter name="RoundRobinFilter2" filterType="Custom"
             customType="RoutingServiceFilters.RoundRobinMessageFilter,
             RoutingService" filterData="group1"/>  
</filters>  
```  
  
> [!NOTE]
> <span data-ttu-id="e8d78-148">El hecho de definir un filtro no hace que los mensajes se evalúen según dicho filtro.</span><span class="sxs-lookup"><span data-stu-id="e8d78-148">Simply defining a filter does not cause messages to be evaluated against the filter.</span></span> <span data-ttu-id="e8d78-149">El filtro se debe agregar a una tabla de filtros, que, posteriormente, se asocia al punto de conexión de servicio expuesto por el servicio de enrutamiento.</span><span class="sxs-lookup"><span data-stu-id="e8d78-149">The filter must be added to a filter table, which is then associated with the service endpoint exposed by the Routing Service.</span></span>  
  
### <a name="namespace-table"></a><span data-ttu-id="e8d78-150">Tabla de espacio de nombres</span><span class="sxs-lookup"><span data-stu-id="e8d78-150">Namespace Table</span></span>  

 <span data-ttu-id="e8d78-151">Al utilizar un filtro XPath, los datos del filtro que contienen la consulta XPath pueden resultar sumamente grandes debido al uso de espacios de nombres.</span><span class="sxs-lookup"><span data-stu-id="e8d78-151">When using an XPath filter, the filter data that contains the XPath query can become extremely large due to the use of namespaces.</span></span> <span data-ttu-id="e8d78-152">Para reducir este problema, el servicio de enrutamiento proporciona la capacidad de definir sus propios prefijos de espacio de nombres utilizando la tabla de espacio de nombres.</span><span class="sxs-lookup"><span data-stu-id="e8d78-152">To alleviate this problem the Routing Service provides the ability to define your own namespace prefixes by using the namespace table.</span></span>  
  
 <span data-ttu-id="e8d78-153">La tabla de espacio de nombres es una colección de objetos <xref:System.ServiceModel.Routing.Configuration.NamespaceElement> que define los prefijos de espacio de nombres para los espacios de nombres comunes que se pueden utilizar en un XPath.</span><span class="sxs-lookup"><span data-stu-id="e8d78-153">The namespace table is a collection of <xref:System.ServiceModel.Routing.Configuration.NamespaceElement> objects that defines the namespace prefixes for common namespaces that can be used in an XPath.</span></span> <span data-ttu-id="e8d78-154">A continuación, se muestran espacios de nombres y prefijos de espacio de nombres predeterminados incluidos en la tabla de espacio de nombres.</span><span class="sxs-lookup"><span data-stu-id="e8d78-154">The following are the default namespaces and namespace prefixes that are contained in the namespace table.</span></span>  
  
|<span data-ttu-id="e8d78-155">Prefijo</span><span class="sxs-lookup"><span data-stu-id="e8d78-155">Prefix</span></span>|<span data-ttu-id="e8d78-156">Espacio de nombres</span><span class="sxs-lookup"><span data-stu-id="e8d78-156">Namespace</span></span>|  
|------------|---------------|  
|<span data-ttu-id="e8d78-157">s11</span><span class="sxs-lookup"><span data-stu-id="e8d78-157">s11</span></span>|`http://schemas.xmlsoap.org/soap/envelope`|  
|<span data-ttu-id="e8d78-158">s12</span><span class="sxs-lookup"><span data-stu-id="e8d78-158">s12</span></span>|`http://www.w3.org/2003/05/soap-envelope`|  
|<span data-ttu-id="e8d78-159">wsaAugust2004</span><span class="sxs-lookup"><span data-stu-id="e8d78-159">wsaAugust2004</span></span>|`http://schemas.xmlsoap.org/ws/2004/08/addressing`|  
|<span data-ttu-id="e8d78-160">wsa10</span><span class="sxs-lookup"><span data-stu-id="e8d78-160">wsa10</span></span>|`http://www.w3.org/2005/08/addressing`|  
|<span data-ttu-id="e8d78-161">sm</span><span class="sxs-lookup"><span data-stu-id="e8d78-161">sm</span></span>|`http://schemas.microsoft.com/serviceModel/2004/05/xpathfunctions`|  
|<span data-ttu-id="e8d78-162">tempuri</span><span class="sxs-lookup"><span data-stu-id="e8d78-162">tempuri</span></span>|`http://tempuri.org`|  
|<span data-ttu-id="e8d78-163">ser</span><span class="sxs-lookup"><span data-stu-id="e8d78-163">ser</span></span>|`http://schemas.microsoft.com/2003/10/Serialization`|  
  
 <span data-ttu-id="e8d78-164">Si sabe que va a usar un espacio de nombres concreto en sus consultas de XPath, puede agregarlo a la tabla de espacio de nombres junto con un prefijo de espacio de nombres único y utilizar dicho prefijo en cualquier consulta XPath en lugar del espacio de nombres completo.</span><span class="sxs-lookup"><span data-stu-id="e8d78-164">When you know that you will be using a specific namespace in your XPath queries, you can add it to the namespace table along with a unique namespace prefix and use the prefix in any XPath query instead of the full namespace.</span></span> <span data-ttu-id="e8d78-165">En el ejemplo siguiente se define un prefijo de "Custom" para el espacio de nombres `"http://my.custom.namespace"` , que después se usa en la consulta XPath contenida en filterData.</span><span class="sxs-lookup"><span data-stu-id="e8d78-165">The following example defines a prefix of "custom" for the namespace `"http://my.custom.namespace"`, which is then used in the XPath query contained in filterData.</span></span>  
  
```xml  
<namespaceTable>  
     <add prefix="custom" namespace="http://my.custom.namespace/"/>  
</namespaceTable>  
<filters>  
     <filter name="XPathFilter" filterType="XPath" filterData="/s12:Envelope/s12:Header/custom:RoundingCalculator = 1"/>  
</filters>  
```  
  
## <a name="filter-tables"></a><span data-ttu-id="e8d78-166">Tablas de filtros</span><span class="sxs-lookup"><span data-stu-id="e8d78-166">Filter Tables</span></span>  

 <span data-ttu-id="e8d78-167">Aunque cada elemento del filtro define una comparación lógica que se puede aplicar a un mensaje, la tabla de filtros proporciona la asociación entre el elemento del filtro y el extremo de cliente de destino.</span><span class="sxs-lookup"><span data-stu-id="e8d78-167">While each filter element defines a logical comparison that can be applied to a message, the filter table provides the association between the filter element and the destination client endpoint.</span></span> <span data-ttu-id="e8d78-168">Una tabla de filtros es una recopilación ordenada de objetos <xref:System.ServiceModel.Routing.Configuration.FilterTableEntryElement> que define la asociación entre un filtro, un extremo de destino primario y una lista de extremos de reserva alternativos.</span><span class="sxs-lookup"><span data-stu-id="e8d78-168">A filter table is a named collection of <xref:System.ServiceModel.Routing.Configuration.FilterTableEntryElement> objects that define the association between a filter, a primary destination endpoint, and a list of alternative backup endpoints.</span></span> <span data-ttu-id="e8d78-169">Las entradas de la tabla de filtros también le permiten especificar una prioridad opcional para cada condición de filtro.</span><span class="sxs-lookup"><span data-stu-id="e8d78-169">The filter table entries also allow you to specify an optional priority for each filter condition.</span></span> <span data-ttu-id="e8d78-170">El siguiente ejemplo define dos filtros y, a continuación, define una tabla de filtros que asocia cada filtro a un punto de conexión de destino.</span><span class="sxs-lookup"><span data-stu-id="e8d78-170">The following example defines two filters and then defines a filter table that associates each filter with a destination endpoint.</span></span>  
  
```xml  
<routing>  
     <filters>  
       <filter name="AddAction" filterType="Action" filterData="Add" />  
       <filter name="SubtractAction" filterType="Action" filterData="Subtract" />  
     </filters>  
     <filterTables>  
       <table name="routingTable1">  
         <filters>  
           <add filterName="AddAction" endpointName="Addition" />  
           <add filterName="SubtractAction" endpointName="Subtraction" />  
         </filters>  
       </table>  
     </filterTables>
</routing>  
```  
  
### <a name="filter-evaluation-priority"></a><span data-ttu-id="e8d78-171">Prioridad de la evaluación de filtros</span><span class="sxs-lookup"><span data-stu-id="e8d78-171">Filter Evaluation Priority</span></span>  

 <span data-ttu-id="e8d78-172">Todas las entradas de la tabla de filtros se evalúan simultáneamente de forma predeterminada, y el mensaje que se evalúa se enruta a los extremos asociados a cada entrada de filtro coincidente.</span><span class="sxs-lookup"><span data-stu-id="e8d78-172">By default, all entries in the filter table are evaluated simultaneously, and the message being evaluated is routed to the endpoint(s) associated with each matching filter entry.</span></span> <span data-ttu-id="e8d78-173">Si varios filtros se evalúan como `true`, y el mensaje es unidireccional o dúplex, el mensaje se transmite por multidifusión a los puntos de conexión de todos los filtros coincidentes.</span><span class="sxs-lookup"><span data-stu-id="e8d78-173">If multiple filters evaluate to `true`, and the message is one-way or duplex, the message is multicast to the endpoints for all matching filters.</span></span> <span data-ttu-id="e8d78-174">Los mensajes solicitud-respuesta no se pueden transmitir por multidifusión porque solo se puede devolver una respuesta al cliente.</span><span class="sxs-lookup"><span data-stu-id="e8d78-174">Request-reply messages cannot be multicast because only one reply can be returned to the client.</span></span>  
  
 <span data-ttu-id="e8d78-175">Puede implementarse una lógica de enrutamiento más compleja especificando niveles de prioridad para cada filtro; el servicio de enrutamiento evalúa primero todos los filtros del nivel de prioridad máxima.</span><span class="sxs-lookup"><span data-stu-id="e8d78-175">More complex routing logic can be implemented by specifying priority levels for each filter; the Routing Service evaluates all filters at the highest priority level first.</span></span> <span data-ttu-id="e8d78-176">Si un mensaje coincide con un filtro de este nivel, no se procesa ningún filtro con una prioridad menor.</span><span class="sxs-lookup"><span data-stu-id="e8d78-176">If a message matches a filter of this level, no filters of a lower priority are processed.</span></span> <span data-ttu-id="e8d78-177">Por ejemplo, un mensaje unidireccional de entrada se evalúa primero con respecto a todos los filtros con prioridad 2.</span><span class="sxs-lookup"><span data-stu-id="e8d78-177">For example, an incoming one-way message is first evaluated against all filters with a priority of 2.</span></span> <span data-ttu-id="e8d78-178">El mensaje no coincide con ningún filtro en este nivel de prioridad, así que, a continuación, el mensaje se compara con los filtros con prioridad 1.</span><span class="sxs-lookup"><span data-stu-id="e8d78-178">The message does not match any filter at this priority level, so next the message is compared against filters with a priority of 1.</span></span> <span data-ttu-id="e8d78-179">Dos filtros de prioridad 1 coinciden con el mensaje y, como es un mensaje unidireccional, se enruta a ambos puntos de conexión de destino.</span><span class="sxs-lookup"><span data-stu-id="e8d78-179">Two priority 1 filters match the message, and because it is a one-way message it is routed to both destination endpoints.</span></span>  <span data-ttu-id="e8d78-180">Dado que se ha detectado una coincidencia en los filtros de prioridad 1, no se evalúa ningún filtro de prioridad 0.</span><span class="sxs-lookup"><span data-stu-id="e8d78-180">Because a match was found among the priority 1 filters, no filters of priority 0 are evaluated.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="e8d78-181">Si no se especifica ninguna prioridad, se usa la prioridad 0 predeterminada.</span><span class="sxs-lookup"><span data-stu-id="e8d78-181">If no priority is specified, the default priority of 0 is used.</span></span>  
  
 <span data-ttu-id="e8d78-182">En el siguiente ejemplo, se define una tabla de filtros que especifica prioridades 2, 1 y 0 para los filtros indicados en la tabla.</span><span class="sxs-lookup"><span data-stu-id="e8d78-182">The following example defines a filter table that specifies priorities of 2, 1, and 0 for the filters referenced in the table.</span></span>  
  
```xml  
<filterTables>  
     <filterTable name="filterTable1">  
          <add filterName="XPathFilter" endpointName="roundingCalcEndpoint"
               priority="2"/>  
          <add filterName="EndpointNameFilter" endpointName="regularCalcEndpoint"
               priority="1"/>  
          <add filterName="PrefixAddressFilter" endpointName="roundingCalcEndpoint"
               priority="1"/>  
          <add filterName="MatchAllMessageFilter" endpointName="defaultCalcEndpoint"
               priority="0"/>  
     </filterTable>  
</filterTables>  
```  
  
 <span data-ttu-id="e8d78-183">En el ejemplo anterior, si un mensaje coincide con XPathFilter, se enrutará a roundingCalcEndpoint y no se evaluará ningún filtro más en la tabla porque todos los demás filtros tienen una prioridad menor.</span><span class="sxs-lookup"><span data-stu-id="e8d78-183">In the preceding example, if a message matches the XPathFilter, it will be routed to the roundingCalcEndpoint and no further filters in the table will be evaluated because all other filters are of a lower priority.</span></span> <span data-ttu-id="e8d78-184">Sin embargo, si el mensaje no coincide con XPathFilter, se evaluará con respecto a todos los filtros de prioridad inmediatamente inferior, EndpointNameFilter y PrefixAddressFilter.</span><span class="sxs-lookup"><span data-stu-id="e8d78-184">However, if the message does not match the XPathFilter it will then be evaluated against all filters of the next lower priority, EndpointNameFilter and PrefixAddressFilter.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="e8d78-185">Cuando sea posible, utilice filtros exclusivos en lugar de especificar una prioridad, ya que la evaluación de la prioridad puede producir una reducción del rendimiento.</span><span class="sxs-lookup"><span data-stu-id="e8d78-185">When possible, use exclusive filters instead of specifying a priority because priority evaluation can result in performance degradation.</span></span>  
  
### <a name="backup-lists"></a><span data-ttu-id="e8d78-186">Listas de reserva</span><span class="sxs-lookup"><span data-stu-id="e8d78-186">Backup Lists</span></span>  

 <span data-ttu-id="e8d78-187">Cada filtro de la tabla de filtros puede especificar opcionalmente una lista de reserva, que es una recopilación ordenada de puntos de conexión (<xref:System.ServiceModel.Routing.Configuration.BackupEndpointCollection>).</span><span class="sxs-lookup"><span data-stu-id="e8d78-187">Each filter in the filter table can optionally specify a backup list, which is a named collection of endpoints (<xref:System.ServiceModel.Routing.Configuration.BackupEndpointCollection>).</span></span> <span data-ttu-id="e8d78-188">Esta colección contiene una lista ordenada de puntos de conexión a los que se transmitirá el mensaje en caso de <xref:System.ServiceModel.CommunicationException> durante un envío al punto de conexión primario especificado en <xref:System.ServiceModel.Routing.Configuration.FilterTableEntryElement.EndpointName%2A>.</span><span class="sxs-lookup"><span data-stu-id="e8d78-188">This collection contains an ordered list of endpoints that the message will be transmitted to in the event of a <xref:System.ServiceModel.CommunicationException> when sending to the primary endpoint specified in <xref:System.ServiceModel.Routing.Configuration.FilterTableEntryElement.EndpointName%2A>.</span></span> <span data-ttu-id="e8d78-189">En el ejemplo siguiente se define una lista de copia de seguridad denominada "backupServiceEndpoints" que contiene dos extremos.</span><span class="sxs-lookup"><span data-stu-id="e8d78-189">The following example defines a backup list named "backupServiceEndpoints" that contains two endpoints.</span></span>  
  
```xml  
<filterTables>  
     <filterTable name="filterTable1">  
          <add filterName="MatchAllFilter1" endpointName="Destination" backupList="backupEndpointList"/>  
     </filterTable>  
</filterTables>  
<backupLists>  
     <backupList name="backupEndpointList">  
          <add endpointName="backupServiceQueue" />  
          <add endpointName="alternateServiceQueue" />  
     </backupList>  
</backupLists>  
```  
  
 <span data-ttu-id="e8d78-190">En el ejemplo anterior, si se produce un error en un envío al punto de conexión principal "destino", el servicio de enrutamiento intentará enviar a cada punto de conexión en la secuencia en la que se enumeran, enviando primero a backupServiceQueue y enviando posteriormente a alternateServiceQueue si se produce un error en el envío a backupServiceQueue.</span><span class="sxs-lookup"><span data-stu-id="e8d78-190">In the preceding example, if a send to the primary endpoint "Destination" fails, the Routing Service will try sending to each endpoint in the sequence they are listed, first sending to backupServiceQueue and subsequently sending to alternateServiceQueue if the send to backupServiceQueue fails.</span></span> <span data-ttu-id="e8d78-191">Si se produce un error en todos los puntos de conexión de reserva, se devuelve un error.</span><span class="sxs-lookup"><span data-stu-id="e8d78-191">If all backup endpoints fail, a fault is returned.</span></span>
