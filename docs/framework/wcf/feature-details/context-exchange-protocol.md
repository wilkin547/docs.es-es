---
title: Protocolo de intercambio de contexto
ms.date: 03/30/2017
ms.assetid: 3dfd38e0-ae52-491c-94f4-7a862b9843d4
ms.openlocfilehash: 86d2a19b086fbd5d6be6f1a084bfd7aaace0e250
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 06/09/2020
ms.locfileid: "84597441"
---
# <a name="context-exchange-protocol"></a><span data-ttu-id="d2fad-102">Protocolo de intercambio de contexto</span><span class="sxs-lookup"><span data-stu-id="d2fad-102">Context Exchange Protocol</span></span>
<span data-ttu-id="d2fad-103">En esta sección se describe el protocolo de intercambio de contexto incluido en Windows Communication Foundation (WCF) versión .NET Framework versión 3,5.</span><span class="sxs-lookup"><span data-stu-id="d2fad-103">This section describes the context exchange protocol introduced in Windows Communication Foundation (WCF) release .NET Framework version 3.5.</span></span> <span data-ttu-id="d2fad-104">Este protocolo permite al canal de cliente que acepte un contexto proporcionado por un servicio y que lo aplique a todas las solicitudes posteriores a ese servicio enviado sobre la misma instancia del canal de cliente.</span><span class="sxs-lookup"><span data-stu-id="d2fad-104">This protocol allows the client channel to accept a context supplied by a service and apply it to all subsequent requests to that service sent over the same client channel instance.</span></span> <span data-ttu-id="d2fad-105">La implementación del protocolo de intercambio de contexto puede utilizar uno de los dos mecanismos siguientes para propagar el contexto entre el servidor y el cliente: cookies de HTTP o un encabezado SOAP.</span><span class="sxs-lookup"><span data-stu-id="d2fad-105">The implementation of the context exchange protocol can use one of the following two mechanisms to propagate the context between the server and the client: HTTP cookies or a SOAP header.</span></span>  
  
 <span data-ttu-id="d2fad-106">El protocolo de intercambio de contexto se implementa en una capa de canal personalizada.</span><span class="sxs-lookup"><span data-stu-id="d2fad-106">The context exchange protocol is implemented in a custom channel layer.</span></span> <span data-ttu-id="d2fad-107">El canal comunica el contexto a y desde el nivel de aplicación utilizando una propiedad <xref:System.ServiceModel.Channels.ContextMessageProperty>.</span><span class="sxs-lookup"><span data-stu-id="d2fad-107">The channel communicates the context to and from the application layer using a <xref:System.ServiceModel.Channels.ContextMessageProperty> property.</span></span> <span data-ttu-id="d2fad-108">Para la transmisión entre extremos, el valor del contexto se serializa como un encabezado SOAP en la capa de canal o convertido a o desde las propiedades de mensaje que representan una solicitud y respuesta HTTP.</span><span class="sxs-lookup"><span data-stu-id="d2fad-108">For transmission between endpoints, the value of the context is either serialized as a SOAP header at the channel layer, or converted to or from the message properties that represent a HTTP request and response.</span></span> <span data-ttu-id="d2fad-109">En el último caso, se espera que una de las capas del canal subyacentes convierta las propiedades de mensajes de solicitud y respuesta HTTP a y desde cookies HTTP, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="d2fad-109">In the latter case, it is expected that one of the underlying channel layers converts the HTTP request and response message properties to and from HTTP cookies, respectively.</span></span> <span data-ttu-id="d2fad-110">La opción del mecanismo utilizado para intercambiar el contexto se realiza mediante la propiedad <xref:System.ServiceModel.Channels.ContextExchangeMechanism> en el <xref:System.ServiceModel.Channels.ContextBindingElement>.</span><span class="sxs-lookup"><span data-stu-id="d2fad-110">The choice of the mechanism used to exchange the context is done using the <xref:System.ServiceModel.Channels.ContextExchangeMechanism> property on the <xref:System.ServiceModel.Channels.ContextBindingElement>.</span></span> <span data-ttu-id="d2fad-111">Los valores válidos son `HttpCookie` y `SoapHeader`.</span><span class="sxs-lookup"><span data-stu-id="d2fad-111">Valid values are `HttpCookie` or `SoapHeader`.</span></span>  
  
 <span data-ttu-id="d2fad-112">En el cliente, una instancia de un canal puede funcionar de dos modos en función de los valores de la propiedad de canal, <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A>.</span><span class="sxs-lookup"><span data-stu-id="d2fad-112">On the client, an instance of a channel can operate in two modes based on the settings on the channel property, <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A>.</span></span>  
  
## <a name="mode-1-channel-context-management"></a><span data-ttu-id="d2fad-113">Modo 1: administración del contexto del canal</span><span class="sxs-lookup"><span data-stu-id="d2fad-113">Mode 1: Channel Context Management</span></span>  
 <span data-ttu-id="d2fad-114">Éste es el modo predeterminado donde <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> está establecido en `true`.</span><span class="sxs-lookup"><span data-stu-id="d2fad-114">This is the default mode where <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> is set to `true`.</span></span> <span data-ttu-id="d2fad-115">En este modo, el canal del contexto administra el contexto y lo almacena en memoria caché durante su duración.</span><span class="sxs-lookup"><span data-stu-id="d2fad-115">In this mode the context channel manages the context and caches the context during its lifetime.</span></span> <span data-ttu-id="d2fad-116">El contexto se puede recuperar desde el canal mediante la propiedad de canal `IContextManager` llamando al método `GetContext`.</span><span class="sxs-lookup"><span data-stu-id="d2fad-116">Context can be retrieved from the channel through channel property `IContextManager` by calling the `GetContext` method.</span></span> <span data-ttu-id="d2fad-117">El canal también se puede preinicializar con contexto concreto antes de abrirse llamando al método `SetContext` en la propiedad de canal.</span><span class="sxs-lookup"><span data-stu-id="d2fad-117">The channel can also be pre-initialized with specific context before being opened by calling the `SetContext` method on the channel property.</span></span> <span data-ttu-id="d2fad-118">Una vez inicializado el canal con contexto no se puede restablecer.</span><span class="sxs-lookup"><span data-stu-id="d2fad-118">Once the channel is initialized with context it cannot be reset.</span></span>  
  
 <span data-ttu-id="d2fad-119">A continuación, se muestra una lista de invariables en este modo:</span><span class="sxs-lookup"><span data-stu-id="d2fad-119">The following is a list of invariants in this mode:</span></span>  
  
- <span data-ttu-id="d2fad-120">Cualquier intento de restablecer el contexto mediante `SetContext` una vez abierto el canal inicia una <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="d2fad-120">Any attempt to reset the context using `SetContext` after the channel has been opened throws an <xref:System.InvalidOperationException>.</span></span>  
  
- <span data-ttu-id="d2fad-121">Cualquier intento de enviar el contexto utilizando la <xref:System.ServiceModel.Channels.ContextMessageProperty> en un mensaje saliente inicia una <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="d2fad-121">Any attempt to send context by using the <xref:System.ServiceModel.Channels.ContextMessageProperty> in an outgoing message throws an <xref:System.InvalidOperationException>.</span></span>  
  
- <span data-ttu-id="d2fad-122">Si un mensaje se recibe del servidor con un contexto concreto, cuando el canal ya se ha inicializado con un contexto concreto, se produce una <xref:System.ServiceModel.ProtocolException>.</span><span class="sxs-lookup"><span data-stu-id="d2fad-122">If a message is received from server with a specific context, when the channel has already been initialized with a specific context, this results in a <xref:System.ServiceModel.ProtocolException>.</span></span>  
  
    > [!NOTE]
    > <span data-ttu-id="d2fad-123">Es adecuado recibir un contexto inicial desde el servidor solo si el canal se abre sin ningún contexto establecido explícitamente.</span><span class="sxs-lookup"><span data-stu-id="d2fad-123">It is appropriate to receive an initial context from the server only if the channel is opened without any context set explicitly.</span></span>  
  
- <span data-ttu-id="d2fad-124"><xref:System.ServiceModel.Channels.ContextMessageProperty> en un mensaje entrante siempre es null.</span><span class="sxs-lookup"><span data-stu-id="d2fad-124">The <xref:System.ServiceModel.Channels.ContextMessageProperty> on incoming message is always null.</span></span>  
  
## <a name="mode-2-application-context-management"></a><span data-ttu-id="d2fad-125">Modo 2: administración de contexto de aplicación</span><span class="sxs-lookup"><span data-stu-id="d2fad-125">Mode 2: Application Context Management</span></span>  
 <span data-ttu-id="d2fad-126">Éste es el modo cuando <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> se establece en `false`.</span><span class="sxs-lookup"><span data-stu-id="d2fad-126">This is the mode when <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> is set to `false`.</span></span> <span data-ttu-id="d2fad-127">En este modo el canal de contexto no administra contexto.</span><span class="sxs-lookup"><span data-stu-id="d2fad-127">In this mode the context channel does not manage context.</span></span> <span data-ttu-id="d2fad-128">Es responsabilidad de la aplicación el recuperar, administrar y aplicar el contexto utilizando la <xref:System.ServiceModel.Channels.ContextMessageProperty>.</span><span class="sxs-lookup"><span data-stu-id="d2fad-128">It is the application's responsibility to retrieve, manage and apply context by using the <xref:System.ServiceModel.Channels.ContextMessageProperty>.</span></span> <span data-ttu-id="d2fad-129">Cualquier intento de llamar al método `GetContext` o `SetContext` produce una <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="d2fad-129">Any attempt to call `GetContext` or `SetContext` results in an <xref:System.InvalidOperationException>.</span></span>  
  
 <span data-ttu-id="d2fad-130">Independientemente del modo elegido, el generador de canales de cliente admite patrones de intercambio de mensajes <xref:System.ServiceModel.Channels.IRequestChannel>, <xref:System.ServiceModel.Channels.IRequestSessionChannel>y <xref:System.ServiceModel.Channels.IDuplexSessionChannel>.</span><span class="sxs-lookup"><span data-stu-id="d2fad-130">No matter which mode is chosen the client channel factory supports <xref:System.ServiceModel.Channels.IRequestChannel>, <xref:System.ServiceModel.Channels.IRequestSessionChannel>, and <xref:System.ServiceModel.Channels.IDuplexSessionChannel> message exchange patterns.</span></span>  
  
 <span data-ttu-id="d2fad-131">En el servicio, una instancia del canal es responsable de convertir el contexto proporcionado por el cliente en los mensajes entrantes a la <xref:System.ServiceModel.Channels.ContextMessageProperty>.</span><span class="sxs-lookup"><span data-stu-id="d2fad-131">On the service, an instance of the channel is responsible for converting the context supplied by the client on incoming messages to the <xref:System.ServiceModel.Channels.ContextMessageProperty>.</span></span> <span data-ttu-id="d2fad-132">A continuación, el nivel de aplicación u otros canales pueden tener acceso a la propiedad de mensaje más arriba en la pila de llamadas.</span><span class="sxs-lookup"><span data-stu-id="d2fad-132">The message property can then be accessed by the application layer or other channels further up in the call stack.</span></span> <span data-ttu-id="d2fad-133">Los canales de servicio también permiten al nivel de aplicación especificar un nuevo valor de contexto se propagará de vuelta al cliente adjuntando una <xref:System.ServiceModel.Channels.ContextMessageProperty> al mensaje de respuesta.</span><span class="sxs-lookup"><span data-stu-id="d2fad-133">The service channels also allow the application layer to specify a new context value to be propagated back to the client by attaching a <xref:System.ServiceModel.Channels.ContextMessageProperty> to the response message.</span></span> <span data-ttu-id="d2fad-134">Esta propiedad se convierte en el encabezado SOAP o en cookie HTTP que contiene el contexto, que depende de la configuración del enlace.</span><span class="sxs-lookup"><span data-stu-id="d2fad-134">This property is converted to the SOAP header or HTTP cookie that contains the context, which depends on the configuration of the binding.</span></span> <span data-ttu-id="d2fad-135">El agente de escuchas del canal de servicio admite patrones de intercambio de mensajes <xref:System.ServiceModel.Channels.IReplyChannel>, <xref:System.ServiceModel.Channels.IReplySessionChannel> y <xref:System.ServiceModel.Channels.IReplySessionChannel>.</span><span class="sxs-lookup"><span data-stu-id="d2fad-135">The service channel listener supports <xref:System.ServiceModel.Channels.IReplyChannel>, <xref:System.ServiceModel.Channels.IReplySessionChannel>, and <xref:System.ServiceModel.Channels.IReplySessionChannel> message exchange patterns.</span></span>  
  
 <span data-ttu-id="d2fad-136">El protocolo de intercambio de contexto introduce un nuevo encabezado SOAP `wsc:Context` para representar las información de contexto cuando no se utilizan cookies HTTP para propagar el contexto.</span><span class="sxs-lookup"><span data-stu-id="d2fad-136">The context exchange protocol introduces a new `wsc:Context` SOAP header to represent the context information when HTTP cookies are not used to propagate the context.</span></span> <span data-ttu-id="d2fad-137">El esquema de encabezado de contexto permite un número ilimitado de elementos secundarios, cada uno con una clave de cadena y contenido de cadena.</span><span class="sxs-lookup"><span data-stu-id="d2fad-137">The context header schema allows for any number of child elements, each with a string key and string content.</span></span> <span data-ttu-id="d2fad-138">A continuación se muestra un ejemplo del encabezado de contexto:</span><span class="sxs-lookup"><span data-stu-id="d2fad-138">The following is an example of a context header.</span></span>  
  
 `<Context xmlns="http://schemas.microsoft.com/ws/2006/05/context">`  
  
 `<property name="myContext">context-2</property>`  
  
 `</Context>`  
  
 <span data-ttu-id="d2fad-139">Cuando se encuentra en modo `HttpCookie`, las cookies se establecen utilizando el encabezado `SetCookie`.</span><span class="sxs-lookup"><span data-stu-id="d2fad-139">When in `HttpCookie` mode, cookies are set using the `SetCookie` header.</span></span> <span data-ttu-id="d2fad-140">El nombre de la cookie es `WscContext`.</span><span class="sxs-lookup"><span data-stu-id="d2fad-140">The cookie name is `WscContext`.</span></span> <span data-ttu-id="d2fad-141">El valor de la cookie es la codificación Base64 del encabezado `wsc:Context`.</span><span class="sxs-lookup"><span data-stu-id="d2fad-141">The value of the cookie is the Base64 encoding of the `wsc:Context` header.</span></span> <span data-ttu-id="d2fad-142">Este valor se encierra entre comillas.</span><span class="sxs-lookup"><span data-stu-id="d2fad-142">This value is enclosed in quotes.</span></span>  
  
 <span data-ttu-id="d2fad-143">El valor del contexto debe protegerse contra modificaciones mientras esté en tránsito por la misma razón que se protegen los encabezados WS-Addressing; el encabezado se utiliza para determinar a dónde enviar la solicitud en el servicio.</span><span class="sxs-lookup"><span data-stu-id="d2fad-143">The value of the context must be protected from modification while in transit for the same reason WS-Addressing headers are protected – the header is used to determine where to dispatch the request to on the service.</span></span> <span data-ttu-id="d2fad-144">El encabezado `wsc:Context` se exige por consiguiente que esté firmado digitalmente o firmado y cifrado en el nivel de transporte o SOAP cuando el enlace ofrece la capacidad de protección de mensajes.</span><span class="sxs-lookup"><span data-stu-id="d2fad-144">The `wsc:Context` header is therefore required to be digitally signed or signed and encrypted at either the SOAP or transport level when the binding offers message protection capability.</span></span> <span data-ttu-id="d2fad-145">Cuando se utilizan cookies HTTP para propagar contexto, deben protegerse utilizando la seguridad de transporte.</span><span class="sxs-lookup"><span data-stu-id="d2fad-145">When HTTP cookies are used to propagate context, they should be protected using transport security.</span></span>  
  
 <span data-ttu-id="d2fad-146">Los puntos de conexión de servicio que requieren compatibilidad con respecto al protocolo de intercambio de contexto pueden hacerlo explícito en la directiva publicada.</span><span class="sxs-lookup"><span data-stu-id="d2fad-146">Service endpoints that require support for the context exchange protocol can make it explicit in the published policy.</span></span> <span data-ttu-id="d2fad-147">Se han introducido dos nuevas aserciones de directivas para representar el requisito de que el cliente admita el protocolo de intercambio de contexto en el nivel de SOAP o de que habilite la compatibilidad con cookies HTTP.</span><span class="sxs-lookup"><span data-stu-id="d2fad-147">Two new policy assertions have been introduced to represent the requirement for the client to support the context exchange protocol at the SOAP level or to enable HTTP cookie support.</span></span> <span data-ttu-id="d2fad-148">La generación de estas aserciones en la directiva en el servicio está controlada por el valor de la propiedad <xref:System.ServiceModel.Channels.ContextBindingElement.ContextExchangeMechanism%2A>, como se muestra a continuación:</span><span class="sxs-lookup"><span data-stu-id="d2fad-148">Generation of these assertions into the policy on the service is controlled by the value of the <xref:System.ServiceModel.Channels.ContextBindingElement.ContextExchangeMechanism%2A> property as follows:</span></span>  
  
- <span data-ttu-id="d2fad-149">Para <xref:System.ServiceModel.Channels.ContextExchangeMechanism.ContextSoapHeader>, se genera la siguiente aserción:</span><span class="sxs-lookup"><span data-stu-id="d2fad-149">For <xref:System.ServiceModel.Channels.ContextExchangeMechanism.ContextSoapHeader>, the following assertion is generated:</span></span>  
  
    ```xml  
    <IncludeContext
    xmlns="http://schemas.microsoft.com/ws/2006/05/context"  
    protectionLevel="Sign" />  
    ```  
  
- <span data-ttu-id="d2fad-150">Para <xref:System.ServiceModel.Channels.ContextExchangeMechanism.HttpCookie>, se genera la siguiente aserción:</span><span class="sxs-lookup"><span data-stu-id="d2fad-150">For <xref:System.ServiceModel.Channels.ContextExchangeMechanism.HttpCookie>, the following assertion is generated:</span></span>  
  
    ```xml  
    <HttpUseCookie xmlns="http://schemas.xmlsoap.org/soap/http"/>  
    ```  
  
## <a name="see-also"></a><span data-ttu-id="d2fad-151">Vea también</span><span class="sxs-lookup"><span data-stu-id="d2fad-151">See also</span></span>

- [<span data-ttu-id="d2fad-152">Guía de interoperabilidad de los protocolos de servicios web</span><span class="sxs-lookup"><span data-stu-id="d2fad-152">Web Services Protocols Interoperability Guide</span></span>](web-services-protocols-interoperability-guide.md)
