---
description: 'Más información sobre: procedimientos recomendados para sesiones confiables'
title: Procedimientos recomendados para lograr sesiones confiables
ms.date: 03/30/2017
ms.assetid: b94f6e01-8070-40b6-aac7-a2cb7b4cb4f2
ms.openlocfilehash: 4b05dd914d2c5b8ec7941417b727bec1e5b43ba4
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/06/2021
ms.locfileid: "99643675"
---
# <a name="best-practices-for-reliable-sessions"></a><span data-ttu-id="3855b-103">Procedimientos recomendados para lograr sesiones confiables</span><span class="sxs-lookup"><span data-stu-id="3855b-103">Best Practices for Reliable Sessions</span></span>

<span data-ttu-id="3855b-104">En este tema se describen los procedimientos recomendados para las sesiones confiables.</span><span class="sxs-lookup"><span data-stu-id="3855b-104">This topic discusses best practices for reliable sessions.</span></span>

## <a name="setting-maxtransferwindowsize"></a><span data-ttu-id="3855b-105">Establecimiento de MaxTransferWindowSize</span><span class="sxs-lookup"><span data-stu-id="3855b-105">Setting MaxTransferWindowSize</span></span>

<span data-ttu-id="3855b-106">Las sesiones confiables en Windows Communication Foundation (WCF) usan una ventana de transferencia para almacenar los mensajes en el cliente y el servicio.</span><span class="sxs-lookup"><span data-stu-id="3855b-106">Reliable sessions in Windows Communication Foundation (WCF) use a transfer window to hold messages on the client and service.</span></span> <span data-ttu-id="3855b-107">La propiedad configurable <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> indica cuántos mensajes puede contener la ventana de transferencia.</span><span class="sxs-lookup"><span data-stu-id="3855b-107">The configurable property <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> indicates how many messages the transfer window can hold.</span></span>

<span data-ttu-id="3855b-108">En el remitente, indica el número de mensajes que puede contener la ventana de transferencia mientras espera las confirmaciones. en el receptor, indica cuántos mensajes se almacenan en búfer para el servicio.</span><span class="sxs-lookup"><span data-stu-id="3855b-108">On the sender, this indicates how many messages the transfer window can hold while waiting for acknowledgements; on the receiver, it indicates how many messages to buffer for the service.</span></span>

<span data-ttu-id="3855b-109">La elección del tamaño adecuado afecta a la eficacia de la red y a la capacidad óptima del servicio.</span><span class="sxs-lookup"><span data-stu-id="3855b-109">Choosing the right size impacts the efficiency of the network and the optimal capacity of the service.</span></span> <span data-ttu-id="3855b-110">En las secciones siguientes se detalla lo que se debe tener en cuenta al elegir un valor para esta propiedad y el impacto del valor.</span><span class="sxs-lookup"><span data-stu-id="3855b-110">The following sections detail what to consider when choosing a value for this property and the impact of the value.</span></span>

<span data-ttu-id="3855b-111">El tamaño predeterminado de la ventana de transferencia es de ocho mensajes.</span><span class="sxs-lookup"><span data-stu-id="3855b-111">The default transfer window size is eight messages.</span></span>

### <a name="efficient-use-of-the-network"></a><span data-ttu-id="3855b-112">Uso eficaz de la red</span><span class="sxs-lookup"><span data-stu-id="3855b-112">Efficient use of the network</span></span>

<span data-ttu-id="3855b-113">En este contexto, el término *red* corresponde a todo lo que se usa como base de la comunicación entre un cliente (remitente) y un servicio (receptor).</span><span class="sxs-lookup"><span data-stu-id="3855b-113">In this context, the term *network* corresponds to everything used as the basis of communication between a client (sender) and a service (receiver).</span></span> <span data-ttu-id="3855b-114">Esto incluye las conexiones de transporte y cualquier intermediario o puentes entre, incluidos los enrutadores SOAP o los proxies o firewalls HTTP.</span><span class="sxs-lookup"><span data-stu-id="3855b-114">This includes the transport connections and any intermediary or bridges in between, including SOAP routers or HTTP proxies/firewalls.</span></span>

<span data-ttu-id="3855b-115">El uso eficaz de la red garantiza el uso total de la capacidad de la red.</span><span class="sxs-lookup"><span data-stu-id="3855b-115">Efficient use of the network ensures that network capacity is fully used.</span></span> <span data-ttu-id="3855b-116">La cantidad de datos que se pueden transferir por segundo a través de la red (*velocidad de datos*) y el tiempo necesario para transferir datos del remitente al receptor (*latencia*) afectan a la eficacia de la utilización de la red.</span><span class="sxs-lookup"><span data-stu-id="3855b-116">Both the amount of data that can be transferred per second over the network (*data rate*) and the time it takes to transfer data from the sender to the receiver (*latency*) impact how effectively the network is utilized.</span></span>

<span data-ttu-id="3855b-117">En el remitente, la propiedad <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> indica cuántos mensajes puede contener su ventana de transferencia mientras espera las confirmaciones.</span><span class="sxs-lookup"><span data-stu-id="3855b-117">On the sender, the property <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> indicates how many messages its transfer window can hold while waiting for acknowledgements.</span></span> <span data-ttu-id="3855b-118">Si la latencia de red es alta y para garantizar un remitente de respuesta y un uso de red eficaz, debe aumentar el tamaño de la ventana de transferencia.</span><span class="sxs-lookup"><span data-stu-id="3855b-118">If the network latency is high and in order to ensure a responsive sender and effective network utilization, you should increase the transfer window size.</span></span>

<span data-ttu-id="3855b-119">Por ejemplo, incluso si el remitente se mantiene con la velocidad de datos, la latencia puede ser alta si existen varios intermediarios entre el remitente y el receptor, o si los datos deben pasar a través de una red o un intermediario de pérdida.</span><span class="sxs-lookup"><span data-stu-id="3855b-119">For example even if the sender keeps up with data rate, latency could be high if several intermediaries exist between the sender and receiver or the data must pass through a lossy intermediary or network.</span></span> <span data-ttu-id="3855b-120">Por lo tanto, el remitente tiene que esperar las confirmaciones de los mensajes en su ventana de transferencia antes de aceptar los mensajes nuevos que se enviarán en la conexión.</span><span class="sxs-lookup"><span data-stu-id="3855b-120">Thus, the sender has to wait for acknowledgements for the messages in its transfer window before accepting new messages to send on the wire.</span></span> <span data-ttu-id="3855b-121">Cuanto menor sea el búfer con latencia alta, menor será la eficacia del uso de la red.</span><span class="sxs-lookup"><span data-stu-id="3855b-121">The smaller the buffer with high latency, the less effective the network utilization.</span></span> <span data-ttu-id="3855b-122">Por otro lado, un tamaño demasiado alto de la ventana de transferencia puede afectar al servicio, ya que es posible que el servicio necesite alcanzar la alta tasa de datos enviados por el cliente.</span><span class="sxs-lookup"><span data-stu-id="3855b-122">On the other hand, too high a transfer window size may impact the service because the service may need to catch up to the high rate of data sent by the client.</span></span>

### <a name="running-the-service-to-capacity"></a><span data-ttu-id="3855b-123">Ejecución del servicio para la capacidad</span><span class="sxs-lookup"><span data-stu-id="3855b-123">Running the service to capacity</span></span>

<span data-ttu-id="3855b-124">En tanto que la red se utiliza de forma eficaz, lo ideal es que también quiera que el servicio se ejecute en una capacidad óptima.</span><span class="sxs-lookup"><span data-stu-id="3855b-124">As much as the network is used efficiently, ideally you also want the service to run at optimal capacity.</span></span> <span data-ttu-id="3855b-125">La propiedad de tamaño de la ventana de transferencia en el receptor indica cuántos mensajes puede almacenar en búfer el receptor.</span><span class="sxs-lookup"><span data-stu-id="3855b-125">The transfer window size property on the receiver indicates how many messages the receiver can buffer.</span></span> <span data-ttu-id="3855b-126">Este almacenamiento en búfer de mensajes no solo ayuda al control del flujo de la red, sino también permite al servicio ejecutarse a capacidad completa.</span><span class="sxs-lookup"><span data-stu-id="3855b-126">This message buffering helps not only the network flow control but also enables the service to run to full capacity.</span></span> <span data-ttu-id="3855b-127">Por ejemplo, si el búfer es un mensaje y los mensajes llegan más rápido de lo que el servicio puede procesar, es posible que la red elimine los mensajes y que la capacidad esté desperdiciada o infrautilizada.</span><span class="sxs-lookup"><span data-stu-id="3855b-127">For example if the buffer is one message and messages arrive faster than the service can process them, then the network might drop messages and capacity might be wasted or underutilized.</span></span>

<span data-ttu-id="3855b-128">El uso de un búfer aumenta la disponibilidad del servicio, ya que recibe y almacena en búfer un mensaje de forma simultánea mientras procesa los mensajes recibidos anteriormente.</span><span class="sxs-lookup"><span data-stu-id="3855b-128">Using a buffer increases the availability of the service as it concurrently receives and buffers a message while processing the previously received messages.</span></span>

<span data-ttu-id="3855b-129">Se recomienda usar el mismo `MaxTransferWindowSize` en el remitente y el receptor.</span><span class="sxs-lookup"><span data-stu-id="3855b-129">We recommended that you use the same `MaxTransferWindowSize` on both the sender and receiver.</span></span>

### <a name="enabling-flow-control"></a><span data-ttu-id="3855b-130">Habilitar el control de flujo</span><span class="sxs-lookup"><span data-stu-id="3855b-130">Enabling flow control</span></span>

<span data-ttu-id="3855b-131">El *control de flujo* es un mecanismo que garantiza que el remitente y el receptor mantienen el ritmo entre sí, es decir, que los mensajes se consumen y actúan con la rapidez con que se producen.</span><span class="sxs-lookup"><span data-stu-id="3855b-131">*Flow control* is a mechanism that ensures that the sender and receiver keep pace with each other, that is, the messages are consumed and acted upon as fast as they're produced.</span></span> <span data-ttu-id="3855b-132">El tamaño de la ventana de transferencia en el cliente y el servicio asegura que el remitente y receptor se encuentran dentro de una ventana razonable de sincronización.</span><span class="sxs-lookup"><span data-stu-id="3855b-132">The transfer window size on the client and service ensures that the sender and receiver are within a reasonable window of synchronization.</span></span>

<span data-ttu-id="3855b-133">Se recomienda establecer la propiedad <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.FlowControlEnabled%2A> en `true` cuando se usa una sesión confiable entre un cliente WCF y un servicio WCF.</span><span class="sxs-lookup"><span data-stu-id="3855b-133">We highly recommended that you set the property <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.FlowControlEnabled%2A> to `true` when you're using a reliable session between a WCF client and a WCF service.</span></span>

## <a name="setting-maxpendingchannels"></a><span data-ttu-id="3855b-134">Establecimiento de MaxPendingChannels</span><span class="sxs-lookup"><span data-stu-id="3855b-134">Setting MaxPendingChannels</span></span>

<span data-ttu-id="3855b-135">Al escribir un servicio que permite la comunicación de sesión confiable de distintos clientes, es posible que muchos clientes establezcan una sesión confiable en el servicio al mismo tiempo.</span><span class="sxs-lookup"><span data-stu-id="3855b-135">When writing a service that enables reliable session communication from different clients, it's possible to have many clients establish a reliable session to the service at the same time.</span></span> <span data-ttu-id="3855b-136">La respuesta del servicio en estas situaciones depende de la propiedad `MaxPendingChannels`.</span><span class="sxs-lookup"><span data-stu-id="3855b-136">The response of the service in these situations depends on the `MaxPendingChannels` property.</span></span>

<span data-ttu-id="3855b-137">Cuando el remitente crea un canal de sesión confiable en un receptor, un protocolo de enlace entre ellos establece una sesión confiable.</span><span class="sxs-lookup"><span data-stu-id="3855b-137">When the sender creates a reliable session channel to a receiver, a handshake between them establishes a reliable session.</span></span> <span data-ttu-id="3855b-138">Una vez establecida la sesión confiable, el canal se coloca en una cola de canales pendientes para que el servicio los acepte.</span><span class="sxs-lookup"><span data-stu-id="3855b-138">After the reliable session is established, the channel is put in a pending channel queue for acceptance by the service.</span></span> <span data-ttu-id="3855b-139">La propiedad `MaxPendingChannels` indica cuántos canales pueden estar en este estado.</span><span class="sxs-lookup"><span data-stu-id="3855b-139">The `MaxPendingChannels` property indicates how many channels can be in this state.</span></span>

<span data-ttu-id="3855b-140">Es posible que el servicio esté en un estado en el que no pueda aceptar más canales.</span><span class="sxs-lookup"><span data-stu-id="3855b-140">It's possible for the service to be in a state where it can't accept more channels.</span></span> <span data-ttu-id="3855b-141">Si la cola está llena, se rechaza un intento de establecer una sesión confiable y el cliente debe volver a intentarlo.</span><span class="sxs-lookup"><span data-stu-id="3855b-141">If the queue is full, an attempt to establish a reliable session is rejected, and the client must retry.</span></span>

<span data-ttu-id="3855b-142">También es posible que los canales pendientes de la cola permanezcan en la cola durante más tiempo.</span><span class="sxs-lookup"><span data-stu-id="3855b-142">It's also possible that the pending channels in the queue remain in the queue for a longer duration.</span></span> <span data-ttu-id="3855b-143">Mientras tanto, se puede producir un tiempo de espera de inactividad en la sesión confiable, lo que provoca que el canal pase a un estado de error.</span><span class="sxs-lookup"><span data-stu-id="3855b-143">In the meantime, an inactivity timeout on the reliable session may occur, causing the channel to transition to a faulted state.</span></span>

<span data-ttu-id="3855b-144">Al escribir un servicio que servicios de varios clientes simultáneamente, debe establecer un valor adecuado para sus necesidades.</span><span class="sxs-lookup"><span data-stu-id="3855b-144">When writing a service that services multiple clients simultaneously, you should set a value that's suitable for your needs.</span></span> <span data-ttu-id="3855b-145">Establecer un valor demasiado alto para la `MaxPendingChannels` propiedad afecta al espacio de trabajo.</span><span class="sxs-lookup"><span data-stu-id="3855b-145">Setting too high a value for the `MaxPendingChannels` property impacts your working set.</span></span>

<span data-ttu-id="3855b-146">El valor predeterminado de <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxPendingChannels%2A> es de cuatro canales.</span><span class="sxs-lookup"><span data-stu-id="3855b-146">The default value for <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxPendingChannels%2A> is four channels.</span></span>

## <a name="reliable-sessions-and-hosting"></a><span data-ttu-id="3855b-147">Hospedaje y sesiones confiables</span><span class="sxs-lookup"><span data-stu-id="3855b-147">Reliable sessions and hosting</span></span>

<span data-ttu-id="3855b-148">Cuando el Web hospeda un servicio que usa sesiones confiables, debe tener en cuenta las siguientes consideraciones importantes:</span><span class="sxs-lookup"><span data-stu-id="3855b-148">When web hosting a service that uses reliable sessions, you should keep the following important considerations in mind:</span></span>

- <span data-ttu-id="3855b-149">Las sesiones confiables tienen estado y el estado se mantiene en el AppDomain.</span><span class="sxs-lookup"><span data-stu-id="3855b-149">Reliable sessions are stateful, and state is maintained in the AppDomain.</span></span> <span data-ttu-id="3855b-150">Esto significa que todos los mensajes que forman parte de una sesión confiable se deben procesar en el mismo AppDomain.</span><span class="sxs-lookup"><span data-stu-id="3855b-150">This means that all messages that are part of a reliable session must be processed in the same AppDomain.</span></span> <span data-ttu-id="3855b-151">Granjas de servidores web y jardines Web en los que el tamaño de la granja o el jardín es mayor que un nodo no puede garantizar esta restricción.</span><span class="sxs-lookup"><span data-stu-id="3855b-151">Web farms and web gardens where the size of the farm or garden is greater than one node can't guarantee this constraint.</span></span>

- <span data-ttu-id="3855b-152">Las sesiones confiables que usan canales HTTP duales (por ejemplo, mediante `WsDualHttpBinding` ) pueden requerir más que el valor predeterminado de dos conexiones http por cliente.</span><span class="sxs-lookup"><span data-stu-id="3855b-152">Reliable sessions using dual HTTP channels (for example, using `WsDualHttpBinding`) can require more than the default of two HTTP connections per-client.</span></span> <span data-ttu-id="3855b-153">Esto significa que una sesión confiable dúplex puede requerir hasta dos conexiones cada vez, ya que los mensajes de protocolo y de aplicación simultáneos pueden transferirse de cada forma en un momento dado.</span><span class="sxs-lookup"><span data-stu-id="3855b-153">This means a duplex reliable session can require up to two connections each way because concurrent application and protocol messages may be transferring each way at any given time.</span></span> <span data-ttu-id="3855b-154">En determinadas condiciones, según el patrón de intercambio de mensajes del servicio, esto significa que es posible crear un interbloqueo de un servicio hospedado en Web mediante el uso de sesiones HTTP duales y confiables.</span><span class="sxs-lookup"><span data-stu-id="3855b-154">Under certain conditions depending on the message exchange pattern of the service, this means that it's possible to deadlock a web-hosted service using dual HTTP and reliable sessions.</span></span> <span data-ttu-id="3855b-155">Para aumentar el número de conexiones HTTP permitidas por cliente, agregue lo siguiente al archivo de configuración correspondiente (por ejemplo, *web.config* del servicio en cuestión):</span><span class="sxs-lookup"><span data-stu-id="3855b-155">To increase the number of allowable HTTP connections per client, add the following to the relevant configuration file (for example, *web.config* of the service in question):</span></span>

  ```xml
  <configuration>
    <system.net>
      <connectionManagement>
        <add name="*" maxconnection="4" />
      </connectionManagement>
    </system.net>
  </configuration>
  ```

  <span data-ttu-id="3855b-156">El valor del `maxconnection` atributo es el número de conexiones necesarias.</span><span class="sxs-lookup"><span data-stu-id="3855b-156">The value of the `maxconnection` attribute is the number of connections needed.</span></span> <span data-ttu-id="3855b-157">En este caso, el mínimo debe ser cuatro conexiones.</span><span class="sxs-lookup"><span data-stu-id="3855b-157">The minimum in this case should be four connections.</span></span>
