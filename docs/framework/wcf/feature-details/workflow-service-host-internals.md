---
description: 'Más información sobre: elementos internos del host de servicio de flujo de trabajo'
title: Información interna de extensiones del host de servicio de flujo de trabajo
ms.date: 03/30/2017
ms.assetid: af44596f-bf6a-4149-9f04-08d8e8f45250
ms.openlocfilehash: fb33e7d6f4e9f78c06459f3d7c8b5c44e2a44a7d
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/06/2021
ms.locfileid: "99704386"
---
# <a name="workflow-service-host-internals"></a><span data-ttu-id="2b1ec-103">Información interna de extensiones del host de servicio de flujo de trabajo</span><span class="sxs-lookup"><span data-stu-id="2b1ec-103">Workflow Service Host Internals</span></span>

<span data-ttu-id="2b1ec-104">La clase <xref:System.ServiceModel.WorkflowServiceHost> proporciona un host para los servicios de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-104"><xref:System.ServiceModel.WorkflowServiceHost> provides a host for workflow services.</span></span> <span data-ttu-id="2b1ec-105">Es responsable de escuchar los mensajes entrantes y enrutarlos a la instancia del servicio de flujo de trabajo adecuada, controlar la descarga y persistencia de los flujos de trabajo inactivos, etc.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-105">It is responsible for listening for incoming messages and routing them to the appropriate workflow service instance, it controls unloading and persisting of idle workflows, and more.</span></span> <span data-ttu-id="2b1ec-106">En este tema se describe cómo procesa la clase WorkflowServiceHost los mensajes entrantes.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-106">This topic describes how WorkflowServiceHost processes incoming messages.</span></span>  
  
## <a name="workflowservicehost-overview"></a><span data-ttu-id="2b1ec-107">Información general de WorkflowServiceHost</span><span class="sxs-lookup"><span data-stu-id="2b1ec-107">WorkflowServiceHost Overview</span></span>  

<span data-ttu-id="2b1ec-108">La clase <xref:System.ServiceModel.WorkflowServiceHost> se usa para hospedar los servicios de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-108">The <xref:System.ServiceModel.WorkflowServiceHost> class is used to host workflow services.</span></span> <span data-ttu-id="2b1ec-109">Escucha los mensajes entrantes y los enruta a la instancia de servicio adecuada. De esta forma, se crean nuevas instancias o se cargan instancias existentes desde un almacenamiento duradero según convenga.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-109">It listens for incoming messages and routes them to the appropriate service instance, creating new instances or loading existing instances from durable storage as needed.</span></span> <span data-ttu-id="2b1ec-110">En el siguiente diagrama se muestra un alto nivel de cómo <xref:System.ServiceModel.WorkflowServiceHost> funciona:</span><span class="sxs-lookup"><span data-stu-id="2b1ec-110">The following diagram illustrates on a high level how <xref:System.ServiceModel.WorkflowServiceHost> works:</span></span>
  
 ![Diagrama que muestra una visión general del host de servicio de flujo de trabajo.](./media/workflow-service-host-internals/workflow-service-host-high-level-overview.gif)  
  
 <span data-ttu-id="2b1ec-112">Este diagrama muestra que la clase <xref:System.ServiceModel.WorkflowServiceHost> carga definiciones de servicio de flujo de trabajo desde archivos .xamlx e información de configuración a partir de un archivo de configuración.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-112">This diagram shows that <xref:System.ServiceModel.WorkflowServiceHost> loads workflow service definitions from .xamlx files and loads configuration information from a configuration file.</span></span> <span data-ttu-id="2b1ec-113">También carga la configuración de seguimiento del perfil de seguimiento.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-113">It also loads tracking configuration from the tracking profile.</span></span> <span data-ttu-id="2b1ec-114"><xref:System.ServiceModel.WorkflowServiceHost> expone un extremo de control de flujo de trabajo que le permite enviar operaciones de control a instancias de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-114"><xref:System.ServiceModel.WorkflowServiceHost> exposes a workflow control endpoint which allows you to send control operations to workflow instances.</span></span>  <span data-ttu-id="2b1ec-115">Para obtener más información, vea [ejemplo de punto de conexión de control de flujo de trabajo](workflow-control-endpoint.md).</span><span class="sxs-lookup"><span data-stu-id="2b1ec-115">For more information see [Workflow Control Endpoint sample](workflow-control-endpoint.md).</span></span>  
  
 <span data-ttu-id="2b1ec-116">La clase <xref:System.ServiceModel.WorkflowServiceHost> también expone los extremos de la aplicación que escuchan los mensajes de aplicación entrantes.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-116"><xref:System.ServiceModel.WorkflowServiceHost> also exposes application endpoints that listen for incoming application messages.</span></span> <span data-ttu-id="2b1ec-117">Cuando un mensaje entrante llega, se envía a la instancia de servicio de flujo de trabajo adecuada, si está cargada actualmente.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-117">When an incoming message arrives it is sent to the appropriate workflow service instance (if it is currently loaded).</span></span> <span data-ttu-id="2b1ec-118">Si es necesario se crea una nueva instancia de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-118">If needed a new workflow instance is created.</span></span> <span data-ttu-id="2b1ec-119">O bien, si se ha conservado una instancia existente, se carga desde el almacén de persistencia.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-119">Or if an existing instance has been persisted it is loaded from the persistence store.</span></span>  
  
## <a name="workflowservicehost-details"></a><span data-ttu-id="2b1ec-120">Detalles de WorkflowServiceHost</span><span class="sxs-lookup"><span data-stu-id="2b1ec-120">WorkflowServiceHost Details</span></span>  

 <span data-ttu-id="2b1ec-121">En el diagrama siguiente se muestra cómo <xref:System.ServiceModel.WorkflowServiceHost> controla los mensajes en un poco más detalle:</span><span class="sxs-lookup"><span data-stu-id="2b1ec-121">The following diagram shows how <xref:System.ServiceModel.WorkflowServiceHost> handles messages in a bit more detail:</span></span>  
  
 ![Diagrama que muestra el flujo de mensajes del host de servicio de flujo de trabajo.](./media/workflow-service-host-internals/workflow-service-host-message-flow.gif)  
  
 <span data-ttu-id="2b1ec-123">Este diagrama muestra tres extremos distintos: un extremo de la aplicación, un extremo de control de flujo de trabajo y un extremo de hospedaje de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-123">This diagram shows three different endpoints, an application endpoint, a workflow control endpoint, and a workflow hosting endpoint.</span></span> <span data-ttu-id="2b1ec-124">El punto de conexión de aplicación recibe los mensajes que se enlazan para una instancia de flujo de trabajo específica.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-124">The application endpoint receives messages that are bound for a specific workflow instance.</span></span> <span data-ttu-id="2b1ec-125">El punto de conexión de control de instancia de flujo de trabajo escucha las operaciones de control.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-125">The workflow control endpoint listens for control operations.</span></span> <span data-ttu-id="2b1ec-126">El extremo de hospedaje de flujo de control escucha mensajes que pueden provocar que la clase <xref:System.ServiceModel.WorkflowServiceHost> cargue y ejecute flujos de trabajo no pertenecientes al servicio.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-126">The workflow hosting endpoint listens for messages that cause <xref:System.ServiceModel.WorkflowServiceHost> to load and execute non-service workflows.</span></span> <span data-ttu-id="2b1ec-127">Como se muestra en el diagrama, se procesan todos los mensajes a través del tiempo de ejecución de WCF.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-127">As shown in the diagram all messages are processed through the WCF runtime.</span></span>  <span data-ttu-id="2b1ec-128">La limitación de instancia de servicio de flujo de trabajo se logra mediante el uso de la propiedad <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentInstances%2A>.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-128">Workflow service instance throttling is achieved by using the <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentInstances%2A> property.</span></span> <span data-ttu-id="2b1ec-129">Esta propiedad limitará el número de instancias de servicio de flujo de trabajo simultáneas.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-129">This property will limit the number of concurrent workflow service instances.</span></span> <span data-ttu-id="2b1ec-130">Se pondrán en cola las solicitudes adicionales de nuevas instancias de servicio de flujo de trabajo o las solicitudes para activar instancias de flujo de trabajo persistentes cuando se supere este límite.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-130">When this throttle is exceeded any additional requests for new workflow service instances or requests to activate persisted workflow instances will be queued.</span></span> <span data-ttu-id="2b1ec-131">Las solicitudes puestas en cola se procesan en el orden FIFO independientemente de si son para una nueva instancia o para un instancia persistente en ejecución.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-131">The queued requests are processed in FIFO order regardless of whether they are requests for a new instance or a running, persisted instance.</span></span> <span data-ttu-id="2b1ec-132">Se carga la información de directivas de host y se determina cómo se tratan las excepciones no controladas, cómo se descargan los servicios de flujo de trabajo inactivos y cómo se conservan.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-132">Host policy information is loaded that determines how unhandled exceptions are dealt with, and how idle workflow services are unloaded and persisted.</span></span> <span data-ttu-id="2b1ec-133">Para obtener más información acerca de estos temas, consulte [How to: configure Workflow Unhandled Exception Behavior with workflowservicehost](config-workflow-unhandled-exception-workflowservicehost.md) y [How to: configure inidle Behavior with workflowservicehost](how-to-configure-idle-behavior-with-workflowservicehost.md).</span><span class="sxs-lookup"><span data-stu-id="2b1ec-133">For more information about these topics see [How to: Configure Workflow Unhandled Exception Behavior with WorkflowServiceHost](config-workflow-unhandled-exception-workflowservicehost.md) and [How to: Configure Idle Behavior with WorkflowServiceHost](how-to-configure-idle-behavior-with-workflowservicehost.md).</span></span> <span data-ttu-id="2b1ec-134">Las instancias de flujo de trabajo se conservan de acuerdo con las directivas de host y se recargan según convenga.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-134">Workflow instances are persisted according to host policies and are reloaded when needed.</span></span> <span data-ttu-id="2b1ec-135">Para obtener más información sobre la persistencia del flujo de trabajo, vea: [Cómo: configurar la persistencia con WorkflowServiceHost](how-to-configure-persistence-with-workflowservicehost.md), [crear un servicio de flujo de trabajo de ejecución prolongada](creating-a-long-running-workflow-service.md)y [persistencia del flujo de trabajo](../../windows-workflow-foundation/workflow-persistence.md).</span><span class="sxs-lookup"><span data-stu-id="2b1ec-135">For more information about workflow persistence see: [How to: Configure Persistence with WorkflowServiceHost](how-to-configure-persistence-with-workflowservicehost.md), [Creating a Long-running Workflow Service](creating-a-long-running-workflow-service.md), and [Workflow Persistence](../../windows-workflow-foundation/workflow-persistence.md).</span></span>  
  
 <span data-ttu-id="2b1ec-136">En la ilustración siguiente se muestra el flujo cuando se llama a WorkflowServiceHost. Open:</span><span class="sxs-lookup"><span data-stu-id="2b1ec-136">The following illustration shows the flow when WorkflowServiceHost.Open is called:</span></span>  
  
 ![Diagrama que muestra el flujo cuando se llama a WorkflowServiceHost. Open.](./media/workflow-service-host-internals/workflow-service-host-open.gif)  
  
 <span data-ttu-id="2b1ec-138">Se carga el flujo de trabajo desde XAML y se crea el árbol de actividad.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-138">The workflow is loaded from XAML and the activity tree is created.</span></span> <span data-ttu-id="2b1ec-139"><xref:System.ServiceModel.WorkflowServiceHost> recorre el árbol de actividad y crea la descripción del servicio.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-139"><xref:System.ServiceModel.WorkflowServiceHost> walks the activity tree and creates the service description.</span></span> <span data-ttu-id="2b1ec-140">La configuración se aplica al host.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-140">Configuration is applied to the host.</span></span> <span data-ttu-id="2b1ec-141">Finalmente, el host empieza a escuchar los mensajes entrantes.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-141">Finally the host begins to listen for incoming messages.</span></span>  
  
 <span data-ttu-id="2b1ec-142">En la ilustración siguiente se muestra lo que <xref:System.ServiceModel.WorkflowServiceHost> hace cuando recibe un mensaje enlazado para una actividad Receive que tiene CanCreateInstance establecido en `true` :</span><span class="sxs-lookup"><span data-stu-id="2b1ec-142">The following illustration shows what the <xref:System.ServiceModel.WorkflowServiceHost> does when it receives a message bound for a Receive activity that has CanCreateInstance set to `true`:</span></span>  
  
 ![Árbol de decisión usado por el host de ft cuando recibe un mensaje y CanCreateInstance es true.](./media/workflow-service-host-internals/workflow-service-host-receive-message-cancreateinstance.gif)  
  
 <span data-ttu-id="2b1ec-144">El mensaje llega y lo procesa la pila del canal WCF.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-144">The message arrives and is processed by the WCF channel stack.</span></span> <span data-ttu-id="2b1ec-145">Se comprueban los límites y se ejecutan las consultas de correlación.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-145">Throttles are checked and correlation queries are executed.</span></span> <span data-ttu-id="2b1ec-146">Si el mensaje se enlaza para una instancia existente, el mensaje se entrega.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-146">If the message is bound for an existing instance the message is delivered.</span></span> <span data-ttu-id="2b1ec-147">Si se debe crear una nueva instancia, se comprueba la propiedad CanCreateInstance de la actividad Receive.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-147">If a new instance needs to be created, the Receive activity’s CanCreateInstance property is checked.</span></span> <span data-ttu-id="2b1ec-148">Si su valor se establece en true, se crea una nueva instancia y se entrega el mensaje.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-148">If it is set to true, a new instance is created and the message is delivered.</span></span>  
  
 <span data-ttu-id="2b1ec-149">En la siguiente ilustración se muestra lo que hace la clase <xref:System.ServiceModel.WorkflowServiceHost> cuando recibe un mensaje enlazado para una actividad Receive con el valor de CanCreateInstance establecido en false.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-149">The following illustration shows what the <xref:System.ServiceModel.WorkflowServiceHost> does when it receives a message bound for a Receive activity that has CanCreateInstance set to false.</span></span>  
  
 ![Árbol de decisión usado por el host de ft cuando recibe un mensaje y CanCreateInstance es false.](./media/workflow-service-host-internals/workflow-service-host-receive-message.gif)  
  
 <span data-ttu-id="2b1ec-151">El mensaje llega y lo procesa la pila del canal WCF.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-151">The message arrives and is processed by the WCF channel stack.</span></span> <span data-ttu-id="2b1ec-152">Se comprueban los límites y se ejecutan las consultas de correlación.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-152">Throttles are checked and correlation queries are executed.</span></span> <span data-ttu-id="2b1ec-153">El mensaje se enlaza para una instancia existente, puesto que el valor de CanCreateInstance es false, con el fin de que la instancia se cargue desde el almacén de persistencia, se reanude el marcador y se ejecute el flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-153">The message is bound for an existing instance (because CanCreateInstance is false) so the instance is loaded from persistence store, the bookmark is resumed and the workflow executes.</span></span>  
  
> [!WARNING]
> <span data-ttu-id="2b1ec-154">Se producirá un error de apertura en el host de servicio de flujo de trabajo si se configura SQL Server para escuchar solo en el protocolo NamedPipe.</span><span class="sxs-lookup"><span data-stu-id="2b1ec-154">Workflow Service Host will fail to open if SQL Server is configured to listen on NamedPipe protocol only.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="2b1ec-155">Vea también</span><span class="sxs-lookup"><span data-stu-id="2b1ec-155">See also</span></span>

- [<span data-ttu-id="2b1ec-156">Servicios de flujo de trabajo</span><span class="sxs-lookup"><span data-stu-id="2b1ec-156">Workflow Services</span></span>](workflow-services.md)
- [<span data-ttu-id="2b1ec-157">Hospedar servicios de flujo de trabajo</span><span class="sxs-lookup"><span data-stu-id="2b1ec-157">Hosting Workflow Services</span></span>](hosting-workflow-services.md)
- [<span data-ttu-id="2b1ec-158">Extremo de control de flujo de trabajo</span><span class="sxs-lookup"><span data-stu-id="2b1ec-158">Workflow Control Endpoint</span></span>](workflow-control-endpoint.md)
- [<span data-ttu-id="2b1ec-159">Procedimiento para configurar el comportamiento de excepción no controlada del flujo de trabajo con WorkflowServiceHost</span><span class="sxs-lookup"><span data-stu-id="2b1ec-159">How to: Configure Workflow Unhandled Exception Behavior with WorkflowServiceHost</span></span>](config-workflow-unhandled-exception-workflowservicehost.md)
- [<span data-ttu-id="2b1ec-160">Crear un servicio de flujo de trabajo de larga ejecución</span><span class="sxs-lookup"><span data-stu-id="2b1ec-160">Creating a Long-running Workflow Service</span></span>](creating-a-long-running-workflow-service.md)
- [<span data-ttu-id="2b1ec-161">Persistencia del flujo de trabajo</span><span class="sxs-lookup"><span data-stu-id="2b1ec-161">Workflow Persistence</span></span>](../../windows-workflow-foundation/workflow-persistence.md)
