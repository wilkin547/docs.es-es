---
title: Procedimientos recomendados acerca de seguridad en WCF
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- best practices [WCF], security
ms.assetid: 3639de41-1fa7-4875-a1d7-f393e4c8bd69
ms.openlocfilehash: c99ab5e1e72aefc688df1692091e60caf930d5e4
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 06/09/2020
ms.locfileid: "84597623"
---
# <a name="best-practices-for-security-in-wcf"></a><span data-ttu-id="75926-102">Procedimientos recomendados acerca de seguridad en WCF</span><span class="sxs-lookup"><span data-stu-id="75926-102">Best Practices for Security in WCF</span></span>
<span data-ttu-id="75926-103">En las secciones siguientes se enumeran los procedimientos recomendados que tener en cuenta a la hora de crear aplicaciones seguras mediante Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="75926-103">The following sections list the best practices to consider when creating secure applications using Windows Communication Foundation (WCF).</span></span> <span data-ttu-id="75926-104">Para obtener más información sobre la seguridad, vea [Consideraciones de seguridad](security-considerations-in-wcf.md), [Consideraciones de seguridad para datos](security-considerations-for-data.md) y [Consideraciones de seguridad con metadatos](security-considerations-with-metadata.md).</span><span class="sxs-lookup"><span data-stu-id="75926-104">For more information about security, see [Security Considerations](security-considerations-in-wcf.md), [Security Considerations for Data](security-considerations-for-data.md), and [Security Considerations with Metadata](security-considerations-with-metadata.md).</span></span>  
  
## <a name="identify-services-performing-windows-authentication-with-spns"></a><span data-ttu-id="75926-105">Identificación de los servicios que utilizan la autenticación de Windows con SPN</span><span class="sxs-lookup"><span data-stu-id="75926-105">Identify Services Performing Windows Authentication with SPNs</span></span>  
 <span data-ttu-id="75926-106">Los servicios se pueden identificar con nombres principales del usuario (UPN) o nombres de entidad de seguridad de servicio (SPN).</span><span class="sxs-lookup"><span data-stu-id="75926-106">Services can be identified with either user principal names (UPNs) or service principal names (SPNs).</span></span> <span data-ttu-id="75926-107">Los servicios que se ejecutan con cuentas de equipo tales como servicio de red tienen una identidad de SPN que corresponde al equipo en que se ejecutan.</span><span class="sxs-lookup"><span data-stu-id="75926-107">Services running under machine accounts such as network service have an SPN identity corresponding to the machine they're running.</span></span> <span data-ttu-id="75926-108">Los servicios que se ejecutan con cuentas de usuario tienen una identidad de UPN que corresponde al usuario en nombre del que se ejecutan, aunque se puede usar la herramienta `setspn` para asignar un SPN a la cuenta de usuario.</span><span class="sxs-lookup"><span data-stu-id="75926-108">Services running under user accounts have a UPN identity corresponding to the user they're running as, although the `setspn` tool can be used to assign an SPN to the user account.</span></span> <span data-ttu-id="75926-109">Configurar un servicio de modo que se pueda identificar a través del SPN y configurar los clientes que se conectan al servicio de manera que utilicen ese SPN puede dificultar ciertos ataques.</span><span class="sxs-lookup"><span data-stu-id="75926-109">Configuring a service so it can be identified via SPN and configuring the clients connecting to the service to use that SPN can make certain attacks more difficult.</span></span> <span data-ttu-id="75926-110">Esta guía se aplica a los enlaces que utilizan la negociación Kerberos o SSPI.</span><span class="sxs-lookup"><span data-stu-id="75926-110">This guidance applies to bindings using Kerberos or SSPI negotiation.</span></span>  <span data-ttu-id="75926-111">Los clientes todavía deberían especificar el SPN si SSPI retrocede a NTLM.</span><span class="sxs-lookup"><span data-stu-id="75926-111">Clients should still specify an SPN in the case where SSPI falls back to NTLM.</span></span>  
  
## <a name="verify-service-identities-in-wsdl"></a><span data-ttu-id="75926-112">Comprobación de las identidades de servicio en WSDL</span><span class="sxs-lookup"><span data-stu-id="75926-112">Verify Service Identities in WSDL</span></span>  
 <span data-ttu-id="75926-113">WS-SecurityPolicy permite a los servicios publicar información sobre sus propias identidades en los metadatos.</span><span class="sxs-lookup"><span data-stu-id="75926-113">WS-SecurityPolicy allows services to publish information about their own identities in metadata.</span></span> <span data-ttu-id="75926-114">Cuando se recupera a través de `svcutil` u otros métodos como <xref:System.ServiceModel.Description.WsdlImporter>, esta información de identidad se convierte en las propiedades de identidad de las direcciones de punto de conexión del servicio WCF.</span><span class="sxs-lookup"><span data-stu-id="75926-114">When retrieved via `svcutil` or other methods such as <xref:System.ServiceModel.Description.WsdlImporter>, this identity information is translated to the identity properties of the WCF service endpoint addresses.</span></span> <span data-ttu-id="75926-115">Los clientes que no comprueban que estas identidades de servicio son correctas y válidas, omiten la autenticación del servicio.</span><span class="sxs-lookup"><span data-stu-id="75926-115">Clients which do not verify that these service identities are correct and valid effectively bypass service authentication.</span></span> <span data-ttu-id="75926-116">Un servicio malintencionado se puede aprovechar de estos clientes para ejecutar ataques de reenvío de credenciales y otros ataques de tipo "Man in the middle" cambiando la identidad alegada en su WSDL.</span><span class="sxs-lookup"><span data-stu-id="75926-116">A malicious service can exploit such clients to execute credential forwarding and other "man in the middle" attacks by changing the identity claimed in its WSDL.</span></span>  
  
## <a name="use-x509-certificates-instead-of-ntlm"></a><span data-ttu-id="75926-117">Uso de certificados X509 en lugar de NTLM</span><span class="sxs-lookup"><span data-stu-id="75926-117">Use X509 Certificates Instead of NTLM</span></span>  
 <span data-ttu-id="75926-118">WCF proporciona dos mecanismos para la autenticación punto a punto: los certificados X509 (usados por el canal del mismo nivel) y la autenticación de Windows, donde la negociación SSPI disminuye de Kerberos a NTLM.</span><span class="sxs-lookup"><span data-stu-id="75926-118">WCF offers two mechanisms for peer-to-peer authentication: X509 certificates (used by peer channel) and Windows authentication where an SSPI negotiation downgrades from Kerberos to NTLM.</span></span>  <span data-ttu-id="75926-119">Se prefiere la autenticación basada en certificado con tamaños de clave de 1024 bits o más antes que NTLM por varias razones:</span><span class="sxs-lookup"><span data-stu-id="75926-119">Certificate-based authentication using key sizes of 1024 bits or more is preferred to NTLM for several reasons:</span></span>  
  
- <span data-ttu-id="75926-120">la disponibilidad de la autenticación mutua</span><span class="sxs-lookup"><span data-stu-id="75926-120">the availability of mutual authentication,</span></span>  
  
- <span data-ttu-id="75926-121">el uso de algoritmos criptográficos más seguros y</span><span class="sxs-lookup"><span data-stu-id="75926-121">the use of stronger cryptographic algorithms, and</span></span>  
  
- <span data-ttu-id="75926-122">la mayor dificultad de usar credenciales X509 reenviadas.</span><span class="sxs-lookup"><span data-stu-id="75926-122">the greater difficulty of utilizing forwarded X509 credentials.</span></span>  

## <a name="always-revert-after-impersonation"></a><span data-ttu-id="75926-123">Siempre revierta tras la suplantación</span><span class="sxs-lookup"><span data-stu-id="75926-123">Always Revert After Impersonation</span></span>  
 <span data-ttu-id="75926-124">Al utilizar API que permiten la suplantación de un cliente, asegúrese de revertir a la identidad original.</span><span class="sxs-lookup"><span data-stu-id="75926-124">When using APIs that enable impersonation of a client, be sure to revert to the original identity.</span></span> <span data-ttu-id="75926-125">Por ejemplo, al usar <xref:System.Security.Principal.WindowsIdentity> y <xref:System.Security.Principal.WindowsImpersonationContext>, use la instrucción `using` de C# o la instrucción `Using` de Visual Basic, como se muestra en el código siguiente.</span><span class="sxs-lookup"><span data-stu-id="75926-125">For example, when using the <xref:System.Security.Principal.WindowsIdentity> and <xref:System.Security.Principal.WindowsImpersonationContext>, use the C# `using` statement or the Visual Basic`Using` statement, as shown in the following code.</span></span> <span data-ttu-id="75926-126">La clase <xref:System.Security.Principal.WindowsImpersonationContext> implementa la interfaz <xref:System.IDisposable> y, por consiguiente, Common Language Runtime (CLR) revierte automáticamente a la identidad original una vez que el código deja el bloque `using`.</span><span class="sxs-lookup"><span data-stu-id="75926-126">The <xref:System.Security.Principal.WindowsImpersonationContext> class implements the <xref:System.IDisposable> interface, and therefore the common language runtime (CLR) automatically reverts to the original identity once the code leaves the `using` block.</span></span>  
  
 [!code-csharp[c_SecurityBestPractices#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securitybestpractices/cs/source.cs#1)]
 [!code-vb[c_SecurityBestPractices#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securitybestpractices/vb/source.vb#1)]  
  
## <a name="impersonate-only-as-needed"></a><span data-ttu-id="75926-127">Suplante solo cuando sea necesario</span><span class="sxs-lookup"><span data-stu-id="75926-127">Impersonate Only as Needed</span></span>  
 <span data-ttu-id="75926-128">Con el método <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> de la clase <xref:System.Security.Principal.WindowsIdentity>, es posible utilizar la suplantación en un ámbito muy controlado.</span><span class="sxs-lookup"><span data-stu-id="75926-128">Using the <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> method of the <xref:System.Security.Principal.WindowsIdentity> class, it is possible to use impersonation in a very controlled scope.</span></span> <span data-ttu-id="75926-129">Esto se opone al uso de la propiedad <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> del <xref:System.ServiceModel.OperationBehaviorAttribute>, que permite la suplantación en toda la operación.</span><span class="sxs-lookup"><span data-stu-id="75926-129">This is in contrast to using the <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> property of the <xref:System.ServiceModel.OperationBehaviorAttribute>, which allows impersonation for the scope of the entire operation.</span></span> <span data-ttu-id="75926-130">Siempre que sea posible, controle el ámbito de suplantación utilizando el método <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> más preciso.</span><span class="sxs-lookup"><span data-stu-id="75926-130">Whenever possible, control the scope of impersonation by using the more precise <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> method.</span></span>  
  
## <a name="obtain-metadata-from-trusted-sources"></a><span data-ttu-id="75926-131">Obtención de los metadatos desde fuentes de confianza</span><span class="sxs-lookup"><span data-stu-id="75926-131">Obtain Metadata from Trusted Sources</span></span>  
 <span data-ttu-id="75926-132">Asegúrese de que confía en el origen de sus metadatos y de que nadie ha manipulado los metadatos.</span><span class="sxs-lookup"><span data-stu-id="75926-132">Be sure you trust the source of your metadata and make sure that no one has tampered with the metadata.</span></span> <span data-ttu-id="75926-133">Los metadatos recuperados utilizando el protocolo HTTP se envían en texto no cifrado y se pueden manipular.</span><span class="sxs-lookup"><span data-stu-id="75926-133">Metadata retrieved using the HTTP protocol is sent in clear text and can be tampered with.</span></span> <span data-ttu-id="75926-134">Si el servicio utiliza la propiedad <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetEnabled%2A> y <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetUrl%2A>, utilice la URL proporcionada por el creador del servicio para descargar los datos mediante el protocolo HTTPS.</span><span class="sxs-lookup"><span data-stu-id="75926-134">If the service uses the <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetEnabled%2A> and <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetUrl%2A> properties, use the URL supplied by the service creator to download the data using the HTTPS protocol.</span></span>  
  
## <a name="publish-metadata-using-security"></a><span data-ttu-id="75926-135">Publicación de metadatos utilizando la seguridad</span><span class="sxs-lookup"><span data-stu-id="75926-135">Publish Metadata Using Security</span></span>  
 <span data-ttu-id="75926-136">Para evitar la modificación de los metadatos publicados de un servicio, proteja el punto de conexión de intercambio de metadatos mediante seguridad de mensajes o de transporte.</span><span class="sxs-lookup"><span data-stu-id="75926-136">To prevent tampering with a service's published metadata, secure the metadata exchange endpoint with transport or message-level security.</span></span> <span data-ttu-id="75926-137">Para obtener más información, vea [Publicación de puntos de conexión de metadatos](../publishing-metadata-endpoints.md) y [Publicación de metadatos para un servicio mediante código](how-to-publish-metadata-for-a-service-using-code.md).</span><span class="sxs-lookup"><span data-stu-id="75926-137">For more information, see [Publishing Metadata Endpoints](../publishing-metadata-endpoints.md) and [How to: Publish Metadata for a Service Using Code](how-to-publish-metadata-for-a-service-using-code.md).</span></span>  
  
## <a name="ensure-use-of-local-issuer"></a><span data-ttu-id="75926-138">Asegure el uso de un emisor local</span><span class="sxs-lookup"><span data-stu-id="75926-138">Ensure Use of Local Issuer</span></span>  
 <span data-ttu-id="75926-139">Si se especifica una dirección y un enlace del emisor para un enlace determinado, el emisor local no se utiliza para los extremos que utilizan ese enlace.</span><span class="sxs-lookup"><span data-stu-id="75926-139">If an issuer address and binding are specified for a given binding, the local issuer is not used for endpoints that use that binding.</span></span> <span data-ttu-id="75926-140">Los clientes que esperan utilizar siempre el emisor local deberían asegurarse de que no utilizan dicho enlace o de que modifican el enlace de manera que la dirección del emisor sea null.</span><span class="sxs-lookup"><span data-stu-id="75926-140">Clients who expect to always use the local issuer should ensure that they do not use such a binding or that they modify the binding such that the issuer address is null.</span></span>  
  
## <a name="saml-token-size-quotas"></a><span data-ttu-id="75926-141">Cuotas de tamaño de tokens de SAML</span><span class="sxs-lookup"><span data-stu-id="75926-141">SAML Token Size Quotas</span></span>  
 <span data-ttu-id="75926-142">Cuando los tokens de Security Assertions Markup Language (SAML) se serializan en mensajes, cuando los emite un servicio de tokens de seguridad (STS) o cuando son presentados por clientes a servicios como parte de la autenticación, la cuota de tamaño máximo del mensaje debe ser suficientemente grande para alojar el token SAML y las otras partes del mensaje.</span><span class="sxs-lookup"><span data-stu-id="75926-142">When Security Assertions Markup Language (SAML) tokens are serialized in messages, either when they are issued by a Security Token Service (STS) or when clients present them to services as part of authentication, the maximum message size quota must be sufficiently large to accommodate the SAML token and the other message parts.</span></span> <span data-ttu-id="75926-143">En casos normales, las cuotas de tamaño del mensaje predeterminadas son suficientes.</span><span class="sxs-lookup"><span data-stu-id="75926-143">In normal cases, the default message size quotas are sufficient.</span></span> <span data-ttu-id="75926-144">Sin embargo, en los casos en los que un token de SAML sea grande porque contiene cientos de notificaciones, se deberían incrementar las cuotas para alojar al token serializado.</span><span class="sxs-lookup"><span data-stu-id="75926-144">However, in cases where a SAML token is large because it contains hundreds of claims, the quotas should be increased to accommodate the serialized token.</span></span> <span data-ttu-id="75926-145">Para obtener más información sobre las cuotas, vea [Consideraciones de seguridad para datos](security-considerations-for-data.md).</span><span class="sxs-lookup"><span data-stu-id="75926-145">For more information about quotas, see [Security Considerations for Data](security-considerations-for-data.md).</span></span>  
  
## <a name="set-securitybindingelementincludetimestamp-to-true-on-custom-bindings"></a><span data-ttu-id="75926-146">Establecer SecurityBindingElement.IncludeTimestamp en True en enlaces personalizados</span><span class="sxs-lookup"><span data-stu-id="75926-146">Set SecurityBindingElement.IncludeTimestamp to True on Custom Bindings</span></span>  
 <span data-ttu-id="75926-147">Al crear un enlace personalizado, debe establecer <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> en `true`.</span><span class="sxs-lookup"><span data-stu-id="75926-147">When you create a custom binding, you must set <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> to `true`.</span></span> <span data-ttu-id="75926-148">De lo contrario, si <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> se establece en `false` y el cliente usa un token basado en clave asimétrica, como un certificado X509, el mensaje no se firmará.</span><span class="sxs-lookup"><span data-stu-id="75926-148">Otherwise, if <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> is set to `false`, and the client is using an asymmetric key-based token such as an X509 certificate, the message will not be signed.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="75926-149">Vea también</span><span class="sxs-lookup"><span data-stu-id="75926-149">See also</span></span>

- [<span data-ttu-id="75926-150">Consideraciones sobre la seguridad</span><span class="sxs-lookup"><span data-stu-id="75926-150">Security Considerations</span></span>](security-considerations-in-wcf.md)
- [<span data-ttu-id="75926-151">Consideraciones de seguridad para datos</span><span class="sxs-lookup"><span data-stu-id="75926-151">Security Considerations for Data</span></span>](security-considerations-for-data.md)
- [<span data-ttu-id="75926-152">Consideraciones de seguridad con metadatos</span><span class="sxs-lookup"><span data-stu-id="75926-152">Security Considerations with Metadata</span></span>](security-considerations-with-metadata.md)
