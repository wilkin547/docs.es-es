---
title: Kit de herramientas de RuleSet externo
ms.date: 03/30/2017
ms.assetid: a306d283-a031-475e-aa01-9ae86e7adcb0
ms.openlocfilehash: b07d2b63d9f3d98b8f08eb697a8d688d8fac1962
ms.sourcegitcommit: 5fb5b6520b06d7f5e6131ec2ad854da302a28f2e
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 12/03/2019
ms.locfileid: "74710898"
---
# <a name="external-ruleset-toolkit"></a><span data-ttu-id="f3bc6-102">Kit de herramientas de RuleSet externo</span><span class="sxs-lookup"><span data-stu-id="f3bc6-102">External Ruleset Toolkit</span></span>

<span data-ttu-id="f3bc6-103">Normalmente cuando las reglas se utilizan dentro de una aplicación de flujo de trabajo, las reglas forman parte del ensamblado.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-103">Normally when rules are used within a workflow application, the rules are part of the assembly.</span></span> <span data-ttu-id="f3bc6-104">En algunos escenarios, puede desear mantener separadamente RuleSets del ensamblado para que se puedan actualizar sin recompilar e implementar el ensamblado de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-104">In some scenarios, you may want to maintain the RuleSets separately from the assembly so that they can be updated without rebuilding and deploying the workflow assembly.</span></span> <span data-ttu-id="f3bc6-105">Este ejemplo le permite administrar y editar RuleSets en una base de datos y acceder a ellos desde un flujo de trabajo en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-105">This sample allows you to manage and edit RuleSets in a database and access those RuleSets from a workflow at runtime.</span></span> <span data-ttu-id="f3bc6-106">Esto habilita las instancias de flujo de trabajo en ejecución para que incorporen automáticamente los cambios de RuleSet.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-106">This enables running workflow instances to automatically incorporate RuleSet changes.</span></span>

<span data-ttu-id="f3bc6-107">El ejemplo de kit de herramientas de RuleSet Kit externo contiene una herramienta basada en Windows Forms que puede utilizar para administrar y editar las versiones de RuleSet en una base de datos.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-107">The External RuleSet Toolkit sample contains a Windows Forms-based tool that you can use to manage and edit RuleSet versions in a database.</span></span> <span data-ttu-id="f3bc6-108">También incluye una actividad y un servicio de host para ejecutar esas reglas.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-108">It also includes an activity and a host service for executing those rules.</span></span>

> [!NOTE]
> <span data-ttu-id="f3bc6-109">Este ejemplo requiere [Microsoft SQL Server](https://go.microsoft.com/fwlink/?LinkId=96181).</span><span class="sxs-lookup"><span data-stu-id="f3bc6-109">This sample requires [Microsoft SQL Server](https://go.microsoft.com/fwlink/?LinkId=96181).</span></span>

<span data-ttu-id="f3bc6-110">Visual Studio proporciona un editor RuleSet como parte del Windows Workflow Foundation (WF).</span><span class="sxs-lookup"><span data-stu-id="f3bc6-110">Visual Studio provides a RuleSet editor as part of the Windows Workflow Foundation (WF).</span></span> <span data-ttu-id="f3bc6-111">Puede iniciar este editor haciendo doble clic en la actividad `Policy` en un flujo de trabajo; serializa el objeto RuleSet definido al archivo .rules asociado al flujo de trabajo (una actividad `Policy` ejecuta una instancia de RuleSet contra el flujo de trabajo).</span><span class="sxs-lookup"><span data-stu-id="f3bc6-111">You can start this editor by double-clicking the `Policy` activity in a workflow; it serializes the defined RuleSet object to the .rules file associated with the workflow (a `Policy` activity runs a RuleSet instance against the workflow).</span></span> <span data-ttu-id="f3bc6-112">El archivo .rules está compilado en el ensamblado como un recurso al generar el proyecto de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-112">The .rules file is compiled into the assembly as a resource when you build the workflow project.</span></span>

<span data-ttu-id="f3bc6-113">Los componentes de este ejemplo incluyen:</span><span class="sxs-lookup"><span data-stu-id="f3bc6-113">The components of this sample include:</span></span>

- <span data-ttu-id="f3bc6-114">Una herramienta de interfaz gráfica de usuario de RuleSet que puede utilizar para editar y administrar las versiones de RuleSet en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-114">A RuleSet graphical user interface tool that you can use to edit and manage RuleSet versions in the database.</span></span>

- <span data-ttu-id="f3bc6-115">Un servicio de RuleSet que se configura en la aplicación del host y que accede a los RuleSets de la base de datos.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-115">A RuleSet service that is configured on the host application and accesses RuleSets from the database.</span></span>

- <span data-ttu-id="f3bc6-116">Una actividad `ExternalPolicy` que solicita un RuleSet al servicio de RuleSet y ejecuta el RuleSet contra el flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-116">An `ExternalPolicy` activity that requests a RuleSet from the RuleSet service and runs the RuleSet against the workflow.</span></span>

<span data-ttu-id="f3bc6-117">La interacción de los componentes se muestra en la siguiente imagen.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-117">The interaction of the components is shown in the following image.</span></span> <span data-ttu-id="f3bc6-118">Las secciones que siguen describen cada componente.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-118">The sections that follow describe each component.</span></span>

![Diagrama que muestra la información general del ejemplo del kit de herramientas de RuleSet externo.](./media/external-ruleset-toolkit/ruleset-toolkit-overview.gif)

> [!IMPORTANT]
> <span data-ttu-id="f3bc6-120">Puede que los ejemplos ya estén instalados en su equipo.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-120">The samples may already be installed on your machine.</span></span> <span data-ttu-id="f3bc6-121">Compruebe el siguiente directorio (predeterminado) antes de continuar.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-121">Check for the following (default) directory before continuing.</span></span>
>
> `<InstallDrive>:\WF_WCF_Samples`
>
> <span data-ttu-id="f3bc6-122">Si este directorio no existe, vaya a [ejemplos de Windows Communication Foundation (WCF) y Windows Workflow Foundation (WF) para .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) para descargar todos los ejemplos de Windows Communication Foundation (WCF) y [!INCLUDE[wf1](../../../../includes/wf1-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f3bc6-122">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="f3bc6-123">Este ejemplo se encuentra en el siguiente directorio.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-123">This sample is located in the following directory.</span></span>
>
> `<InstallDrive>:\WF_WCF_Samples\WF\Scenario\ExternalRuleSetToolKit`

## <a name="ruleset-tool"></a><span data-ttu-id="f3bc6-124">Herramienta RuleSet</span><span class="sxs-lookup"><span data-stu-id="f3bc6-124">RuleSet Tool</span></span>

<span data-ttu-id="f3bc6-125">La imagen siguiente es una captura de pantalla de la herramienta RuleSet.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-125">The following image is a screenshot of the RuleSet tool.</span></span> <span data-ttu-id="f3bc6-126">En el menú **almacén de reglas** , puede cargar los conjuntos de reglas disponibles de la base de datos y volver a guardar los conjuntos de reglas modificados en el almacén.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-126">From the **Rule Store** menu, you can load the available RuleSets from the database and save modified RuleSets back to the store.</span></span> <span data-ttu-id="f3bc6-127">Un archivo de configuración de la aplicación proporciona una cadena de conexión a bases de datos para la base de datos RuleSet.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-127">An application configuration file provides a database connection string for the RuleSet database.</span></span> <span data-ttu-id="f3bc6-128">Al iniciar la herramienta, carga automáticamente los RuleSets de la base de datos configurada.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-128">When you start the tool, it automatically loads the RuleSets from the configured database.</span></span>

![Captura de pantalla que muestra el explorador RuleSet.](./media/external-ruleset-toolkit/ruleset-browser-dialog.gif)

<span data-ttu-id="f3bc6-130">La herramienta RuleSet aplica números de versión principal y secundario a los RuleSets, permitiéndole mantener simultáneamente y almacenar varias versiones (la herramienta no proporciona ningún bloqueo u otras características de gestión de la configuración además de la función de administración de la versión).</span><span class="sxs-lookup"><span data-stu-id="f3bc6-130">The RuleSet tool applies major and minor version numbers to the RuleSets, allowing you to simultaneously maintain and store multiple versions (the tool provides no locking or other configuration management features in addition to the versioning capability).</span></span> <span data-ttu-id="f3bc6-131">Con la herramienta, puede crear nuevas versiones de RuleSet o eliminar las versiones existentes.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-131">Using the tool, you can create new RuleSet versions or delete existing versions.</span></span> <span data-ttu-id="f3bc6-132">Al hacer clic en **nuevo**, la herramienta crea un nuevo nombre de ruleset y aplica la versión 1,0.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-132">When you click **New**, the tool creates a new RuleSet name and applies version 1.0.</span></span> <span data-ttu-id="f3bc6-133">Al copiar una versión, la herramienta crea una copia de la versión RuleSet seleccionada, incluidas las reglas contenidas, y asigna los nuevos números de versión únicos.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-133">When you copy a version, the tool creates a copy of the selected RuleSet version, including the contained rules, and assigns new, unique version numbers.</span></span> <span data-ttu-id="f3bc6-134">Estos números de versión están basados en los números de versión de los RuleSets existentes.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-134">These version numbers are based on the version numbers of existing RuleSets.</span></span> <span data-ttu-id="f3bc6-135">Puede cambiar el nombre de RuleSet y los números de versión utilizando los campos asociados en el formulario.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-135">You can change the RuleSet name and version numbers using the associated fields on the form.</span></span>

<span data-ttu-id="f3bc6-136">Al hacer clic en **editar reglas**, se inicia el editor de ruleset, tal como se muestra en la siguiente imagen:</span><span class="sxs-lookup"><span data-stu-id="f3bc6-136">When you click **Edit Rules**, the RuleSet editor starts, as shown in the following image:</span></span>

![Captura de pantalla que muestra el editor de RuleSet.](./media/external-ruleset-toolkit/ruleset-editor-dialog.gif)

<span data-ttu-id="f3bc6-138">Se trata de un nuevo hospedaje del cuadro de diálogo del editor que forma parte del complemento Windows Workflow Foundation Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-138">This is a re-hosting of the editor dialog that is part of the Windows Workflow Foundation Visual Studio add-in.</span></span> <span data-ttu-id="f3bc6-139">Proporciona la misma funcionalidad, incluyendo la compatibilidad del IntelliSense.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-139">It provides the same functionality, including Intellisense support.</span></span> <span data-ttu-id="f3bc6-140">Las reglas se crean con un tipo de destino (por ejemplo, un flujo de trabajo) que está asociado con el conjunto de reglas de la herramienta. al hacer clic en **examinar** en el cuadro de diálogo principal de la herramienta, aparece el cuadro de diálogo **selector de flujo de trabajo/tipo** , como se muestra en la figura 4.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-140">The rules are authored against a target type (such as a workflow) that is associated with the RuleSet in the tool; when you click **Browse** in the main tool dialog, the **Workflow/Type Selector** dialog appears, as shown in Figure 4.</span></span>

<span data-ttu-id="f3bc6-141">![Selección &#47;de tipo de flujo de trabajo](./media/71f08d57-e8f2-499e-8151-ece2cbdcabfd.gif "71f08d57-e8f2-499e-8151-ece2cbdcabfd")</span><span class="sxs-lookup"><span data-stu-id="f3bc6-141">![Workflow &#47;Type Selection](./media/71f08d57-e8f2-499e-8151-ece2cbdcabfd.gif "71f08d57-e8f2-499e-8151-ece2cbdcabfd")</span></span>

<span data-ttu-id="f3bc6-142">Figura 4: Selector de flujo de trabajo/tipo</span><span class="sxs-lookup"><span data-stu-id="f3bc6-142">Figure 4: Workflow/Type Selector</span></span>

<span data-ttu-id="f3bc6-143">Puede usar el cuadro de diálogo **selector de flujo de trabajo/tipo** para especificar un ensamblado y un tipo específico dentro de ese ensamblado.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-143">You can use the **Workflow/Type Selector** dialog to specify an assembly and a specific type within that assembly.</span></span> <span data-ttu-id="f3bc6-144">Este tipo es el tipo de destino contra el que se crean (y se ejecuta) las reglas.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-144">This type is the target type against which the rules are authored (and run).</span></span> <span data-ttu-id="f3bc6-145">En muchos casos, el tipo de destino es un flujo de trabajo o algún otro tipo de actividad.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-145">In many cases, the target type is a workflow or some other activity type.</span></span> <span data-ttu-id="f3bc6-146">Sin embargo, puede ejecutar un RuleSet contra cualquier tipo de .NET.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-146">However, you can run a RuleSet against any .NET type.</span></span>

<span data-ttu-id="f3bc6-147">La ruta de acceso al archivo de ensamblado y el tipo `name are stored with the` RuleSet en la base de datos, de modo que cuando se recupere el conjunto de reglas de la base de datos, la herramienta intente cargar automáticamente el tipo de destino.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-147">The path to the assembly file and the type `name are stored with the` RuleSet in the database, so that when the RuleSet is retrieved from the database, the tool attempts to automatically load the target type.</span></span>

<span data-ttu-id="f3bc6-148">Al hacer clic en **Aceptar** en el cuadro de diálogo **selector de flujo de trabajo/tipo** , valida el tipo seleccionado en el conjunto de reglas para asegurarse de que el tipo de destino tenga todos los miembros a los que hacen referencia las reglas.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-148">When you click **OK** in the **Workflow/Type Selector** dialog, it validates the selected type against the RuleSet, to ensure that the target type has all the members referenced by the rules.</span></span> <span data-ttu-id="f3bc6-149">Los errores se muestran en un cuadro de diálogo **errores de validación** .</span><span class="sxs-lookup"><span data-stu-id="f3bc6-149">Errors are shown in a **Validation Errors** dialog.</span></span> <span data-ttu-id="f3bc6-150">Puede optar por continuar con el cambio a pesar de los errores o hacer clic en **Cancelar**.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-150">You can choose to continue with the change despite the errors, or click **Cancel**.</span></span> <span data-ttu-id="f3bc6-151">En el menú **herramientas** del cuadro de diálogo principal de la herramienta, puede hacer clic en **validar** para volver a validar la versión del ruleset con respecto a la actividad de destino.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-151">From the **Tools** menu in the main tool dialog, you can click **Validate** to re-validate the RuleSet version against the target activity.</span></span>

![Captura de pantalla que muestra el cuadro de diálogo errores de validación.](./media/external-ruleset-toolkit/validation-errors-dialog.png)

<span data-ttu-id="f3bc6-153">En el menú **datos** de la herramienta, puede importar y exportar conjuntos de herramientas.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-153">From the **Data** menu in the tool, you can import and export RuleSets.</span></span> <span data-ttu-id="f3bc6-154">Al hacer clic en **importar**, aparece un cuadro de diálogo Selector de archivos, desde el que puede seleccionar un archivo. rules.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-154">When you click **Import**, a file-chooser dialog appears, from which you can select a .rules file.</span></span> <span data-ttu-id="f3bc6-155">Puede ser o no un archivo creado inicialmente en Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-155">This may or may not be a file initially created in Visual Studio.</span></span> <span data-ttu-id="f3bc6-156">El archivo .rules debería contener una instancia `RuleDefinitions` serializada que contiene una colección de condiciones y una colección de RuleSets.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-156">The .rules file should contain a serialized `RuleDefinitions` instance that contains a collection of conditions and a collection of RuleSets.</span></span> <span data-ttu-id="f3bc6-157">La herramienta no utiliza la colección de condiciones, pero usa el formato `RuleDefinitions`. rules para permitir la interacción con el entorno de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-157">The tool does not use the conditions collection, but it does use the `RuleDefinitions` .rules format to allow interaction with the Visual Studio environment.</span></span>

<span data-ttu-id="f3bc6-158">Después de seleccionar un archivo. rules, aparece un cuadro de diálogo **selector ruleset** .</span><span class="sxs-lookup"><span data-stu-id="f3bc6-158">After selecting a .rules file, a **RuleSet Selector** dialog appears.</span></span> <span data-ttu-id="f3bc6-159">Puede utilizar el cuadro de diálogo para seleccionar RuleSets desde el archivo que desea importar (el valor predeterminado especificada todos los RuleSets).</span><span class="sxs-lookup"><span data-stu-id="f3bc6-159">You can use the dialog to select the RuleSets from the file that you want to import (the default specifies all RuleSets).</span></span> <span data-ttu-id="f3bc6-160">Los RuleSets en el archivo .rules no tienen números de versión, porque su versión dentro de un proyecto WF es igual que la versión del ensamblado.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-160">RuleSets in the .rules file do not have version numbers, because their versioning within a WF project is the same as the version of the assembly.</span></span> <span data-ttu-id="f3bc6-161">Durante el proceso de importación, la herramienta asigna automáticamente el siguiente número de versión principal disponible (que puede cambiar después de la importación); puede ver los números de versión asignados en la lista de **selector ruleset** .</span><span class="sxs-lookup"><span data-stu-id="f3bc6-161">During the importing process, the tool automatically assigns the next available major version number (which you can change after importing); you can see the assigned version numbers in the **RuleSet Selector** list.</span></span>

<span data-ttu-id="f3bc6-162">Para cada RuleSet que importa, la herramienta intenta buscar el tipo asociado de la carpeta bin\Debug bajo la ubicación del archivo .rules (si existe), basándose en los miembros utilizados en el RuleSet.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-162">For each RuleSet it imports, the tool attempts to locate the associated type from the bin\Debug folder under the location of the .rules file (if it exists), based on the members used in the RuleSet.</span></span> <span data-ttu-id="f3bc6-163">Si la herramienta encuentra varios tipos correspondientes, intenta elegir un tipo basado en una coincidencia entre el nombre de archivo de .rules y el nombre de tipo (por ejemplo, el tipo `Workflow1` corresponde a Workflow1.rules).</span><span class="sxs-lookup"><span data-stu-id="f3bc6-163">If the tool finds multiple matching types, it attempts to choose a type based on a match between the .rules file name and the type name (for example, the `Workflow1` type corresponds to Workflow1.rules).</span></span> <span data-ttu-id="f3bc6-164">Si existen varias coincidencias, se le pedirá que seleccione el tipo.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-164">If multiple matches exist, you are prompted to select the type.</span></span> <span data-ttu-id="f3bc6-165">Si este mecanismo de identificación automática no encuentra un ensamblado o tipo coincidente, después de la importación, puede hacer clic en **examinar** en el cuadro de diálogo principal de la herramienta para navegar hasta el tipo asociado.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-165">If this auto-identification mechanism fails to locate a matching assembly or type, then after importing you can click **Browse** on the main tool dialog to navigate to the associated type.</span></span> <span data-ttu-id="f3bc6-166">En la imagen siguiente se muestra el selector RuleSet:</span><span class="sxs-lookup"><span data-stu-id="f3bc6-166">The following image shows the RuleSet Selector:</span></span>

![Captura de pantalla que muestra el cuadro de diálogo Selector RuleSet.](./media/external-ruleset-toolkit/ruleset-selector-dialog.gif)

<span data-ttu-id="f3bc6-168">Al hacer clic en **exportación de datos** desde el menú principal de la herramienta, aparece de nuevo el cuadro de diálogo **selector ruleset** , desde el que puede determinar los conjuntos de reglas de la base de datos que se debe exportar.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-168">When you click **Data-Export** from the main tool menu, the **RuleSet Selector** dialog appears again, from which you can determine the RuleSets from the database that should be exported.</span></span> <span data-ttu-id="f3bc6-169">Al hacer clic en **Aceptar**, aparece el cuadro de diálogo **Guardar archivo** , en el que puede especificar el nombre y la ubicación del archivo. rules resultante.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-169">When you click **OK**, a **Save File** dialog appears, in which you can specify the name and location of the resulting .rules file.</span></span> <span data-ttu-id="f3bc6-170">Dado que el archivo .rules no contiene información de versión, sólo puede seleccionar una versión RuleSet con un nombre RuleSet determinado.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-170">Because the .rules file does not contain version information, you can only select one RuleSet version with a given RuleSet name.</span></span>

## <a name="policyfromservice-activity"></a><span data-ttu-id="f3bc6-171">Actividad PolicyFromService</span><span class="sxs-lookup"><span data-stu-id="f3bc6-171">PolicyFromService Activity</span></span>

<span data-ttu-id="f3bc6-172">El código para la actividad `PolicyFromService` es sencillo.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-172">The code for the `PolicyFromService` activity is straightforward.</span></span> <span data-ttu-id="f3bc6-173">Funciona en gran medida como la actividad `Policy` proporcionada con WF, pero en lugar de recuperar el RuleSet de destino del archivo .rules, llama a un servicio del host para obtener la instancia de RuleSet.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-173">It works much like the `Policy` activity provided with WF, but instead of retrieving the target RuleSet from the .rules file, it calls a host service to obtain the RuleSet instance.</span></span> <span data-ttu-id="f3bc6-174">A continuación, ejecuta el RuleSet contra la instancia de actividad de flujo de trabajo raíz.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-174">It then runs the RuleSet against the root workflow activity instance.</span></span>

<span data-ttu-id="f3bc6-175">Para utilizar la actividad en un flujo de trabajo, agregue una referencia a `PolicyActivities` y los ensamblados `RuleSetService` de su proyecto de flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-175">To use the activity in a workflow, add a reference to the `PolicyActivities` and `RuleSetService` assemblies from your workflow project.</span></span> <span data-ttu-id="f3bc6-176">Vea el procedimiento al final de este tema para obtener una descripción sobre cómo agregar la actividad al cuadro de herramientas.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-176">See the procedure at the end of this topic for a discussion of how to add the activity to the toolbox.</span></span>

<span data-ttu-id="f3bc6-177">Después de colocar la actividad en su flujo de trabajo, debe proporcionar el nombre del RuleSet que se va a ejecutar.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-177">After placing the activity in your workflow, you must provide the name of the RuleSet to be run.</span></span> <span data-ttu-id="f3bc6-178">Puede introducir el nombre como un valor literal o enlazarlo con una variable de flujo de trabajo o propiedad de otra actividad.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-178">You can enter the name as a literal value, or bind to a workflow variable or property of another activity.</span></span> <span data-ttu-id="f3bc6-179">Opcionalmente, puede introducir los números de versión del RuleSet específico que se debería ejecutar.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-179">Optionally, you can enter version numbers for the specific RuleSet that should be run.</span></span> <span data-ttu-id="f3bc6-180">Si deja el valor predeterminado de 0 para los números de versión principal y secundario, el número de versión último en la base de datos se proporciona automáticamente para la actividad.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-180">If you leave the default value of 0 for the major and minor version numbers, the latest version number in the database is automatically provided for the activity.</span></span>

## <a name="ruleset-service"></a><span data-ttu-id="f3bc6-181">Servicio RuleSet</span><span class="sxs-lookup"><span data-stu-id="f3bc6-181">RuleSet Service</span></span>

<span data-ttu-id="f3bc6-182">El servicio es responsable de recuperar la versión de RuleSet especificada de la base de datos y devolverla a la actividad de llamada.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-182">The service is responsible for retrieving the specified RuleSet version from the database and returning it to the calling activity.</span></span> <span data-ttu-id="f3bc6-183">Como se ha abordado previamente, si los valores de versión principal y secundaria pasados en la llamada `GetRuleSet` son 0, el servicio recupera la última versión.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-183">As previously discussed, if the major and minor version values passed in the `GetRuleSet` call are both 0, the service retrieves the latest version.</span></span> <span data-ttu-id="f3bc6-184">En este punto no hay ningún almacenamiento en caché de definiciones o instancias RuleSet; de igual forma, no hay ninguna característica para marcar las versiones RuleSet como "implementadas" para diferenciarlas de RuleSets en curso.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-184">At this point, there is no caching of RuleSet definitions or instances; similarly, there are no features for marking RuleSet versions as "deployed" to differentiate them from in-progress RuleSets.</span></span>

<span data-ttu-id="f3bc6-185">La base de datos a la que va a acceder el servicio se debería configurar en el host utilizando un archivo de configuración de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-185">The database to be accessed by the service should be configured on the host using an application configuration file.</span></span>

#### <a name="to-run-the-tool"></a><span data-ttu-id="f3bc6-186">Para ejecutar la herramienta</span><span class="sxs-lookup"><span data-stu-id="f3bc6-186">To run the tool</span></span>

1. <span data-ttu-id="f3bc6-187">La carpeta que prepara la tabla RuleSet utilizada por la herramienta y el servicio contiene un archivo Setup.sql.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-187">The folder that sets up the RuleSet table used by the tool and the service contains a Setup.sql file.</span></span> <span data-ttu-id="f3bc6-188">Puede ejecutar el archivo por lotes de Setup.cmd para crear la base de datos de reglas en SQL Express y configurar la tabla RuleSet.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-188">You can run the Setup.cmd batch file to create the Rules database on SQL Express and to set up the RuleSet table.</span></span>

2. <span data-ttu-id="f3bc6-189">Si modifica el archivo por lotes o Setup.sql y especifica no utilizar SQL Express o colocar la tabla en una base de datos con una denominación diferente a `Rules`, los archivos de configuración de la aplicación en la herramienta RuleSet y los proyectos `UsageSample` se deberían editar con la misma información.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-189">If you edit the batch file or Setup.sql and specify not to use SQL Express or to place the table in a database named something other than `Rules`, the application configuration files in the RuleSet tool and `UsageSample` projects should be edited with the same information.</span></span>

3. <span data-ttu-id="f3bc6-190">Después de ejecutar el script Setup.sql, puede compilar la solución `ExternalRuleSetToolkit` y, a continuación, iniciar la herramienta RuleSet desde el proyecto ExternalRuleSetTool.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-190">After you run the Setup.sql script, you can build the `ExternalRuleSetToolkit` solution and then launch the RuleSet tool from the ExternalRuleSetTool project.</span></span>

4. <span data-ttu-id="f3bc6-191">La solución de aplicación de la consola de flujo de trabajo secuencial `RuleSetToolkitUsageSample` incluye un flujo de trabajo de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-191">The `RuleSetToolkitUsageSample` Sequential Workflow Console Application solution includes a sample workflow.</span></span> <span data-ttu-id="f3bc6-192">El flujo de trabajo está compuesto de una actividad `PolicyFromService` y dos variables, `orderValue` y `discount`, contra los que el RuleSet de destino se ejecuta.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-192">The workflow consists of a `PolicyFromService` activity and two variables, `orderValue` and `discount`, against which the target RuleSet runs.</span></span>

5. <span data-ttu-id="f3bc6-193">Para utilizar el ejemplo, compile la solución `RuleSetToolkitUsageSample`.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-193">To use the sample, build the `RuleSetToolkitUsageSample` solution.</span></span> <span data-ttu-id="f3bc6-194">A continuación, en el menú principal de la herramienta RuleSet, haga clic en **importación de datos** y seleccione el archivo DiscountRuleSet. rules en la carpeta RuleSetToolkitUsageSample</span><span class="sxs-lookup"><span data-stu-id="f3bc6-194">Then from the RuleSet tool main menu, click **Data-Import** and point to the DiscountRuleSet.rules file in the RuleSetToolkitUsageSample folder.</span></span> <span data-ttu-id="f3bc6-195">Haga clic en la opción **de menú almacén de reglas-guardar** para guardar el conjunto de reglas importado en la base de datos.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-195">Click the **Rule Store-Save** menu option to save the imported RuleSet to the database.</span></span>

6. <span data-ttu-id="f3bc6-196">Dado que se hace referencia al ensamblado `PolicyActivities` desde el proyecto de flujo de trabajo de ejemplo, la actividad `PolicyFromService` aparece en el flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-196">Because the `PolicyActivities` assembly is referenced from the sample workflow project, the `PolicyFromService` activity appears in the workflow.</span></span> <span data-ttu-id="f3bc6-197">Sin embargo, no aparece de forma predeterminada en el cuadro de herramientas.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-197">It does not, however, appear in the toolbox by default.</span></span> <span data-ttu-id="f3bc6-198">Para agregarla al cuadro de herramientas, haga lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="f3bc6-198">To add it to the toolbox, do the following:</span></span>

    - <span data-ttu-id="f3bc6-199">Haga clic con el botón secundario en el cuadro de herramientas y seleccione **elegir elementos** (esto puede tardar unos minutos).</span><span class="sxs-lookup"><span data-stu-id="f3bc6-199">Right-click the toolbox and select **Choose Items** (this may take a while).</span></span>

    - <span data-ttu-id="f3bc6-200">Cuando aparezca el cuadro de diálogo **elegir elementos del cuadro de herramientas** , haga clic en la pestaña **actividades** .</span><span class="sxs-lookup"><span data-stu-id="f3bc6-200">When the **Choose Toolbox Items** dialog appears, click the **Activities** tab.</span></span>

    - <span data-ttu-id="f3bc6-201">Vaya al ensamblado `PolicyActivities` en la solución de `ExternalRuleSetToolkit` y haga clic en **abrir**.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-201">Browse to the `PolicyActivities` assembly in the `ExternalRuleSetToolkit` solution and click **Open**.</span></span>

    - <span data-ttu-id="f3bc6-202">Asegúrese de que la actividad `PolicyFromService` está seleccionada en el cuadro de diálogo **elegir elementos del cuadro de herramientas** y haga clic en **Aceptar**.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-202">Ensure that the `PolicyFromService` activity is selected in the **Choose Toolbox Items** dialog and then click **OK**.</span></span>

    - <span data-ttu-id="f3bc6-203">La actividad debe aparecer ahora en el cuadro de herramientas en la categoría **componentes de RuleSetToolkitUsageSample** .</span><span class="sxs-lookup"><span data-stu-id="f3bc6-203">The activity should now appear in the toolbox in the **RuleSetToolkitUsageSample Components** category.</span></span>

7. <span data-ttu-id="f3bc6-204">El servicio RuleSet ya está configurado en el host de la aplicación de consola utilizando la instrucción siguiente en Program.cs.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-204">The RuleSet service is already configured on the console application host using the following statement in Program.cs.</span></span>

    ```csharp
    workflowRuntime.AddService(new RuleSetService());
    ```

8. <span data-ttu-id="f3bc6-205">También puede configurar el servicio en el host utilizando un archivo de configuración; consulte la documentación de SDK para obtener detalles.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-205">You can also configure the service on the host using a configuration file; see the SDK documentation for details.</span></span>

9. <span data-ttu-id="f3bc6-206">Un archivo de configuración de la aplicación se agrega al proyecto de flujo de trabajo para especificar la cadena de conexión para la base de datos que va a utilizar el servicio.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-206">An application configuration file is added to the workflow project to specify the connection string for the database to be used by the service.</span></span> <span data-ttu-id="f3bc6-207">Ésta debería ser la misma cadena de conexión utilizada por la herramienta RuleSet, que señala a la base de datos que contiene la tabla RuleSet.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-207">This should be the same connection string used by the RuleSet tool, which points to the database that contains the RuleSet table.</span></span>

10. <span data-ttu-id="f3bc6-208">Ahora puede ejecutar el proyecto `RuleSetToolkitUsageSample` como lo haría con cualquier otra aplicación de consola del flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-208">You can now run the `RuleSetToolkitUsageSample` project as you would any other workflow console application.</span></span> <span data-ttu-id="f3bc6-209">Presione F5 o Ctrl + F5 dentro de Visual Studio o ejecute el archivo RuleSetToolkitUsageSample. exe directamente.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-209">Press F5 or Ctrl+F5 within Visual Studio or run the RuleSetToolkitUsageSample.exe file directly.</span></span>

    > [!NOTE]
    > <span data-ttu-id="f3bc6-210">Debe cerrar la herramienta RuleSet para recompilar el ejemplo de uso, porque la herramienta carga el ensamblado del ejemplo de uso.</span><span class="sxs-lookup"><span data-stu-id="f3bc6-210">You must close the RuleSet tool to recompile the usage sample, because the tool loads the usage sample assembly.</span></span>
