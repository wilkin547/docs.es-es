---
title: Crear actividades asincrónicas en WF
description: Obtenga información sobre cómo crear actividades asincrónicas personalizadas mediante AsyncCodeActivity, que permite a las actividades derivadas implementar la lógica de ejecución asincrónica.
ms.date: 03/30/2017
ms.assetid: 497e81ed-5eef-460c-ba55-fae73c05824f
ms.openlocfilehash: f7ce0c0157791b34723feff185aed24bb56a4b3f
ms.sourcegitcommit: 9a4488a3625866335e83a20da5e9c5286b1f034c
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 05/15/2020
ms.locfileid: "83421532"
---
# <a name="creating-asynchronous-activities-in-wf"></a><span data-ttu-id="df468-103">Crear actividades asincrónicas en WF</span><span class="sxs-lookup"><span data-stu-id="df468-103">Creating Asynchronous Activities in WF</span></span>
<span data-ttu-id="df468-104"><xref:System.Activities.AsyncCodeActivity> proporciona a los autores de actividad el uso de una clase base que permite a las actividades derivadas implementar la lógica de ejecución asincrónica.</span><span class="sxs-lookup"><span data-stu-id="df468-104"><xref:System.Activities.AsyncCodeActivity> provides activity authors a base class to use that enables derived activities to implement asynchronous execution logic.</span></span> <span data-ttu-id="df468-105">Resulta útil para las actividades personalizadas que deben realizar el trabajo asincrónico sin retener el subproceso de programador de flujo de trabajo y bloquear cualquier actividad que pueda ejecutarse en paralelo.</span><span class="sxs-lookup"><span data-stu-id="df468-105">This is useful for custom activities that must perform asynchronous work without holding the workflow scheduler thread and blocking any activities that may be able to run in parallel.</span></span> <span data-ttu-id="df468-106">En este tema se proporciona información general de cómo crear actividades asincrónicas personalizadas mediante <xref:System.Activities.AsyncCodeActivity>.</span><span class="sxs-lookup"><span data-stu-id="df468-106">This topic provides an overview of how to create custom asynchronous activities using <xref:System.Activities.AsyncCodeActivity>.</span></span>  
  
## <a name="using-asynccodeactivity"></a><span data-ttu-id="df468-107">Usar AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="df468-107">Using AsyncCodeActivity</span></span>  
 <span data-ttu-id="df468-108"><xref:System.Activities?displayProperty=nameWithType> proporciona a los autores de actividad personalizada clases base diferentes para distintos requisitos de creación de actividades.</span><span class="sxs-lookup"><span data-stu-id="df468-108"><xref:System.Activities?displayProperty=nameWithType> provides custom activity authors with different base classes for different activity authoring requirements.</span></span> <span data-ttu-id="df468-109">Cada uno posee una semántica particular y proporciona al autor del flujo de trabajo (y al tiempo de ejecución de la actividad) el contrato correspondiente.</span><span class="sxs-lookup"><span data-stu-id="df468-109">Each one carries a particular semantic and provides a workflow author (and the activity runtime) a corresponding contract.</span></span> <span data-ttu-id="df468-110">Una actividad basada en <xref:System.Activities.AsyncCodeActivity> es aquélla que realiza el trabajo de manera asincrónica según el subproceso del programador y cuya lógica de ejecución se expresa en código administrado.</span><span class="sxs-lookup"><span data-stu-id="df468-110">An <xref:System.Activities.AsyncCodeActivity> based activity is an activity that performs work asynchronously relative to the scheduler thread and whose execution logic is expressed in managed code.</span></span> <span data-ttu-id="df468-111">Como resultado de la asincronía, <xref:System.Activities.AsyncCodeActivity> puede inducir un punto inactivo durante la ejecución.</span><span class="sxs-lookup"><span data-stu-id="df468-111">As a result of going asynchronous, an <xref:System.Activities.AsyncCodeActivity> may induce an idle point during execution.</span></span> <span data-ttu-id="df468-112">Debido a la naturaleza volátil del trabajo asincrónico, <xref:System.Activities.AsyncCodeActivity> crea siempre un bloque de no persistencia durante la ejecución de la actividad.</span><span class="sxs-lookup"><span data-stu-id="df468-112">Due to the volatile nature of asynchronous work, an <xref:System.Activities.AsyncCodeActivity> always creates a no persist block for the duration of the activity’s execution.</span></span> <span data-ttu-id="df468-113">Esto evita que el tiempo de ejecución del flujo de trabajo conserve la instancia de flujo de trabajo en medio del trabajo asincrónico y también evita que la instancia de flujo de trabajo se descargue mientras el código asincrónico se está ejecutando.</span><span class="sxs-lookup"><span data-stu-id="df468-113">This prevents the workflow runtime from persisting the workflow instance in the middle of the asynchronous work, and also prevents the workflow instance from unloading while the asynchronous code is executing.</span></span>  
  
### <a name="asynccodeactivity-methods"></a><span data-ttu-id="df468-114">Métodos AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="df468-114">AsyncCodeActivity Methods</span></span>  
 <span data-ttu-id="df468-115">Las actividades que derivan de <xref:System.Activities.AsyncCodeActivity> pueden crear la lógica de ejecución asincrónica reemplazando los métodos <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> y <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> con código personalizado.</span><span class="sxs-lookup"><span data-stu-id="df468-115">Activities that derive from <xref:System.Activities.AsyncCodeActivity> can create asynchronous execution logic by overriding the <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> methods with custom code.</span></span> <span data-ttu-id="df468-116">Cuando los llama el tiempo de ejecución, se pasa un <xref:System.Activities.AsyncCodeActivityContext> a estos métodos.</span><span class="sxs-lookup"><span data-stu-id="df468-116">When called by the runtime, these methods are passed an <xref:System.Activities.AsyncCodeActivityContext>.</span></span> <span data-ttu-id="df468-117"><xref:System.Activities.AsyncCodeActivityContext>permite que el autor de la actividad proporcione el estado compartido <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> /  <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> en la <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> propiedad del contexto.</span><span class="sxs-lookup"><span data-stu-id="df468-117"><xref:System.Activities.AsyncCodeActivityContext> allows the activity author to provide shared state across <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>/ <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> in the context’s <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> property.</span></span> <span data-ttu-id="df468-118">En el siguiente ejemplo, una actividad `GenerateRandom` genera un número aleatorio de forma asincrónica.</span><span class="sxs-lookup"><span data-stu-id="df468-118">In the following example, a `GenerateRandom` activity generates a random number asynchronously.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#8](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#8)]  
  
 <span data-ttu-id="df468-119">La actividad de ejemplo anterior deriva de <xref:System.Activities.AsyncCodeActivity%601>y tiene un `OutArgument<int>` elevado denominado `Result`.</span><span class="sxs-lookup"><span data-stu-id="df468-119">The previous example activity derives from <xref:System.Activities.AsyncCodeActivity%601>, and has an elevated `OutArgument<int>` named `Result`.</span></span> <span data-ttu-id="df468-120">El valor devuelto por el método `GetRandom` se extrae y, a su vez, lo devuelve el reemplazo del <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A>. Este valor se establece como el valor `Result`.</span><span class="sxs-lookup"><span data-stu-id="df468-120">The value returned by the `GetRandom` method is extracted and returned by the <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> override, and this value is set as the `Result` value.</span></span> <span data-ttu-id="df468-121">Las actividades asincrónicas que no devuelvan un resultado deberían derivar de <xref:System.Activities.AsyncCodeActivity>.</span><span class="sxs-lookup"><span data-stu-id="df468-121">Asynchronous activities that do not return a result should derive from <xref:System.Activities.AsyncCodeActivity>.</span></span> <span data-ttu-id="df468-122">En el siguiente ejemplo, se define una actividad `DisplayRandom` que deriva de <xref:System.Activities.AsyncCodeActivity>.</span><span class="sxs-lookup"><span data-stu-id="df468-122">In the following example, a `DisplayRandom` activity is defined which derives from <xref:System.Activities.AsyncCodeActivity>.</span></span> <span data-ttu-id="df468-123">Esta actividad es similar a la actividad `GetRandom`, pero en lugar de devolver un resultado muestra un mensaje en la consola.</span><span class="sxs-lookup"><span data-stu-id="df468-123">This activity is like the `GetRandom` activity but instead of returning a result it displays a message to the console.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#11](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#11)]  
  
 <span data-ttu-id="df468-124">Tenga en cuenta que dado que no hay ningún valor devuelto, `DisplayRandom` utiliza <xref:System.Action> en lugar de <xref:System.Func%602> para invocar su delegado y el delegado no devuelve ningún valor.</span><span class="sxs-lookup"><span data-stu-id="df468-124">Note that because there is no return value, `DisplayRandom` uses an <xref:System.Action> instead of a <xref:System.Func%602> to invoke its delegate, and the delegate returns no value.</span></span>  
  
 <span data-ttu-id="df468-125"><xref:System.Activities.AsyncCodeActivity> también proporciona el reemplazo de <xref:System.Activities.AsyncCodeActivity.Cancel%2A>.</span><span class="sxs-lookup"><span data-stu-id="df468-125"><xref:System.Activities.AsyncCodeActivity> also provides a <xref:System.Activities.AsyncCodeActivity.Cancel%2A> override.</span></span> <span data-ttu-id="df468-126">Aunque <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> y <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> son reemplazos necesarios, <xref:System.Activities.AsyncCodeActivity.Cancel%2A> es opcional y puede reemplazarse de manera que la actividad pueda limpiar el estado asincrónico pendiente cuando se cancele o anule.</span><span class="sxs-lookup"><span data-stu-id="df468-126">While <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> are required overrides, <xref:System.Activities.AsyncCodeActivity.Cancel%2A> is optional, and can be overridden so the activity can clean up its outstanding asynchronous state when it is being canceled or aborted.</span></span> <span data-ttu-id="df468-127">Si la limpieza es posible y `AsyncCodeActivity.ExecutingActivityInstance.IsCancellationRequested` es `true`, la actividad debería llamar a <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A>.</span><span class="sxs-lookup"><span data-stu-id="df468-127">If clean up is possible and `AsyncCodeActivity.ExecutingActivityInstance.IsCancellationRequested` is `true`, the activity should call <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A>.</span></span> <span data-ttu-id="df468-128">Cualquier excepción que se inicie a partir de este método será grave para la instancia del flujo de trabajo.</span><span class="sxs-lookup"><span data-stu-id="df468-128">Any exceptions thrown from this method are fatal to the workflow instance.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#10](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#10)]  
  
### <a name="invoking-asynchronous-methods-on-a-class"></a><span data-ttu-id="df468-129">Invocar métodos asincrónicos en una clase</span><span class="sxs-lookup"><span data-stu-id="df468-129">Invoking Asynchronous Methods on a Class</span></span>  
 <span data-ttu-id="df468-130">Muchas de las clases del .NET Framework proporcionan funcionalidad asincrónica y esta funcionalidad se puede invocar de forma asincrónica mediante una <xref:System.Activities.AsyncCodeActivity> actividad basada en.</span><span class="sxs-lookup"><span data-stu-id="df468-130">Many of the classes in the .NET Framework provide asynchronous functionality, and this functionality can be asynchronously invoked by using an <xref:System.Activities.AsyncCodeActivity> based activity.</span></span> <span data-ttu-id="df468-131">En el ejemplo siguiente, se crea una actividad que crea de forma asincrónica un archivo mediante la <xref:System.IO.FileStream> clase.</span><span class="sxs-lookup"><span data-stu-id="df468-131">In the following example, an activity is created that asynchronously creates a file by using the <xref:System.IO.FileStream> class.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#12](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#12)]  
  
### <a name="sharing-state-between-the-beginexecute-and-endexecute-methods"></a><span data-ttu-id="df468-132">Compartir el estado entre los métodos BeginExecute y EndExecute</span><span class="sxs-lookup"><span data-stu-id="df468-132">Sharing State Between the BeginExecute and EndExecute Methods</span></span>  
 <span data-ttu-id="df468-133">En el ejemplo anterior, se tuvo acceso en <xref:System.IO.FileStream> al objeto <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> creado en <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="df468-133">In the previous example, the <xref:System.IO.FileStream> object that was created in <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> was accessed in the <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span></span> <span data-ttu-id="df468-134">Esto es posible porque la variable `file` se pasó en la propiedad <xref:System.Activities.AsyncCodeActivityContext.UserState%2A?displayProperty=nameWithType> en <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="df468-134">This is possible because the `file` variable was passed in the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A?displayProperty=nameWithType> property in <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>.</span></span> <span data-ttu-id="df468-135">Este es el método correcto para compartir el estado entre <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> y <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="df468-135">This is the correct method for sharing state between <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span></span> <span data-ttu-id="df468-136">Es incorrecto usar una variable miembro en la clase derivada (`FileWriter` en este caso) para compartir el estado entre el <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> y <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> porque varias instancias de actividad pueden hacer referencia al objeto de actividad.</span><span class="sxs-lookup"><span data-stu-id="df468-136">It is incorrect to use a member variable in the derived class (`FileWriter` in this case) to share state between <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> because the activity object may be referenced by multiple activity instances.</span></span> <span data-ttu-id="df468-137">Si se intenta usar una variable miembro para compartir el estado puede dar lugar a valores de una <xref:System.Activities.ActivityInstance> que sobrescriban o que usen valores de otra <xref:System.Activities.ActivityInstance>.</span><span class="sxs-lookup"><span data-stu-id="df468-137">Attempting to use a member variable to share state can result in values from one <xref:System.Activities.ActivityInstance> overwriting or consuming values from another <xref:System.Activities.ActivityInstance>.</span></span>  
  
### <a name="accessing-argument-values"></a><span data-ttu-id="df468-138">Acceso a valores de argumento</span><span class="sxs-lookup"><span data-stu-id="df468-138">Accessing Argument Values</span></span>  
 <span data-ttu-id="df468-139">El entorno de <xref:System.Activities.AsyncCodeActivity> está compuesto de los argumentos definidos en la actividad.</span><span class="sxs-lookup"><span data-stu-id="df468-139">The environment of an <xref:System.Activities.AsyncCodeActivity> consists of the arguments defined on the activity.</span></span> <span data-ttu-id="df468-140">Se puede tener acceso a estos argumentos desde las <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> / <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> invalidaciones mediante el <xref:System.Activities.AsyncCodeActivityContext> parámetro.</span><span class="sxs-lookup"><span data-stu-id="df468-140">These arguments can be accessed from the <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>/<xref:System.Activities.AsyncCodeActivity.EndExecute%2A> overrides using the <xref:System.Activities.AsyncCodeActivityContext> parameter.</span></span> <span data-ttu-id="df468-141">No se puede tener acceso a los argumentos en el delegado, pero los valores de argumento o cualquier otro dato deseado se pueden pasar al delegado con sus parámetros.</span><span class="sxs-lookup"><span data-stu-id="df468-141">The arguments cannot be accessed in the delegate, but the argument values or any other desired data can be passed in to the delegate using its parameters.</span></span> <span data-ttu-id="df468-142">En el siguiente ejemplo, se define una actividad que genera números aleatorios y que obtiene el enlace superior inclusivo del argumento `Max`.</span><span class="sxs-lookup"><span data-stu-id="df468-142">In the following example, a random number-generating activity is defined that obtains the inclusive upper bound from its `Max` argument.</span></span> <span data-ttu-id="df468-143">El valor del argumento se pasa al código asincrónico cuando se invoca el delegado.</span><span class="sxs-lookup"><span data-stu-id="df468-143">The value of the argument is passed in to the asynchronous code when the delegate is invoked.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#9](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#9)]  
  
### <a name="scheduling-actions-or-child-activities-using-asynccodeactivity"></a><span data-ttu-id="df468-144">Programar acciones o actividades secundarias mediante AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="df468-144">Scheduling Actions or Child Activities Using AsyncCodeActivity</span></span>  
 <span data-ttu-id="df468-145">Las actividades personalizadas derivadas de <xref:System.Activities.AsyncCodeActivity> proporcionan un método para realizar el trabajo de forma asincrónica con respecto al subproceso del flujo de trabajo, pero no proporcionan la capacidad de programar actividades secundarias o acciones.</span><span class="sxs-lookup"><span data-stu-id="df468-145"><xref:System.Activities.AsyncCodeActivity> derived custom activities  provide a method for performing work asynchronously with regard to the workflow thread, but do not provide the ability to schedule child activities or actions.</span></span> <span data-ttu-id="df468-146">Sin embargo, el comportamiento asincrónico se puede incorporar con la programación de actividades secundarias a través de composición.</span><span class="sxs-lookup"><span data-stu-id="df468-146">However, asynchronous behavior can be incorporated with scheduling of child activities through composition.</span></span> <span data-ttu-id="df468-147">Una actividad asincrónica se puede crear, y después componer con una <xref:System.Activities.Activity> o una actividad derivada de <xref:System.Activities.NativeActivity> para proporcionar comportamiento asincrónico y programación de actividades o acciones secundarias.</span><span class="sxs-lookup"><span data-stu-id="df468-147">An asynchronous activity can be created, and then composed with an <xref:System.Activities.Activity> or <xref:System.Activities.NativeActivity> derived activity to provide asynchronous behavior and scheduling of child activities or actions.</span></span> <span data-ttu-id="df468-148">Por ejemplo, se podría crear una actividad que derive de <xref:System.Activities.Activity> y tenga como su implementación una <xref:System.Activities.Statements.Sequence> que contenga la actividad asincrónica, así como otras actividades que implementen la lógica de la actividad.</span><span class="sxs-lookup"><span data-stu-id="df468-148">For example, an activity could be created that derives from <xref:System.Activities.Activity>, and has as its implementation a <xref:System.Activities.Statements.Sequence> containing the asynchronous activity as well the other activities that implement the logic of the activity.</span></span> <span data-ttu-id="df468-149">Para obtener más ejemplos de cómo componer actividades mediante <xref:System.Activities.Activity> y <xref:System.Activities.NativeActivity> , consulte [Cómo: crear una actividad](how-to-create-an-activity.md) y [las opciones de creación de actividades](activity-authoring-options-in-wf.md).</span><span class="sxs-lookup"><span data-stu-id="df468-149">For more examples of composing activities using <xref:System.Activities.Activity> and <xref:System.Activities.NativeActivity>, see [How to: Create an Activity](how-to-create-an-activity.md) and [Activity Authoring Options](activity-authoring-options-in-wf.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="df468-150">Consulte también</span><span class="sxs-lookup"><span data-stu-id="df468-150">See also</span></span>

- <xref:System.Action>
- <xref:System.Func%602>
