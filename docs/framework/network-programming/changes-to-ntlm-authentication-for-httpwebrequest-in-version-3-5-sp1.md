---
description: 'Más información acerca de: Cambios en la autenticación NTLM para HttpWebRequest en la versión 3.5 SP1'
title: Cambios en la autenticación NTLM para HttpWebRequest en la versión 3.5 SP1
ms.date: 03/30/2017
ms.assetid: 8bf0b428-5a21-4299-8d6e-bf8251fd978a
ms.openlocfilehash: 24787894d89f65024f7022a44b507c689bb0beb5
ms.sourcegitcommit: 10e719780594efc781b15295e499c66f316068b8
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 02/14/2021
ms.locfileid: "100434854"
---
# <a name="changes-to-ntlm-authentication-for-httpwebrequest-in-version-35-sp1"></a><span data-ttu-id="16998-103">Cambios en la autenticación NTLM para HttpWebRequest en la versión 3.5 SP1</span><span class="sxs-lookup"><span data-stu-id="16998-103">Changes to NTLM authentication for HttpWebRequest in Version 3.5 SP1</span></span>

<span data-ttu-id="16998-104">Se han realizado cambios de seguridad en .NET Framework versión 3.5 SP1 que afectan al modo en que las clases <xref:System.Net.HttpWebRequest>, <xref:System.Net.HttpListener>, <xref:System.Net.Security.NegotiateStream> y relacionadas del espacio de nombres System.Net controlan la autenticación integrada de Windows.</span><span class="sxs-lookup"><span data-stu-id="16998-104">Security changes were made in .NET Framework version 3.5 SP1 and later that affect how integrated Windows authentication is handled by the <xref:System.Net.HttpWebRequest>, <xref:System.Net.HttpListener>, <xref:System.Net.Security.NegotiateStream>, and related classes in the System.Net namespace.</span></span> <span data-ttu-id="16998-105">Estos cambios pueden afectar a las aplicaciones que usan estas clases para realizar solicitudes web y recibir respuestas donde se emplea la autenticación integrada de Windows basada en NTLM.</span><span class="sxs-lookup"><span data-stu-id="16998-105">These changes can affect applications that use these classes to make web requests and receive responses where integrated Windows authentication based on NTLM is used.</span></span> <span data-ttu-id="16998-106">Este cambio puede afectar a los servidores web y a las aplicaciones cliente configurados para usar autenticación integrada de Windows.</span><span class="sxs-lookup"><span data-stu-id="16998-106">This change can impact web servers and client applications that are configured to use integrated Windows authentication.</span></span>

## <a name="overview"></a><span data-ttu-id="16998-107">Información general</span><span class="sxs-lookup"><span data-stu-id="16998-107">Overview</span></span>

<span data-ttu-id="16998-108">El diseño de la autenticación integrada de Windows permite que algunas respuestas de credenciales sean universales, lo que significa que se pueden volver a usar o reenviar.</span><span class="sxs-lookup"><span data-stu-id="16998-108">The design of integrated Windows authentication allows for some credential responses to be universal, meaning they can be re-used or forwarded.</span></span> <span data-ttu-id="16998-109">Si no se necesita esta característica de diseño concreta, los protocolos de autenticación deben incluir información específica de destino, así como información específica de canal.</span><span class="sxs-lookup"><span data-stu-id="16998-109">If this particular design feature is not needed, then the authentication protocols should carry target specific information as well as channel specific information.</span></span> <span data-ttu-id="16998-110">Entonces los servicios pueden proporcionar protección extendida para asegurarse de que las respuestas de credenciales contengan información específica de servicio, como un nombre de entidad de seguridad de servicio (SPN).</span><span class="sxs-lookup"><span data-stu-id="16998-110">Services can then provide extended protection to ensure that credential responses contain service specific information such as a Service Principal Name (SPN).</span></span> <span data-ttu-id="16998-111">Con esta información en los intercambios de credenciales, los servicios pueden mejorar la protección contra el uso malintencionado de respuestas de credenciales que podrían haberse obtenido de forma inapropiada.</span><span class="sxs-lookup"><span data-stu-id="16998-111">With this information in the credential exchanges, services are able to better protect against malicious use of credential responses that might have been improperly obtained.</span></span>

<span data-ttu-id="16998-112">Varios componentes de los espacios de nombres <xref:System.Net> y <xref:System.Net.Security> realizan la autenticación integrada de Windows en nombre de una aplicación que llama.</span><span class="sxs-lookup"><span data-stu-id="16998-112">Multiple components in the <xref:System.Net> and <xref:System.Net.Security> namespaces perform integrated Windows authentication on behalf of a calling application.</span></span> <span data-ttu-id="16998-113">En esta sección se describen los cambios en los componentes de System.Net para agregar protección ampliada al uso de la autenticación integrada de Windows.</span><span class="sxs-lookup"><span data-stu-id="16998-113">This section describes changes to System.Net components to add extended protection in their use of integrated Windows authentication.</span></span>

## <a name="changes"></a><span data-ttu-id="16998-114">Cambios</span><span class="sxs-lookup"><span data-stu-id="16998-114">Changes</span></span>

<span data-ttu-id="16998-115">El proceso de autenticación NTLM usado con la autenticación integrada de Windows incluye un desafío emitido por el equipo de destino y enviado de vuelta al equipo cliente.</span><span class="sxs-lookup"><span data-stu-id="16998-115">The NTLM authentication process used with integrated Windows authentication includes a challenge issued by the destination computer and sent back to the client computer.</span></span> <span data-ttu-id="16998-116">Cuando un equipo recibe un desafío que ha generado él mismo, se produce un error en la autenticación, a menos que la conexión sea una conexión de bucle invertido (dirección IPv4 127.0.0.1, por ejemplo).</span><span class="sxs-lookup"><span data-stu-id="16998-116">When a computer receives a challenge it generated itself, the authentication will fail unless the connection is a loop back connection (IPv4 address 127.0.0.1, for example).</span></span>

<span data-ttu-id="16998-117">Al tener acceso a un servicio que se ejecuta en un servidor web interno, es habitual hacerlo por medio de una dirección URL similar a `http://contoso/service` o `https://contoso/service`.</span><span class="sxs-lookup"><span data-stu-id="16998-117">When accessing a service running on an internal Web server, it is common to access the service using a URL similar to `http://contoso/service` or `https://contoso/service`.</span></span> <span data-ttu-id="16998-118">El nombre "contoso" no suele ser el nombre del equipo en el que se implementa el servicio.</span><span class="sxs-lookup"><span data-stu-id="16998-118">The name "contoso" is often not the computer name of the computer on which the service is deployed.</span></span> <span data-ttu-id="16998-119">Los espacios de nombres <xref:System.Net> y relacionados admiten el uso de Active Directory, DNS, NetBIOS, el archivo de hosts del equipo local (normalmente WINDOWS\system32\drivers\etc\hosts, por ejemplo) o el archivo Imhosts del equipo local (normalmente WINDOWS\system32\drivers\etc\lmhosts, por ejemplo) para resolver nombres en direcciones.</span><span class="sxs-lookup"><span data-stu-id="16998-119">The <xref:System.Net> and related namespaces support using Active Directory, DNS, NetBIOS, the local computer's hosts file (typically WINDOWS\system32\drivers\etc\hosts, for example), or the local computer's lmhosts file (typically WINDOWS\system32\drivers\etc\lmhosts, for example) to resolve names to addresses.</span></span> <span data-ttu-id="16998-120">El nombre "contoso" se resuelve de modo que las solicitudes enviadas a "contoso" se envíen al equipo de servidor adecuado.</span><span class="sxs-lookup"><span data-stu-id="16998-120">The name "contoso" is resolved so that requests sent to "contoso" are sent to the appropriate server computer.</span></span>

<span data-ttu-id="16998-121">Cuando se ha configurado para implementaciones grandes, también es común que se asigne un nombre único de servidor virtual a la implementación con los nombres de equipos subyacentes no usados nunca por aplicaciones cliente y usuarios finales.</span><span class="sxs-lookup"><span data-stu-id="16998-121">When configured for large deployments, it is also common for a single virtual server name to be given to the deployment with the underlying machine names never used by client applications and end users.</span></span> <span data-ttu-id="16998-122">Por ejemplo, se podría asignar el nombre `www.contoso.com` al servidor, pero en una red interna, usar simplemente "contoso".</span><span class="sxs-lookup"><span data-stu-id="16998-122">For example, you might call the server `www.contoso.com`, but on an internal network simply use "contoso".</span></span> <span data-ttu-id="16998-123">Este nombre se denomina encabezado de host en la solicitud de web cliente.</span><span class="sxs-lookup"><span data-stu-id="16998-123">This name is called the Host header in the client web request.</span></span> <span data-ttu-id="16998-124">Como especifica el protocolo HTTP, el campo de encabezado o solicitud de host especifica el número de puerto y el host de Internet del recurso que se solicita.</span><span class="sxs-lookup"><span data-stu-id="16998-124">As specified by the HTTP protocol, the Host request-header field specifies the Internet host and port number of the resource being requested.</span></span> <span data-ttu-id="16998-125">Esta información se obtiene del URI original proporcionado por el usuario o el recurso que hace referencia (normalmente una dirección URL HTTP).</span><span class="sxs-lookup"><span data-stu-id="16998-125">This information is obtained from the original URI given by the user or referring resource (generally an HTTP URL).</span></span> <span data-ttu-id="16998-126">En .NET Framework versión 4, esta información también puede establecerla el cliente con la nueva propiedad <xref:System.Net.HttpWebRequest.Host%2A>.</span><span class="sxs-lookup"><span data-stu-id="16998-126">On .NET Framework version 4, this information can also be set by the client using the new <xref:System.Net.HttpWebRequest.Host%2A> property.</span></span>

<span data-ttu-id="16998-127">La clase <xref:System.Net.AuthenticationManager> controla los componentes de autenticación administrados ("módulos") usados por las clases derivadas <xref:System.Net.WebRequest> y la clase <xref:System.Net.WebClient>.</span><span class="sxs-lookup"><span data-stu-id="16998-127">The <xref:System.Net.AuthenticationManager> class controls the managed authentication components ("modules") that are used by <xref:System.Net.WebRequest> derivative classes and the <xref:System.Net.WebClient> class.</span></span> <span data-ttu-id="16998-128">La clase <xref:System.Net.AuthenticationManager> proporciona una propiedad que expone un objeto <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=nameWithType>, indexado por cadena URI, para que las aplicaciones proporcionen una cadena SPN personalizada que se use durante la autenticación.</span><span class="sxs-lookup"><span data-stu-id="16998-128">The <xref:System.Net.AuthenticationManager> class provides a property that exposes a <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=nameWithType> object, indexed by URI string, for applications to supply a custom SPN string to be used during authentication.</span></span>

<span data-ttu-id="16998-129">Ahora el comportamiento predeterminado de SP1 versión 3.5 es especificar el nombre de host usado en la dirección URL de solicitud del SPN en el intercambio de autenticación NTLM (NT LAN Manager) cuando la propiedad <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A> no está establecida.</span><span class="sxs-lookup"><span data-stu-id="16998-129">Version 3.5 SP1 now defaults to specifying the host name used in the request URL in the SPN in the NTLM (NT LAN Manager) authentication exchange when the <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A> property is not set.</span></span> <span data-ttu-id="16998-130">El nombre de host usado en la dirección URL de solicitud puede ser diferente al encabezado de host especificado en <xref:System.Net.HttpRequestHeader?displayProperty=nameWithType> en la solicitud de cliente.</span><span class="sxs-lookup"><span data-stu-id="16998-130">The host name used in the request URL may be different from the Host header specified in the <xref:System.Net.HttpRequestHeader?displayProperty=nameWithType> in the client request.</span></span> <span data-ttu-id="16998-131">El nombre de host usado en la dirección URL de solicitud puede ser diferente al nombre de host real del servidor, el nombre de equipo del servidor, la dirección IP del equipo o la dirección de bucle invertido.</span><span class="sxs-lookup"><span data-stu-id="16998-131">The host name used in the request URL may be different from the actual host name of the server, the machine name of the server, the computer's IP address, or the loopback address.</span></span> <span data-ttu-id="16998-132">En estos casos se produce un error en la solicitud de autenticación de Windows.</span><span class="sxs-lookup"><span data-stu-id="16998-132">In these cases, Windows will fail the authentication request.</span></span> <span data-ttu-id="16998-133">Para solucionar el problema, es necesario notificar a Windows que el nombre de host usado en la dirección URL de solicitud en la solicitud de cliente (por ejemplo, "contoso") es realmente un nombre alternativo para el equipo local.</span><span class="sxs-lookup"><span data-stu-id="16998-133">To address the issue, we need to notify Windows that the host name used in the request URL in the client request ("contoso", for example) is actually an alternate name for the local computer.</span></span>

<span data-ttu-id="16998-134">Existen varios métodos posibles para que una aplicación de servidor solucione este cambio.</span><span class="sxs-lookup"><span data-stu-id="16998-134">There are several possible methods for a server application to work around this change.</span></span> <span data-ttu-id="16998-135">El enfoque recomendado consiste en asignar el nombre de host usado en la dirección URL de solicitud a la clave `BackConnectionHostNames` del Registro en el servidor.</span><span class="sxs-lookup"><span data-stu-id="16998-135">The recommended approach is to map the host name used in the request URL to the `BackConnectionHostNames` key in the registry on the server.</span></span> <span data-ttu-id="16998-136">La clave `BackConnectionHostNames` del Registro normalmente se usa para asignar un nombre de host a una dirección de bucle invertido.</span><span class="sxs-lookup"><span data-stu-id="16998-136">The `BackConnectionHostNames` registry key is normally used to map a host name to a loopback address.</span></span> <span data-ttu-id="16998-137">Los pasos se indican a continuación.</span><span class="sxs-lookup"><span data-stu-id="16998-137">The steps are listed below.</span></span>

<span data-ttu-id="16998-138">Para especificar los nombres de host que se asignan a la dirección de bucle invertido y pueden conectar con sitios web en un equipo local, siga estos pasos:</span><span class="sxs-lookup"><span data-stu-id="16998-138">To specify the host names that are mapped to the loopback address and can connect to Web sites on a local computer, follow these steps:</span></span>

1. <span data-ttu-id="16998-139">Haga clic en Inicio, en Ejecutar, escriba regedit y luego haga clic en Aceptar.</span><span class="sxs-lookup"><span data-stu-id="16998-139">Click Start, click Run, type regedit, and then click OK.</span></span>

2. <span data-ttu-id="16998-140">En el editor del Registro, busque y luego haga clic en la siguiente clave del Registro:</span><span class="sxs-lookup"><span data-stu-id="16998-140">In Registry Editor, locate and then click the following registry key:</span></span>

    `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\MSV1_0`

3. <span data-ttu-id="16998-141">Haga clic con el botón derecho en MSV1_0, apunte a Nuevo y luego haga clic en Valor de cadena múltiple.</span><span class="sxs-lookup"><span data-stu-id="16998-141">Right-click MSV1_0, point to New, and then click Multi-String Value.</span></span>

4. <span data-ttu-id="16998-142">Escriba `BackConnectionHostNames` y presione ENTRAR.</span><span class="sxs-lookup"><span data-stu-id="16998-142">Type `BackConnectionHostNames`, and then press ENTER.</span></span>

5. <span data-ttu-id="16998-143">Haga clic con el botón derecho en `BackConnectionHostNames` y luego haga clic en Modificar.</span><span class="sxs-lookup"><span data-stu-id="16998-143">Right-click `BackConnectionHostNames`, and then click Modify.</span></span>

6. <span data-ttu-id="16998-144">En el cuadro de datos Valor, escriba el nombre de host o los nombres de host de los sitios (el nombre de host usado en la dirección URL de solicitud) que se encuentran en el equipo local y luego haga clic en Aceptar.</span><span class="sxs-lookup"><span data-stu-id="16998-144">In the Value data box, type the host name or the host names for the sites (the host name used in the request URL) that are on the local computer, and then click OK.</span></span>

7. <span data-ttu-id="16998-145">Salga del editor del Registro y luego reinicie el servicio IISAdmin y ejecute IISReset.</span><span class="sxs-lookup"><span data-stu-id="16998-145">Quit Registry Editor, and then restart the IISAdmin service and run IISReset.</span></span>

<span data-ttu-id="16998-146">Una solución menos segura consiste en deshabilitar la comprobación de bucle inverso.</span><span class="sxs-lookup"><span data-stu-id="16998-146">A less secure work around is to disable the loop back check.</span></span> <span data-ttu-id="16998-147">Esto deshabilita la protección contra ataques de reflejo.</span><span class="sxs-lookup"><span data-stu-id="16998-147">This disables the protection against reflection attacks.</span></span> <span data-ttu-id="16998-148">Por eso es mejor restringir el conjunto de nombres alternativos a solo aquellos que espera que use el equipo en realidad.</span><span class="sxs-lookup"><span data-stu-id="16998-148">So it is better to constrain the set of alternate names to only those you expect the machine to actually use.</span></span>

## <a name="see-also"></a><span data-ttu-id="16998-149">Vea también</span><span class="sxs-lookup"><span data-stu-id="16998-149">See also</span></span>

- <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=nameWithType>
- <xref:System.Net.HttpRequestHeader?displayProperty=nameWithType>
- <xref:System.Net.HttpWebRequest.Host%2A?displayProperty=nameWithType>
