---
title: Arquitecturas de aplicaciones web comunes
description: Diseño de aplicaciones web modernas con ASP.NET Core y Azure | Explorar las arquitecturas de aplicaciones web comunes
author: ardalis
ms.author: wiwagn
ms.date: 12/04/2019
ms.openlocfilehash: c9a8e9450d81ac2e63a8c8ea54592ed81e646e05
ms.sourcegitcommit: e3cbf26d67f7e9286c7108a2752804050762d02d
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 04/09/2020
ms.locfileid: "80988133"
---
# <a name="common-web-application-architectures"></a><span data-ttu-id="37e52-103">Arquitecturas de aplicaciones web comunes</span><span class="sxs-lookup"><span data-stu-id="37e52-103">Common web application architectures</span></span>

> <span data-ttu-id="37e52-104">"Si cree que la buena arquitectura es cara, pruebe la mala".</span><span class="sxs-lookup"><span data-stu-id="37e52-104">"If you think good architecture is expensive, try bad architecture."</span></span>  
> <span data-ttu-id="37e52-105">_- Brian Foote y Joseph Yoder_</span><span class="sxs-lookup"><span data-stu-id="37e52-105">_- Brian Foote and Joseph Yoder_</span></span>

<span data-ttu-id="37e52-106">La mayoría de aplicaciones .NET tradicionales se implementan como unidades únicas que corresponden a un archivo ejecutable o una sola aplicación web que se ejecuta dentro de un único dominio de aplicación de IIS.</span><span class="sxs-lookup"><span data-stu-id="37e52-106">Most traditional .NET applications are deployed as single units corresponding to an executable or a single web application running within a single IIS appdomain.</span></span> <span data-ttu-id="37e52-107">Este es el modelo de implementación más sencillo y sirve muy bien a muchas aplicaciones internas y públicas más pequeñas.</span><span class="sxs-lookup"><span data-stu-id="37e52-107">This is the simplest deployment model and serves many internal and smaller public applications very well.</span></span> <span data-ttu-id="37e52-108">Pero incluso con esta única unidad de implementación, la mayoría de las aplicaciones de negocio importantes se aprovechan de cierta separación lógica en varias capas.</span><span class="sxs-lookup"><span data-stu-id="37e52-108">However, even given this single unit of deployment, most non-trivial business applications benefit from some logical separation into several layers.</span></span>

## <a name="what-is-a-monolithic-application"></a><span data-ttu-id="37e52-109">¿Qué es una aplicación monolítica?</span><span class="sxs-lookup"><span data-stu-id="37e52-109">What is a monolithic application?</span></span>

<span data-ttu-id="37e52-110">Una aplicación monolítica es aquella completamente independiente, en términos de su comportamiento.</span><span class="sxs-lookup"><span data-stu-id="37e52-110">A monolithic application is one that is entirely self-contained, in terms of its behavior.</span></span> <span data-ttu-id="37e52-111">Puede interactuar con otros servicios o almacenes de datos en el transcurso de sus operaciones, pero el núcleo de su comportamiento se ejecuta dentro de su propio proceso y toda la aplicación normalmente se implementa como una única unidad.</span><span class="sxs-lookup"><span data-stu-id="37e52-111">It may interact with other services or data stores in the course of performing its operations, but the core of its behavior runs within its own process and the entire application is typically deployed as a single unit.</span></span> <span data-ttu-id="37e52-112">Si es necesario escalar horizontalmente este tipo de aplicación, normalmente la aplicación completa se duplica en varios servidores o máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="37e52-112">If such an application needs to scale horizontally, typically the entire application is duplicated across multiple servers or virtual machines.</span></span>

## <a name="all-in-one-applications"></a><span data-ttu-id="37e52-113">Aplicaciones todo en uno</span><span class="sxs-lookup"><span data-stu-id="37e52-113">All-in-one applications</span></span>

<span data-ttu-id="37e52-114">El menor número posible de proyectos para una arquitectura de aplicación es uno.</span><span class="sxs-lookup"><span data-stu-id="37e52-114">The smallest possible number of projects for an application architecture is one.</span></span> <span data-ttu-id="37e52-115">En esta arquitectura, toda la lógica de la aplicación está contenida en un solo proyecto, se compila en un único ensamblado y se implementa como una sola unidad.</span><span class="sxs-lookup"><span data-stu-id="37e52-115">In this architecture, the entire logic of the application is contained in a single project, compiled to a single assembly, and deployed as a single unit.</span></span>

<span data-ttu-id="37e52-116">Un proyecto nuevo de ASP.NET Core, independientemente de que se cree en Visual Studio o desde la línea de comandos, empieza como un simple monolito "todo en uno".</span><span class="sxs-lookup"><span data-stu-id="37e52-116">A new ASP.NET Core project, whether created in Visual Studio or from the command line, starts out as a simple "all-in-one" monolith.</span></span> <span data-ttu-id="37e52-117">Contiene todo el comportamiento de la aplicación, incluida la lógica de presentación, de negocios y de acceso a datos.</span><span class="sxs-lookup"><span data-stu-id="37e52-117">It contains all of the behavior of the application, including presentation, business, and data access logic.</span></span> <span data-ttu-id="37e52-118">En la figura 5-1 se muestra la estructura de archivos de una aplicación de un solo proyecto.</span><span class="sxs-lookup"><span data-stu-id="37e52-118">Figure 5-1 shows the file structure of a single-project app.</span></span>

![Una aplicación ASP.NET Core de un solo proyecto.](./media/image5-1.png)

<span data-ttu-id="37e52-120">**Figura 5-1**.</span><span class="sxs-lookup"><span data-stu-id="37e52-120">**Figure 5-1.**</span></span> <span data-ttu-id="37e52-121">Una aplicación ASP.NET Core de un solo proyecto.</span><span class="sxs-lookup"><span data-stu-id="37e52-121">A single project ASP.NET Core app.</span></span>

<span data-ttu-id="37e52-122">En un escenario de un solo proyecto, la separación de intereses se logra mediante el uso de carpetas.</span><span class="sxs-lookup"><span data-stu-id="37e52-122">In a single project scenario, separation of concerns is achieved through the use of folders.</span></span> <span data-ttu-id="37e52-123">La plantilla predeterminada incluye carpetas independientes para las responsabilidades del patrón MVC de modelos, vistas y controladores, así como carpetas adicionales para los datos y servicios.</span><span class="sxs-lookup"><span data-stu-id="37e52-123">The default template includes separate folders for MVC pattern responsibilities of Models, Views, and Controllers, as well as additional folders for Data and Services.</span></span> <span data-ttu-id="37e52-124">En esta disposición, los detalles de presentación deben estar limitados tanto como sea posible a la carpeta Vistas y los detalles de implementación del acceso a datos se deben limitar a las clases de la carpeta Datos.</span><span class="sxs-lookup"><span data-stu-id="37e52-124">In this arrangement, presentation details should be limited as much as possible to the Views folder, and data access implementation details should be limited to classes kept in the Data folder.</span></span> <span data-ttu-id="37e52-125">La lógica de negocios debe residir en los servicios y las clases de la carpeta Modelos.</span><span class="sxs-lookup"><span data-stu-id="37e52-125">Business logic should reside in services and classes within the Models folder.</span></span>

<span data-ttu-id="37e52-126">Aunque es simple, la solución monolítica de un solo proyecto tiene algunas desventajas.</span><span class="sxs-lookup"><span data-stu-id="37e52-126">Although simple, the single-project monolithic solution has some disadvantages.</span></span> <span data-ttu-id="37e52-127">A medida que aumenta el tamaño y la complejidad del proyecto, el número de archivos y carpetas también seguirá creciendo.</span><span class="sxs-lookup"><span data-stu-id="37e52-127">As the project's size and complexity grows, the number of files and folders will continue to grow as well.</span></span> <span data-ttu-id="37e52-128">Los intereses de la interfaz de usuario (IU) (modelos, vistas, controladores) residen en varias carpetas, que no están agrupadas alfabéticamente.</span><span class="sxs-lookup"><span data-stu-id="37e52-128">User interface (UI) concerns (models, views, controllers) reside in multiple folders, which aren't grouped together alphabetically.</span></span> <span data-ttu-id="37e52-129">Este problema empeora cuando se agregan otras construcciones de nivel de la interfaz de usuario, como filtros o ModelBinders, en sus propias carpetas.</span><span class="sxs-lookup"><span data-stu-id="37e52-129">This issue only gets worse when additional UI-level constructs, such as Filters or ModelBinders, are added in their own folders.</span></span> <span data-ttu-id="37e52-130">La lógica de negocios se distribuye entre las carpetas Modelos y Servicios, y no hay ninguna indicación clara de qué clases de qué carpetas deben depender de otras.</span><span class="sxs-lookup"><span data-stu-id="37e52-130">Business logic is scattered between the Models and Services folders, and there's no clear indication of which classes in which folders should depend on which others.</span></span> <span data-ttu-id="37e52-131">Esta falta de organización en el nivel del proyecto suele dar lugar a [código espagueti](https://deviq.com/spaghetti-code/).</span><span class="sxs-lookup"><span data-stu-id="37e52-131">This lack of organization at the project level frequently leads to [spaghetti code](https://deviq.com/spaghetti-code/).</span></span>

<span data-ttu-id="37e52-132">Para resolver estos problemas, las aplicaciones suelen evolucionar a soluciones de varios proyectos, donde se considera que cada proyecto reside en una determinada _capa_ de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="37e52-132">To address these issues, applications often evolve into multi-project solutions, where each project is considered to reside in a particular _layer_ of the application.</span></span>

## <a name="what-are-layers"></a><span data-ttu-id="37e52-133">¿Qué son las capas?</span><span class="sxs-lookup"><span data-stu-id="37e52-133">What are layers?</span></span>

<span data-ttu-id="37e52-134">Cuando aumenta la complejidad de las aplicaciones, una manera de administrarla consiste en dividir la aplicación según sus responsabilidades o intereses.</span><span class="sxs-lookup"><span data-stu-id="37e52-134">As applications grow in complexity, one way to manage that complexity is to break up the application according to its responsibilities or concerns.</span></span> <span data-ttu-id="37e52-135">Esto sigue el principio de separación de intereses y puede ayudar a mantener organizado un código base que crece para que los desarrolladores puedan encontrar fácilmente donde se implementa una funcionalidad determinada.</span><span class="sxs-lookup"><span data-stu-id="37e52-135">This follows the separation of concerns principle and can help keep a growing codebase organized so that developers can easily find where certain functionality is implemented.</span></span> <span data-ttu-id="37e52-136">Pero la arquitectura en capas ofrece una serie de ventajas que van más allá de la simple organización del código.</span><span class="sxs-lookup"><span data-stu-id="37e52-136">Layered architecture offers a number of advantages beyond just code organization, though.</span></span>

<span data-ttu-id="37e52-137">Al organizar el código en capas, la funcionalidad común de bajo nivel se puede reutilizar en toda la aplicación.</span><span class="sxs-lookup"><span data-stu-id="37e52-137">By organizing code into layers, common low-level functionality can be reused throughout the application.</span></span> <span data-ttu-id="37e52-138">Esta reutilización es beneficiosa ya que significa escribir menos código y puede permitir que la aplicación se estandarice en una sola implementación, siguiendo el principio [Una vez y solo una (DRY)](https://en.wikipedia.org/wiki/Don%27t_repeat_yourself).</span><span class="sxs-lookup"><span data-stu-id="37e52-138">This reuse is beneficial because it means less code needs to be written and because it can allow the application to standardize on a single implementation, following the [don't repeat yourself (DRY)](https://en.wikipedia.org/wiki/Don%27t_repeat_yourself) principle.</span></span>

<span data-ttu-id="37e52-139">Con una arquitectura en capas, las aplicaciones pueden aplicar restricciones sobre qué capas se pueden comunicar con otras capas.</span><span class="sxs-lookup"><span data-stu-id="37e52-139">With a layered architecture, applications can enforce restrictions on which layers can communicate with other layers.</span></span> <span data-ttu-id="37e52-140">Esto ayuda a lograr la encapsulación.</span><span class="sxs-lookup"><span data-stu-id="37e52-140">This helps to achieve encapsulation.</span></span> <span data-ttu-id="37e52-141">Cuando se cambia o reemplaza una capa, solo deberían verse afectadas aquellas capas que funcionan con ella.</span><span class="sxs-lookup"><span data-stu-id="37e52-141">When a layer is changed or replaced, only those layers that work with it should be impacted.</span></span> <span data-ttu-id="37e52-142">Mediante la limitación de qué capas dependen de otras, se puede mitigar el impacto de los cambios para que un único cambio no afecte a toda la aplicación.</span><span class="sxs-lookup"><span data-stu-id="37e52-142">By limiting which layers depend on which other layers, the impact of changes can be mitigated so that a single change doesn't impact the entire application.</span></span>

<span data-ttu-id="37e52-143">Las capas (y la encapsulación) facilitan considerablemente el reemplazo de funcionalidad dentro de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="37e52-143">Layers (and encapsulation) make it much easier to replace functionality within the application.</span></span> <span data-ttu-id="37e52-144">Por ejemplo, es posible que una aplicación use inicialmente su propia base de datos de SQL Server para la persistencia, pero más adelante podría optar por usar una estrategia de persistencia basada en la nube, o situada detrás de una API web.</span><span class="sxs-lookup"><span data-stu-id="37e52-144">For example, an application might initially use its own SQL Server database for persistence, but later could choose to use a cloud-based persistence strategy, or one behind a web API.</span></span> <span data-ttu-id="37e52-145">Si la aplicación ha encapsulado correctamente su implementación de persistencia dentro de una capa lógica, esa capa específica de SQL Server se podría sustituir por una nueva que implementara la misma interfaz pública.</span><span class="sxs-lookup"><span data-stu-id="37e52-145">If the application has properly encapsulated its persistence implementation within a logical layer, that SQL Server specific layer could be replaced by a new one implementing the same public interface.</span></span>

<span data-ttu-id="37e52-146">Además de la posibilidad de intercambiar las implementaciones en respuesta a cambios futuros en los requisitos, las capas de aplicación también facilitan el intercambio de implementaciones con fines de prueba.</span><span class="sxs-lookup"><span data-stu-id="37e52-146">In addition to the potential of swapping out implementations in response to future changes in requirements, application layers can also make it easier to swap out implementations for testing purposes.</span></span> <span data-ttu-id="37e52-147">En lugar de tener que escribir pruebas que funcionan en la capa de datos reales o de la interfaz de usuario de la aplicación, estas capas se pueden reemplazar en tiempo de prueba con implementaciones falsas que proporcionen respuestas conocidas a las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="37e52-147">Instead of having to write tests that operate against the real data layer or UI layer of the application, these layers can be replaced at test time with fake implementations that provide known responses to requests.</span></span> <span data-ttu-id="37e52-148">Esto normalmente hace que las pruebas sean mucho más fáciles de escribir y mucho más rápidas de ejecutar en comparación con la ejecución de pruebas sobre la infraestructura real de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="37e52-148">This typically makes tests much easier to write and much faster to run when compared to running tests against the application's real infrastructure.</span></span>

<span data-ttu-id="37e52-149">Las capas lógicas son una técnica común para mejorar la organización del código en las aplicaciones de software empresarial, y hay varias formas de organizar el código en capas.</span><span class="sxs-lookup"><span data-stu-id="37e52-149">Logical layering is a common technique for improving the organization of code in enterprise software applications, and there are several ways in which code can be organized into layers.</span></span>

> [!NOTE]
 > <span data-ttu-id="37e52-150">Las _capas_ representan una separación lógica dentro de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="37e52-150">_Layers_ represent logical separation within the application.</span></span> <span data-ttu-id="37e52-151">En caso de que la lógica de la aplicación se distribuya físicamente en servidores o procesos independientes, estos destinos de implementación físicos independientes se conocen como _niveles_.</span><span class="sxs-lookup"><span data-stu-id="37e52-151">In the event that application logic is physically distributed to separate servers or processes, these separate physical deployment targets are referred to as _tiers_.</span></span> <span data-ttu-id="37e52-152">Es posible, y bastante habitual, tener una aplicación de N capas que se implemente en un solo nivel.</span><span class="sxs-lookup"><span data-stu-id="37e52-152">It's possible, and quite common, to have an N-Layer application that is deployed to a single tier.</span></span>

## <a name="traditional-n-layer-architecture-applications"></a><span data-ttu-id="37e52-153">Aplicaciones tradicionales de arquitectura de "N capas"</span><span class="sxs-lookup"><span data-stu-id="37e52-153">Traditional "N-Layer" architecture applications</span></span>

<span data-ttu-id="37e52-154">En la figura 5-2 se muestra la organización más común de la lógica de la aplicación en capas.</span><span class="sxs-lookup"><span data-stu-id="37e52-154">The most common organization of application logic into layers is shown in Figure 5-2.</span></span>

![Capas de aplicación típicas](./media/image5-2.png)

<span data-ttu-id="37e52-156">**Figura 5-2.**</span><span class="sxs-lookup"><span data-stu-id="37e52-156">**Figure 5-2.**</span></span> <span data-ttu-id="37e52-157">Capas de aplicación típicas.</span><span class="sxs-lookup"><span data-stu-id="37e52-157">Typical application layers.</span></span>

<span data-ttu-id="37e52-158">Estas capas se suelen abreviar como UI (interfaz de usuario), BLL (capa de lógica de negocios) y DAL (capa de acceso a datos).</span><span class="sxs-lookup"><span data-stu-id="37e52-158">These layers are frequently abbreviated as UI, BLL (Business Logic Layer), and DAL (Data Access Layer).</span></span> <span data-ttu-id="37e52-159">Con esta arquitectura, los usuarios realizan solicitudes a través de la capa de interfaz de usuario, que interactúa con la capa BLL.</span><span class="sxs-lookup"><span data-stu-id="37e52-159">Using this architecture, users make requests through the UI layer, which interacts only with the BLL.</span></span> <span data-ttu-id="37e52-160">BLL, a su vez, puede llamar a DAL para las solicitudes de acceso de datos.</span><span class="sxs-lookup"><span data-stu-id="37e52-160">The BLL, in turn, can call the DAL for data access requests.</span></span> <span data-ttu-id="37e52-161">La capa de interfaz de usuario no debe realizar solicitudes directamente a DAL, ni debe interactuar con la persistencia de forma directa a través de otros medios.</span><span class="sxs-lookup"><span data-stu-id="37e52-161">The UI layer shouldn't make any requests to the DAL directly, nor should it interact with persistence directly through other means.</span></span> <span data-ttu-id="37e52-162">Del mismo modo, BLL solo debe interactuar con la persistencia a través de DAL.</span><span class="sxs-lookup"><span data-stu-id="37e52-162">Likewise, the BLL should only interact with persistence by going through the DAL.</span></span> <span data-ttu-id="37e52-163">De este modo, cada capa tiene su propia responsabilidad conocida.</span><span class="sxs-lookup"><span data-stu-id="37e52-163">In this way, each layer has its own well-known responsibility.</span></span>

<span data-ttu-id="37e52-164">Una desventaja de este enfoque de distribución en capas tradicional es que las dependencias de tiempo de compilación se ejecutan desde la parte superior a la inferior.</span><span class="sxs-lookup"><span data-stu-id="37e52-164">One disadvantage of this traditional layering approach is that compile-time dependencies run from the top to the bottom.</span></span> <span data-ttu-id="37e52-165">Es decir, la capa de interfaz de usuario depende de BLL, que depende de DAL.</span><span class="sxs-lookup"><span data-stu-id="37e52-165">That is, the UI layer depends on the BLL, which depends on the DAL.</span></span> <span data-ttu-id="37e52-166">Esto significa que BLL, que normalmente contiene la lógica más importante de la aplicación, depende de los detalles de implementación del acceso a datos (y a menudo de la existencia de una base de datos).</span><span class="sxs-lookup"><span data-stu-id="37e52-166">This means that the BLL, which usually holds the most important logic in the application, is dependent on data access implementation details (and often on the existence of a database).</span></span> <span data-ttu-id="37e52-167">Probar la lógica de negocios en este tipo de arquitectura suele ser difícil, y requiere una base de datos de prueba.</span><span class="sxs-lookup"><span data-stu-id="37e52-167">Testing business logic in such an architecture is often difficult, requiring a test database.</span></span> <span data-ttu-id="37e52-168">Se puede usar el principio de inversión de dependencias para resolver este problema, como se verá en la sección siguiente.</span><span class="sxs-lookup"><span data-stu-id="37e52-168">The dependency inversion principle can be used to address this issue, as you'll see in the next section.</span></span>

<span data-ttu-id="37e52-169">En la figura 5-3 se muestra una solución de ejemplo, en la que se divide la aplicación en tres proyectos por responsabilidad (o capa).</span><span class="sxs-lookup"><span data-stu-id="37e52-169">Figure 5-3 shows an example solution, breaking the application into three projects by responsibility (or layer).</span></span>

![Una aplicación monolítica sencilla con tres proyectos](./media/image5-3.png)

<span data-ttu-id="37e52-171">**Figura 5-3.**</span><span class="sxs-lookup"><span data-stu-id="37e52-171">**Figure 5-3.**</span></span> <span data-ttu-id="37e52-172">Una aplicación monolítica sencilla con tres proyectos.</span><span class="sxs-lookup"><span data-stu-id="37e52-172">A simple monolithic application with three projects.</span></span>

<span data-ttu-id="37e52-173">Aunque en esta aplicación se usan varios proyectos por motivos organizativos, se sigue implementando como una sola unidad y sus clientes interactúan con ella como una sola aplicación web.</span><span class="sxs-lookup"><span data-stu-id="37e52-173">Although this application uses several projects for organizational purposes, it's still deployed as a single unit and its clients will interact with it as a single web app.</span></span> <span data-ttu-id="37e52-174">Esto permite que el proceso de implementación sea muy simple.</span><span class="sxs-lookup"><span data-stu-id="37e52-174">This allows for very simple deployment process.</span></span> <span data-ttu-id="37e52-175">En la figura 5-4 se muestra cómo se podría hospedar este tipo de aplicación con Azure.</span><span class="sxs-lookup"><span data-stu-id="37e52-175">Figure 5-4 shows how such an app might be hosted using Azure.</span></span>

![Implementación simple de una aplicación web de Azure](./media/image5-4.png)

<span data-ttu-id="37e52-177">**Figura 5-4.**</span><span class="sxs-lookup"><span data-stu-id="37e52-177">**Figure 5-4.**</span></span> <span data-ttu-id="37e52-178">Implementación simple de una aplicación web de Azure</span><span class="sxs-lookup"><span data-stu-id="37e52-178">Simple deployment of Azure Web App</span></span>

<span data-ttu-id="37e52-179">Cuando aumenten las necesidades de la aplicación, se pueden necesitar soluciones de implementación más sólidas y complejas.</span><span class="sxs-lookup"><span data-stu-id="37e52-179">As application needs grow, more complex and robust deployment solutions may be required.</span></span> <span data-ttu-id="37e52-180">En la figura 5-5 se muestra un ejemplo de un plan de implementación más complejo que admite funciones adicionales.</span><span class="sxs-lookup"><span data-stu-id="37e52-180">Figure 5-5 shows an example of a more complex deployment plan that supports additional capabilities.</span></span>

![Implementación de una aplicación web en Azure App Service](./media/image5-5.png)

<span data-ttu-id="37e52-182">**Figura 5-5.**</span><span class="sxs-lookup"><span data-stu-id="37e52-182">**Figure 5-5.**</span></span> <span data-ttu-id="37e52-183">Implementación de una aplicación web en Azure App Service</span><span class="sxs-lookup"><span data-stu-id="37e52-183">Deploying a web app to an Azure App Service</span></span>

<span data-ttu-id="37e52-184">Internamente, la organización de este proyecto en varios en función de la responsabilidad mejora la facilidad de mantenimiento de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="37e52-184">Internally, this project's organization into multiple projects based on responsibility improves the maintainability of the application.</span></span>

<span data-ttu-id="37e52-185">Esta unidad se puede escalar vertical u horizontalmente para aprovechar la escalabilidad a petición basada en la nube.</span><span class="sxs-lookup"><span data-stu-id="37e52-185">This unit can be scaled up or out to take advantage of cloud-based on-demand scalability.</span></span> <span data-ttu-id="37e52-186">El escalado vertical significa agregar más CPU, memoria, espacio en disco u otros recursos al servidor en el que se hospeda la aplicación.</span><span class="sxs-lookup"><span data-stu-id="37e52-186">Scaling up means adding additional CPU, memory, disk space, or other resources to the server(s) hosting your app.</span></span> <span data-ttu-id="37e52-187">El escalado horizontal significa agregar instancias adicionales de estos servidores, con independencia de que sean servidores físicos, máquinas virtuales o contenedores.</span><span class="sxs-lookup"><span data-stu-id="37e52-187">Scaling out means adding additional instances of such servers, whether these are physical servers, virtual machines, or containers.</span></span> <span data-ttu-id="37e52-188">Cuando la aplicación se hospeda en varias instancias, se usa un equilibrador de carga para asignar solicitudes a instancias individuales de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="37e52-188">When your app is hosted across multiple instances, a load balancer is used to assign requests to individual app instances.</span></span>

<span data-ttu-id="37e52-189">El enfoque más sencillo para escalar una aplicación web en Azure consiste en configurar manualmente el escalado en el plan de App Service de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="37e52-189">The simplest approach to scaling a web application in Azure is to configure scaling manually in the application's App Service Plan.</span></span> <span data-ttu-id="37e52-190">En la figura 5-6 se muestra la pantalla de panel de Azure adecuada para configurar el número de instancias que prestan servicio a una aplicación.</span><span class="sxs-lookup"><span data-stu-id="37e52-190">Figure 5-6 shows the appropriate Azure dashboard screen to configure how many instances are serving an app.</span></span>

![Escalado del plan de App Service en Azure](./media/image5-6.png)

<span data-ttu-id="37e52-192">**Figura 5-6**.</span><span class="sxs-lookup"><span data-stu-id="37e52-192">**Figure 5-6.**</span></span> <span data-ttu-id="37e52-193">Escalado de plan de App Service en Azure.</span><span class="sxs-lookup"><span data-stu-id="37e52-193">App Service Plan scaling in Azure.</span></span>

## <a name="clean-architecture"></a><span data-ttu-id="37e52-194">Arquitectura limpia</span><span class="sxs-lookup"><span data-stu-id="37e52-194">Clean architecture</span></span>

<span data-ttu-id="37e52-195">Las aplicaciones que siguen el principio de inversión de dependencias, así como los principios de diseño controlado por dominios (DDD), tienden a llegar a una arquitectura similar.</span><span class="sxs-lookup"><span data-stu-id="37e52-195">Applications that follow the Dependency Inversion Principle as well as the Domain-Driven Design (DDD) principles tend to arrive at a similar architecture.</span></span> <span data-ttu-id="37e52-196">Esta arquitectura ha pasado por muchos nombres con los años.</span><span class="sxs-lookup"><span data-stu-id="37e52-196">This architecture has gone by many names over the years.</span></span> <span data-ttu-id="37e52-197">Uno de los primeros nombres fue Arquitectura hexagonal, seguido por Puertos y adaptadores.</span><span class="sxs-lookup"><span data-stu-id="37e52-197">One of the first names was Hexagonal Architecture, followed by Ports-and-Adapters.</span></span> <span data-ttu-id="37e52-198">Más recientemente, se ha citado como [arquitectura cebolla](https://jeffreypalermo.com/blog/the-onion-architecture-part-1/) o [arquitectura limpia](https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html).</span><span class="sxs-lookup"><span data-stu-id="37e52-198">More recently, it's been cited as the [Onion Architecture](https://jeffreypalermo.com/blog/the-onion-architecture-part-1/) or [Clean Architecture](https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html).</span></span> <span data-ttu-id="37e52-199">Este último nombre, Arquitectura limpia, es el que se usa para esta arquitectura en este libro electrónico.</span><span class="sxs-lookup"><span data-stu-id="37e52-199">The latter name, Clean Architecture, is used as the name for this architecture in this e-book.</span></span>

<span data-ttu-id="37e52-200">La aplicación de referencia eShopOnWeb utiliza el enfoque de arquitectura limpia para organizar su código en proyectos.</span><span class="sxs-lookup"><span data-stu-id="37e52-200">The eShopOnWeb reference application uses the Clean Architecture approach in organizing its code into projects.</span></span> <span data-ttu-id="37e52-201">Puede encontrar una plantilla de solución que puede usar como punto de partida para su propio ASP.NET Core en el repositorio de GitHub [ardalis/cleanarchitecture](https://github.com/ardalis/cleanarchitecture).</span><span class="sxs-lookup"><span data-stu-id="37e52-201">You can find a solution template you can use as a starting point for your own ASP.NET Core on the [ardalis/cleanarchitecture](https://github.com/ardalis/cleanarchitecture) GitHub repository.</span></span>

<span data-ttu-id="37e52-202">La arquitectura limpia coloca el modelo de lógica de negocios y aplicación en el centro de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="37e52-202">Clean architecture puts the business logic and application model at the center of the application.</span></span> <span data-ttu-id="37e52-203">En lugar de tener lógica de negocios que depende del acceso a datos o de otros aspectos de infraestructura, esta dependencia se invierte: los detalles de la infraestructura y la implementación dependen del núcleo de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="37e52-203">Instead of having business logic depend on data access or other infrastructure concerns, this dependency is inverted: infrastructure and implementation details depend on the Application Core.</span></span> <span data-ttu-id="37e52-204">Esto se logra mediante la definición de abstracciones o interfaces, en el núcleo de la aplicación, que después se implementan mediante tipos definidos en el nivel de infraestructura.</span><span class="sxs-lookup"><span data-stu-id="37e52-204">This is achieved by defining abstractions, or interfaces, in the Application Core, which are then implemented by types defined in the Infrastructure layer.</span></span> <span data-ttu-id="37e52-205">Una forma habitual de visualizar esta arquitectura es usar una serie de círculos concéntricos, similares a una cebolla.</span><span class="sxs-lookup"><span data-stu-id="37e52-205">A common way of visualizing this architecture is to use a series of concentric circles, similar to an onion.</span></span> <span data-ttu-id="37e52-206">En la figura 5-7 se muestra un ejemplo de este estilo de representación de la arquitectura.</span><span class="sxs-lookup"><span data-stu-id="37e52-206">Figure 5-7 shows an example of this style of architectural representation.</span></span>

![Arquitectura limpia; vista de cebolla](./media/image5-7.png)

<span data-ttu-id="37e52-208">**Figura 5-7.**</span><span class="sxs-lookup"><span data-stu-id="37e52-208">**Figure 5-7.**</span></span> <span data-ttu-id="37e52-209">Arquitectura limpia; vista de cebolla</span><span class="sxs-lookup"><span data-stu-id="37e52-209">Clean Architecture; onion view</span></span>

<span data-ttu-id="37e52-210">En este diagrama, las dependencias fluyen hacia el círculo más interno.</span><span class="sxs-lookup"><span data-stu-id="37e52-210">In this diagram, dependencies flow toward the innermost circle.</span></span> <span data-ttu-id="37e52-211">El núcleo de la aplicación toma su nombre de su posición en el núcleo de este diagrama.</span><span class="sxs-lookup"><span data-stu-id="37e52-211">The Application Core takes its name from its position at the core of this diagram.</span></span> <span data-ttu-id="37e52-212">Y en el diagrama puede ver que el núcleo de la aplicación no tiene dependencias de otros niveles de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="37e52-212">And you can see on the diagram that the Application Core has no dependencies on other application layers.</span></span> <span data-ttu-id="37e52-213">Las entidades e interfaces de la aplicación se encuentran justo en el centro.</span><span class="sxs-lookup"><span data-stu-id="37e52-213">The application's entities and interfaces are at the very center.</span></span> <span data-ttu-id="37e52-214">En el exterior, pero todavía en el núcleo de la aplicación, están los servicios de dominio, que normalmente implementan interfaces definidas en el círculo interior.</span><span class="sxs-lookup"><span data-stu-id="37e52-214">Just outside, but still in the Application Core, are domain services, which typically implement interfaces defined in the inner circle.</span></span> <span data-ttu-id="37e52-215">Fuera del núcleo de la aplicación, las capas de la interfaz de usuario y la infraestructura dependen del núcleo de la aplicación, pero no una de la otra (necesariamente).</span><span class="sxs-lookup"><span data-stu-id="37e52-215">Outside of the Application Core, both the UI and the Infrastructure layers depend on the Application Core, but not on one another (necessarily).</span></span>

<span data-ttu-id="37e52-216">En la figura 5-8 se muestra un diagrama de capas horizontal más tradicional que refleja mejor la dependencia entre la interfaz de usuario y otras capas.</span><span class="sxs-lookup"><span data-stu-id="37e52-216">Figure 5-8 shows a more traditional horizontal layer diagram that better reflects the dependency between the UI and other layers.</span></span>

![Arquitectura limpia; vista de capas horizontal](./media/image5-8.png)

<span data-ttu-id="37e52-218">**Figura 5-8.**</span><span class="sxs-lookup"><span data-stu-id="37e52-218">**Figure 5-8.**</span></span> <span data-ttu-id="37e52-219">Arquitectura limpia; vista de capas horizontal</span><span class="sxs-lookup"><span data-stu-id="37e52-219">Clean Architecture; horizontal layer view</span></span>

<span data-ttu-id="37e52-220">Tenga en cuenta que las flechas sólidas representan las dependencias de tiempo de compilación, mientras que la flecha discontinua representa una dependencia solo de tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="37e52-220">Note that the solid arrows represent compile-time dependencies, while the dashed arrow represents a runtime-only dependency.</span></span> <span data-ttu-id="37e52-221">Con la arquitectura limpia, la capa de interfaz de usuario funciona con las interfaces definidas en el núcleo de la aplicación en tiempo de compilación y lo ideal es que no conozca los tipos de implementación definidos en el nivel de infraestructura.</span><span class="sxs-lookup"><span data-stu-id="37e52-221">With the clean architecture, the UI layer works with interfaces defined in the Application Core at compile time, and ideally shouldn't know about the implementation types defined in the Infrastructure layer.</span></span> <span data-ttu-id="37e52-222">Pero en tiempo de ejecución, estos tipos de implementación son necesarios para ejecutar la aplicación, por lo que deben estar presentes y conectados a las interfaces del núcleo de la aplicación a través de la inserción de dependencias.</span><span class="sxs-lookup"><span data-stu-id="37e52-222">At run time, however, these implementation types are required for the app to execute, so they need to be present and wired up to the Application Core interfaces via dependency injection.</span></span>

<span data-ttu-id="37e52-223">En la figura 5-9 se muestra una vista más detallada de la arquitectura de la aplicación ASP.NET Core cuando se compila siguiendo estas recomendaciones.</span><span class="sxs-lookup"><span data-stu-id="37e52-223">Figure 5-9 shows a more detailed view of an ASP.NET Core application's architecture when built following these recommendations.</span></span>

![Diagrama de arquitectura de ASP.NET Core en el que se sigue la arquitectura limpia](./media/image5-9.png)

<span data-ttu-id="37e52-225">**Figura 5-9.**</span><span class="sxs-lookup"><span data-stu-id="37e52-225">**Figure 5-9.**</span></span> <span data-ttu-id="37e52-226">Diagrama de arquitectura de ASP.NET Core en el que se sigue la arquitectura limpia.</span><span class="sxs-lookup"><span data-stu-id="37e52-226">ASP.NET Core architecture diagram following Clean Architecture.</span></span>

<span data-ttu-id="37e52-227">Como el núcleo de la aplicación no depende de la infraestructura, es muy fácil escribir pruebas unitarias automatizadas para esta capa.</span><span class="sxs-lookup"><span data-stu-id="37e52-227">Because the Application Core doesn't depend on Infrastructure, it's very easy to write automated unit tests for this layer.</span></span> <span data-ttu-id="37e52-228">En las figuras 5-10 y 5-11 se muestra cómo encajan las pruebas en esta arquitectura.</span><span class="sxs-lookup"><span data-stu-id="37e52-228">Figures 5-10 and 5-11 show how tests fit into this architecture.</span></span>

![UnitTestCore](./media/image5-10.png)

<span data-ttu-id="37e52-230">**Figura 5-10.**</span><span class="sxs-lookup"><span data-stu-id="37e52-230">**Figure 5-10.**</span></span> <span data-ttu-id="37e52-231">Pruebas unitarias del núcleo de la aplicación de forma aislada.</span><span class="sxs-lookup"><span data-stu-id="37e52-231">Unit testing Application Core in isolation.</span></span>

![IntegrationTests](./media/image5-11.png)

<span data-ttu-id="37e52-233">**Figura 5-11.**</span><span class="sxs-lookup"><span data-stu-id="37e52-233">**Figure 5-11.**</span></span> <span data-ttu-id="37e52-234">Pruebas de integración de las implementaciones de infraestructura con dependencias externas.</span><span class="sxs-lookup"><span data-stu-id="37e52-234">Integration testing Infrastructure implementations with external dependencies.</span></span>

<span data-ttu-id="37e52-235">Como la capa de interfaz de usuario no tiene ninguna dependencia directa de los tipos definidos en el proyecto de infraestructura, también es muy fácil intercambiar las implementaciones, ya sea para facilitar las pruebas o en respuesta a los requisitos cambiantes de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="37e52-235">Since the UI layer doesn't have any direct dependency on types defined in the Infrastructure project, it's likewise very easy to swap out implementations, either to facilitate testing or in response to changing application requirements.</span></span> <span data-ttu-id="37e52-236">El uso y la compatibilidad integrados de ASP.NET Core con la inserción de dependencias hace que esta arquitectura sea la forma más adecuada de estructurar aplicaciones monolíticas no triviales.</span><span class="sxs-lookup"><span data-stu-id="37e52-236">ASP.NET Core's built-in use of and support for dependency injection makes this architecture the most appropriate way to structure non-trivial monolithic applications.</span></span>

<span data-ttu-id="37e52-237">Para las aplicaciones monolíticas, los proyectos de núcleo de la aplicación, infraestructura e interfaz de usuario se ejecutan como una sola aplicación.</span><span class="sxs-lookup"><span data-stu-id="37e52-237">For monolithic applications the Application Core, Infrastructure, and UI projects are all run as a single application.</span></span> <span data-ttu-id="37e52-238">La arquitectura de la aplicación en tiempo de ejecución podría ser similar a la de la figura 5-12.</span><span class="sxs-lookup"><span data-stu-id="37e52-238">The runtime application architecture might look something like Figure 5-12.</span></span>

![Arquitectura 2 de ASP.NET Core](./media/image5-12.png)

<span data-ttu-id="37e52-240">**Figura 5-12.**</span><span class="sxs-lookup"><span data-stu-id="37e52-240">**Figure 5-12.**</span></span> <span data-ttu-id="37e52-241">Ejemplo de arquitectura en tiempo de ejecución de la aplicación ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="37e52-241">A sample ASP.NET Core app's runtime architecture.</span></span>

### <a name="organizing-code-in-clean-architecture"></a><span data-ttu-id="37e52-242">Organización del código en la arquitectura limpia</span><span class="sxs-lookup"><span data-stu-id="37e52-242">Organizing code in Clean Architecture</span></span>

<span data-ttu-id="37e52-243">En una solución de arquitectura limpia, cada proyecto tiene responsabilidades claras.</span><span class="sxs-lookup"><span data-stu-id="37e52-243">In a Clean Architecture solution, each project has clear responsibilities.</span></span> <span data-ttu-id="37e52-244">Por tanto, algunos tipos pertenecen a cada proyecto y con frecuencia encontrará las carpetas correspondientes a estos tipos en el proyecto adecuado.</span><span class="sxs-lookup"><span data-stu-id="37e52-244">As such, certain types belong in each project and you'll frequently find folders corresponding to these types in the appropriate project.</span></span>

<span data-ttu-id="37e52-245">El núcleo de la aplicación contiene el modelo de negocio, que incluye entidades, servicios e interfaces.</span><span class="sxs-lookup"><span data-stu-id="37e52-245">The Application Core holds the business model, which includes entities, services, and interfaces.</span></span> <span data-ttu-id="37e52-246">Estas interfaces incluyen abstracciones para las operaciones que se llevarán a cabo mediante la infraestructura, como el acceso a datos, el acceso al sistema de archivos, las llamadas de red, etc. En ocasiones los servicios o interfaces definidos en este nivel tendrán que trabajar con tipos sin entidad que no tienen dependencias en la interfaz de usuario o la infraestructura.</span><span class="sxs-lookup"><span data-stu-id="37e52-246">These interfaces include abstractions for operations that will be performed using Infrastructure, such as data access, file system access, network calls, etc. Sometimes services or interfaces defined at this layer will need to work with non-entity types that have no dependencies on UI or Infrastructure.</span></span> <span data-ttu-id="37e52-247">Estos se pueden definir como Objetos de transferencia de datos (DTO) simples.</span><span class="sxs-lookup"><span data-stu-id="37e52-247">These can be defined as simple Data Transfer Objects (DTOs).</span></span>

### <a name="application-core-types"></a><span data-ttu-id="37e52-248">Tipos de núcleo de la aplicación</span><span class="sxs-lookup"><span data-stu-id="37e52-248">Application Core types</span></span>

- <span data-ttu-id="37e52-249">Entidades (las clases de modelo de negocio que se conservan)</span><span class="sxs-lookup"><span data-stu-id="37e52-249">Entities (business model classes that are persisted)</span></span>
- <span data-ttu-id="37e52-250">Interfaces</span><span class="sxs-lookup"><span data-stu-id="37e52-250">Interfaces</span></span>
- <span data-ttu-id="37e52-251">Servicios</span><span class="sxs-lookup"><span data-stu-id="37e52-251">Services</span></span>
- <span data-ttu-id="37e52-252">DTO</span><span class="sxs-lookup"><span data-stu-id="37e52-252">DTOs</span></span>

<span data-ttu-id="37e52-253">El proyecto de infraestructura incluye normalmente las implementaciones de acceso a datos.</span><span class="sxs-lookup"><span data-stu-id="37e52-253">The Infrastructure project typically includes data access implementations.</span></span> <span data-ttu-id="37e52-254">En una aplicación web ASP.NET Core típica, estas implementaciones incluyen DbContext de Entity Framework (EF), todos los objetos `Migration` de EF Core que se hayan definido y las clases de implementación de acceso a datos.</span><span class="sxs-lookup"><span data-stu-id="37e52-254">In a typical ASP.NET Core web application, these implementations include the Entity Framework (EF) DbContext, any EF Core `Migration` objects that have been defined, and data access implementation classes.</span></span> <span data-ttu-id="37e52-255">La manera más común de abstraer el código de implementación de acceso a datos consiste en usar el [modelo de diseño de repositorio](https://deviq.com/repository-pattern/).</span><span class="sxs-lookup"><span data-stu-id="37e52-255">The most common way to abstract data access implementation code is through the use of the [Repository design pattern](https://deviq.com/repository-pattern/).</span></span>

<span data-ttu-id="37e52-256">Además de las implementaciones de acceso a datos, el proyecto de infraestructura debe contener las implementaciones de los servicios que tienen que interactuar con los intereses de infraestructura.</span><span class="sxs-lookup"><span data-stu-id="37e52-256">In addition to data access implementations, the Infrastructure project should contain implementations of services that must interact with infrastructure concerns.</span></span> <span data-ttu-id="37e52-257">Estos servicios deben implementar interfaces definidas en el núcleo de la aplicación, por lo que la infraestructura deberá tener una referencia al proyecto del núcleo de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="37e52-257">These services should implement interfaces defined in the Application Core, and so Infrastructure should have a reference to the Application Core project.</span></span>

### <a name="infrastructure-types"></a><span data-ttu-id="37e52-258">Tipos de infraestructura</span><span class="sxs-lookup"><span data-stu-id="37e52-258">Infrastructure types</span></span>

- <span data-ttu-id="37e52-259">Tipos de EF Core (`DbContext`, `Migration`)</span><span class="sxs-lookup"><span data-stu-id="37e52-259">EF Core types (`DbContext`, `Migration`)</span></span>
- <span data-ttu-id="37e52-260">Tipos de implementación de acceso a datos (Repositorios)</span><span class="sxs-lookup"><span data-stu-id="37e52-260">Data access implementation types (Repositories)</span></span>
- <span data-ttu-id="37e52-261">Servicios específicos de la infraestructura (por ejemplo, `FileLogger` o `SmtpNotifier`)</span><span class="sxs-lookup"><span data-stu-id="37e52-261">Infrastructure-specific services (for example, `FileLogger` or `SmtpNotifier`)</span></span>

<span data-ttu-id="37e52-262">La capa de interfaz de usuario en una aplicación ASP.NET Core MVC es el punto de entrada para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="37e52-262">The user interface layer in an ASP.NET Core MVC application is the entry point for the application.</span></span> <span data-ttu-id="37e52-263">Este proyecto debe hacer referencia al proyecto Application Core y sus tipos deben interactuar con la infraestructura estrictamente a través de las interfaces definidas en Application Core.</span><span class="sxs-lookup"><span data-stu-id="37e52-263">This project should reference the Application Core project, and its types should interact with infrastructure strictly through interfaces defined in Application Core.</span></span> <span data-ttu-id="37e52-264">En la capa de interfaz de usuario no se debe permitir la creación de instancias directas o llamadas estáticas a los tipos de la capa de infraestructura.</span><span class="sxs-lookup"><span data-stu-id="37e52-264">No direct instantiation of or static calls to the Infrastructure layer types should be allowed in the UI layer.</span></span>

### <a name="ui-layer-types"></a><span data-ttu-id="37e52-265">Tipos de capa de interfaz de usuario</span><span class="sxs-lookup"><span data-stu-id="37e52-265">UI layer types</span></span>

- <span data-ttu-id="37e52-266">Controladores</span><span class="sxs-lookup"><span data-stu-id="37e52-266">Controllers</span></span>
- <span data-ttu-id="37e52-267">Filtros</span><span class="sxs-lookup"><span data-stu-id="37e52-267">Filters</span></span>
- <span data-ttu-id="37e52-268">Vistas</span><span class="sxs-lookup"><span data-stu-id="37e52-268">Views</span></span>
- <span data-ttu-id="37e52-269">ViewModels</span><span class="sxs-lookup"><span data-stu-id="37e52-269">ViewModels</span></span>
- <span data-ttu-id="37e52-270">Inicio</span><span class="sxs-lookup"><span data-stu-id="37e52-270">Startup</span></span>

<span data-ttu-id="37e52-271">La clase Startup es responsable de configurar la aplicación y de conectar los tipos de implementación a las interfaces, lo que permite que la inserción de dependencias funcione correctamente en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="37e52-271">The Startup class is responsible for configuring the application, and for wiring up implementation types to interfaces, allowing dependency injection to work properly at run time.</span></span>

> [!NOTE]
> <span data-ttu-id="37e52-272">Para conectar la inserción de dependencias de ConfigureServices al archivo Startup.cs del proyecto de interfaz de usuario, el proyecto tiene que hacer referencia al proyecto de infraestructura.</span><span class="sxs-lookup"><span data-stu-id="37e52-272">In order to wire up dependency injection in ConfigureServices in the Startup.cs file of the UI project, the project may need to reference the Infrastructure project.</span></span> <span data-ttu-id="37e52-273">Esta dependencia se puede eliminar con facilidad mediante un contenedor de DI personalizado.</span><span class="sxs-lookup"><span data-stu-id="37e52-273">This dependency can be eliminated, most easily by using a custom DI container.</span></span> <span data-ttu-id="37e52-274">Para los fines de este ejemplo, el enfoque más sencillo consiste en permitir que el proyecto de interfaz de usuario haga referencia al proyecto de infraestructura.</span><span class="sxs-lookup"><span data-stu-id="37e52-274">For the purposes of this sample, the simplest approach is to allow the UI project to reference the Infrastructure project.</span></span>

## <a name="monolithic-applications-and-containers"></a><span data-ttu-id="37e52-275">Aplicaciones monolíticas y contenedores</span><span class="sxs-lookup"><span data-stu-id="37e52-275">Monolithic applications and containers</span></span>

<span data-ttu-id="37e52-276">Puede compilar una aplicación o un servicio web único basado en una implementación monolítica e implementarlos como un contenedor.</span><span class="sxs-lookup"><span data-stu-id="37e52-276">You can build a single and monolithic-deployment based Web Application or Service and deploy it as a container.</span></span> <span data-ttu-id="37e52-277">Dentro de la aplicación, es posible que no sean de tipo monolítico, sino que se organicen en varias bibliotecas, componentes o capas.</span><span class="sxs-lookup"><span data-stu-id="37e52-277">Within the application, it might not be monolithic but organized into several libraries, components, or layers.</span></span> <span data-ttu-id="37e52-278">Externamente, es un contenedor único como un proceso único, una aplicación web única o un servicio único.</span><span class="sxs-lookup"><span data-stu-id="37e52-278">Externally, it's a single container like a single process, single web application, or single service.</span></span>

<span data-ttu-id="37e52-279">Para administrar este modelo, debe implementar un único contenedor para representar la aplicación.</span><span class="sxs-lookup"><span data-stu-id="37e52-279">To manage this model, you deploy a single container to represent the application.</span></span> <span data-ttu-id="37e52-280">Para escalar, solo tiene que agregar más copias con un equilibrador de carga delante.</span><span class="sxs-lookup"><span data-stu-id="37e52-280">To scale, just add additional copies with a load balancer in front.</span></span> <span data-ttu-id="37e52-281">La simplicidad proviene de administrar una única implementación en un solo contenedor o máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="37e52-281">The simplicity comes from managing a single deployment in a single container or VM.</span></span>

![Figura 5-13](./media/image5-13.png)

<span data-ttu-id="37e52-283">Puede incluir varios componentes, bibliotecas o capas internas en cada contenedor, como se muestra en la figura 5-13.</span><span class="sxs-lookup"><span data-stu-id="37e52-283">You can include multiple components/libraries or internal layers within each container, as illustrated in Figure 5-13.</span></span> <span data-ttu-id="37e52-284">Pero, al seguir el principio de contenedor "_un contenedor realiza una acción y lo hace en un proceso_", es posible que el patrón monolítico entre en conflicto.</span><span class="sxs-lookup"><span data-stu-id="37e52-284">But, following the container principle of _"a container does one thing, and does it in one process_", the monolithic pattern might be a conflict.</span></span>

<span data-ttu-id="37e52-285">El inconveniente de este enfoque aparece si o cuando la aplicación aumenta y debe escalarse.</span><span class="sxs-lookup"><span data-stu-id="37e52-285">The downside of this approach comes if/when the application grows, requiring it to scale.</span></span> <span data-ttu-id="37e52-286">Si se escala toda la aplicación, realmente no es un problema.</span><span class="sxs-lookup"><span data-stu-id="37e52-286">If the entire application scales, it's not really a problem.</span></span> <span data-ttu-id="37e52-287">Pero en la mayoría de los casos, solo algunos elementos de la aplicación son los puntos de obstrucción que deben escalarse, mientras que otros componentes se usan menos.</span><span class="sxs-lookup"><span data-stu-id="37e52-287">However, in most cases, a few parts of the application are the choke points requiring scaling, while other components are used less.</span></span>

<span data-ttu-id="37e52-288">En el ejemplo típico de comercio electrónico, lo que probablemente sea necesario escalar es el componente de información del producto.</span><span class="sxs-lookup"><span data-stu-id="37e52-288">Using the typical eCommerce example, what you likely need to scale is the product information component.</span></span> <span data-ttu-id="37e52-289">Hay muchos más clientes que buscan productos de los que los compran.</span><span class="sxs-lookup"><span data-stu-id="37e52-289">Many more customers browse products than purchase them.</span></span> <span data-ttu-id="37e52-290">Más clientes usan la cesta en lugar de usar la canalización de pago.</span><span class="sxs-lookup"><span data-stu-id="37e52-290">More customers use their basket than use the payment pipeline.</span></span> <span data-ttu-id="37e52-291">Menos clientes publican comentarios o consultan su historial de compras.</span><span class="sxs-lookup"><span data-stu-id="37e52-291">Fewer customers add comments or view their purchase history.</span></span> <span data-ttu-id="37e52-292">Y es probable que solo tenga un grupo reducido de empleados, en una única región, que tenga que administrar las campañas de contenido y marketing.</span><span class="sxs-lookup"><span data-stu-id="37e52-292">And you likely only have a handful of employees, in a single region, that need to manage the content and marketing campaigns.</span></span> <span data-ttu-id="37e52-293">Al escalar el diseño monolítico, todo el código se implementa varias veces.</span><span class="sxs-lookup"><span data-stu-id="37e52-293">By scaling the monolithic design, all the code is deployed multiple times.</span></span>

<span data-ttu-id="37e52-294">Además del problema de "escalarlo todo", los cambios en un único componente requieren volver a probar por completo toda la aplicación e implementar por completo todas las instancias.</span><span class="sxs-lookup"><span data-stu-id="37e52-294">In addition to the "scale everything" problem, changes to a single component require complete retesting of the entire application, and a complete redeployment of all the instances.</span></span>

<span data-ttu-id="37e52-295">El enfoque monolítico es habitual y muchas organizaciones realizan el desarrollo con este enfoque de diseño.</span><span class="sxs-lookup"><span data-stu-id="37e52-295">The monolithic approach is common, and many organizations are developing with this architectural approach.</span></span> <span data-ttu-id="37e52-296">Muchas obtienen resultados bastante positivos, mientras que otras alcanzan los límites.</span><span class="sxs-lookup"><span data-stu-id="37e52-296">Many are having good enough results, while others are hitting limits.</span></span> <span data-ttu-id="37e52-297">Muchas diseñaron sus aplicaciones con este modelo, ya que crear arquitecturas orientadas a servicios (SOA) con infraestructura y herramientas resultaba demasiado difícil, y no vieron la necesidad hasta que la aplicación creció.</span><span class="sxs-lookup"><span data-stu-id="37e52-297">Many designed their applications in this model, because the tools and infrastructure were too difficult to build service-oriented architectures (SOA), and they didn't see the need until the app grew.</span></span> <span data-ttu-id="37e52-298">Si comprueba que está alcanzando los límites del enfoque monolítico, dividir la aplicación para que pueda aprovechar mejor los contenedores y microservicios puede ser el siguiente paso lógico.</span><span class="sxs-lookup"><span data-stu-id="37e52-298">If you find you're hitting the limits of the monolithic approach, breaking up the app to enable it to better leverage containers and microservices may be the next logical step.</span></span>

![Figura 5-14](./media/image5-14.png)

<span data-ttu-id="37e52-300">La implementación de aplicaciones monolíticas en Microsoft Azure se puede conseguir con máquinas virtuales dedicadas para cada instancia.</span><span class="sxs-lookup"><span data-stu-id="37e52-300">Deploying monolithic applications in Microsoft Azure can be achieved using dedicated VMs for each instance.</span></span> <span data-ttu-id="37e52-301">Con [Azure Virtual Machine Scale Sets](https://docs.microsoft.com/azure/virtual-machine-scale-sets/), las máquinas virtuales se pueden escalar fácilmente.</span><span class="sxs-lookup"><span data-stu-id="37e52-301">Using [Azure Virtual Machine Scale Sets](https://docs.microsoft.com/azure/virtual-machine-scale-sets/), you can easily scale the VMs.</span></span> <span data-ttu-id="37e52-302">[Azure App Services](https://azure.microsoft.com/services/app-service/) puede ejecutar aplicaciones monolíticas y escalar fácilmente instancias sin necesidad de administrar las máquinas virtuales.</span><span class="sxs-lookup"><span data-stu-id="37e52-302">[Azure App Services](https://azure.microsoft.com/services/app-service/) can run monolithic applications and easily scale instances without having to manage the VMs.</span></span> <span data-ttu-id="37e52-303">Azure App Services también puede ejecutar instancias únicas de contenedores de Docker, lo que simplifica la implementación.</span><span class="sxs-lookup"><span data-stu-id="37e52-303">Azure App Services can run single instances of Docker containers as well, simplifying the deployment.</span></span> <span data-ttu-id="37e52-304">Con Docker, se puede implementar una única máquina virtual como un host de Docker y ejecutar varias instancias.</span><span class="sxs-lookup"><span data-stu-id="37e52-304">Using Docker, you can deploy a single VM as a Docker host, and run multiple instances.</span></span> <span data-ttu-id="37e52-305">Con el equilibrador de Azure, como se muestra en la figura 5-14, se puede administrar el escalado.</span><span class="sxs-lookup"><span data-stu-id="37e52-305">Using the Azure balancer, as shown in the Figure 5-14, you can manage scaling.</span></span>

<span data-ttu-id="37e52-306">La implementación en los distintos hosts se puede administrar con técnicas de implementación tradicionales.</span><span class="sxs-lookup"><span data-stu-id="37e52-306">The deployment to the various hosts can be managed with traditional deployment techniques.</span></span> <span data-ttu-id="37e52-307">Los hosts de Docker se pueden administrar con comandos como **docker run** ejecutados manualmente o a través de la automatización como canalizaciones de entrega continua (CD).</span><span class="sxs-lookup"><span data-stu-id="37e52-307">The Docker hosts can be managed with commands like **docker run** performed manually, or through automation such as Continuous Delivery (CD) pipelines.</span></span>

### <a name="monolithic-application-deployed-as-a-container"></a><span data-ttu-id="37e52-308">Una aplicación monolítica implementada como un contenedor</span><span class="sxs-lookup"><span data-stu-id="37e52-308">Monolithic application deployed as a container</span></span>

<span data-ttu-id="37e52-309">El uso de contenedores para administrar las implementaciones de aplicaciones monolíticas tiene una serie de ventajas.</span><span class="sxs-lookup"><span data-stu-id="37e52-309">There are benefits of using containers to manage monolithic application deployments.</span></span> <span data-ttu-id="37e52-310">Escalar las instancias de los contenedores es mucho más rápido y fácil que implementar máquinas virtuales adicionales.</span><span class="sxs-lookup"><span data-stu-id="37e52-310">Scaling the instances of containers is far faster and easier than deploying additional VMs.</span></span> <span data-ttu-id="37e52-311">Incluso cuando se usan conjuntos de escalado de máquinas virtuales para escalar las máquinas virtuales, se tarda tiempo en crear las instancias.</span><span class="sxs-lookup"><span data-stu-id="37e52-311">Even when using virtual machine scale sets to scale VMs, they take time to instance.</span></span> <span data-ttu-id="37e52-312">Cuando se implementa como instancias de aplicación, la configuración de la aplicación se administra como parte de la máquina virtual.</span><span class="sxs-lookup"><span data-stu-id="37e52-312">When deployed as app instances, the configuration of the app is managed as part of the VM.</span></span>

<span data-ttu-id="37e52-313">Implementar las actualizaciones como imágenes de Docker es mucho más rápido y eficaz en la red.</span><span class="sxs-lookup"><span data-stu-id="37e52-313">Deploying updates as Docker images is far faster and network efficient.</span></span> <span data-ttu-id="37e52-314">Normalmente, las imágenes de Docker se inician en segundos, lo que acelera las implementaciones.</span><span class="sxs-lookup"><span data-stu-id="37e52-314">Docker Images typically start in seconds, speeding rollouts.</span></span> <span data-ttu-id="37e52-315">Anular una instancia de Docker es tan fácil como ejecutar un comando `docker stop`, que normalmente se completa en menos de un segundo.</span><span class="sxs-lookup"><span data-stu-id="37e52-315">Tearing down a Docker instance is as easy as issuing a `docker stop` command, typically completing in less than a second.</span></span>

<span data-ttu-id="37e52-316">Como por diseño los contenedores son intrínsecamente inmutables, no tendrá que preocuparse de que las máquinas virtuales resulten dañadas, mientras que es posible que los scripts de actualización olviden tener en cuenta alguna configuración concreta o archivo que se conserve en disco.</span><span class="sxs-lookup"><span data-stu-id="37e52-316">As containers are inherently immutable by design, you never need to worry about corrupted VMs, whereas update scripts might forget to account for some specific configuration or file left on disk.</span></span>

<span data-ttu-id="37e52-317">Puede usar contenedores de Docker para la implementación monolítica de aplicaciones web más sencillas.</span><span class="sxs-lookup"><span data-stu-id="37e52-317">You can use Docker containers for monolithic deployment of simpler web applications.</span></span> <span data-ttu-id="37e52-318">Esto mejora la integración continua y las canalizaciones de implementación continua y ayuda a llevar a cabo correctamente el proceso desde la implementación hasta la producción.</span><span class="sxs-lookup"><span data-stu-id="37e52-318">This improves continuous integration and continuous deployment pipelines and helps achieve deployment-to-production success.</span></span> <span data-ttu-id="37e52-319">Ya no tendrá que pensar en por qué no funciona en producción, aunque sí que funcione en su equipo.</span><span class="sxs-lookup"><span data-stu-id="37e52-319">No more “It works on my machine, why does it not work in production?”</span></span>

<span data-ttu-id="37e52-320">Una arquitectura basada en microservicios tiene muchas ventajas, pero a costa de una mayor complejidad.</span><span class="sxs-lookup"><span data-stu-id="37e52-320">A microservices-based architecture has many benefits, but those benefits come at a cost of increased complexity.</span></span> <span data-ttu-id="37e52-321">En algunos casos, los costos superan las ventajas, por lo que es una opción mejor utilizar una aplicación de implementación monolítica que se ejecute en un solo contenedor o en unos pocos contenedores.</span><span class="sxs-lookup"><span data-stu-id="37e52-321">In some cases, the costs outweigh the benefits, so a monolithic deployment application running in a single container or in just a few containers is a better option.</span></span>

<span data-ttu-id="37e52-322">Es posible que una aplicación monolítica no se pueda descomponer fácilmente en microservicios bien separados.</span><span class="sxs-lookup"><span data-stu-id="37e52-322">A monolithic application might not be easily decomposable into well-separated microservices.</span></span> <span data-ttu-id="37e52-323">Los microservicios deberían funcionar de manera independiente para proporcionar una aplicación más resistente.</span><span class="sxs-lookup"><span data-stu-id="37e52-323">Microservices should work independently of each other to provide a more resilient application.</span></span> <span data-ttu-id="37e52-324">Si no puede proporcionar sectores de características independientes de la aplicación, el hecho de separarla solo conlleva más complejidad.</span><span class="sxs-lookup"><span data-stu-id="37e52-324">If you can't deliver independent feature slices of the application, separating it only adds complexity.</span></span>

<span data-ttu-id="37e52-325">Una aplicación podría no necesitar inicialmente el escalado de las características por separado.</span><span class="sxs-lookup"><span data-stu-id="37e52-325">An application might not yet need to scale features independently.</span></span> <span data-ttu-id="37e52-326">Cuando es necesario escalar una aplicación más allá de una única instancia, muchas aplicaciones pueden hacerlo a través del proceso relativamente sencillo de clonación de esa instancia completa.</span><span class="sxs-lookup"><span data-stu-id="37e52-326">Many applications, when they need to scale beyond a single instance, can do so through the relatively simple process of cloning that entire instance.</span></span> <span data-ttu-id="37e52-327">El trabajo adicional de separar la aplicación en servicios discretos apenas proporciona beneficios, mientras que el escalado de instancias completas de la aplicación es simple y rentable.</span><span class="sxs-lookup"><span data-stu-id="37e52-327">The additional work to separate the application into discrete services provides minimal benefit when scaling full instances of the application is simple and cost-effective.</span></span>

<span data-ttu-id="37e52-328">En las fases tempranas del desarrollo de una aplicación, es posible que no se tenga una idea clara de dónde están los límites funcionales naturales.</span><span class="sxs-lookup"><span data-stu-id="37e52-328">Early in the development of an application, you might not have a clear idea where the natural functional boundaries are.</span></span> <span data-ttu-id="37e52-329">Mientras desarrolla un producto mínimamente viable, puede que todavía no sea evidente la separación natural.</span><span class="sxs-lookup"><span data-stu-id="37e52-329">As you develop a minimum viable product, the natural separation might not yet have emerged.</span></span> <span data-ttu-id="37e52-330">Algunas de estas condiciones pueden ser temporales.</span><span class="sxs-lookup"><span data-stu-id="37e52-330">Some of these conditions might be temporary.</span></span> <span data-ttu-id="37e52-331">Podría empezar creando una aplicación monolítica y, más adelante, separar algunas características para desarrollarlas e implementarlas como microservicios.</span><span class="sxs-lookup"><span data-stu-id="37e52-331">You might start by creating a monolithic application, and later separate some features to be developed and deployed as microservices.</span></span> <span data-ttu-id="37e52-332">Otras condiciones podrían ser básicas para el espacio de problemas de la aplicación y, en consecuencia, tal vez no se pueda dividir nunca en varios microservicios.</span><span class="sxs-lookup"><span data-stu-id="37e52-332">Other conditions might be essential to the application's problem space, meaning that the application might never be broken into multiple microservices.</span></span>

<span data-ttu-id="37e52-333">La separación de una aplicación en varios procesos diferenciados también introduce una sobrecarga.</span><span class="sxs-lookup"><span data-stu-id="37e52-333">Separating an application into many discrete processes also introduces overhead.</span></span> <span data-ttu-id="37e52-334">La separación de funciones en procesos diferentes conlleva una mayor complejidad.</span><span class="sxs-lookup"><span data-stu-id="37e52-334">There's more complexity in separating features into different processes.</span></span> <span data-ttu-id="37e52-335">Los protocolos de comunicación se vuelven más complejos.</span><span class="sxs-lookup"><span data-stu-id="37e52-335">The communication protocols become more complex.</span></span> <span data-ttu-id="37e52-336">En lugar de llamadas a métodos, debe usar comunicaciones asincrónicas entre servicios.</span><span class="sxs-lookup"><span data-stu-id="37e52-336">Instead of method calls, you must use asynchronous communications between services.</span></span> <span data-ttu-id="37e52-337">Cuando cambie a una arquitectura de microservicios, deberá agregar muchos de los bloques de creación que se implementan en la versión de microservicios de la aplicación eShopOnContainers: control de bus de eventos, reintentos y resistencia de mensajes, coherencia eventual y mucho más.</span><span class="sxs-lookup"><span data-stu-id="37e52-337">As you move to a microservices architecture, you need to add many of the building blocks implemented in the microservices version of the eShopOnContainers application: event bus handling, message resiliency and retries, eventual consistency, and more.</span></span>

<span data-ttu-id="37e52-338">La [aplicación de referencia eShopOnWeb](https://github.com/dotnet-architecture/eShopOnWeb), mucho más sencilla, admite el uso de un único contenedor monolítico.</span><span class="sxs-lookup"><span data-stu-id="37e52-338">The much simpler [eShopOnWeb reference application](https://github.com/dotnet-architecture/eShopOnWeb) supports single-container monolithic container usage.</span></span> <span data-ttu-id="37e52-339">La aplicación incluye una aplicación web con vistas MVC tradicionales, API web y Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="37e52-339">The application includes one web application that includes traditional MVC views, web APIs, and Razor Pages.</span></span> <span data-ttu-id="37e52-340">Esta aplicación se puede iniciar desde la raíz de la solución mediante los comandos `docker-compose build` y `docker-compose up`.</span><span class="sxs-lookup"><span data-stu-id="37e52-340">This application can be launched from the solution root using the `docker-compose build` and `docker-compose up` commands.</span></span> <span data-ttu-id="37e52-341">Este comando configura un contenedor para la instancia web mediante el elemento `Dockerfile` que se encuentra en la raíz de cada proyecto web y ejecuta el contenedor en un puerto específico.</span><span class="sxs-lookup"><span data-stu-id="37e52-341">This command configures a container for the web instance, using the `Dockerfile` found in the web project's root, and runs the container on a specified port.</span></span> <span data-ttu-id="37e52-342">Puede descargar de GitHub el código fuente para esta aplicación y ejecutarlo de forma local.</span><span class="sxs-lookup"><span data-stu-id="37e52-342">You can download the source for this application from GitHub and run it locally.</span></span> <span data-ttu-id="37e52-343">Incluso esta aplicación monolítica se beneficia de la implementación en un entorno de contenedor.</span><span class="sxs-lookup"><span data-stu-id="37e52-343">Even this monolithic application benefits from being deployed in a container environment.</span></span>

<span data-ttu-id="37e52-344">Ante todo, la implementación en contenedor implica que cada instancia de la aplicación se ejecuta en el mismo entorno.</span><span class="sxs-lookup"><span data-stu-id="37e52-344">For one, the containerized deployment means that every instance of the application runs in the same environment.</span></span> <span data-ttu-id="37e52-345">Esto incluye el entorno de desarrollo donde tienen lugar las pruebas y el desarrollo iniciales.</span><span class="sxs-lookup"><span data-stu-id="37e52-345">This includes the developer environment where early testing and development take place.</span></span> <span data-ttu-id="37e52-346">El equipo de desarrollo puede ejecutar la aplicación en un entorno en contenedor que coincida con el entorno de producción.</span><span class="sxs-lookup"><span data-stu-id="37e52-346">The development team can run the application in a containerized environment that matches the production environment.</span></span>

<span data-ttu-id="37e52-347">Además, las aplicaciones en contenedor se escalan horizontalmente con un costo menor.</span><span class="sxs-lookup"><span data-stu-id="37e52-347">In addition, containerized applications scale out at lower cost.</span></span> <span data-ttu-id="37e52-348">La utilización de un entorno de contenedor permite un mayor uso compartido de los recursos que los entornos de máquina virtual tradicionales.</span><span class="sxs-lookup"><span data-stu-id="37e52-348">Using a container environment enables greater resource sharing than traditional VM environments.</span></span>

<span data-ttu-id="37e52-349">Por último, el hecho de incluir la aplicación en un contenedor fuerza la separación entre la lógica de negocios y el servidor de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="37e52-349">Finally, containerizing the application forces a separation between the business logic and the storage server.</span></span> <span data-ttu-id="37e52-350">Cuando la aplicación se escala horizontalmente, los diversos contenedores se basan en un único medio de almacenamiento físico.</span><span class="sxs-lookup"><span data-stu-id="37e52-350">As the application scales out, the multiple containers will all rely on a single physical storage medium.</span></span> <span data-ttu-id="37e52-351">Normalmente este medio de almacenamiento es un servidor de alta disponibilidad que ejecuta una base de datos de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="37e52-351">This storage medium would typically be a high-availability server running a SQL Server database.</span></span>

## <a name="docker-support"></a><span data-ttu-id="37e52-352">Compatibilidad con Docker</span><span class="sxs-lookup"><span data-stu-id="37e52-352">Docker support</span></span>

<span data-ttu-id="37e52-353">El proyecto `eShopOnWeb` se ejecuta en .NET Core.</span><span class="sxs-lookup"><span data-stu-id="37e52-353">The `eShopOnWeb` project runs on .NET Core.</span></span> <span data-ttu-id="37e52-354">Por lo tanto, se puede ejecutar en contenedores basados en Linux o en Windows.</span><span class="sxs-lookup"><span data-stu-id="37e52-354">Therefore, it can run in either Linux-based or Windows-based containers.</span></span> <span data-ttu-id="37e52-355">Tenga en cuenta que, para la implementación de Docker, le interesa usar el mismo tipo de host para SQL Server.</span><span class="sxs-lookup"><span data-stu-id="37e52-355">Note that for Docker deployment, you want to use the same host type for SQL Server.</span></span> <span data-ttu-id="37e52-356">Los contenedores basados en Linux permiten una superficie menor y son preferibles.</span><span class="sxs-lookup"><span data-stu-id="37e52-356">Linux-based containers allow a smaller footprint and are preferred.</span></span>

<span data-ttu-id="37e52-357">Puede usar Visual Studio 2017 o versiones posteriores para agregar compatibilidad con Docker a una aplicación existente haciendo clic con el botón derecho en **Explorador de soluciones** y seleccionando **Agregar** > **Compatibilidad con Docker**.</span><span class="sxs-lookup"><span data-stu-id="37e52-357">You can use Visual Studio 2017 or later to add Docker support to an existing application by right-clicking on a project in **Solution Explorer** and choosing **Add** > **Docker Support**.</span></span> <span data-ttu-id="37e52-358">Esto agrega los archivos necesarios y modifica el proyecto para poder usarlos.</span><span class="sxs-lookup"><span data-stu-id="37e52-358">This adds the files required and modifies the project to use them.</span></span> <span data-ttu-id="37e52-359">En el ejemplo `eShopOnWeb` actual ya se incluyen estos archivos.</span><span class="sxs-lookup"><span data-stu-id="37e52-359">The current `eShopOnWeb` sample already has these files in place.</span></span>

<span data-ttu-id="37e52-360">El archivo `docker-compose.yml` de nivel de solución contiene información sobre qué imágenes se van a compilar y qué contenedores se van a iniciar.</span><span class="sxs-lookup"><span data-stu-id="37e52-360">The solution-level `docker-compose.yml` file contains information about what images to build and what containers to launch.</span></span> <span data-ttu-id="37e52-361">El archivo le permite usar el comando `docker-compose` para iniciar varias aplicaciones al mismo tiempo.</span><span class="sxs-lookup"><span data-stu-id="37e52-361">The file allows you to use the `docker-compose` command to launch multiple applications at the same time.</span></span> <span data-ttu-id="37e52-362">En este caso, solo está iniciando el proyecto web.</span><span class="sxs-lookup"><span data-stu-id="37e52-362">In this case, it is only launching the Web project.</span></span> <span data-ttu-id="37e52-363">También se puede usar para configurar las dependencias, como un contenedor de base de datos independiente.</span><span class="sxs-lookup"><span data-stu-id="37e52-363">You can also use it to configure dependencies, such as a separate database container.</span></span>

```yml
version: '3'

services:
  eshopwebmvc:
    image: eshopwebmvc
    build:
      context: .
      dockerfile: src/Web/Dockerfile
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
    ports:
      - "5106:5106"

networks:
  default:
    external:
      name: nat
```

<span data-ttu-id="37e52-364">El archivo `docker-compose.yml` hace referencia a `Dockerfile` en el proyecto `Web`.</span><span class="sxs-lookup"><span data-stu-id="37e52-364">The `docker-compose.yml` file references the `Dockerfile` in the `Web` project.</span></span> <span data-ttu-id="37e52-365">El `Dockerfile` se usa para especificar qué contenedor base se va a utilizar y cómo se configurará la aplicación en él.</span><span class="sxs-lookup"><span data-stu-id="37e52-365">The `Dockerfile` is used to specify which base container will be used and how the application will be configured on it.</span></span> <span data-ttu-id="37e52-366">El `Dockerfile` de `Web`:</span><span class="sxs-lookup"><span data-stu-id="37e52-366">The `Web`' `Dockerfile`:</span></span>

```Dockerfile
FROM mcr.microsoft.com/dotnet/core/sdk:3.1 AS build
WORKDIR /app

COPY *.sln .
COPY . .
WORKDIR /app/src/Web
RUN dotnet restore

RUN dotnet publish -c Release -o out

FROM mcr.microsoft.com/dotnet/core/aspnet:3.1 AS runtime
WORKDIR /app
COPY --from=build /app/src/Web/out ./

ENTRYPOINT ["dotnet", "Web.dll"]
```

### <a name="troubleshooting-docker-problems"></a><span data-ttu-id="37e52-367">Solución de problemas de Docker</span><span class="sxs-lookup"><span data-stu-id="37e52-367">Troubleshooting Docker problems</span></span>

<span data-ttu-id="37e52-368">Una vez que se ejecute la aplicación en contenedores, se sigue ejecutando hasta que se detenga.</span><span class="sxs-lookup"><span data-stu-id="37e52-368">Once you run the containerized application, it continues to run until you stop it.</span></span> <span data-ttu-id="37e52-369">Con el comando `docker ps` puede ver qué contenedores se están ejecutando.</span><span class="sxs-lookup"><span data-stu-id="37e52-369">You can view which containers are running with the `docker ps` command.</span></span> <span data-ttu-id="37e52-370">Puede detener un contenedor en ejecución si usa el comando `docker stop` y especifica el identificador del contenedor.</span><span class="sxs-lookup"><span data-stu-id="37e52-370">You can stop a running container by using the `docker stop` command and specifying the container ID.</span></span>

<span data-ttu-id="37e52-371">Tenga en cuenta que los contenedores de Docker en ejecución pueden estar enlazados a puertos que, en otros casos, es posible que intentara usar en el entorno de desarrollo.</span><span class="sxs-lookup"><span data-stu-id="37e52-371">Note that running Docker containers may be bound to ports you might otherwise try to use in your development environment.</span></span> <span data-ttu-id="37e52-372">Si intenta ejecutar o depurar una aplicación con el mismo puerto que un contenedor de Docker en ejecución, obtendrá un error que indica que el servidor no se puede enlazar a ese puerto.</span><span class="sxs-lookup"><span data-stu-id="37e52-372">If you try to run or debug an application using the same port as a running Docker container, you'll get an error stating that the server can't bind to that port.</span></span> <span data-ttu-id="37e52-373">Una vez más, detener el contenedor debería resolver el problema.</span><span class="sxs-lookup"><span data-stu-id="37e52-373">Once again, stopping the container should resolve the issue.</span></span>

<span data-ttu-id="37e52-374">Si quiere agregar compatibilidad con Docker a la aplicación mediante Visual Studio, asegúrese de que Docker Desktop se esté ejecutando.</span><span class="sxs-lookup"><span data-stu-id="37e52-374">If you want to add Docker support to your application using Visual Studio, make sure Docker Desktop is running when you do so.</span></span> <span data-ttu-id="37e52-375">Si Docker Desktop no está funcionando cuando se inicia el asistente, el asistente no se ejecutará correctamente.</span><span class="sxs-lookup"><span data-stu-id="37e52-375">The wizard won't run correctly if Docker Desktop isn't running when you start the wizard.</span></span> <span data-ttu-id="37e52-376">Además, el asistente examinará el contenedor que ha elegido actualmente para agregar la compatibilidad correcta con Docker.</span><span class="sxs-lookup"><span data-stu-id="37e52-376">In addition, the wizard examines your current container choice to add the correct Docker support.</span></span> <span data-ttu-id="37e52-377">Si quiere agregar compatibilidad con contenedores de Windows, debe ejecutar el asistente mientras Docker Desktop se ejecuta con contenedores de Windows configurados.</span><span class="sxs-lookup"><span data-stu-id="37e52-377">If you want to add support for Windows Containers, you need to run the wizard while you have Docker Desktop running with Windows Containers configured.</span></span> <span data-ttu-id="37e52-378">Si quiere agregar compatibilidad con contenedores de Linux, ejecute el asistente mientras Docker se ejecuta con contenedores de Linux configurados.</span><span class="sxs-lookup"><span data-stu-id="37e52-378">If you want to add support for Linux containers, run the wizard while you have Docker running with Linux containers configured.</span></span>

### <a name="references--common-web-architectures"></a><span data-ttu-id="37e52-379">Referencias: arquitecturas web comunes</span><span class="sxs-lookup"><span data-stu-id="37e52-379">References – Common web architectures</span></span>

- <span data-ttu-id="37e52-380">**The Clean Architecture** (La arquitectura limpia)</span><span class="sxs-lookup"><span data-stu-id="37e52-380">**The Clean Architecture**</span></span>  
  <https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html>
- <span data-ttu-id="37e52-381">**The Onion Architecture** (La arquitectura cebolla)</span><span class="sxs-lookup"><span data-stu-id="37e52-381">**The Onion Architecture**</span></span>  
  <https://jeffreypalermo.com/blog/the-onion-architecture-part-1/>
- <span data-ttu-id="37e52-382">**The Repository Pattern** (El modelo de repositorio)</span><span class="sxs-lookup"><span data-stu-id="37e52-382">**The Repository Pattern**</span></span>  
  <https://deviq.com/repository-pattern/>
- <span data-ttu-id="37e52-383">**Plantilla de solución de arquitectura limpia**</span><span class="sxs-lookup"><span data-stu-id="37e52-383">**Clean Architecture Solution Template**</span></span>  
  <https://github.com/ardalis/cleanarchitecture>
- <span data-ttu-id="37e52-384">**Architecting Microservices e-book** (Libro electrónico de arquitectura de microservicios)</span><span class="sxs-lookup"><span data-stu-id="37e52-384">**Architecting Microservices e-book**</span></span>  
  <https://aka.ms/MicroservicesEbook>
- <span data-ttu-id="37e52-385">**DDD (diseño guiado por el dominio)**</span><span class="sxs-lookup"><span data-stu-id="37e52-385">**DDD (Domain-Driven Design)**</span></span>  
  <https://docs.microsoft.com/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/>

>[!div class="step-by-step"]
><span data-ttu-id="37e52-386">[Anterior](architectural-principles.md)
>[Siguiente](common-client-side-web-technologies.md)</span><span class="sxs-lookup"><span data-stu-id="37e52-386">[Previous](architectural-principles.md)
[Next](common-client-side-web-technologies.md)</span></span>
