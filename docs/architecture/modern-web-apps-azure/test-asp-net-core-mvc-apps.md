---
title: Prueba de aplicaciones ASP.NET Core MVC
description: Diseño de aplicaciones web modernas con ASP.NET Core y Azure | Prueba de aplicaciones ASP.NET Core MVC
author: ardalis
ms.author: wiwagn
ms.date: 12/01/2020
ms.openlocfilehash: b253cfb90487cc462b0f3b8a7564c97ad403aa06
ms.sourcegitcommit: 45c7148f2483db2501c1aa696ab6ed2ed8cb71b2
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 12/08/2020
ms.locfileid: "96851404"
---
# <a name="test-aspnet-core-mvc-apps"></a><span data-ttu-id="1555e-103">Prueba de aplicaciones ASP.NET Core MVC</span><span class="sxs-lookup"><span data-stu-id="1555e-103">Test ASP.NET Core MVC apps</span></span>

> <span data-ttu-id="1555e-104">*"Si no le gusta realizar pruebas unitarias de su producto, lo más probable es que a los clientes tampoco les guste probarlo".*</span><span class="sxs-lookup"><span data-stu-id="1555e-104">*"If you don't like unit testing your product, most likely your customers won't like to test it, either."*</span></span>
 > <span data-ttu-id="1555e-105">\_- Anónimo-</span><span class="sxs-lookup"><span data-stu-id="1555e-105">\_- Anonymous-</span></span>

<span data-ttu-id="1555e-106">En el software de cualquier complejidad se pueden producir errores inesperados en respuesta a los cambios.</span><span class="sxs-lookup"><span data-stu-id="1555e-106">Software of any complexity can fail in unexpected ways in response to changes.</span></span> <span data-ttu-id="1555e-107">Por tanto, es necesario realizar pruebas después de realizar cambios en todas las aplicaciones menos en las más triviales (o las menos críticas).</span><span class="sxs-lookup"><span data-stu-id="1555e-107">Thus, testing after making changes is required for all but the most trivial (or least critical) applications.</span></span> <span data-ttu-id="1555e-108">Las pruebas manuales son la forma más lenta, menos confiable y más costosa de probar software.</span><span class="sxs-lookup"><span data-stu-id="1555e-108">Manual testing is the slowest, least reliable, most expensive way to test software.</span></span> <span data-ttu-id="1555e-109">Desafortunadamente, si las aplicaciones no están diseñadas para que se puedan probar, puede ser el único medio disponible.</span><span class="sxs-lookup"><span data-stu-id="1555e-109">Unfortunately, if applications aren't designed to be testable, it can be the only means available.</span></span> <span data-ttu-id="1555e-110">Las aplicaciones escritas para seguir los principios de arquitecturas que se indican en el [capítulo 4](architectural-principles.md) deben poder someterse a pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="1555e-110">Applications written to follow the architectural principles laid out in [chapter 4](architectural-principles.md) should be unit testable.</span></span> <span data-ttu-id="1555e-111">Las aplicaciones ASP.NET Core deben admitir pruebas de integración y funcionales automatizadas.</span><span class="sxs-lookup"><span data-stu-id="1555e-111">ASP.NET Core applications support automated integration and functional testing.</span></span>

## <a name="kinds-of-automated-tests"></a><span data-ttu-id="1555e-112">Tipos de pruebas automatizadas</span><span class="sxs-lookup"><span data-stu-id="1555e-112">Kinds of automated tests</span></span>

<span data-ttu-id="1555e-113">Hay muchos tipos de pruebas automatizadas para las aplicaciones de software.</span><span class="sxs-lookup"><span data-stu-id="1555e-113">There are many kinds of automated tests for software applications.</span></span> <span data-ttu-id="1555e-114">La prueba más sencilla y de nivel más bajo es la prueba unitaria.</span><span class="sxs-lookup"><span data-stu-id="1555e-114">The simplest, lowest level test is the unit test.</span></span> <span data-ttu-id="1555e-115">En un nivel ligeramente superior se encuentran las pruebas de integración y las pruebas funcionales.</span><span class="sxs-lookup"><span data-stu-id="1555e-115">At a slightly higher level, there are integration tests and functional tests.</span></span> <span data-ttu-id="1555e-116">Otros tipos de pruebas, como las de interfaz de usuario, de carga, de esfuerzo y de humo, quedan fuera del ámbito de este documento.</span><span class="sxs-lookup"><span data-stu-id="1555e-116">Other kinds of tests, such as UI tests, load tests, stress tests, and smoke tests, are beyond the scope of this document.</span></span>

### <a name="unit-tests"></a><span data-ttu-id="1555e-117">Pruebas unitarias</span><span class="sxs-lookup"><span data-stu-id="1555e-117">Unit tests</span></span>

<span data-ttu-id="1555e-118">Una prueba unitaria prueba un único elemento de la lógica de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="1555e-118">A unit test tests a single part of your application's logic.</span></span> <span data-ttu-id="1555e-119">Se puede describir aún más enumerando algunas de las cosas que no hace.</span><span class="sxs-lookup"><span data-stu-id="1555e-119">One can further describe it by listing some of the things that it isn't.</span></span> <span data-ttu-id="1555e-120">Una prueba unitaria no prueba el funcionamiento del código con dependencias o infraestructura; eso lo comprueban las pruebas de integración.</span><span class="sxs-lookup"><span data-stu-id="1555e-120">A unit test doesn't test how your code works with dependencies or infrastructure – that's what integration tests are for.</span></span> <span data-ttu-id="1555e-121">Una prueba unitaria no prueba el marco para el que se escribe el código; se debe asumir que funciona o, si se detecta que no lo hace, registrar un error y codificar una solución alternativa.</span><span class="sxs-lookup"><span data-stu-id="1555e-121">A unit test doesn't test the framework your code is written on – you should assume it works or, if you find it doesn't, file a bug and code a workaround.</span></span> <span data-ttu-id="1555e-122">Una prueba unitaria se ejecuta completamente en memoria y en proceso.</span><span class="sxs-lookup"><span data-stu-id="1555e-122">A unit test runs completely in memory and in process.</span></span> <span data-ttu-id="1555e-123">No se comunica con el sistema de archivos, la red o una base de datos.</span><span class="sxs-lookup"><span data-stu-id="1555e-123">It doesn't communicate with the file system, the network, or a database.</span></span> <span data-ttu-id="1555e-124">Las pruebas unitarias solo deben probar el código.</span><span class="sxs-lookup"><span data-stu-id="1555e-124">Unit tests should only test your code.</span></span>

<span data-ttu-id="1555e-125">Las pruebas unitarias, puesto que solo prueban una unidad del código, sin dependencias externas, se deben ejecutar muy rápidamente.</span><span class="sxs-lookup"><span data-stu-id="1555e-125">Unit tests, by virtue of the fact that they test only a single unit of your code, with no external dependencies, should execute extremely fast.</span></span> <span data-ttu-id="1555e-126">Por tanto, debe ser capaz de ejecutar conjuntos de cientos de pruebas unitarias en unos segundos.</span><span class="sxs-lookup"><span data-stu-id="1555e-126">Thus, you should be able to run test suites of hundreds of unit tests in a few seconds.</span></span> <span data-ttu-id="1555e-127">Ejecute las pruebas con frecuencia, idealmente antes de cada inserción en un repositorio de control de código fuente compartido y, por supuesto, con cada compilación automatizada en el servidor de compilación.</span><span class="sxs-lookup"><span data-stu-id="1555e-127">Run them frequently, ideally before every push to a shared source control repository, and certainly with every automated build on your build server.</span></span>

### <a name="integration-tests"></a><span data-ttu-id="1555e-128">Pruebas de integración</span><span class="sxs-lookup"><span data-stu-id="1555e-128">Integration tests</span></span>

<span data-ttu-id="1555e-129">Aunque es una buena idea encapsular el código que interactúa con la infraestructura como bases de datos y sistemas de archivos, seguirá disponiendo de parte de ese código y, probablemente le interesará probarlo.</span><span class="sxs-lookup"><span data-stu-id="1555e-129">Although it's a good idea to encapsulate your code that interacts with infrastructure like databases and file systems, you will still have some of that code, and you will probably want to test it.</span></span> <span data-ttu-id="1555e-130">Además, debe comprobar que las capas del código interactúan según lo esperado cuando se resuelvan completamente las dependencias de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="1555e-130">Additionally, you should verify that your code's layers interact as you expect when your application's dependencies are fully resolved.</span></span> <span data-ttu-id="1555e-131">Esta función es la responsabilidad de las pruebas de integración.</span><span class="sxs-lookup"><span data-stu-id="1555e-131">This functionality is the responsibility of integration tests.</span></span> <span data-ttu-id="1555e-132">Las pruebas de integración tienden a ser más lentas y más difíciles de configurar que las pruebas unitarias, porque a menudo dependen de la infraestructura y de dependencias externas.</span><span class="sxs-lookup"><span data-stu-id="1555e-132">Integration tests tend to be slower and more difficult to set up than unit tests, because they often depend on external dependencies and infrastructure.</span></span> <span data-ttu-id="1555e-133">Por tanto, debe evitar realizar pruebas de cosas que podrían evaluarse con pruebas unitarias en pruebas de integración.</span><span class="sxs-lookup"><span data-stu-id="1555e-133">Thus, you should avoid testing things that could be tested with unit tests in integration tests.</span></span> <span data-ttu-id="1555e-134">Si un escenario determinado se puede probar con una prueba unitaria, debe probarlo con una prueba unitaria.</span><span class="sxs-lookup"><span data-stu-id="1555e-134">If you can test a given scenario with a unit test, you should test it with a unit test.</span></span> <span data-ttu-id="1555e-135">Si no es posible, considere la posibilidad de usar una prueba de integración.</span><span class="sxs-lookup"><span data-stu-id="1555e-135">If you can't, then consider using an integration test.</span></span>

<span data-ttu-id="1555e-136">Las pruebas de integración a menudo tendrán procedimientos más complejos de instalación y desmontaje que las pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="1555e-136">Integration tests will often have more complex setup and teardown procedures than unit tests.</span></span> <span data-ttu-id="1555e-137">Por ejemplo, una prueba de integración dirigida a una base de datos real necesitará un modo de devolver la base de datos a un estado conocido antes de cada serie de pruebas.</span><span class="sxs-lookup"><span data-stu-id="1555e-137">For example, an integration test that goes against an actual database will need a way to return the database to a known state before each test run.</span></span> <span data-ttu-id="1555e-138">Cuando se agregan nuevas pruebas y el esquema de base de datos de producción evoluciona, estos scripts de prueba tienden a aumentar de tamaño y complejidad.</span><span class="sxs-lookup"><span data-stu-id="1555e-138">As new tests are added and the production database schema evolves, these test scripts will tend to grow in size and complexity.</span></span> <span data-ttu-id="1555e-139">En muchos sistemas de gran tamaño, no resulta práctico ejecutar conjuntos completos de pruebas de integración en las estaciones de trabajo de desarrollador antes de insertar en el repositorio los cambios en el control de código fuente compartido.</span><span class="sxs-lookup"><span data-stu-id="1555e-139">In many large systems, it is impractical to run full suites of integration tests on developer workstations before checking in changes to shared source control.</span></span> <span data-ttu-id="1555e-140">En estos casos, las pruebas de integración se pueden ejecutar en un servidor de compilación.</span><span class="sxs-lookup"><span data-stu-id="1555e-140">In these cases, integration tests may be run on a build server.</span></span>

### <a name="functional-tests"></a><span data-ttu-id="1555e-141">Pruebas funcionales</span><span class="sxs-lookup"><span data-stu-id="1555e-141">Functional tests</span></span>

<span data-ttu-id="1555e-142">Las pruebas de integración se escriben desde la perspectiva del desarrollador, para comprobar que algunos componentes del sistema funcionen correctamente entre sí.</span><span class="sxs-lookup"><span data-stu-id="1555e-142">Integration tests are written from the perspective of the developer, to verify that some components of the system work correctly together.</span></span> <span data-ttu-id="1555e-143">Las pruebas funcionales se escriben desde la perspectiva del usuario y comprueban la exactitud del sistema en función de sus requisitos.</span><span class="sxs-lookup"><span data-stu-id="1555e-143">Functional tests are written from the perspective of the user, and verify the correctness of the system based on its requirements.</span></span> <span data-ttu-id="1555e-144">En el fragmento siguiente se ofrece una analogía útil para saber cómo pensar en las pruebas funcionales, en comparación con las pruebas unitarias:</span><span class="sxs-lookup"><span data-stu-id="1555e-144">The following excerpt offers a useful analogy for how to think about functional tests, compared to unit tests:</span></span>

> <span data-ttu-id="1555e-145">"En muchas ocasiones, el desarrollo de un sistema se asemeja a la construcción de una casa.</span><span class="sxs-lookup"><span data-stu-id="1555e-145">"Many times the development of a system is likened to the building of a house.</span></span> <span data-ttu-id="1555e-146">Aunque esta analogía no es del todo correcta, podemos ampliarla para explicar la diferencia entre las pruebas unitarias y las funcionales.</span><span class="sxs-lookup"><span data-stu-id="1555e-146">While this analogy isn't quite correct, we can extend it for the purposes of understanding the difference between unit and functional tests.</span></span> <span data-ttu-id="1555e-147">Las pruebas unitarias son similares a un inspector municipal que visita la obra de construcción de una casa.</span><span class="sxs-lookup"><span data-stu-id="1555e-147">Unit testing is analogous to a building inspector visiting a house's construction site.</span></span> <span data-ttu-id="1555e-148">Se centra en los distintos sistemas internos de la casa, los cimientos, los muros, la instalación eléctrica, la fontanería y así sucesivamente.</span><span class="sxs-lookup"><span data-stu-id="1555e-148">He is focused on the various internal systems of the house, the foundation, framing, electrical, plumbing, and so on.</span></span> <span data-ttu-id="1555e-149">Se asegura (prueba) de que las partes de la casa funcionarán correctamente y de manera segura, es decir, cumplen el código de construcción.</span><span class="sxs-lookup"><span data-stu-id="1555e-149">He ensures (tests) that the parts of the house will work correctly and safely, that is, meet the building code.</span></span> <span data-ttu-id="1555e-150">En este escenario, las pruebas funcionales son análogas al propietario que visita esta misma obra.</span><span class="sxs-lookup"><span data-stu-id="1555e-150">Functional tests in this scenario are analogous to the homeowner visiting this same construction site.</span></span> <span data-ttu-id="1555e-151">Da por supuesto que los sistemas internos se comportarán de forma adecuada, que el inspector municipal está realizando su trabajo.</span><span class="sxs-lookup"><span data-stu-id="1555e-151">He assumes that the internal systems will behave appropriately, that the building inspector is performing his task.</span></span> <span data-ttu-id="1555e-152">El propietario se centra en cómo será vivir en esta casa.</span><span class="sxs-lookup"><span data-stu-id="1555e-152">The homeowner is focused on what it will be like to live in this house.</span></span> <span data-ttu-id="1555e-153">Le preocupa el aspecto de la casa, si las distintas habitaciones tienen un tamaño cómodo, si la casa se ajusta a las necesidades de la familia, si las ventanas están en una zona adecuada para captar el sol por la mañana.</span><span class="sxs-lookup"><span data-stu-id="1555e-153">He is concerned with how the house looks, are the various rooms a comfortable size, does the house fit the family's needs, are the windows in a good spot to catch the morning sun.</span></span> <span data-ttu-id="1555e-154">El propietario está realizando pruebas funcionales de la casa.</span><span class="sxs-lookup"><span data-stu-id="1555e-154">The homeowner is performing functional tests on the house.</span></span> <span data-ttu-id="1555e-155">Tiene la perspectiva del usuario.</span><span class="sxs-lookup"><span data-stu-id="1555e-155">He has the user's perspective.</span></span> <span data-ttu-id="1555e-156">El inspector municipal está realizando pruebas unitarias en la casa.</span><span class="sxs-lookup"><span data-stu-id="1555e-156">The building inspector is performing unit tests on the house.</span></span> <span data-ttu-id="1555e-157">Tiene la perspectiva del constructor".</span><span class="sxs-lookup"><span data-stu-id="1555e-157">He has the builder's perspective."</span></span>

<span data-ttu-id="1555e-158">Fuente: [Unit Testing versus Functional Tests](https://www.softwaretestingtricks.com/2007/01/unit-testing-versus-functional-tests.html) (Diferencias entre pruebas unitarias y pruebas funcionales)</span><span class="sxs-lookup"><span data-stu-id="1555e-158">Source: [Unit Testing versus Functional Tests](https://www.softwaretestingtricks.com/2007/01/unit-testing-versus-functional-tests.html)</span></span>

<span data-ttu-id="1555e-159">Me gusta decir: "Como desarrolladores, fallamos de dos maneras: creamos algo de forma incorrecta o creamos algo incorrecto".</span><span class="sxs-lookup"><span data-stu-id="1555e-159">I'm fond of saying "As developers, we fail in two ways: we build the thing wrong, or we build the wrong thing."</span></span> <span data-ttu-id="1555e-160">Las pruebas unitarias aseguran que se cree algo de forma correcta y las pruebas funcionales que se cree algo correcto.</span><span class="sxs-lookup"><span data-stu-id="1555e-160">Unit tests ensure you are building the thing right; functional tests ensure you are building the right thing.</span></span>

<span data-ttu-id="1555e-161">Como las pruebas funcionales operan en el nivel de sistema, pueden requerir cierto grado de automatización de la interfaz de usuario.</span><span class="sxs-lookup"><span data-stu-id="1555e-161">Since functional tests operate at the system level, they may require some degree of UI automation.</span></span> <span data-ttu-id="1555e-162">Al igual que las pruebas de integración, también suelen funcionar con algún tipo de infraestructura de pruebas.</span><span class="sxs-lookup"><span data-stu-id="1555e-162">Like integration tests, they usually work with some kind of test infrastructure as well.</span></span> <span data-ttu-id="1555e-163">Esta actividad hace que sean más lentas y frágiles que las pruebas unitarias y de integración.</span><span class="sxs-lookup"><span data-stu-id="1555e-163">This activity makes them slower and more brittle than unit and integration tests.</span></span> <span data-ttu-id="1555e-164">Solo se deben tener las pruebas funcionales necesarias para estar seguro de que el sistema se comporta tal y como esperan los usuarios.</span><span class="sxs-lookup"><span data-stu-id="1555e-164">You should have only as many functional tests as you need to be confident the system is behaving as users expect.</span></span>

### <a name="testing-pyramid"></a><span data-ttu-id="1555e-165">Pirámide de pruebas</span><span class="sxs-lookup"><span data-stu-id="1555e-165">Testing Pyramid</span></span>

<span data-ttu-id="1555e-166">Martin Fowler escribió sobre la pirámide de pruebas, de la que se muestra un ejemplo en la figura 9-1.</span><span class="sxs-lookup"><span data-stu-id="1555e-166">Martin Fowler wrote about the testing pyramid, an example of which is shown in Figure 9-1.</span></span>

![Pirámide de pruebas](./media/image9-1.png)

<span data-ttu-id="1555e-168">**Figura 9-1**.</span><span class="sxs-lookup"><span data-stu-id="1555e-168">**Figure 9-1**.</span></span> <span data-ttu-id="1555e-169">Pirámide de pruebas</span><span class="sxs-lookup"><span data-stu-id="1555e-169">Testing Pyramid</span></span>

<span data-ttu-id="1555e-170">Los diferentes niveles de la pirámide y sus tamaños relativos representan distintos tipos de pruebas y cuántas se deben escribir para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="1555e-170">The different layers of the pyramid, and their relative sizes, represent different kinds of tests and how many you should write for your application.</span></span> <span data-ttu-id="1555e-171">Como se puede ver, la recomendación es tener una base grande de pruebas unitarias, respaldada por un nivel más pequeño de pruebas de integración, con un nivel incluso más pequeño de pruebas funcionales.</span><span class="sxs-lookup"><span data-stu-id="1555e-171">As you can see, the recommendation is to have a large base of unit tests, supported by a smaller layer of integration tests, with an even smaller layer of functional tests.</span></span> <span data-ttu-id="1555e-172">Idealmente, cada nivel solo debería incluir las pruebas que no se puedan realizar de forma adecuada en un nivel inferior.</span><span class="sxs-lookup"><span data-stu-id="1555e-172">Each layer should ideally only have tests in it that cannot be performed adequately at a lower layer.</span></span> <span data-ttu-id="1555e-173">Tenga presente la pirámide de pruebas al tratar de decidir qué tipo de prueba necesita para un escenario determinado.</span><span class="sxs-lookup"><span data-stu-id="1555e-173">Keep the testing pyramid in mind when you are trying to decide which kind of test you need for a particular scenario.</span></span>

### <a name="what-to-test"></a><span data-ttu-id="1555e-174">Qué se va a probar</span><span class="sxs-lookup"><span data-stu-id="1555e-174">What to test</span></span>

<span data-ttu-id="1555e-175">Un problema común para los desarrolladores sin experiencia con la escritura de pruebas automatizadas es determinar lo que se debe probar.</span><span class="sxs-lookup"><span data-stu-id="1555e-175">A common problem for developers who are inexperienced with writing automated tests is coming up with what to test.</span></span> <span data-ttu-id="1555e-176">Un buen punto de partida es probar la lógica condicional.</span><span class="sxs-lookup"><span data-stu-id="1555e-176">A good starting point is to test conditional logic.</span></span> <span data-ttu-id="1555e-177">Siempre que haya un método con un comportamiento que cambia en función de una instrucción condicional (if-else, switch, etc.), debería poder dar idear al menos un par de pruebas que confirmen el comportamiento correcto para determinadas condiciones.</span><span class="sxs-lookup"><span data-stu-id="1555e-177">Anywhere you have a method with behavior that changes based on a conditional statement (if-else, switch, and so on), you should be able to come up with at least a couple of tests that confirm the correct behavior for certain conditions.</span></span> <span data-ttu-id="1555e-178">Si el código tiene condiciones de error, es conveniente escribir al menos una prueba para la "ruta feliz" a través del código (sin errores) y al menos una prueba para la "ruta triste" (con errores o resultados pocos frecuentes) para confirmar que la aplicación se comporta según lo previsto ante los errores.</span><span class="sxs-lookup"><span data-stu-id="1555e-178">If your code has error conditions, it's good to write at least one test for the "happy path" through the code (with no errors), and at least one test for the "sad path" (with errors or atypical results) to confirm your application behaves as expected in the face of errors.</span></span> <span data-ttu-id="1555e-179">Por último, intente centrarse en probar cosas en las que se pueda producir un error, en lugar de centrarse en métricas como la cobertura de código.</span><span class="sxs-lookup"><span data-stu-id="1555e-179">Finally, try to focus on testing things that can fail, rather than focusing on metrics like code coverage.</span></span> <span data-ttu-id="1555e-180">Por lo general, es mejor tener más cobertura de código que menos.</span><span class="sxs-lookup"><span data-stu-id="1555e-180">More code coverage is better than less, generally.</span></span> <span data-ttu-id="1555e-181">Pero escribir algunas pruebas más de un método complejo y esencial para la empresa suele ser un mejor uso del tiempo que escribir pruebas para propiedades automáticas solo para mejorar la métrica de cobertura del código de prueba.</span><span class="sxs-lookup"><span data-stu-id="1555e-181">However, writing a few more tests of a complex and business-critical method is usually a better use of time than writing tests for auto-properties just to improve test code coverage metrics.</span></span>

## <a name="organizing-test-projects"></a><span data-ttu-id="1555e-182">Organización de los proyectos de prueba</span><span class="sxs-lookup"><span data-stu-id="1555e-182">Organizing test projects</span></span>

<span data-ttu-id="1555e-183">Los proyectos de prueba se pueden organizar de la manera que mejor funcione.</span><span class="sxs-lookup"><span data-stu-id="1555e-183">Test projects can be organized however works best for you.</span></span> <span data-ttu-id="1555e-184">Es una buena idea separar las pruebas por tipo (prueba unitaria, prueba de integración) y por lo que van a probar (por proyecto, por espacio de nombres).</span><span class="sxs-lookup"><span data-stu-id="1555e-184">It's a good idea to separate tests by type (unit test, integration test) and by what they are testing (by project, by namespace).</span></span> <span data-ttu-id="1555e-185">Que esta separación conste de carpetas dentro de un único proyecto de prueba o de varios es una decisión de diseño.</span><span class="sxs-lookup"><span data-stu-id="1555e-185">Whether this separation consists of folders within a single test project, or multiple test projects, is a design decision.</span></span> <span data-ttu-id="1555e-186">Lo más sencillo es un proyecto, pero para proyectos grandes con muchas pruebas, o bien para ejecutar más fácilmente otros conjuntos de pruebas, es posible que le interese tener varios proyectos de prueba distintos.</span><span class="sxs-lookup"><span data-stu-id="1555e-186">One project is simplest, but for large projects with many tests, or in order to more easily run different sets of tests, you might want to have several different test projects.</span></span> <span data-ttu-id="1555e-187">Muchos equipos organizan los proyectos de prueba en función del proyecto que se está probando, que para las aplicaciones con más de unos pocos proyectos puede provocar un gran número de proyectos de prueba, en especial si se siguen dividiendo según el tipo de pruebas de cada proyecto.</span><span class="sxs-lookup"><span data-stu-id="1555e-187">Many teams organize test projects based on the project they are testing, which for applications with more than a few projects can result in a large number of test projects, especially if you still break these down according to what kind of tests are in each project.</span></span> <span data-ttu-id="1555e-188">Un enfoque de compromiso consiste en disponer de un proyecto por tipo de prueba, por aplicación, con carpetas dentro de los proyectos de prueba para indicar el proyecto (y la clase) que se van a probar.</span><span class="sxs-lookup"><span data-stu-id="1555e-188">A compromise approach is to have one project per kind of test, per application, with folders inside the test projects to indicate the project (and class) being tested.</span></span>

<span data-ttu-id="1555e-189">Un enfoque común consiste en organizar los proyectos de la aplicación en una carpeta "src" y los proyectos de prueba en una carpeta "tests" paralela.</span><span class="sxs-lookup"><span data-stu-id="1555e-189">A common approach is to organize the application projects under a 'src' folder, and the application's test projects under a parallel 'tests' folder.</span></span> <span data-ttu-id="1555e-190">Si esta organización le parece útil, puede crear carpetas de solución coincidentes en Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="1555e-190">You can create matching solution folders in Visual Studio, if you find this organization useful.</span></span>

![Organización de las pruebas en la solución](./media/image9-2.png)

<span data-ttu-id="1555e-192">**Figura 9-2**.</span><span class="sxs-lookup"><span data-stu-id="1555e-192">**Figure 9-2**.</span></span> <span data-ttu-id="1555e-193">Organización de las pruebas en la solución</span><span class="sxs-lookup"><span data-stu-id="1555e-193">Test organization in your solution</span></span>

<span data-ttu-id="1555e-194">Puede usar el marco de pruebas que prefiera.</span><span class="sxs-lookup"><span data-stu-id="1555e-194">You can use whichever test framework you prefer.</span></span> <span data-ttu-id="1555e-195">El marco de trabajo xUnit funciona bien y es en el que se escriben todas las pruebas de ASP.NET Core y EF Core.</span><span class="sxs-lookup"><span data-stu-id="1555e-195">The xUnit framework works well and is what all of the ASP.NET Core and EF Core tests are written in.</span></span> <span data-ttu-id="1555e-196">Puede agregar un proyecto de prueba de xUnit en Visual Studio con la plantilla que se muestra en la figura 9-3 o desde la CLI con `dotnet new xunit`.</span><span class="sxs-lookup"><span data-stu-id="1555e-196">You can add an xUnit test project in Visual Studio using the template shown in Figure 9-3, or from the CLI using `dotnet new xunit`.</span></span>

![Agregar un proyecto de prueba de xUnit en Visual Studio](./media/image9-3.png)

<span data-ttu-id="1555e-198">**Figura 9-3**.</span><span class="sxs-lookup"><span data-stu-id="1555e-198">**Figure 9-3**.</span></span> <span data-ttu-id="1555e-199">Agregar un proyecto de prueba de xUnit en Visual Studio</span><span class="sxs-lookup"><span data-stu-id="1555e-199">Add an xUnit Test Project in Visual Studio</span></span>

### <a name="test-naming"></a><span data-ttu-id="1555e-200">Nombres de pruebas</span><span class="sxs-lookup"><span data-stu-id="1555e-200">Test naming</span></span>

<span data-ttu-id="1555e-201">Asigne nombres a las pruebas de forma coherente, con un nombre que indique lo que hace cada prueba.</span><span class="sxs-lookup"><span data-stu-id="1555e-201">Name your tests in a consistent fashion, with names that indicate what each test does.</span></span> <span data-ttu-id="1555e-202">Un enfoque con el que he tenido buenos resultados consiste en asignar nombres a las clases de prueba en función de la clase y el método que estén probando.</span><span class="sxs-lookup"><span data-stu-id="1555e-202">One approach I've had great success with is to name test classes according to the class and method they are testing.</span></span> <span data-ttu-id="1555e-203">Este enfoque da como resultado muchas clases de prueba pequeñas, pero deja muy claro la responsabilidad de cada una.</span><span class="sxs-lookup"><span data-stu-id="1555e-203">This approach results in many small test classes, but it makes it extremely clear what each test is responsible for.</span></span> <span data-ttu-id="1555e-204">Con el nombre de la clase de prueba configurado para identificar la clase y el método que se van a probar, se puede usar el nombre del método de prueba para especificar el comportamiento que se está probando.</span><span class="sxs-lookup"><span data-stu-id="1555e-204">With the test class name set up, to identify the class and method to be tested, the test method name can be used to specify the behavior being tested.</span></span> <span data-ttu-id="1555e-205">Este nombre debe incluir el comportamiento esperado, y las entradas o suposiciones que deban producir este comportamiento.</span><span class="sxs-lookup"><span data-stu-id="1555e-205">This name should include the expected behavior and any inputs or assumptions that should yield this behavior.</span></span> <span data-ttu-id="1555e-206">Algunos nombres de prueba de ejemplo:</span><span class="sxs-lookup"><span data-stu-id="1555e-206">Some example test names:</span></span>

- `CatalogControllerGetImage.CallsImageServiceWithId`

- `CatalogControllerGetImage.LogsWarningGivenImageMissingException`

- `CatalogControllerGetImage.ReturnsFileResultWithBytesGivenSuccess`

- `CatalogControllerGetImage.ReturnsNotFoundResultGivenImageMissingException`

<span data-ttu-id="1555e-207">Una variante de este enfoque finaliza cada nombre de clase de prueba con "Should" (Debería) y modifica ligeramente el tiempo:</span><span class="sxs-lookup"><span data-stu-id="1555e-207">A variation of this approach ends each test class name with "Should" and modifies the tense slightly:</span></span>

- <span data-ttu-id="1555e-208">`CatalogControllerGetImage`**Should**`.`**Call**`ImageServiceWithId`</span><span class="sxs-lookup"><span data-stu-id="1555e-208">`CatalogControllerGetImage`**Should**`.`**Call**`ImageServiceWithId`</span></span>

- <span data-ttu-id="1555e-209">`CatalogControllerGetImage`**Should**`.`**Log**`WarningGivenImageMissingException`</span><span class="sxs-lookup"><span data-stu-id="1555e-209">`CatalogControllerGetImage`**Should**`.`**Log**`WarningGivenImageMissingException`</span></span>

<span data-ttu-id="1555e-210">Para algunos equipos el segundo método de nomenclatura es más claro, aunque un poco más detallado.</span><span class="sxs-lookup"><span data-stu-id="1555e-210">Some teams find the second naming approach clearer, though slightly more verbose.</span></span> <span data-ttu-id="1555e-211">En cualquier caso, intente usar una convención de nomenclatura que proporcione información del comportamiento de la prueba, para que cuando se produzca un error en una o varias pruebas, sea obvio a partir de los nombres en qué casos se ha producido el error.</span><span class="sxs-lookup"><span data-stu-id="1555e-211">In any case, try to use a naming convention that provides insight into test behavior, so that when one or more tests fail, it's obvious from their names what cases have failed.</span></span> <span data-ttu-id="1555e-212">Evite asignar nombres vagos a las pruebas, como ControllerTests.Test1, dado que estos nombres no ofrecen ningún valor cuando se ven en los resultados de las pruebas.</span><span class="sxs-lookup"><span data-stu-id="1555e-212">Avoid naming your tests vaguely, such as ControllerTests.Test1, as these names offer no value when you see them in test results.</span></span>

<span data-ttu-id="1555e-213">Si sigue una convención de nomenclatura como la anterior que genera muchas clases de prueba pequeñas, es aconsejable organizar más las pruebas mediante carpetas y espacios de nombres.</span><span class="sxs-lookup"><span data-stu-id="1555e-213">If you follow a naming convention like the one above that produces many small test classes, it's a good idea to further organize your tests using folders and namespaces.</span></span> <span data-ttu-id="1555e-214">En la figura 9-4 se muestra un enfoque para organizar las pruebas por carpeta en varios proyectos de prueba.</span><span class="sxs-lookup"><span data-stu-id="1555e-214">Figure 9-4 shows one approach to organizing tests by folder within several test projects.</span></span>

![Organización de las clases de prueba por carpeta en función de la clase que se prueba](./media/image9-4.png)

<span data-ttu-id="1555e-216">**Figura 9-4.**</span><span class="sxs-lookup"><span data-stu-id="1555e-216">**Figure 9-4.**</span></span> <span data-ttu-id="1555e-217">Organización de las clases de prueba por carpeta en función de la clase que se está probando.</span><span class="sxs-lookup"><span data-stu-id="1555e-217">Organizing test classes by folder based on class being tested.</span></span>

<span data-ttu-id="1555e-218">Si una clase de aplicación determinada tiene muchos métodos para probar (y, por tanto, muchas clases de prueba), tiene sentido colocar estas clases en una carpeta correspondiente a la clase de aplicación.</span><span class="sxs-lookup"><span data-stu-id="1555e-218">If a particular application class has many methods being tested (and thus many test classes), it may make sense to place these classes in a folder corresponding to the application class.</span></span> <span data-ttu-id="1555e-219">Esta organización es similar a cómo se podrían organizar los archivos en carpetas en otra parte.</span><span class="sxs-lookup"><span data-stu-id="1555e-219">This organization is no different than how you might organize files into folders elsewhere.</span></span> <span data-ttu-id="1555e-220">Si tiene más de tres o cuatro archivos relacionados en una carpeta que contiene otros muchos archivos, suele resultar útil moverlos a su propia subcarpeta.</span><span class="sxs-lookup"><span data-stu-id="1555e-220">If you have more than three or four related files in a folder containing many other files, it's often helpful to move them into their own subfolder.</span></span>

## <a name="unit-testing-aspnet-core-apps"></a><span data-ttu-id="1555e-221">Pruebas unitarias de aplicaciones ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="1555e-221">Unit testing ASP.NET Core apps</span></span>

<span data-ttu-id="1555e-222">En una aplicación ASP.NET Core bien diseñada, la mayor parte de la complejidad y la lógica de negocios se encapsulará en entidades de negocio y una variedad de servicios.</span><span class="sxs-lookup"><span data-stu-id="1555e-222">In a well-designed ASP.NET Core application, most of the complexity and business logic will be encapsulated in business entities and a variety of services.</span></span> <span data-ttu-id="1555e-223">La propia aplicación ASP.NET Core MVC, con sus controladores, filtros, modelos de vista y vistas, no debería requerir muchas pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="1555e-223">The ASP.NET Core MVC app itself, with its controllers, filters, viewmodels, and views, should require few unit tests.</span></span> <span data-ttu-id="1555e-224">Gran parte de la funcionalidad de una acción determinada se encuentra fuera del propio método de acción.</span><span class="sxs-lookup"><span data-stu-id="1555e-224">Much of the functionality of a given action lies outside the action method itself.</span></span> <span data-ttu-id="1555e-225">Con una prueba unitaria no se puede comprobar de forma eficaz si el enrutamiento o el control de errores globales funcionan correctamente.</span><span class="sxs-lookup"><span data-stu-id="1555e-225">Testing whether routing or global error handling work correctly cannot be done effectively with a unit test.</span></span> <span data-ttu-id="1555e-226">Del mismo modo, los filtros, incluidos los de autenticación y validación del modelo y los de autorización, no se pueden someter a pruebas unitarias con una prueba que tiene como objetivo el método de acción de un controlador.</span><span class="sxs-lookup"><span data-stu-id="1555e-226">Likewise, any filters, including model validation and authentication and authorization filters, cannot be unit tested with a test targeting a controller's action method.</span></span> <span data-ttu-id="1555e-227">Sin estas fuentes de comportamiento, la mayoría de los métodos de acción deberían ser pequeños, y delegar la mayor parte de su trabajo a servicios que se puedan probar de forma independiente al controlador que los usa.</span><span class="sxs-lookup"><span data-stu-id="1555e-227">Without these sources of behavior, most action methods should be trivially small, delegating the bulk of their work to services that can be tested independent of the controller that uses them.</span></span>

<span data-ttu-id="1555e-228">En ocasiones tendrá que refactorizar el código para poder realizar pruebas unitarias en él.</span><span class="sxs-lookup"><span data-stu-id="1555e-228">Sometimes you'll need to refactor your code in order to unit test it.</span></span> <span data-ttu-id="1555e-229">Con frecuencia, esta actividad implica la identificación de abstracciones y el uso de la inserción de dependencias para acceder a la abstracción en el código que se quiere probar, en lugar de codificar directamente en la infraestructura.</span><span class="sxs-lookup"><span data-stu-id="1555e-229">Frequently this activity involves identifying abstractions and using dependency injection to access the abstraction in the code you'd like to test, rather than coding directly against infrastructure.</span></span> <span data-ttu-id="1555e-230">Por ejemplo, considere este método de acción sencillo para mostrar imágenes:</span><span class="sxs-lookup"><span data-stu-id="1555e-230">For example, consider this easy action method for displaying images:</span></span>

```csharp
[HttpGet("[controller]/pic/{id}")]
public IActionResult GetImage(int id)
{
    var contentRoot = _env.ContentRootPath + "//Pics";
    var path = Path.Combine(contentRoot, id + ".png");
    Byte[] b = System.IO.File.ReadAllBytes(path);
    return File(b, "image/png");
}
```

<span data-ttu-id="1555e-231">La realización de pruebas unitarias en este método se complica debido a su dependencia directa de `System.IO.File`, que usa para leer el sistema de archivos.</span><span class="sxs-lookup"><span data-stu-id="1555e-231">Unit testing this method is made difficult by its direct dependency on `System.IO.File`, which it uses to read from the file system.</span></span> <span data-ttu-id="1555e-232">Puede probar este comportamiento para asegurarse de que funciona de la forma esperada, pero si lo hace con archivos reales será una prueba de integración.</span><span class="sxs-lookup"><span data-stu-id="1555e-232">You can test this behavior to ensure it works as expected, but doing so with real files is an integration test.</span></span> <span data-ttu-id="1555e-233">Cabe destacar que no se puede realizar la prueba unitaria de la ruta de este método: verá cómo hacerla con una prueba funcional en breve.</span><span class="sxs-lookup"><span data-stu-id="1555e-233">It's worth noting you can't unit test this method's route&mdash;you'll see how to do this testing with a functional test shortly.</span></span>

<span data-ttu-id="1555e-234">Si no se pueden realizar directamente pruebas unitarias del comportamiento del sistema de archivos y no se puede probar la ruta, ¿qué se puede probar?</span><span class="sxs-lookup"><span data-stu-id="1555e-234">If you can't unit test the file system behavior directly, and you can't test the route, what is there to test?</span></span> <span data-ttu-id="1555e-235">Después de la refactorización para que las pruebas unitarias sean posibles, puede detectar varios casos de prueba y comportamiento que falta, como el control de errores.</span><span class="sxs-lookup"><span data-stu-id="1555e-235">Well, after refactoring to make unit testing possible, you may discover some test cases and missing behavior, such as error handling.</span></span> <span data-ttu-id="1555e-236">¿Qué hace el método cuando no se encuentra un archivo?</span><span class="sxs-lookup"><span data-stu-id="1555e-236">What does the method do when a file isn't found?</span></span> <span data-ttu-id="1555e-237">¿Qué debería hacer?</span><span class="sxs-lookup"><span data-stu-id="1555e-237">What should it do?</span></span> <span data-ttu-id="1555e-238">En este ejemplo, el método refactorizado tiene el aspecto siguiente:</span><span class="sxs-lookup"><span data-stu-id="1555e-238">In this example, the refactored method looks like this:</span></span>

```csharp
[HttpGet("[controller]/pic/{id}")]
public IActionResult GetImage(int id)
{
    byte[] imageBytes;
    try
    {
        imageBytes = _imageService.GetImageBytesById(id);
    }
    catch (CatalogImageMissingException ex)
    {
        _logger.LogWarning($"No image found for id: {id}");
        return NotFound();
    }
    return File(imageBytes, "image/png");
}
```

<span data-ttu-id="1555e-239">`_logger` y `_imageService` se insertan como dependencias.</span><span class="sxs-lookup"><span data-stu-id="1555e-239">`_logger` and `_imageService` are both injected as dependencies.</span></span> <span data-ttu-id="1555e-240">Ahora se puede probar que el mismo identificador que se pasa al método de acción se pasa a `_imageService` y que los bytes resultantes se devuelven como parte de FileResult.</span><span class="sxs-lookup"><span data-stu-id="1555e-240">Now you can test that the same ID that is passed to the action method is passed to `_imageService`, and that the resulting bytes are returned as part of the FileResult.</span></span> <span data-ttu-id="1555e-241">También se puede probar que el registro de errores se esté realizando de la forma esperada y que se devuelva un resultado de `NotFound` si la imagen no se encuentra, suponiendo que se trate de un comportamiento importante de la aplicación (es decir, no solo código temporal que el desarrollador ha agregado para diagnosticar una incidencia).</span><span class="sxs-lookup"><span data-stu-id="1555e-241">You can also test that error logging is happening as expected, and that a `NotFound` result is returned if the image is missing, assuming this behavior is important application behavior (that is, not just temporary code the developer added to diagnose an issue).</span></span> <span data-ttu-id="1555e-242">La lógica real del archivo se ha trasladado a un servicio de implementación independiente y se ha ampliado para devolver una excepción específica de la aplicación en el caso de un archivo que falta.</span><span class="sxs-lookup"><span data-stu-id="1555e-242">The actual file logic has moved into a separate implementation service, and has been augmented to return an application-specific exception for the case of a missing file.</span></span> <span data-ttu-id="1555e-243">Puede probar esta implementación de forma independiente, con una prueba de integración.</span><span class="sxs-lookup"><span data-stu-id="1555e-243">You can test this implementation independently, using an integration test.</span></span>

<span data-ttu-id="1555e-244">En la mayoría de los casos, es recomendable que use controladores de excepciones globales en los controladores, por lo que la cantidad de lógica que contengan debería ser mínima y probablemente no valga la pena realizar pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="1555e-244">In most cases, you'll want to use global exception handlers in your controllers, so the amount of logic in them should be minimal and probably not worth unit testing.</span></span> <span data-ttu-id="1555e-245">Haga la mayoría de las pruebas de acciones de controlador con pruebas funcionales y la clase `TestServer`, que se describe a continuación.</span><span class="sxs-lookup"><span data-stu-id="1555e-245">Do most of your testing of controller actions using functional tests and the `TestServer` class described below.</span></span>

## <a name="integration-testing-aspnet-core-apps"></a><span data-ttu-id="1555e-246">Pruebas de integración en aplicaciones ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="1555e-246">Integration testing ASP.NET Core apps</span></span>

<span data-ttu-id="1555e-247">La mayoría de las pruebas de integración en las aplicaciones ASP.NET Core deberían consistir en la prueba de servicios y otros tipos de implementación definidos en el proyecto de la infraestructura.</span><span class="sxs-lookup"><span data-stu-id="1555e-247">Most of the integration tests in your ASP.NET Core apps should be testing services and other implementation types defined in your Infrastructure project.</span></span> <span data-ttu-id="1555e-248">Por ejemplo, podría [probar que EF Core actualiza y recupera correctamente los datos que espera](/ef/core/miscellaneous/testing/) de las clases de acceso a los datos que residen en el proyecto de infraestructura.</span><span class="sxs-lookup"><span data-stu-id="1555e-248">For example, you could [test that EF Core was successfully updating and retrieving the data that you expect](/ef/core/miscellaneous/testing/) from your data access classes residing in the Infrastructure project.</span></span> <span data-ttu-id="1555e-249">La mejor manera de probar si el proyecto de ASP.NET Core MVC se comporta correctamente es realizar pruebas funcionales en la aplicación que se ejecuta en un host de prueba.</span><span class="sxs-lookup"><span data-stu-id="1555e-249">The best way to test that your ASP.NET Core MVC project is behaving correctly is with functional tests that run against your app running in a test host.</span></span>

## <a name="functional-testing-aspnet-core-apps"></a><span data-ttu-id="1555e-250">Pruebas funcionales en aplicaciones ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="1555e-250">Functional testing ASP.NET Core apps</span></span>

<span data-ttu-id="1555e-251">Para las aplicaciones ASP.NET Core, la clase `TestServer` facilita considerablemente la escritura de pruebas funcionales.</span><span class="sxs-lookup"><span data-stu-id="1555e-251">For ASP.NET Core applications, the `TestServer` class makes functional tests fairly easy to write.</span></span> <span data-ttu-id="1555e-252">Para configurar un elemento `TestServer`, use directamente `WebHostBuilder` (o `HostBuilder`), como lo haría para su aplicación, o bien el tipo `WebApplicationFactory` (disponible a partir de la versión 2.1).</span><span class="sxs-lookup"><span data-stu-id="1555e-252">You configure a `TestServer` using a `WebHostBuilder` (or `HostBuilder`) directly (as you normally do for your application), or with the `WebApplicationFactory` type (available since version 2.1).</span></span> <span data-ttu-id="1555e-253">Intente que el host de prueba coincida lo máximo posible con el host de producción para que las pruebas ejecuten un comportamiento similar al que tendrá la aplicación en la fase de producción.</span><span class="sxs-lookup"><span data-stu-id="1555e-253">Try to match your test host to your production host as closely as possible, so your tests exercise behavior similar to what the app will do in production.</span></span> <span data-ttu-id="1555e-254">La clase `WebApplicationFactory` es útil para configurar ContentRoot de TestServer, que ASP.NET Core usa para localizar recursos estáticos como las vistas.</span><span class="sxs-lookup"><span data-stu-id="1555e-254">The `WebApplicationFactory` class is helpful for configuring the TestServer's ContentRoot, which is used by ASP.NET Core to locate static resource like Views.</span></span>

<span data-ttu-id="1555e-255">Puede crear pruebas funcionales sencillas si crea una clase de prueba que implemente `IClassFixture\<WebApplicationFactory\<TEntry>>`, donde `TEntry` es la clase `Startup` de la aplicación web.</span><span class="sxs-lookup"><span data-stu-id="1555e-255">You can create simple functional tests by creating a test class that implements `IClassFixture\<WebApplicationFactory\<TEntry>>`, where `TEntry` is your web application's `Startup` class.</span></span> <span data-ttu-id="1555e-256">Después de incorporar esta interfaz, el accesorio de prueba puede crear un cliente con el método `CreateClient` de la fábrica:</span><span class="sxs-lookup"><span data-stu-id="1555e-256">With this interface in place, your test fixture can create a client using the factory's `CreateClient` method:</span></span>

```csharp
public class BasicWebTests : IClassFixture<WebApplicationFactory<Startup>>
{
    protected readonly HttpClient _client;

    public BasicWebTests(WebApplicationFactory<Startup> factory)
    {
        _client = factory.CreateClient();
    }

    // write tests that use _client
}
```

<span data-ttu-id="1555e-257">Con frecuencia, querrá configurar opciones adicionales del sitio antes de ejecutar cada prueba, como configurar la aplicación para que use un almacén de datos en memoria y, después, propagar datos de prueba en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="1555e-257">Frequently, you'll want to perform some additional configuration of your site before each test runs, such as configuring the application to use an in-memory data store and then seeding the application with test data.</span></span> <span data-ttu-id="1555e-258">Para lograr esta función, cree su propia subclase de `WebApplicationFactory\<TEntry>` e invalide su método `ConfigureWebHost`.</span><span class="sxs-lookup"><span data-stu-id="1555e-258">To achieve this functionality, create your own subclass of `WebApplicationFactory\<TEntry>` and override its `ConfigureWebHost` method.</span></span> <span data-ttu-id="1555e-259">El ejemplo siguiente es del proyecto eShopOnWeb FunctionalTests y se usa como parte de las pruebas en la aplicación web principal.</span><span class="sxs-lookup"><span data-stu-id="1555e-259">The example below is from the eShopOnWeb FunctionalTests project and is used as part of the tests on the main web application.</span></span>

```csharp
using Microsoft.AspNetCore.Hosting;
using Microsoft.AspNetCore.Identity;
using Microsoft.AspNetCore.Mvc.Testing;
using Microsoft.EntityFrameworkCore;
using Microsoft.eShopWeb.Infrastructure.Data;
using Microsoft.eShopWeb.Infrastructure.Identity;
using Microsoft.eShopWeb.Web;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Logging;
using System;

namespace Microsoft.eShopWeb.FunctionalTests.Web
{
    public class WebTestFixture : WebApplicationFactory<Startup>
    {
        protected override void ConfigureWebHost(IWebHostBuilder builder)
        {
            builder.UseEnvironment("Testing");

            builder.ConfigureServices(services =>
            {
                 services.AddEntityFrameworkInMemoryDatabase();

                // Create a new service provider.
                var provider = services
                    .AddEntityFrameworkInMemoryDatabase()
                    .BuildServiceProvider();

                // Add a database context (ApplicationDbContext) using an in-memory
                // database for testing.
                services.AddDbContext<CatalogContext>(options =>
                {
                    options.UseInMemoryDatabase("InMemoryDbForTesting");
                    options.UseInternalServiceProvider(provider);
                });

                services.AddDbContext<AppIdentityDbContext>(options =>
                {
                    options.UseInMemoryDatabase("Identity");
                    options.UseInternalServiceProvider(provider);
                });

                // Build the service provider.
                var sp = services.BuildServiceProvider();

                // Create a scope to obtain a reference to the database
                // context (ApplicationDbContext).
                using (var scope = sp.CreateScope())
                {
                    var scopedServices = scope.ServiceProvider;
                    var db = scopedServices.GetRequiredService<CatalogContext>();
                    var loggerFactory = scopedServices.GetRequiredService<ILoggerFactory>();

                    var logger = scopedServices
                        .GetRequiredService<ILogger<WebTestFixture>>();

                    // Ensure the database is created.
                    db.Database.EnsureCreated();

                    try
                    {
                        // Seed the database with test data.
                        CatalogContextSeed.SeedAsync(db, loggerFactory).Wait();

                        // seed sample user data
                        var userManager = scopedServices.GetRequiredService<UserManager<ApplicationUser>>();
                        var roleManager = scopedServices.GetRequiredService<RoleManager<IdentityRole>>();
                        AppIdentityDbContextSeed.SeedAsync(userManager, roleManager).Wait();
                    }
                    catch (Exception ex)
                    {
                        logger.LogError(ex, $"An error occurred seeding the " +
                            "database with test messages. Error: {ex.Message}");
                    }
                }
            });
        }
    }
}
```

<span data-ttu-id="1555e-260">Las pruebas pueden hacer uso de esta clase WebApplicationFactory personalizada para crear a un cliente y, después, realizar solicitudes a la aplicación mediante esta instancia de cliente.</span><span class="sxs-lookup"><span data-stu-id="1555e-260">Tests can make use of this custom WebApplicationFactory by using it to create a client and then making requests to the application using this client instance.</span></span> <span data-ttu-id="1555e-261">La aplicación tendrá datos propagados que se pueden usar como parte de las aserciones de la prueba.</span><span class="sxs-lookup"><span data-stu-id="1555e-261">The application will have data seeded that can be used as part of the test's assertions.</span></span> <span data-ttu-id="1555e-262">La prueba que encontrará a continuación comprueba que la página principal de la aplicación eShopOnWeb se carga correctamente y que incluye una lista de productos que se ha agregado a la aplicación como parte de los datos de inicialización.</span><span class="sxs-lookup"><span data-stu-id="1555e-262">The following test verifies that the home page of the eShopOnWeb application loads correctly and includes a product listing that was added to the application as part of the seed data.</span></span>

```csharp
using Microsoft.eShopWeb.FunctionalTests.Web;
using System.Net.Http;
using System.Threading.Tasks;
using Xunit;

namespace Microsoft.eShopWeb.FunctionalTests.WebRazorPages
{
    [Collection("Sequential")]
    public class HomePageOnGet : IClassFixture<WebTestFixture>
    {
        public HomePageOnGet(WebTestFixture factory)
        {
            Client = factory.CreateClient();
        }

        public HttpClient Client { get; }

        [Fact]
        public async Task ReturnsHomePageWithProductListing()
        {
            // Arrange & Act
            var response = await Client.GetAsync("/");
            response.EnsureSuccessStatusCode();
            var stringResponse = await response.Content.ReadAsStringAsync();

            // Assert
            Assert.Contains(".NET Bot Black Sweatshirt", stringResponse);
        }
    }
}
```

<span data-ttu-id="1555e-263">Esta prueba funcional ejecuta la pila de la aplicación ASP.NET Core MVC o Razor Pages completa, incluido todo el middleware, los filtros y los enlazadores, que puedan estar definidos.</span><span class="sxs-lookup"><span data-stu-id="1555e-263">This functional test exercises the full ASP.NET Core MVC / Razor Pages application stack, including all middleware, filters, and binders that may be in place.</span></span> <span data-ttu-id="1555e-264">Comprueba que una ruta determinada ("/") devuelve el código de estado correcto esperado y la salida HTML.</span><span class="sxs-lookup"><span data-stu-id="1555e-264">It verifies that a given route ("/") returns the expected success status code and HTML output.</span></span> <span data-ttu-id="1555e-265">Lo hace sin configurar un servidor web real y evita gran parte de la fragilidad que supone el uso de un servidor web real para realizar pruebas (por ejemplo, problemas con la configuración de firewall).</span><span class="sxs-lookup"><span data-stu-id="1555e-265">It does so without setting up a real web server, and avoids much of the brittleness that using a real web server for testing can experience (for example, problems with firewall settings).</span></span> <span data-ttu-id="1555e-266">Las pruebas funcionales que se ejecutan en TestServer normalmente son más lentas que las pruebas unitarias y de integración, pero son mucho más rápidas que las que se ejecutarían a través de la red a un servidor web de prueba.</span><span class="sxs-lookup"><span data-stu-id="1555e-266">Functional tests that run against TestServer are usually slower than integration and unit tests, but are much faster than tests that would run over the network to a test web server.</span></span> <span data-ttu-id="1555e-267">Use pruebas funcionales para garantizar que la pila de front-end de la aplicación funciona según lo previsto.</span><span class="sxs-lookup"><span data-stu-id="1555e-267">Use functional tests to ensure your application's front-end stack is working as expected.</span></span> <span data-ttu-id="1555e-268">Estas pruebas son especialmente útiles al buscar duplicados en controladores o páginas, y solucionar la duplicación mediante la adición de filtros.</span><span class="sxs-lookup"><span data-stu-id="1555e-268">These tests are especially useful when you find duplication in your controllers or pages and you address the duplication by adding filters.</span></span> <span data-ttu-id="1555e-269">Idealmente, esta refactorización no cambiará el comportamiento de la aplicación, y un conjunto de pruebas funcionales comprobará que sea así.</span><span class="sxs-lookup"><span data-stu-id="1555e-269">Ideally, this refactoring won't change the behavior of the application, and a suite of functional tests will verify this is the case.</span></span>

> ### <a name="references--test-aspnet-core-mvc-apps"></a><span data-ttu-id="1555e-270">Referencias: prueba de aplicaciones ASP.NET Core MVC</span><span class="sxs-lookup"><span data-stu-id="1555e-270">References – Test ASP.NET Core MVC apps</span></span>
>
> - <span data-ttu-id="1555e-271">**Pruebas y depuración en ASP.NET Core** </span><span class="sxs-lookup"><span data-stu-id="1555e-271">**Testing in ASP.NET Core** </span></span>\
>   <https://docs.microsoft.com/aspnet/core/testing/>
> - <span data-ttu-id="1555e-272">**Convención de nomenclatura de prueba unitaria** </span><span class="sxs-lookup"><span data-stu-id="1555e-272">**Unit Test Naming Convention** </span></span>\
>   <https://ardalis.com/unit-test-naming-convention>
> - <span data-ttu-id="1555e-273">**Pruebas de EF Core** </span><span class="sxs-lookup"><span data-stu-id="1555e-273">**Testing EF Core** </span></span>\
>   <https://docs.microsoft.com/ef/core/miscellaneous/testing/>
> - <span data-ttu-id="1555e-274">**Pruebas de integración en ASP.NET Core** </span><span class="sxs-lookup"><span data-stu-id="1555e-274">**Integration tests in ASP.NET Core** </span></span>\
>   <https://docs.microsoft.com/aspnet/core/test/integration-tests>

>[!div class="step-by-step"]
><span data-ttu-id="1555e-275">[Anterior](work-with-data-in-asp-net-core-apps.md)
>[Siguiente](development-process-for-azure.md)</span><span class="sxs-lookup"><span data-stu-id="1555e-275">[Previous](work-with-data-in-asp-net-core-apps.md)
[Next](development-process-for-azure.md)</span></span>
