---
title: Desarrollo de aplicaciones ASP.NET Core MVC
description: Diseño de aplicaciones web modernas con ASP.NET Core y Azure | Desarrollo de aplicaciones ASP.NET Core MVC
author: ardalis
ms.author: wiwagn
ms.date: 12/01/2020
no-loc:
- Blazor
- WebAssembly
ms.openlocfilehash: c0fc92b2dbc25a1a48e0264b64c79fc8631fa8f0
ms.sourcegitcommit: 81f1bba2c97a67b5ca76bcc57b37333ffca60c7b
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 12/10/2020
ms.locfileid: "97009669"
---
# <a name="develop-aspnet-core-mvc-apps"></a><span data-ttu-id="4042c-103">Desarrollo de aplicaciones ASP.NET Core MVC</span><span class="sxs-lookup"><span data-stu-id="4042c-103">Develop ASP.NET Core MVC apps</span></span>

> <span data-ttu-id="4042c-104">"No es importante hacerlo bien la primera vez.</span><span class="sxs-lookup"><span data-stu-id="4042c-104">"It's not important to get it right the first time.</span></span> <span data-ttu-id="4042c-105">Es sumamente importante hacerlo bien la última vez".</span><span class="sxs-lookup"><span data-stu-id="4042c-105">It's vitally important to get it right the last time."</span></span>
> <span data-ttu-id="4042c-106">_- Andrew Hunt y David Thomas_</span><span class="sxs-lookup"><span data-stu-id="4042c-106">_- Andrew Hunt and David Thomas_</span></span>

<span data-ttu-id="4042c-107">ASP.NET Core es un marco multiplataforma de código abierto para compilar aplicaciones web modernas optimizadas para la nube.</span><span class="sxs-lookup"><span data-stu-id="4042c-107">ASP.NET Core is a cross-platform, open-source framework for building modern cloud-optimized web applications.</span></span> <span data-ttu-id="4042c-108">Las aplicaciones ASP.NET Core son ligeras y modulares, con compatibilidad integrada para la inserción de dependencias, lo que permite una mayor capacidad de prueba y mantenimiento.</span><span class="sxs-lookup"><span data-stu-id="4042c-108">ASP.NET Core apps are lightweight and modular, with built-in support for dependency injection, enabling greater testability and maintainability.</span></span> <span data-ttu-id="4042c-109">Al combinarlo con MVC, que admite la creación de API web modernas además de aplicaciones basadas en vistas, ASP.NET Core es un marco eficaz con el que compilar aplicaciones web empresariales.</span><span class="sxs-lookup"><span data-stu-id="4042c-109">Combined with MVC, which supports building modern web APIs in addition to view-based apps, ASP.NET Core is a powerful framework with which to build enterprise web applications.</span></span>

## <a name="mvc-and-razor-pages"></a><span data-ttu-id="4042c-110">MVC y Razor Pages</span><span class="sxs-lookup"><span data-stu-id="4042c-110">MVC and Razor Pages</span></span>

<span data-ttu-id="4042c-111">ASP.NET Core MVC ofrece muchas características que son útiles para crear API y aplicaciones basadas en web.</span><span class="sxs-lookup"><span data-stu-id="4042c-111">ASP.NET Core MVC offers many features that are useful for building web-based APIs and apps.</span></span> <span data-ttu-id="4042c-112">El término MVC significa "Modelo-Vista-Controlador", un patrón de interfaz de usuario que divide las responsabilidades de responder a las solicitudes de los usuarios en varias partes.</span><span class="sxs-lookup"><span data-stu-id="4042c-112">The term MVC stands for "Model-View-Controller", a UI pattern that breaks up the responsibilities of responding to user requests into several parts.</span></span> <span data-ttu-id="4042c-113">Además de seguir este patrón, también puede implementar características en sus aplicaciones ASP.NET Core, como Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="4042c-113">In addition to following this pattern, you can also implement features in your ASP.NET Core apps as Razor Pages.</span></span> <span data-ttu-id="4042c-114">Razor Pages está integrado en ASP.NET Core MVC y usa las mismas características de enrutamiento, enlace de modelos, filtros, autorización, etcétera. Pero, en lugar de tener archivos y carpetas independientes para los controladores, los modelos, las vistas y otros elementos, y usar el enrutamiento basado en atributos, Razor Pages se coloca en una sola carpeta ("/Páginas"). La ruta se basa en su ubicación relativa en la carpeta, y las solicitudes se controlan mediante controladores en lugar de acciones de controlador.</span><span class="sxs-lookup"><span data-stu-id="4042c-114">Razor Pages are built into ASP.NET Core MVC, and use the same features for routing, model binding, filters, authorization, etc. However, instead of having separate folders and files for Controllers, Models, Views, etc. and using attribute-based routing, Razor Pages are placed in a single folder ("/Pages"), route based on their relative location in this folder, and handle requests with handlers instead of controller actions.</span></span> <span data-ttu-id="4042c-115">Como resultado, al trabajar con Razor Pages, todos los archivos y clases que necesita se colocan normalmente, no se distribuyen por todo el proyecto web.</span><span class="sxs-lookup"><span data-stu-id="4042c-115">As a result, when working with Razor Pages, all of the files and classes you need are typically colocated, not spread throughout the web project.</span></span>

<span data-ttu-id="4042c-116">Al crear una aplicación ASP.NET Core, debe tener un plan en cuenta para el tipo de aplicación que quiera crear.</span><span class="sxs-lookup"><span data-stu-id="4042c-116">When you create a new ASP.NET Core App, you should have a plan in mind for the kind of app you want to build.</span></span> <span data-ttu-id="4042c-117">En Visual Studio, podrá elegir entre varias plantillas.</span><span class="sxs-lookup"><span data-stu-id="4042c-117">In Visual Studio, you'll choose from several templates.</span></span> <span data-ttu-id="4042c-118">Las tres plantillas de proyecto más comunes son API web, Aplicación web y Aplicación web (Modelo-Vista-Controlador).</span><span class="sxs-lookup"><span data-stu-id="4042c-118">The three most common project templates are Web API, Web Application, and Web Application (Model-View-Controller).</span></span> <span data-ttu-id="4042c-119">Aunque solo puede tomar esta decisión al crear un proyecto, no es irrevocable.</span><span class="sxs-lookup"><span data-stu-id="4042c-119">Although you can only make this decision when you first create a project, it's not an irrevocable decision.</span></span> <span data-ttu-id="4042c-120">El proyecto API web usa controladores de Modelo-Vista-Controlador estándar; simplemente carece de las vistas de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="4042c-120">The Web API project uses standard Model-View-Controller controllers – it just lacks Views by default.</span></span> <span data-ttu-id="4042c-121">Del mismo modo, la plantilla predeterminada Aplicación web usa Razor Pages, por lo que también carece de la carpeta de vistas.</span><span class="sxs-lookup"><span data-stu-id="4042c-121">Likewise, the default Web Application template uses Razor Pages, and so also lacks a Views folder.</span></span> <span data-ttu-id="4042c-122">Puede agregar la carpeta de vistas para estos proyectos más adelante para admitir el comportamiento basado en vistas.</span><span class="sxs-lookup"><span data-stu-id="4042c-122">You can add a Views folder to these projects later to support view-based behavior.</span></span> <span data-ttu-id="4042c-123">Los proyectos de tipo API web y Modelo-Vista-Controlador no incluyen la carpeta de páginas de forma predeterminada, pero puede agregar una más tarde para admitir el comportamiento basado en Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="4042c-123">Web API and Model-View-Controller projects don't include a Pages folder by default, but you can add one later to support Razor Pages-based behavior.</span></span> <span data-ttu-id="4042c-124">Estos tres tipos de plantilla están diseñados para tres tipos de interacción predeterminada del usuario distintos: datos (API web), basada en páginas y basada en vistas.</span><span class="sxs-lookup"><span data-stu-id="4042c-124">You can think of these three templates as supporting three different kinds of default user interaction: data (web API), page-based, and view-based.</span></span> <span data-ttu-id="4042c-125">Si quiere, puede combinar cualquiera de estas plantillas, o todas ellas, en un mismo proyecto.</span><span class="sxs-lookup"><span data-stu-id="4042c-125">However, you can mix and match any or all of these templates within a single project if you wish.</span></span>

### <a name="why-razor-pages"></a><span data-ttu-id="4042c-126">¿Por qué Razor Pages?</span><span class="sxs-lookup"><span data-stu-id="4042c-126">Why Razor Pages?</span></span>

<span data-ttu-id="4042c-127">Razor Pages es el método predeterminado para nuevas aplicaciones web en Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="4042c-127">Razor Pages is the default approach for new web applications in Visual Studio.</span></span> <span data-ttu-id="4042c-128">Razor Pages ofrece una manera más fácil de crear características de aplicaciones basadas en páginas, como los formularios que no son de aplicaciones de página única.</span><span class="sxs-lookup"><span data-stu-id="4042c-128">Razor Pages offers a simpler way of building page-based application features, such as non-SPA forms.</span></span> <span data-ttu-id="4042c-129">Al usar controladores y vistas, era habitual que las aplicaciones tuvieran controladores muy grandes que funcionaban con varias dependencias y varios modelos de vista distintos, así como que devolvieran muchas vistas diferentes.</span><span class="sxs-lookup"><span data-stu-id="4042c-129">Using controllers and views, it was common for applications to have very large controllers that worked with many different dependencies and view models and returned many different views.</span></span> <span data-ttu-id="4042c-130">Esto generaba una mayor complejidad y, a menudo, daba lugar a controladores que no seguían el principio de responsabilidad única o los principios de apertura y cierre de forma eficaz.</span><span class="sxs-lookup"><span data-stu-id="4042c-130">This resulted in more complexity and often resulted in controllers that didn't follow the Single Responsibility Principle or Open/Closed Principles effectively.</span></span> <span data-ttu-id="4042c-131">Razor Pages soluciona este problema, ya que encapsula la lógica del lado servidor para una determinada "página" lógica en una aplicación web con el marcado de Razor.</span><span class="sxs-lookup"><span data-stu-id="4042c-131">Razor Pages addresses this issue by encapsulating the server-side logic for a given logical "page" in a web application with its Razor markup.</span></span> <span data-ttu-id="4042c-132">Una página de Razor Pages que no tenga ninguna lógica del lado servidor solo puede constar de un archivo de Razor (por ejemplo, "Index.cshtml").</span><span class="sxs-lookup"><span data-stu-id="4042c-132">A Razor Page that has no server-side logic can only consist of a Razor file (for instance, "Index.cshtml").</span></span> <span data-ttu-id="4042c-133">Sin embargo, la mayoría de Razor Pages no triviales tendrá una clase de modelo de página asociado, que, por convención, tendrá el mismo nombre que el archivo Razor con una extensión ".cs" (por ejemplo, "Index.cshtml.cs").</span><span class="sxs-lookup"><span data-stu-id="4042c-133">However, most non-trivial Razor Pages will have an associated page model class, which by convention is named the same as the Razor file with a ".cs" extension (for example, "Index.cshtml.cs").</span></span>

<span data-ttu-id="4042c-134">Un modelo de página de Razor Pages combina las responsabilidades de un controlador de MVC y un modelo de vista.</span><span class="sxs-lookup"><span data-stu-id="4042c-134">A Razor Page's page model combines the responsibilities of an MVC controller and a viewmodel.</span></span> <span data-ttu-id="4042c-135">En lugar de controlar las solicitudes con los métodos de acción de controlador, se ejecutan los controladores de modelo de página, como "OnGet()", con lo que se representa la página asociada de forma predeterminada.</span><span class="sxs-lookup"><span data-stu-id="4042c-135">Instead of handling requests with controller action methods, page model handlers like "OnGet()" are executed, rendering their associated page by default.</span></span> <span data-ttu-id="4042c-136">Razor Pages simplifica el proceso de compilar páginas individuales en la aplicación ASP.NET Core sin dejar de proporciona todas las características arquitectónicas de ASP.NET Core MVC.</span><span class="sxs-lookup"><span data-stu-id="4042c-136">Razor Pages simplifies the process of building individual pages in an ASP.NET Core app, while still providing all the architectural features of ASP.NET Core MVC.</span></span> <span data-ttu-id="4042c-137">Es una buena opción predeterminada para la nueva funcionalidad basada en páginas.</span><span class="sxs-lookup"><span data-stu-id="4042c-137">They're a good default choice for new page-based functionality.</span></span>

### <a name="when-to-use-mvc"></a><span data-ttu-id="4042c-138">Cuándo usar MVC</span><span class="sxs-lookup"><span data-stu-id="4042c-138">When to use MVC</span></span>

<span data-ttu-id="4042c-139">Si va a crear interfaces API web, el patrón MVC tiene más sentido que Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="4042c-139">If you're building web APIs, the MVC pattern makes more sense than trying to use Razor Pages.</span></span> <span data-ttu-id="4042c-140">Si el proyecto va a exponer solo los puntos de conexión de la API Web, lo ideal es empezar a partir de la plantilla de proyecto de API web.</span><span class="sxs-lookup"><span data-stu-id="4042c-140">If your project will only expose web API endpoints, you should ideally start from the Web API project template.</span></span> <span data-ttu-id="4042c-141">De lo contrario, es fácil agregar controladores y puntos de conexión de API asociados a cualquier aplicación ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="4042c-141">Otherwise, it's easy to add controllers and associated API endpoints to any ASP.NET Core app.</span></span> <span data-ttu-id="4042c-142">Use el método MVC basado en vista si quiere realizar la migración de una aplicación ASP.NET MVC 5 existente o versiones anteriores a ASP.NET Core MVC y quiere hacerlo de la forma más fácil posible.</span><span class="sxs-lookup"><span data-stu-id="4042c-142">Use the view-based MVC approach if you're migrating an existing application from ASP.NET MVC 5 or earlier to ASP.NET Core MVC and you want to do so with the least amount of effort.</span></span> <span data-ttu-id="4042c-143">Una vez que haya realizado la migración inicial, podrá evaluar si tiene sentido adoptar Razor Pages para las nuevas características o incluso como migración general.</span><span class="sxs-lookup"><span data-stu-id="4042c-143">Once you've made the initial migration, you can evaluate whether it makes sense to adopt Razor Pages for new features or even as a wholesale migration.</span></span>

<span data-ttu-id="4042c-144">Si opta por crear su aplicación web mediante Razor Pages o las vistas de MVC, la aplicación tendrá un rendimiento similar e incluirá compatibilidad con la inserción de dependencias, los filtros, el enlace de modelos, la validación y otras características.</span><span class="sxs-lookup"><span data-stu-id="4042c-144">Whether you choose to build your web app using Razor Pages or MVC views, your app will have similar performance and will include support for dependency injection, filters, model binding, validation, and so on.</span></span>

## <a name="mapping-requests-to-responses"></a><span data-ttu-id="4042c-145">Asignación de solicitudes a respuestas</span><span class="sxs-lookup"><span data-stu-id="4042c-145">Mapping requests to responses</span></span>

<span data-ttu-id="4042c-146">En su núcleo, las aplicaciones ASP.NET Core asignan las solicitudes entrantes a las respuestas salientes.</span><span class="sxs-lookup"><span data-stu-id="4042c-146">At its heart, ASP.NET Core apps map incoming requests to outgoing responses.</span></span> <span data-ttu-id="4042c-147">En un nivel bajo, esta asignación se realiza mediante middleware, y las aplicaciones y microservicios sencillos de ASP.NET Core pueden constar únicamente de middleware personalizado.</span><span class="sxs-lookup"><span data-stu-id="4042c-147">At a low level, this mapping is done with middleware, and simple ASP.NET Core apps and microservices may be comprised solely of custom middleware.</span></span> <span data-ttu-id="4042c-148">Cuando se usa ASP.NET Core MVC, se puede trabajar en un cierto nivel superior y pensar en términos de _rutas_, _controladores_ y _acciones_.</span><span class="sxs-lookup"><span data-stu-id="4042c-148">When using ASP.NET Core MVC, you can work at a somewhat higher level, thinking in terms of _routes_, _controllers_, and _actions_.</span></span> <span data-ttu-id="4042c-149">Cada solicitud entrante se compara con la tabla de enrutamiento de la aplicación y, si se encuentra una ruta coincidente, se llama al método de acción asociado (perteneciente a un controlador) para controlar la solicitud.</span><span class="sxs-lookup"><span data-stu-id="4042c-149">Each incoming request is compared with the application's routing table, and if a matching route is found, the associated action method (belonging to a controller) is called to handle the request.</span></span> <span data-ttu-id="4042c-150">Si no se encuentra ninguna ruta que coincida, se llama a un controlador de errores (en este caso, se devuelve un resultado de NotFound).</span><span class="sxs-lookup"><span data-stu-id="4042c-150">If no matching route is found, an error handler (in this case, returning a NotFound result) is called.</span></span>

<span data-ttu-id="4042c-151">Las aplicaciones ASP.NET Core MVC pueden usar rutas convencionales, rutas de atributo o las dos.</span><span class="sxs-lookup"><span data-stu-id="4042c-151">ASP.NET Core MVC apps can use conventional routes, attribute routes, or both.</span></span> <span data-ttu-id="4042c-152">Las rutas convencionales se definen en el código, especificando _convenciones_ de enrutamiento con una sintaxis similar a la del ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="4042c-152">Conventional routes are defined in code, specifying routing _conventions_ using syntax like in the example below:</span></span>

```csharp
app.UseEndpoints(endpoints =>
{
    endpoints.MapControllerRoute(name: "default", pattern: "{controller=Home}/{action=Index}/{id?}");
});
```

<span data-ttu-id="4042c-153">En este ejemplo, se agregó una ruta con el nombre "default" a la tabla de enrutamiento.</span><span class="sxs-lookup"><span data-stu-id="4042c-153">In this example, a route named "default" has been added to the routing table.</span></span> <span data-ttu-id="4042c-154">Define una plantilla de ruta con marcadores de posición para `controller`, `action` y `id`.</span><span class="sxs-lookup"><span data-stu-id="4042c-154">It defines a route template with placeholders for `controller`, `action`, and `id`.</span></span> <span data-ttu-id="4042c-155">Los marcadores de posición `controller` y `action` tienen el valor predeterminado especificado (`Home` y `Index`, respectivamente), y el marcador de posición `id` es opcional (en virtud de la aplicación de "?").</span><span class="sxs-lookup"><span data-stu-id="4042c-155">The `controller` and `action` placeholders have the default specified (`Home` and `Index`, respectively), and the `id` placeholder is optional (by virtue of a "?" applied to it).</span></span> <span data-ttu-id="4042c-156">La convención que se define aquí indica que la primera parte de una solicitud debe corresponder al nombre del controlador, la segunda parte, a la acción y después, si es necesario, una tercera parte representará un parámetro del identificador.</span><span class="sxs-lookup"><span data-stu-id="4042c-156">The convention defined here states that the first part of a request should correspond to the name of the controller, the second part to the action, and then if necessary a third part will represent an ID parameter.</span></span> <span data-ttu-id="4042c-157">Las rutas convencionales normalmente se definen en un solo lugar para la aplicación, por ejemplo, en el método `Configure` de la clase `Startup`.</span><span class="sxs-lookup"><span data-stu-id="4042c-157">Conventional routes are typically defined in one place for the application, such as in the `Configure` method in the `Startup` class.</span></span>

<span data-ttu-id="4042c-158">Las rutas de atributo se aplican directamente a los controladores y acciones, en lugar de especificarse globalmente.</span><span class="sxs-lookup"><span data-stu-id="4042c-158">Attribute routes are applied to controllers and actions directly, rather than specified globally.</span></span> <span data-ttu-id="4042c-159">Este enfoque tiene la ventaja de que son mucho más sencillas de detectar cuando se examina un método concreto, pero significa que la información de enrutamiento no se mantiene en un lugar de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="4042c-159">This approach has the advantage of making them much more discoverable when you're looking at a particular method, but does mean that routing information is not kept in one place in the application.</span></span> <span data-ttu-id="4042c-160">Con las rutas de atributo, se pueden especificar fácilmente varias rutas para una acción determinada, así como combinar rutas entre controladores y acciones.</span><span class="sxs-lookup"><span data-stu-id="4042c-160">With attribute routes, you can easily specify multiple routes for a given action, as well as combine routes between controllers and actions.</span></span> <span data-ttu-id="4042c-161">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="4042c-161">For example:</span></span>

```csharp
[Route("Home")]
public class HomeController : Controller
{
    [Route("")] // Combines to define the route template "Home"
    [Route("Index")] // Combines to define route template "Home/Index"
    [Route("/")] // Does not combine, defines the route template ""
    public IActionResult Index() {}
}
```

<span data-ttu-id="4042c-162">Las rutas se pueden especificar en atributos [HttpGet] y similares, evitando la necesidad de agregar atributos [Route] independientes.</span><span class="sxs-lookup"><span data-stu-id="4042c-162">Routes can be specified on [HttpGet] and similar attributes, avoiding the need to add separate [Route] attributes.</span></span> <span data-ttu-id="4042c-163">Las rutas de atributo también pueden usar tokens para reducir la necesidad de repetir los nombres de acciones o controladores, como se muestra a continuación:</span><span class="sxs-lookup"><span data-stu-id="4042c-163">Attribute routes can also use tokens to reduce the need to repeat controller or action names, as shown below:</span></span>

```csharp
[Route("[controller]")]
public class ProductsController : Controller
{
    [Route("")] // Matches 'Products'
    [Route("Index")] // Matches 'Products/Index'
    public IActionResult Index() {}
}
```

<span data-ttu-id="4042c-164">Razor Pages no usa el enrutamiento de atributos.</span><span class="sxs-lookup"><span data-stu-id="4042c-164">Razor Pages doesn't use attribute routing.</span></span> <span data-ttu-id="4042c-165">Puede especificar información de la plantilla de ruta adicional para una Razor Page como parte de su directiva de `@page`:</span><span class="sxs-lookup"><span data-stu-id="4042c-165">You can specify additional route template information for a Razor Page as part of its `@page` directive:</span></span>

```csharp
@page "{id:int}"
```

<span data-ttu-id="4042c-166">En el ejemplo anterior, la página en cuestión coincidiría con una ruta con un parámetro `id` de número entero.</span><span class="sxs-lookup"><span data-stu-id="4042c-166">In the previous example, the page in question would match a route with an integer `id` parameter.</span></span> <span data-ttu-id="4042c-167">Por ejemplo, la página *Products.cshtml*, que se encuentra en la raíz de `/Pages`, tendría esta ruta:</span><span class="sxs-lookup"><span data-stu-id="4042c-167">For example, the *Products.cshtml* page located in the root of `/Pages` would have this route:</span></span>

```csharp
"/Products/123"
```

<span data-ttu-id="4042c-168">Una vez que una determinada solicitud se ha asociado a una ruta, pero antes de llamar al método de acción, ASP.NET Core MVC realizará el [enlace del modelo](/aspnet/core/mvc/models/model-binding) y la [validación del modelo](/aspnet/core/mvc/models/validation) en la solicitud.</span><span class="sxs-lookup"><span data-stu-id="4042c-168">Once a given request has been matched to a route, but before the action method is called, ASP.NET Core MVC will perform [model binding](/aspnet/core/mvc/models/model-binding) and [model validation](/aspnet/core/mvc/models/validation) on the request.</span></span> <span data-ttu-id="4042c-169">El enlace del modelo es responsable de convertir los datos HTTP entrantes en los tipos de .NET especificados como parámetros del método de acción que se va a llamar.</span><span class="sxs-lookup"><span data-stu-id="4042c-169">Model binding is responsible for converting incoming HTTP data into the .NET types specified as parameters of the action method to be called.</span></span> <span data-ttu-id="4042c-170">Por ejemplo, si el método de acción espera un parámetro `int id`, el enlace de modelos intentará proporcionar este parámetro a partir de un valor que se suministre como parte de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="4042c-170">For example, if the action method expects an `int id` parameter, model binding will attempt to provide this parameter from a value provided as part of the request.</span></span> <span data-ttu-id="4042c-171">Para ello, el enlace de modelos busca valores en un formulario enviado, valores en la propia misma ruta y valores de cadena de consulta.</span><span class="sxs-lookup"><span data-stu-id="4042c-171">To do so, model binding looks for values in a posted form, values in the route itself, and query string values.</span></span> <span data-ttu-id="4042c-172">Suponiendo que se encuentre un valor `id`, se convertirá en un entero antes de pasarlo al método de acción.</span><span class="sxs-lookup"><span data-stu-id="4042c-172">Assuming an `id` value is found, it will be converted to an integer before being passed into the action method.</span></span>

<span data-ttu-id="4042c-173">Después de enlazar el modelo, pero antes de llamar al método de acción, se produce la validación del modelo.</span><span class="sxs-lookup"><span data-stu-id="4042c-173">After binding the model but before calling the action method, model validation occurs.</span></span> <span data-ttu-id="4042c-174">La validación del modelo usa atributos opcionales en el tipo de modelo y puede ayudar a garantizar que el objeto de modelo proporcionado cumple determinados requisitos de datos.</span><span class="sxs-lookup"><span data-stu-id="4042c-174">Model validation uses optional attributes on the model type, and can help ensure that the provided model object conforms to certain data requirements.</span></span> <span data-ttu-id="4042c-175">Se pueden especificar determinados valores como obligatorios, o limitarlos a una longitud o un intervalo numérico determinados, etc. Si se especifican atributos de validación, pero el modelo no cumple sus requisitos, la propiedad ModelState.IsValid será false y el conjunto de reglas de validación con errores estará disponible para enviarlo al cliente que realiza la solicitud.</span><span class="sxs-lookup"><span data-stu-id="4042c-175">Certain values may be specified as required, or limited to a certain length or numeric range, etc. If validation attributes are specified but the model does not conform to their requirements, the property ModelState.IsValid will be false, and the set of failing validation rules will be available to send to the client making the request.</span></span>

<span data-ttu-id="4042c-176">Si se usa la validación del modelo, siempre se debe comprobar que el modelo es válido antes de ejecutar cualquier comando de modificación del estado, para asegurarse de que la aplicación no resulta dañada por datos no válidos.</span><span class="sxs-lookup"><span data-stu-id="4042c-176">If you're using model validation, you should be sure to always check that the model is valid before performing any state-altering commands, to ensure your app is not corrupted by invalid data.</span></span> <span data-ttu-id="4042c-177">Se puede usar un [filtro](/aspnet/core/mvc/controllers/filters) para evitar la necesidad de agregar código para esta validación en todas las acciones.</span><span class="sxs-lookup"><span data-stu-id="4042c-177">You can use a [filter](/aspnet/core/mvc/controllers/filters) to avoid the need to add code for this validation in every action.</span></span> <span data-ttu-id="4042c-178">Los filtros de ASP.NET Core MVC ofrecen una manera de interceptar grupos de solicitudes, para poder aplicar directivas comunes e intereses transversales por cada destino.</span><span class="sxs-lookup"><span data-stu-id="4042c-178">ASP.NET Core MVC filters offer a way of intercepting groups of requests, so that common policies and cross-cutting concerns can be applied on a targeted basis.</span></span> <span data-ttu-id="4042c-179">Los filtros se pueden aplicar a acciones individuales, controladores completos o de forma global para una aplicación.</span><span class="sxs-lookup"><span data-stu-id="4042c-179">Filters can be applied to individual actions, whole controllers, or globally for an application.</span></span>

<span data-ttu-id="4042c-180">Para las API web, ASP.NET Core MVC admite la [_negociación de contenido_](/aspnet/core/mvc/models/formatting), lo que permite a las solicitudes especificar cómo se debe aplicar formato a las respuestas.</span><span class="sxs-lookup"><span data-stu-id="4042c-180">For web APIs, ASP.NET Core MVC supports [_content negotiation_](/aspnet/core/mvc/models/formatting), allowing requests to specify how responses should be formatted.</span></span> <span data-ttu-id="4042c-181">Según los encabezados proporcionados en la solicitud, las acciones que devuelven datos darán formato a la respuesta en XML, JSON o en otro formato compatible.</span><span class="sxs-lookup"><span data-stu-id="4042c-181">Based on headers provided in the request, actions returning data will format the response in XML, JSON, or another supported format.</span></span> <span data-ttu-id="4042c-182">Esta característica permite usar la misma API en varios clientes con requisitos de formato de datos diferentes.</span><span class="sxs-lookup"><span data-stu-id="4042c-182">This feature enables the same API to be used by multiple clients with different data format requirements.</span></span>

<span data-ttu-id="4042c-183">Para los proyectos de API web, debería valorarse el uso del atributo `[ApiController]`, que se puede aplicar a controladores individuales, a una clase de controlador base o a todo el ensamblado.</span><span class="sxs-lookup"><span data-stu-id="4042c-183">Web API projects should consider using the `[ApiController]` attribute, which can be applied to individual controllers, to a base controller class, or to the entire assembly.</span></span> <span data-ttu-id="4042c-184">Este atributo agrega la comprobación de validación de modelos automática; cualquier acción con una modelo no válido devolverá una solicitud BadRequest con los detalles de los errores de validación.</span><span class="sxs-lookup"><span data-stu-id="4042c-184">This attribute adds automatic model validation checking and any action with an invalid model will return a BadRequest with the details of the validation errors.</span></span> <span data-ttu-id="4042c-185">El atributo también requiere que todas las acciones tengan una ruta de atributo, en lugar de utilizar una ruta convencional, y devuelve información más detallada de ProblemDetails en respuesta a los errores.</span><span class="sxs-lookup"><span data-stu-id="4042c-185">The attribute also requires all actions have an attribute route, rather than using a conventional route, and returns more detailed ProblemDetails information in response to errors.</span></span>

### <a name="keeping-controllers-under-control"></a><span data-ttu-id="4042c-186">Mantenimiento de los controladores bajo control</span><span class="sxs-lookup"><span data-stu-id="4042c-186">Keeping controllers under control</span></span>

<span data-ttu-id="4042c-187">En el caso de las aplicaciones basadas en páginas, Razor Pages hace un gran trabajo evitando que los controladores se vuelvan demasiado grandes.</span><span class="sxs-lookup"><span data-stu-id="4042c-187">For page-based applications, Razor Pages do a great job of keeping controllers from getting too large.</span></span> <span data-ttu-id="4042c-188">Cada página tiene sus propios archivos y clases dedicados únicamente para sus controladores.</span><span class="sxs-lookup"><span data-stu-id="4042c-188">Each individual page is given its own files and classes dedicated just to its handler(s).</span></span> <span data-ttu-id="4042c-189">Antes de la introducción de Razor Pages, muchas aplicaciones centradas en las vistas tenían grandes clases de controladores responsables de muchas acciones y vistas diferentes.</span><span class="sxs-lookup"><span data-stu-id="4042c-189">Prior to the introduction of Razor Pages, many view-centric applications would have large controller classes responsible for many different actions and views.</span></span> <span data-ttu-id="4042c-190">Estas clases crecían de forma natural hasta tener muchas responsabilidades y dependencias, lo que dificultaba el mantenimiento.</span><span class="sxs-lookup"><span data-stu-id="4042c-190">These classes would naturally grow to have many responsibilities and dependencies, making them harder to maintain.</span></span> <span data-ttu-id="4042c-191">Si sus controladores basados en vistas están creciendo demasiado, considere la posibilidad de refactorizarlos para usar Razor Pages o de incluir un patrón como mediador.</span><span class="sxs-lookup"><span data-stu-id="4042c-191">If you find your view-based controllers are growing too large, consider refactoring them to use Razor Pages, or introducing a pattern like a mediator.</span></span>

<span data-ttu-id="4042c-192">El patrón de diseño de mediador se usa para reducir el acoplamiento entre las clases y permitir la comunicación entre ellas.</span><span class="sxs-lookup"><span data-stu-id="4042c-192">The mediator design pattern is used to reduce coupling between classes while allowing communication between them.</span></span> <span data-ttu-id="4042c-193">En las aplicaciones de ASP.NET Core MVC, este patrón suele emplearse para dividir los controladores en partes más pequeñas mediante el uso de *rutinas de controladores* para realizar el trabajo de los métodos de acción.</span><span class="sxs-lookup"><span data-stu-id="4042c-193">In ASP.NET Core MVC applications, this pattern is frequently employed to break up controllers into smaller pieces by using *handlers* to do the work of action methods.</span></span> <span data-ttu-id="4042c-194">El popular [paquete NuGet MediatR](https://www.nuget.org/packages/MediatR/) se usa a menudo para lograr esto.</span><span class="sxs-lookup"><span data-stu-id="4042c-194">The popular [MediatR NuGet package](https://www.nuget.org/packages/MediatR/) is often used to accomplish this.</span></span> <span data-ttu-id="4042c-195">Normalmente, los controladores incluyen muchos métodos de acción diferentes, y cada uno puede requerir ciertas dependencias.</span><span class="sxs-lookup"><span data-stu-id="4042c-195">Typically, controllers include many different action methods, each of which may require certain dependencies.</span></span> <span data-ttu-id="4042c-196">El conjunto de todas las dependencias requeridas por cualquier acción debe transferirse al constructor del controlador.</span><span class="sxs-lookup"><span data-stu-id="4042c-196">The set of all dependencies required by any action must be passed into the controller's constructor.</span></span> <span data-ttu-id="4042c-197">Cuando se usa MediatR, la única dependencia que tiene un controlador es la de una instancia del mediador.</span><span class="sxs-lookup"><span data-stu-id="4042c-197">When using MediatR, the only dependency a controller has is on an instance of the mediator.</span></span> <span data-ttu-id="4042c-198">Cada acción usa la instancia del mediador para enviar un mensaje, el cual es procesado por un controlador.</span><span class="sxs-lookup"><span data-stu-id="4042c-198">Each action then uses the mediator instance to send a message, which is processed by a handler.</span></span> <span data-ttu-id="4042c-199">El controlador es específico para una única acción y, por tanto, solo necesita las dependencias que requiere dicha acción.</span><span class="sxs-lookup"><span data-stu-id="4042c-199">The handler is specific to a single action and thus only needs the dependencies required by that action.</span></span> <span data-ttu-id="4042c-200">A continuación se muestra un ejemplo de un controlador que usa MediatR:</span><span class="sxs-lookup"><span data-stu-id="4042c-200">An example of a controller using MediatR is shown here:</span></span>

```csharp
public class OrderController : Controller
{
    private readonly IMediator _mediator;

    public OrderController(IMediator mediator)
    {
        _mediator = mediator;
    }

    [HttpGet]
    public async Task<IActionResult> MyOrders()
    {
        var viewModel = await _mediator.Send(new GetMyOrders(User.Identity.Name));

        return View(viewModel);
    }

    // other actions implemented similarly
}
```

<span data-ttu-id="4042c-201">En la acción `MyOrders`, esta clase controla la llamada a `Send` para enviar un mensaje de `GetMyOrders`:</span><span class="sxs-lookup"><span data-stu-id="4042c-201">In the `MyOrders` action, the call to `Send` a `GetMyOrders` message is handled by this class:</span></span>

```csharp
public class GetMyOrdersHandler : IRequestHandler<GetMyOrders, IEnumerable<OrderViewModel>>
{
    private readonly IOrderRepository _orderRepository;

    public GetMyOrdersHandler(IOrderRepository orderRepository)
    {
        _orderRepository = orderRepository;
    }

    public async Task<IEnumerable<OrderViewModel>> Handle(GetMyOrders request, CancellationToken cancellationToken)
    {
        var specification = new CustomerOrdersWithItemsSpecification(request.UserName);
        var orders = await _orderRepository.ListAsync(specification);

        return orders.Select(o => new OrderViewModel
        {
            OrderDate = o.OrderDate,
            OrderItems = o.OrderItems?.Select(oi => new OrderItemViewModel()
            {
                PictureUrl = oi.ItemOrdered.PictureUri,
                ProductId = oi.ItemOrdered.CatalogItemId,
                ProductName = oi.ItemOrdered.ProductName,
                UnitPrice = oi.UnitPrice,
                Units = oi.Units
            }).ToList(),
            OrderNumber = o.Id,
            ShippingAddress = o.ShipToAddress,
            Total = o.Total()
        });
    }
}
```

<span data-ttu-id="4042c-202">El resultado final de este enfoque es que los controladores deben ser mucho más pequeños y estar centrados principalmente en el enrutamiento y el enlace de modelos; mientras que las rutinas de controladores individuales son responsables de las tareas específicas que necesita un punto de conexión determinado.</span><span class="sxs-lookup"><span data-stu-id="4042c-202">The end result of this approach is for controllers to be much smaller and focused primarily on routing and model binding, while individual handlers are responsible for the specific tasks needed by a given endpoint.</span></span> <span data-ttu-id="4042c-203">Este enfoque también se puede lograr sin MediatR mediante el uso del [paquete NuGet ApiEndpoints](https://www.nuget.org/packages/Ardalis.ApiEndpoints/), que intenta proporcionar a los controladores de API las mismas ventajas que proporciona Razor Pages a los controladores basados en vistas.</span><span class="sxs-lookup"><span data-stu-id="4042c-203">This approach can also be achieved without MediatR by using the [ApiEndpoints NuGet package](https://www.nuget.org/packages/Ardalis.ApiEndpoints/), which attempts to bring to API controllers the same benefits Razor Pages brings to view-based controllers.</span></span>

> ### <a name="references--mapping-requests-to-responses"></a><span data-ttu-id="4042c-204">Referencias: asignación de solicitudes a respuestas</span><span class="sxs-lookup"><span data-stu-id="4042c-204">References – Mapping Requests to Responses</span></span>
>
> - <span data-ttu-id="4042c-205">**Routing to Controller Actions (Enrutamiento a acciones del controlador)** </span><span class="sxs-lookup"><span data-stu-id="4042c-205">**Routing to Controller Actions**</span></span>\
 > <https://docs.microsoft.com/aspnet/core/mvc/controllers/routing>
> - <span data-ttu-id="4042c-206">**Enlace de modelos**</span><span class="sxs-lookup"><span data-stu-id="4042c-206">**Model Binding**</span></span>\
 > <https://docs.microsoft.com/aspnet/core/mvc/models/model-binding>
> - <span data-ttu-id="4042c-207">**Validación de modelos**</span><span class="sxs-lookup"><span data-stu-id="4042c-207">**Model Validation**</span></span>\
 > <https://docs.microsoft.com/aspnet/core/mvc/models/validation>
> - <span data-ttu-id="4042c-208">**Filtros**</span><span class="sxs-lookup"><span data-stu-id="4042c-208">**Filters**</span></span>\
 > <https://docs.microsoft.com/aspnet/core/mvc/controllers/filters>
> - <span data-ttu-id="4042c-209">**Atributo ApiController**</span><span class="sxs-lookup"><span data-stu-id="4042c-209">**ApiController Attribute**</span></span>\
 > <https://docs.microsoft.com/aspnet/core/web-api/>

## <a name="working-with-dependencies"></a><span data-ttu-id="4042c-210">Trabajar con dependencias</span><span class="sxs-lookup"><span data-stu-id="4042c-210">Working with dependencies</span></span>

<span data-ttu-id="4042c-211">ASP.NET Core tiene compatibilidad integrada con una técnica conocida como [inserción de dependencias](/aspnet/core/fundamentals/dependency-injection) y la usa de manera interna.</span><span class="sxs-lookup"><span data-stu-id="4042c-211">ASP.NET Core has built-in support for and internally makes use of a technique known as [dependency injection](/aspnet/core/fundamentals/dependency-injection).</span></span> <span data-ttu-id="4042c-212">La inserción de dependencias es una técnica que permite el acoplamiento flexible entre los distintos elementos de una aplicación.</span><span class="sxs-lookup"><span data-stu-id="4042c-212">Dependency injection is a technique that enables loose coupling between different parts of an application.</span></span> <span data-ttu-id="4042c-213">El acoplamiento más flexible es deseable porque facilita aislar los elementos de la aplicación, lo que permite realizar pruebas o reemplazos.</span><span class="sxs-lookup"><span data-stu-id="4042c-213">Looser coupling is desirable because it makes it easier to isolate parts of the application, allowing for testing or replacement.</span></span> <span data-ttu-id="4042c-214">También hace que sea menos probable que un cambio en un elemento de la aplicación tenga un impacto inesperado en otro lugar de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="4042c-214">It also makes it less likely that a change in one part of the application will have an unexpected impact somewhere else in the application.</span></span> <span data-ttu-id="4042c-215">La inserción de dependencias se basa en el principio de inversión de dependencias y suele ser es clave para lograr el principio abierto o cerrado.</span><span class="sxs-lookup"><span data-stu-id="4042c-215">Dependency injection is based on the dependency inversion principle, and is often key to achieving the open/closed principle.</span></span> <span data-ttu-id="4042c-216">Al evaluar el funcionamiento de la aplicación con sus dependencias, tenga cuidado del problema de la [estática](https://deviq.com/static-cling/) en el código y recuerde el aforismo "[lo nuevo se pega](https://ardalis.com/new-is-glue)".</span><span class="sxs-lookup"><span data-stu-id="4042c-216">When evaluating how your application works with its dependencies, beware of the [static cling](https://deviq.com/static-cling/) code smell, and remember the aphorism "[new is glue](https://ardalis.com/new-is-glue)."</span></span>

<span data-ttu-id="4042c-217">La estática se produce cuando las clases realizan llamadas a métodos estáticos, o bien tienen acceso a propiedades estáticas, que tienen efectos secundarios o dependencias en la infraestructura.</span><span class="sxs-lookup"><span data-stu-id="4042c-217">Static cling occurs when your classes make calls to static methods, or access static properties, which have side effects or dependencies on infrastructure.</span></span> <span data-ttu-id="4042c-218">Por ejemplo, si tiene un método que llama a un método estático, que a su vez escribe en una base de datos, el método está estrechamente acoplado a la base de datos.</span><span class="sxs-lookup"><span data-stu-id="4042c-218">For example, if you have a method that calls a static method, which in turn writes to a database, your method is tightly coupled to the database.</span></span> <span data-ttu-id="4042c-219">Todo lo que interrumpa esa llamada a la base de datos interrumpirá el método.</span><span class="sxs-lookup"><span data-stu-id="4042c-219">Anything that breaks that database call will break your method.</span></span> <span data-ttu-id="4042c-220">Es muy difícil probar este tipo de métodos, ya que esas pruebas requieren bibliotecas de simulación comerciales para simular las llamadas estáticas o solo se pueden probar con una base de datos de prueba.</span><span class="sxs-lookup"><span data-stu-id="4042c-220">Testing such methods is notoriously difficult, since such tests either require commercial mocking libraries to mock the static calls, or can only be tested with a test database in place.</span></span> <span data-ttu-id="4042c-221">Las llamadas estáticas que no tienen ninguna dependencia de la infraestructura, sobre todo las que son completamente sin estado, se pueden llamar sin problemas y no tienen ningún impacto en el acoplamiento o la capacidad de prueba (más allá del acoplamiento de código a la propia llamada estática).</span><span class="sxs-lookup"><span data-stu-id="4042c-221">Static calls that don't have any dependence on infrastructure, especially those calls that are completely stateless, are fine to call and have no impact on coupling or testability (beyond coupling code to the static call itself).</span></span>

<span data-ttu-id="4042c-222">Muchos desarrolladores comprenden los riesgos de la estática y el estado global, pero siguen acoplando estrechamente el código a implementaciones específicas a través de la creación directa de instancias.</span><span class="sxs-lookup"><span data-stu-id="4042c-222">Many developers understand the risks of static cling and global state, but will still tightly couple their code to specific implementations through direct instantiation.</span></span> <span data-ttu-id="4042c-223">"Lo nuevo se pega" está pensado para ser un aviso de este acoplamiento y no un rechazo general del uso de la palabra clave `new`.</span><span class="sxs-lookup"><span data-stu-id="4042c-223">"New is glue" is meant to be a reminder of this coupling, and not a general condemnation of the use of the `new` keyword.</span></span> <span data-ttu-id="4042c-224">Como sucede con las llamadas de métodos estáticos, las instancias nuevas de tipos que no tienen dependencias externas normalmente no acoplan estrechamente código a los detalles de implementación ni dificultan las pruebas.</span><span class="sxs-lookup"><span data-stu-id="4042c-224">Just as with static method calls, new instances of types that have no external dependencies typically do not tightly couple code to implementation details or make testing more difficult.</span></span> <span data-ttu-id="4042c-225">Pero cada vez que se crea una instancia de una clase, dedique un instante a considerar si tiene sentido integrar como parte del código esa instancia específica en esa ubicación concreta, o si un mejor diseño sería solicitar esa instancia como una dependencia.</span><span class="sxs-lookup"><span data-stu-id="4042c-225">But each time a class is instantiated, take just a brief moment to consider whether it makes sense to hard-code that specific instance in that particular location, or if it would be a better design to request that instance as a dependency.</span></span>

### <a name="declare-your-dependencies"></a><span data-ttu-id="4042c-226">Declarar las dependencias</span><span class="sxs-lookup"><span data-stu-id="4042c-226">Declare your dependencies</span></span>

<span data-ttu-id="4042c-227">ASP.NET Core se basa en hacer que los métodos y las clases declaren sus dependencias y las soliciten como argumentos.</span><span class="sxs-lookup"><span data-stu-id="4042c-227">ASP.NET Core is built around having methods and classes declare their dependencies, requesting them as arguments.</span></span> <span data-ttu-id="4042c-228">Las aplicaciones ASP.NET normalmente se configuran en una clase de inicio, que a su vez se configura para admitir la inserción de dependencias en varios puntos.</span><span class="sxs-lookup"><span data-stu-id="4042c-228">ASP.NET applications are typically set up in a Startup class, which itself is configured to support dependency injection at several points.</span></span> <span data-ttu-id="4042c-229">Si la clase de inicio tiene un constructor, puede solicitar las dependencias a través del constructor, de este modo:</span><span class="sxs-lookup"><span data-stu-id="4042c-229">If your Startup class has a constructor, it can request dependencies through the constructor, like so:</span></span>

```csharp
public class Startup
{
    public Startup(IHostingEnvironment env)
    {
        var builder = new ConfigurationBuilder()
            .SetBasePath(env.ContentRootPath)
            .AddJsonFile("appsettings.json", optional: false, reloadOnChange: true)
            .AddJsonFile($"appsettings.{env.EnvironmentName}.json", optional: true);
    }
}
```

<span data-ttu-id="4042c-230">La clase de inicio es interesante en el sentido de que no hay requisitos de tipos explícitos para ella.</span><span class="sxs-lookup"><span data-stu-id="4042c-230">The Startup class is interesting in that there are no explicit type requirements for it.</span></span> <span data-ttu-id="4042c-231">No hereda de una clase base de inicio especial, ni implementa ninguna interfaz determinada.</span><span class="sxs-lookup"><span data-stu-id="4042c-231">It doesn't inherit from a special Startup base class, nor does it implement any particular interface.</span></span> <span data-ttu-id="4042c-232">Se le puede asignar un constructor, o no, y se pueden especificar tantos parámetros en el constructor como se quiera.</span><span class="sxs-lookup"><span data-stu-id="4042c-232">You can give it a constructor, or not, and you can specify as many parameters on the constructor as you want.</span></span> <span data-ttu-id="4042c-233">Cuando se inicia el host web configurado para la aplicación, llamará a la clase de inicio que se le ha indicado que use y usará la inserción de dependencias para rellenar todas las dependencias que la clase de inicio requiera.</span><span class="sxs-lookup"><span data-stu-id="4042c-233">When the web host you've configured for your application starts, it will call the Startup class you've told it to use, and will use dependency injection to populate any dependencies the Startup class requires.</span></span> <span data-ttu-id="4042c-234">Por supuesto, si se solicitan parámetros que no están configurados en el contenedor de servicios que usa ASP.NET Core, se obtendrá una excepción, pero siempre que se respeten las dependencias que el contenedor conoce, se puede solicitar lo que se quiera.</span><span class="sxs-lookup"><span data-stu-id="4042c-234">Of course, if you request parameters that aren't configured in the services container used by ASP.NET Core, you'll get an exception, but as long as you stick to dependencies the container knows about, you can request anything you want.</span></span>

<span data-ttu-id="4042c-235">La inserción de dependencias se integra en las aplicaciones ASP.NET Core desde el principio, cuando se crea la instancia de la clase de inicio.</span><span class="sxs-lookup"><span data-stu-id="4042c-235">Dependency injection is built into your ASP.NET Core apps right from the start, when you create the Startup instance.</span></span> <span data-ttu-id="4042c-236">No se detiene ahí para la clase de inicio.</span><span class="sxs-lookup"><span data-stu-id="4042c-236">It doesn't stop there for the Startup class.</span></span> <span data-ttu-id="4042c-237">Las dependencias también se pueden solicitar en el método Configure:</span><span class="sxs-lookup"><span data-stu-id="4042c-237">You can also request dependencies in the Configure method:</span></span>

```csharp
public void Configure(IApplicationBuilder app,
    IHostingEnvironment env,
    ILoggerFactory loggerFactory)
{

}
```

<span data-ttu-id="4042c-238">El método ConfigureServices es la excepción a este comportamiento; solo debe tomar un parámetro de tipo IServiceCollection.</span><span class="sxs-lookup"><span data-stu-id="4042c-238">The ConfigureServices method is the exception to this behavior; it must take just one parameter of type IServiceCollection.</span></span> <span data-ttu-id="4042c-239">Realmente no necesita admitir la inserción de dependencias, ya que por un lado es responsable de agregar objetos al contenedor de servicios y, por otro, tiene acceso a todos los servicios configurados actualmente a través del parámetro IServiceCollection.</span><span class="sxs-lookup"><span data-stu-id="4042c-239">It doesn't really need to support dependency injection, since on the one hand it is responsible for adding objects to the services container, and on the other it has access to all currently configured services via the IServiceCollection parameter.</span></span> <span data-ttu-id="4042c-240">Por tanto, se puede trabajar con las dependencias definidas en la colección de servicios de ASP.NET Core en todos los elementos de la clase de inicio, ya sea solicitando el servicio necesario como un parámetro o trabajando con IServiceCollection en ConfigureServices.</span><span class="sxs-lookup"><span data-stu-id="4042c-240">Thus, you can work with dependencies defined in the ASP.NET Core services collection in every part of the Startup class, either by requesting the needed service as a parameter or by working with the IServiceCollection in ConfigureServices.</span></span>

> [!NOTE]
> <span data-ttu-id="4042c-241">Si necesita asegurarse de que determinados servicios estén disponibles para la clase de inicio, puede configurarlos mediante IWebHostBuilder y su método ConfigureServices en la llamada CreateDefaultBuilder.</span><span class="sxs-lookup"><span data-stu-id="4042c-241">If you need to ensure certain services are available to your Startup class, you can configure them using an IWebHostBuilder and its ConfigureServices method inside the CreateDefaultBuilder call.</span></span>

<span data-ttu-id="4042c-242">La clase de inicio es un modelo de cómo estructurar otros elementos de la aplicación ASP.NET Core, desde controladores a software intermedio o filtros para sus propios servicios.</span><span class="sxs-lookup"><span data-stu-id="4042c-242">The Startup class is a model for how you should structure other parts of your ASP.NET Core application, from Controllers to Middleware to Filters to your own Services.</span></span> <span data-ttu-id="4042c-243">En cada caso, se debe seguir el [principio de dependencias explícitas](https://deviq.com/explicit-dependencies-principle/), y solicitar las dependencias en lugar de crearlas directamente, y aprovechar la inserción de dependencias en toda la aplicación.</span><span class="sxs-lookup"><span data-stu-id="4042c-243">In each case, you should follow the [Explicit Dependencies Principle](https://deviq.com/explicit-dependencies-principle/), requesting your dependencies rather than directly creating them, and leveraging dependency injection throughout your application.</span></span> <span data-ttu-id="4042c-244">Tenga cuidado de dónde y cómo se crean instancias directas de las implementaciones, especialmente de servicios y objetos que funcionan con la infraestructura o tienen efectos secundarios.</span><span class="sxs-lookup"><span data-stu-id="4042c-244">Be careful of where and how you directly instantiate implementations, especially services and objects that work with infrastructure or have side effects.</span></span> <span data-ttu-id="4042c-245">Es preferible trabajar con abstracciones definidas en el núcleo de la aplicación y pasadas como argumentos que integrar las referencias como parte del código en tipos de implementación específicos.</span><span class="sxs-lookup"><span data-stu-id="4042c-245">Prefer working with abstractions defined in your application core and passed in as arguments to hardcoding references to specific implementation types.</span></span>

## <a name="structuring-the-application"></a><span data-ttu-id="4042c-246">Estructuración de la aplicación</span><span class="sxs-lookup"><span data-stu-id="4042c-246">Structuring the application</span></span>

<span data-ttu-id="4042c-247">Las aplicaciones monolíticas suelen tener un único punto de entrada.</span><span class="sxs-lookup"><span data-stu-id="4042c-247">Monolithic applications typically have a single entry point.</span></span> <span data-ttu-id="4042c-248">En el caso de una aplicación web ASP.NET Core, el punto de entrada será el proyecto web ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="4042c-248">In the case of an ASP.NET Core web application, the entry point will be the ASP.NET Core web project.</span></span> <span data-ttu-id="4042c-249">Pero eso no significa que la solución deba constar simplemente de un solo proyecto.</span><span class="sxs-lookup"><span data-stu-id="4042c-249">However, that doesn't mean the solution should consist of just a single project.</span></span> <span data-ttu-id="4042c-250">Resulta útil dividir la aplicación en diferentes capas para seguir la separación de intereses.</span><span class="sxs-lookup"><span data-stu-id="4042c-250">It's useful to break up the application into different layers in order to follow separation of concerns.</span></span> <span data-ttu-id="4042c-251">Una vez dividida en capas, resulta útil ir más allá de las carpetas para separar los proyectos, lo que puede ayudar a conseguir una mejor encapsulación.</span><span class="sxs-lookup"><span data-stu-id="4042c-251">Once broken up into layers, it's helpful to go beyond folders to separate projects, which can help achieve better encapsulation.</span></span> <span data-ttu-id="4042c-252">El mejor método para lograr estos objetivos con una aplicación ASP.NET Core consiste en una variación de la arquitectura limpia que se describe en el capítulo 5.</span><span class="sxs-lookup"><span data-stu-id="4042c-252">The best approach to achieve these goals with an ASP.NET Core application is a variation of the Clean Architecture discussed in chapter 5.</span></span> <span data-ttu-id="4042c-253">A raíz de este enfoque, la solución de la aplicación estará compuesta por bibliotecas independientes para la interfaz de usuario, la infraestructura y ApplicationCore.</span><span class="sxs-lookup"><span data-stu-id="4042c-253">Following this approach, the application's solution will comprise separate libraries for the UI, Infrastructure, and ApplicationCore.</span></span>

<span data-ttu-id="4042c-254">Además de estos proyectos, también se incluyen proyectos de prueba independientes (las pruebas se describen en el capítulo 9).</span><span class="sxs-lookup"><span data-stu-id="4042c-254">In addition to these projects, separate test projects are included as well (Testing is discussed in Chapter 9).</span></span>

<span data-ttu-id="4042c-255">El modelo de objetos y las interfaces de la aplicación se deben colocar en el proyecto ApplicationCore.</span><span class="sxs-lookup"><span data-stu-id="4042c-255">The application's object model and interfaces should be placed in the ApplicationCore project.</span></span> <span data-ttu-id="4042c-256">Este proyecto tendrá el menor número posible de dependencias y los otros proyectos de la solución le harán referencia.</span><span class="sxs-lookup"><span data-stu-id="4042c-256">This project will have as few dependencies as possible, and the other projects in the solution will reference it.</span></span> <span data-ttu-id="4042c-257">Las entidades de negocio que deban conservarse se definen en el proyecto ApplicationCore, al igual que los servicios que no dependen directamente de la infraestructura.</span><span class="sxs-lookup"><span data-stu-id="4042c-257">Business entities that need to be persisted are defined in the ApplicationCore project, as are services that do not directly depend on infrastructure.</span></span>

<span data-ttu-id="4042c-258">Los detalles de implementación, por ejemplo, cómo se realiza la persistencia o cómo se pueden enviar notificaciones a un usuario, se mantienen en el proyecto de infraestructura.</span><span class="sxs-lookup"><span data-stu-id="4042c-258">Implementation details, such as how persistence is performed or how notifications might be sent to a user, are kept in the Infrastructure project.</span></span> <span data-ttu-id="4042c-259">Este proyecto hará referencia a paquetes específicos de la implementación como Entity Framework Core, pero no debe exponer detalles sobre estas implementaciones fuera del proyecto.</span><span class="sxs-lookup"><span data-stu-id="4042c-259">This project will reference implementation-specific packages such as Entity Framework Core, but should not expose details about these implementations outside of the project.</span></span> <span data-ttu-id="4042c-260">Los servicios de infraestructura y los repositorios deben implementar interfaces definidas en el proyecto ApplicationCore, y sus implementaciones de persistencia serán responsables de recuperar y almacenar las entidades definidas en ApplicationCore.</span><span class="sxs-lookup"><span data-stu-id="4042c-260">Infrastructure services and repositories should implement interfaces that are defined in the ApplicationCore project, and its persistence implementations are responsible for retrieving and storing entities defined in ApplicationCore.</span></span>

<span data-ttu-id="4042c-261">El propio proyecto de interfaz de usuario de ASP.NET Core es responsable de cualquier interés del nivel de la interfaz de usuario, pero no debe incluir lógica empresarial o detalles de infraestructura.</span><span class="sxs-lookup"><span data-stu-id="4042c-261">The ASP.NET Core UI project is responsible for any UI level concerns, but should not include business logic or infrastructure details.</span></span> <span data-ttu-id="4042c-262">De hecho, idealmente ni siquiera debería tener una dependencia en el proyecto de infraestructura, lo que ayudará a garantizar que no se introduce por accidente ninguna dependencia entre los dos proyectos.</span><span class="sxs-lookup"><span data-stu-id="4042c-262">In fact, ideally it shouldn't even have a dependency on the Infrastructure project, which will help ensure no dependency between the two projects is introduced accidentally.</span></span> <span data-ttu-id="4042c-263">Esto se puede lograr mediante un contenedor de DI de terceros, como Autofac, que permite definir reglas de DI en clases del módulo en cada proyecto.</span><span class="sxs-lookup"><span data-stu-id="4042c-263">This can be achieved using a third-party DI container like Autofac, which allows you to define DI rules in Module classes in each project.</span></span>

<span data-ttu-id="4042c-264">Otro enfoque para desacoplar la aplicación de los detalles de implementación consiste en hacer que la aplicación llame a microservicios, posiblemente implementados en contenedores de Docker individuales.</span><span class="sxs-lookup"><span data-stu-id="4042c-264">Another approach to decoupling the application from implementation details is to have the application call microservices, perhaps deployed in individual Docker containers.</span></span> <span data-ttu-id="4042c-265">Esto proporciona una separación de intereses y desacoplamiento incluso mayor que aprovechar la DI entre dos proyectos, pero tiene una complejidad adicional.</span><span class="sxs-lookup"><span data-stu-id="4042c-265">This provides even greater separation of concerns and decoupling than leveraging DI between two projects, but has additional complexity.</span></span>

### <a name="feature-organization"></a><span data-ttu-id="4042c-266">Organización de las características</span><span class="sxs-lookup"><span data-stu-id="4042c-266">Feature organization</span></span>

<span data-ttu-id="4042c-267">De forma predeterminada, las aplicaciones ASP.NET Core organizan su estructura de carpetas para que incluir controladores y vistas, y con frecuencia ViewModels.</span><span class="sxs-lookup"><span data-stu-id="4042c-267">By default, ASP.NET Core applications organize their folder structure to include Controllers and Views, and frequently ViewModels.</span></span> <span data-ttu-id="4042c-268">El código del lado cliente para admitir estas estructuras del lado servidor normalmente se almacena por separado en la carpeta wwwroot.</span><span class="sxs-lookup"><span data-stu-id="4042c-268">Client-side code to support these server-side structures is typically stored separately in the wwwroot folder.</span></span> <span data-ttu-id="4042c-269">Pero es posible que esta organización genere problemas en aplicaciones grandes, puesto que trabajar con cualquier característica determinada a menudo requiere saltar entre estas carpetas.</span><span class="sxs-lookup"><span data-stu-id="4042c-269">However, large applications may encounter problems with this organization, since working on any given feature often requires jumping between these folders.</span></span> <span data-ttu-id="4042c-270">Esto se complica cada vez más a medida que aumenta el número de archivos y subcarpetas en cada carpeta, lo que da lugar a una gran cantidad de desplazamiento por el Explorador de soluciones.</span><span class="sxs-lookup"><span data-stu-id="4042c-270">This gets more and more difficult as the number of files and subfolders in each folder grows, resulting in a great deal of scrolling through Solution Explorer.</span></span> <span data-ttu-id="4042c-271">Una solución a este problema consiste en organizar el código de aplicación por _característica_ en lugar de por tipo de archivo.</span><span class="sxs-lookup"><span data-stu-id="4042c-271">One solution to this problem is to organize application code by _feature_ instead of by file type.</span></span> <span data-ttu-id="4042c-272">Este estilo profesional se conoce normalmente como carpetas de características o [sectores de características](/archive/msdn-magazine/2016/september/asp-net-core-feature-slices-for-asp-net-core-mvc) (vea también: [Vertical Slice](https://deviq.com/vertical-slices/) (Sectores verticales).</span><span class="sxs-lookup"><span data-stu-id="4042c-272">This organizational style is typically referred to as feature folders or [feature slices](/archive/msdn-magazine/2016/september/asp-net-core-feature-slices-for-asp-net-core-mvc) (see also: [Vertical Slices](https://deviq.com/vertical-slices/)).</span></span>

<span data-ttu-id="4042c-273">ASP.NET Core MVC admite las áreas para este propósito.</span><span class="sxs-lookup"><span data-stu-id="4042c-273">ASP.NET Core MVC supports Areas for this purpose.</span></span> <span data-ttu-id="4042c-274">Con las áreas, se pueden crear conjuntos independientes de carpetas de controladores y vistas (así como los modelos asociados) en cada carpeta de área.</span><span class="sxs-lookup"><span data-stu-id="4042c-274">Using areas, you can create separate sets of Controllers and Views folders (as well as any associated models) in each Area folder.</span></span> <span data-ttu-id="4042c-275">En la figura 7-1 se muestra una estructura de carpetas de ejemplo, en la que se usan áreas.</span><span class="sxs-lookup"><span data-stu-id="4042c-275">Figure 7-1 shows an example folder structure, using Areas.</span></span>

![Organización de áreas de ejemplo](./media/image7-1.png)

<span data-ttu-id="4042c-277">**Figura 7-1**.</span><span class="sxs-lookup"><span data-stu-id="4042c-277">**Figure 7-1**.</span></span> <span data-ttu-id="4042c-278">Organización de áreas de ejemplo</span><span class="sxs-lookup"><span data-stu-id="4042c-278">Sample Area Organization</span></span>

<span data-ttu-id="4042c-279">Cuando se usan las áreas, se deben usar atributos para decorar los controladores con el nombre del área a la que pertenecen:</span><span class="sxs-lookup"><span data-stu-id="4042c-279">When using Areas, you must use attributes to decorate your controllers with the name of the area to which they belong:</span></span>

```csharp
[Area("Catalog")]
public class HomeController
{}
```

<span data-ttu-id="4042c-280">También se debe agregar compatibilidad con las áreas a las rutas:</span><span class="sxs-lookup"><span data-stu-id="4042c-280">You also need to add area support to your routes:</span></span>

```csharp
app.UseEndpoints(endpoints =>
{
    endpoints.MapControllerRoute(name: "areaRoute", pattern: "{area:exists}/{controller=Home}/{action=Index}/{id?}");
    endpoints.MapControllerRoute(name: "default", pattern: "{controller=Home}/{action=Index}/{id?}");
});
```

<span data-ttu-id="4042c-281">Además de la compatibilidad integrada con las áreas, también se puede usar una estructura de carpetas propia y convenciones en lugar de atributos y rutas personalizadas.</span><span class="sxs-lookup"><span data-stu-id="4042c-281">In addition to the built-in support for Areas, you can also use your own folder structure, and conventions in place of attributes and custom routes.</span></span> <span data-ttu-id="4042c-282">Esto permitiría tener carpetas de características que no incluyeran carpetas independientes para vistas, controladores, etc., manteniendo la jerarquía más plana y facilitando la tarea de ver todos los archivos relacionados en un único lugar para cada característica.</span><span class="sxs-lookup"><span data-stu-id="4042c-282">This would allow you to have feature folders that didn't include separate folders for Views, Controllers, etc., keeping the hierarchy flatter and making it easier to see all related files in a single place for each feature.</span></span>

<span data-ttu-id="4042c-283">ASP.NET Core usa tipos de convención integrados para controlar su comportamiento.</span><span class="sxs-lookup"><span data-stu-id="4042c-283">ASP.NET Core uses built-in convention types to control its behavior.</span></span> <span data-ttu-id="4042c-284">Estas convenciones se pueden modificar o reemplazar.</span><span class="sxs-lookup"><span data-stu-id="4042c-284">You can modify or replace these conventions.</span></span> <span data-ttu-id="4042c-285">Por ejemplo, se puede crear una convención que obtenga automáticamente el nombre de característica de un controlador determinado en función de su espacio de nombres (lo que normalmente se correlaciona con la carpeta en la que se encuentra el controlador):</span><span class="sxs-lookup"><span data-stu-id="4042c-285">For example, you can create a convention that will automatically get the feature name for a given controller based on its namespace (which typically correlates to the folder in which the controller is located):</span></span>

```csharp
public class FeatureConvention : IControllerModelConvention
{
    public void Apply(ControllerModel controller)
    {
        controller.Properties.Add("feature",
        GetFeatureName(controller.ControllerType));
    }

    private string GetFeatureName(TypeInfo controllerType)
    {
        string[] tokens = controllerType.FullName.Split('.');
        if (!tokens.Any(t => t == "Features")) return "";
        string featureName = tokens
        .SkipWhile(t => !t.Equals("features",
        StringComparison.CurrentCultureIgnoreCase))
        .Skip(1)
        .Take(1)
        .FirstOrDefault();
        return featureName;
    }
}
```

<span data-ttu-id="4042c-286">Después, esta convención se especifica como una opción al agregar compatibilidad para MVC a la aplicación en ConfigureServices:</span><span class="sxs-lookup"><span data-stu-id="4042c-286">You then specify this convention as an option when you add support for MVC to your application in ConfigureServices:</span></span>

```csharp
services.AddMvc(o => o.Conventions.Add(new FeatureConvention()));
```

<span data-ttu-id="4042c-287">ASP.NET Core MVC también usa una convención para localizar vistas.</span><span class="sxs-lookup"><span data-stu-id="4042c-287">ASP.NET Core MVC also uses a convention to locate views.</span></span> <span data-ttu-id="4042c-288">Se puede reemplazar con una convención personalizada para que las vistas se ubiquen en las carpetas de características (mediante el nombre de la característica proporcionado por FeatureConvention, anteriormente).</span><span class="sxs-lookup"><span data-stu-id="4042c-288">You can override it with a custom convention so that views will be located in your feature folders (using the feature name provided by the FeatureConvention, above).</span></span> <span data-ttu-id="4042c-289">Puede obtener más información sobre este enfoque y descargar un ejemplo funcional en el artículo de MSDN Magazine [Sectores de características para ASP.NET Core MVC](/archive/msdn-magazine/2016/september/asp-net-core-feature-slices-for-asp-net-core-mvc).</span><span class="sxs-lookup"><span data-stu-id="4042c-289">You can learn more about this approach and download a working sample from the MSDN Magazine article, [Feature Slices for ASP.NET Core MVC](/archive/msdn-magazine/2016/september/asp-net-core-feature-slices-for-asp-net-core-mvc).</span></span>

### <a name="apis-and-no-locblazor-applications"></a><span data-ttu-id="4042c-290">API y aplicaciones Blazor</span><span class="sxs-lookup"><span data-stu-id="4042c-290">APIs and Blazor applications</span></span>

<span data-ttu-id="4042c-291">Si la aplicación incluye un conjunto de API web que se deba proteger, estas API idealmente se deben configurar como un proyecto independiente de la aplicación de vista o de Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="4042c-291">If your application includes a set of web APIs, which must be secured, these apis should ideally be configured as a separate project from your View or Razor Pages application.</span></span> <span data-ttu-id="4042c-292">La separación de las API, sobre todo las API públicas, de la aplicación web del lado servidor tiene una serie de ventajas.</span><span class="sxs-lookup"><span data-stu-id="4042c-292">Separating APIs, especially public APIs, from your server-side web application has a number of benefits.</span></span> <span data-ttu-id="4042c-293">Estas aplicaciones a menudo tendrán características de implementación y carga únicas.</span><span class="sxs-lookup"><span data-stu-id="4042c-293">These applications often will have unique deployment and load characteristics.</span></span> <span data-ttu-id="4042c-294">También es muy probable que adopten diferentes mecanismos de seguridad; las aplicaciones estándar basadas en formularios aprovechan la autenticación basada en cookies y las API probablemente usan la autenticación basada en tokens.</span><span class="sxs-lookup"><span data-stu-id="4042c-294">They're also very likely to adopt different mechanisms for security, with standard form-based applications leveraging cookie-based authentication and APIs most likely using token-based authentication.</span></span>

<span data-ttu-id="4042c-295">Además, las aplicaciones Blazor, tanto si usan Blazor Server como Blazor WebAssembly, deben compilarse como proyectos independientes.</span><span class="sxs-lookup"><span data-stu-id="4042c-295">Additionally, Blazor applications, whether using Blazor Server or Blazor WebAssembly, should be built as separate projects.</span></span> <span data-ttu-id="4042c-296">Estas aplicaciones tienen características de entorno de ejecución y modelos de seguridad diferentes.</span><span class="sxs-lookup"><span data-stu-id="4042c-296">The applications have different runtime characteristics as well as security models.</span></span> <span data-ttu-id="4042c-297">Es probable que compartan tipos comunes con la aplicación web del lado servidor (o el proyecto de API), y estos tipos se deben definir en un proyecto compartido común.</span><span class="sxs-lookup"><span data-stu-id="4042c-297">They're likely to share common types with the server-side web application (or API project), and these types should be defined in a common shared project.</span></span>

<span data-ttu-id="4042c-298">La adición de una interfaz de administrador de Blazor WebAssembly a eShopOnWeb hizo necesaria la adición de varios proyectos nuevos:</span><span class="sxs-lookup"><span data-stu-id="4042c-298">The addition of a Blazor WebAssembly admin interface to eShopOnWeb required adding several new projects.</span></span> <span data-ttu-id="4042c-299">el propio proyecto de Blazor WebAssembly, `BlazorAdmin`;</span><span class="sxs-lookup"><span data-stu-id="4042c-299">The Blazor WebAssembly project itself, `BlazorAdmin`.</span></span> <span data-ttu-id="4042c-300">el proyecto `PublicApi`, donde se define un nuevo conjunto de puntos de conexión de API pública usados por `BlazorAdmin` y configurados para usar la autenticación basada en tokens;</span><span class="sxs-lookup"><span data-stu-id="4042c-300">A new set of public API endpoints, used by `BlazorAdmin` and configured to use token-based authentication, is defined in the `PublicApi` project.</span></span> <span data-ttu-id="4042c-301">y un nuevo proyecto `BlazorShared` que almacena ciertos tipos compartidos que se usan en los dos proyectos anteriores.</span><span class="sxs-lookup"><span data-stu-id="4042c-301">And certain shared types used by both of these projects are kept in a new `BlazorShared` project.</span></span>

<span data-ttu-id="4042c-302">Podría preguntarse por qué es necesario agregar un proyecto `BlazorShared` independiente cuando ya existe un proyecto `ApplicationCore` común que podría usarse para compartir los tipos que requieren tanto `PublicApi` como `BlazorAdmin`.</span><span class="sxs-lookup"><span data-stu-id="4042c-302">One might ask, why add a separate `BlazorShared` project when there is already a common `ApplicationCore` project that could be used to share any types required by both `PublicApi` and `BlazorAdmin`?</span></span> <span data-ttu-id="4042c-303">La respuesta es que este proyecto incluye toda la lógica empresarial de la aplicación y, por tanto, es mucho mayor de lo necesario y es mucho más probable que deba mantenerse protegido en el servidor.</span><span class="sxs-lookup"><span data-stu-id="4042c-303">The answer is that this project includes all of the application's business logic and is thus much larger than necessary and also much more likely to need to be kept secure on the server.</span></span> <span data-ttu-id="4042c-304">Recuerde que cualquier biblioteca a la que haga referencia `BlazorAdmin` se descargará en los exploradores de los usuarios cuando carguen la aplicación Blazor.</span><span class="sxs-lookup"><span data-stu-id="4042c-304">Remember that any library referenced by `BlazorAdmin` will be downloaded to users' browsers when they load the Blazor application.</span></span>

<span data-ttu-id="4042c-305">Dependiendo de si se usa el patrón [Backends For Frontends (BFF)](/azure/architecture/patterns/backends-for-frontends), es posible que las API que consume la aplicación WebAssembly Blazor no compartan sus tipos con Blazor al 100 %.</span><span class="sxs-lookup"><span data-stu-id="4042c-305">Depending on whether one is using the [Backends-For-Frontends (BFF) pattern](/azure/architecture/patterns/backends-for-frontends), the APIs consumed by the Blazor WebAssembly app may not share their types 100% with Blazor.</span></span> <span data-ttu-id="4042c-306">En concreto, una API pública pensada para ser usada por muchos clientes diferentes puede definir sus propios tipos de solicitud y de resultado, en lugar de compartirlos en un proyecto compartido específico del cliente.</span><span class="sxs-lookup"><span data-stu-id="4042c-306">In particular, a public API that's meant to be consumed by many different clients may define its own request and result types, rather than sharing them in a client-specific shared project.</span></span> <span data-ttu-id="4042c-307">En el ejemplo de eShopOnWeb, se supone que el proyecto `PublicApi` está hospedando una API pública, por lo que no todos sus tipos de solicitud y de respuesta proceden del proyecto `BlazorShared`.</span><span class="sxs-lookup"><span data-stu-id="4042c-307">In the eShopOnWeb sample, the assumption is being made that the `PublicApi` project is, in fact, hosting a public API, so not all of its request and response types come from the `BlazorShared` project.</span></span>

### <a name="cross-cutting-concerns"></a><span data-ttu-id="4042c-308">Intereses transversales</span><span class="sxs-lookup"><span data-stu-id="4042c-308">Cross-cutting concerns</span></span>

<span data-ttu-id="4042c-309">A medida que las aplicaciones aumentan de tamaño, resulta cada vez más importante separar los intereses transversales para eliminar la duplicación y mantener la coherencia.</span><span class="sxs-lookup"><span data-stu-id="4042c-309">As applications grow, it becomes increasingly important to factor out cross-cutting concerns to eliminate duplication and maintain consistency.</span></span> <span data-ttu-id="4042c-310">Algunos ejemplos de intereses transversales en aplicaciones ASP.NET Core son la autenticación, las reglas de validación del modelo, el almacenamiento en caché de salida y el control de errores, aunque hay muchos otros.</span><span class="sxs-lookup"><span data-stu-id="4042c-310">Some examples of cross-cutting concerns in ASP.NET Core applications are authentication, model validation rules, output caching, and error handling, though there are many others.</span></span> <span data-ttu-id="4042c-311">Los [filtros](/aspnet/core/mvc/controllers/filters) de ASP.NET Core MVC permiten ejecutar código antes o después de ciertas fases de la canalización de procesamiento de la solicitud.</span><span class="sxs-lookup"><span data-stu-id="4042c-311">ASP.NET Core MVC [filters](/aspnet/core/mvc/controllers/filters) allow you to run code before or after certain steps in the request processing pipeline.</span></span> <span data-ttu-id="4042c-312">Por ejemplo, se puede ejecutar un filtro antes y después del enlace del modelo, antes y después de una acción, o antes y después del resultado de una acción.</span><span class="sxs-lookup"><span data-stu-id="4042c-312">For instance, a filter can run before and after model binding, before and after an action, or before and after an action's result.</span></span> <span data-ttu-id="4042c-313">También se puede usar un filtro de autorización para controlar el acceso al resto de la canalización.</span><span class="sxs-lookup"><span data-stu-id="4042c-313">You can also use an authorization filter to control access to the rest of the pipeline.</span></span> <span data-ttu-id="4042c-314">En la figura 7-2 se muestra cómo solicitar flujos de ejecución a través de filtros, si se han configurado.</span><span class="sxs-lookup"><span data-stu-id="4042c-314">Figures 7-2 shows how request execution flows through filters, if configured.</span></span>

![La solicitud se procesa a través de las fases Filtros de autorización, Filtros de recursos, Enlace de modelos, Filtros de acciones, Ejecución de acciones/Conversión del resultado de acción, Filtros de excepción, Filtros de resultados y Ejecución del resultado.](./media/image7-2.png)

<span data-ttu-id="4042c-317">**Figura 7-2**.</span><span class="sxs-lookup"><span data-stu-id="4042c-317">**Figure 7-2**.</span></span> <span data-ttu-id="4042c-318">Ejecución de la solicitud a través de los filtros y la canalización de solicitud.</span><span class="sxs-lookup"><span data-stu-id="4042c-318">Request execution through filters and request pipeline.</span></span>

<span data-ttu-id="4042c-319">Normalmente, los filtros se implementan como atributos, para que se puedan aplicar a controladores o acciones, o incluso de forma global.</span><span class="sxs-lookup"><span data-stu-id="4042c-319">Filters are usually implemented as attributes, so you can apply them to controllers or actions (or even globally).</span></span> <span data-ttu-id="4042c-320">Cuando se agregan de esta forma, los filtros especificados en el nivel de acción invalidan o se basan en los filtros especificados en el nivel de controlador, que a su vez invalidan los filtros globales.</span><span class="sxs-lookup"><span data-stu-id="4042c-320">When added in this fashion, filters specified at the action level override or build upon filters specified at the controller level, which themselves override global filters.</span></span> <span data-ttu-id="4042c-321">Por ejemplo, el atributo \[Route\] se puede usar para crear rutas entre controladores y acciones.</span><span class="sxs-lookup"><span data-stu-id="4042c-321">For example, the \[Route\] attribute can be used to build up routes between controllers and actions.</span></span> <span data-ttu-id="4042c-322">Del mismo modo, la autorización se puede configurar en el nivel de controlador y, después, reemplazarse por acciones individuales, como se muestra en el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="4042c-322">Likewise, authorization can be configured at the controller level, and then overridden by individual actions, as the following sample demonstrates:</span></span>

```csharp
[Authorize]
public class AccountController : Controller

{
    [AllowAnonymous] // overrides the Authorize attribute
    public async Task<IActionResult> Login() {}
    public async Task<IActionResult> ForgotPassword() {}
}
```

<span data-ttu-id="4042c-323">En el primer método, Login, se usa el filtro AllowAnonymous (atributo) para invalidar el filtro Authorize establecido en el nivel de controlador.</span><span class="sxs-lookup"><span data-stu-id="4042c-323">The first method, Login, uses the AllowAnonymous filter (attribute) to override the Authorize filter set at the controller level.</span></span> <span data-ttu-id="4042c-324">La acción ForgotPassword (y cualquier otra acción de la clase que no tenga un atributo AllowAnonymous) requerirá una solicitud autenticada.</span><span class="sxs-lookup"><span data-stu-id="4042c-324">The ForgotPassword action (and any other action in the class that doesn't have an AllowAnonymous attribute) will require an authenticated request.</span></span>

<span data-ttu-id="4042c-325">Los filtros se pueden usar para eliminar la duplicación en forma de directivas de control de errores comunes para las API.</span><span class="sxs-lookup"><span data-stu-id="4042c-325">Filters can be used to eliminate duplication in the form of common error handling policies for APIs.</span></span> <span data-ttu-id="4042c-326">Por ejemplo, una directiva de API típica es devolver una respuesta NotFound a las solicitudes que hacen referencia a claves que no existen y una respuesta BadRequest si se produce un error en la validación del modelo.</span><span class="sxs-lookup"><span data-stu-id="4042c-326">For example, a typical API policy is to return a NotFound response to requests referencing keys that do not exist, and a BadRequest response if model validation fails.</span></span> <span data-ttu-id="4042c-327">En el ejemplo siguiente se muestran estas dos directivas en funcionamiento:</span><span class="sxs-lookup"><span data-stu-id="4042c-327">The following example demonstrates these two policies in action:</span></span>

```csharp
[HttpPut("{id}")]
public async Task<IActionResult> Put(int id, [FromBody]Author author)
{
    if ((await _authorRepository.ListAsync()).All(a => a.Id != id))
    {
        return NotFound(id);
    }
    if (!ModelState.IsValid)
    {
        return BadRequest(ModelState);
    }
    author.Id = id;
    await _authorRepository.UpdateAsync(author);
    return Ok();
}
```

<span data-ttu-id="4042c-328">No permita que los métodos de acción se llenen con código condicional similar a este.</span><span class="sxs-lookup"><span data-stu-id="4042c-328">Don't allow your action methods to become cluttered with conditional code like this.</span></span> <span data-ttu-id="4042c-329">En su lugar, extraiga las directivas en filtros que se puedan aplicar según sea necesario.</span><span class="sxs-lookup"><span data-stu-id="4042c-329">Instead, pull the policies into filters that can be applied on an as-needed basis.</span></span> <span data-ttu-id="4042c-330">En este ejemplo, la comprobación de validación del modelo, que debería producirse siempre que se envíe un comando a la API, se puede reemplazar por el atributo siguiente:</span><span class="sxs-lookup"><span data-stu-id="4042c-330">In this example, the model validation check, which should occur anytime a command is sent to the API, can be replaced by the following attribute:</span></span>

```csharp
public class ValidateModelAttribute : ActionFilterAttribute
{
    public override void OnActionExecuting(ActionExecutingContext context)
    {
        if (!context.ModelState.IsValid)
        {
            context.Result = new BadRequestObjectResult(context.ModelState);
        }
    }
}
```

<span data-ttu-id="4042c-331">Puede agregar el elemento `ValidateModelAttribute` al proyecto como una dependencia de NuGet ; para ello, debe incluir el paquete [Ardalis.ValidateModel](https://www.nuget.org/packages/Ardalis.ValidateModel).</span><span class="sxs-lookup"><span data-stu-id="4042c-331">You can add the `ValidateModelAttribute` to your project as a NuGet dependency by including the [Ardalis.ValidateModel](https://www.nuget.org/packages/Ardalis.ValidateModel) package.</span></span> <span data-ttu-id="4042c-332">Para las API, puede usar el atributo `ApiController` para aplicar este comportamiento sin tener que usar un filtro `ValidateModel` independiente.</span><span class="sxs-lookup"><span data-stu-id="4042c-332">For APIs, you can use the `ApiController` attribute to enforce this behavior without the need for a separate `ValidateModel` filter.</span></span>

<span data-ttu-id="4042c-333">Del mismo modo, se puede usar un filtro para comprobar si existe un registro y devolver un error 404 antes de ejecutar la acción, lo que elimina la necesidad de realizar estas comprobaciones en la acción.</span><span class="sxs-lookup"><span data-stu-id="4042c-333">Likewise, a filter can be used to check if a record exists and return a 404 before the action is executed, eliminating the need to perform these checks in the action.</span></span> <span data-ttu-id="4042c-334">Una vez que se han extraído las convenciones comunes y se ha organizado la solución para separar el código de infraestructura y la lógica de negocio de la interfaz de usuario, los métodos de acción de MVC deben ser sumamente ligeros:</span><span class="sxs-lookup"><span data-stu-id="4042c-334">Once you've pulled out common conventions and organized your solution to separate infrastructure code and business logic from your UI, your MVC action methods should be extremely thin:</span></span>

```csharp
[HttpPut("{id}")]
[ValidateAuthorExists]
public async Task<IActionResult> Put(int id, [FromBody]Author author)
{
    await _authorRepository.UpdateAsync(author);
    return Ok();
}
```

<span data-ttu-id="4042c-335">Puede obtener más detalles sobre la implementación de filtros y descargar un ejemplo funcional en el artículo de MSDN Magazine [ASP.NET Core: filtros reales de ASP.NET Core MVC](/archive/msdn-magazine/2016/august/asp-net-core-real-world-asp-net-core-mvc-filters).</span><span class="sxs-lookup"><span data-stu-id="4042c-335">You can read more about implementing filters and download a working sample from the MSDN Magazine article, [Real-World ASP.NET Core MVC Filters](/archive/msdn-magazine/2016/august/asp-net-core-real-world-asp-net-core-mvc-filters).</span></span>

> ### <a name="references--structuring-applications"></a><span data-ttu-id="4042c-336">Referencias: estructuración de aplicaciones</span><span class="sxs-lookup"><span data-stu-id="4042c-336">References – Structuring applications</span></span>
>
> - <span data-ttu-id="4042c-337">**Áreas**</span><span class="sxs-lookup"><span data-stu-id="4042c-337">**Areas**</span></span>\
>   <https://docs.microsoft.com/aspnet/core/mvc/controllers/areas>
> - <span data-ttu-id="4042c-338">**MSDN Magazine: Sectores de características para ASP.NET Core MVC**</span><span class="sxs-lookup"><span data-stu-id="4042c-338">**MSDN Magazine – Feature Slices for ASP.NET Core MVC**</span></span>\
>   <https://docs.microsoft.com/archive/msdn-magazine/2016/september/asp-net-core-feature-slices-for-asp-net-core-mvc>
> - <span data-ttu-id="4042c-339">**Filtros**</span><span class="sxs-lookup"><span data-stu-id="4042c-339">**Filters**</span></span>\
>   <https://docs.microsoft.com/aspnet/core/mvc/controllers/filters>
> - <span data-ttu-id="4042c-340">**MSDN Magazine: Filtros reales de ASP.NET Core MVC**</span><span class="sxs-lookup"><span data-stu-id="4042c-340">**MSDN Magazine – Real World ASP.NET Core MVC Filters**</span></span>\
>   <https://docs.microsoft.com/archive/msdn-magazine/2016/august/asp-net-core-real-world-asp-net-core-mvc-filters>

## <a name="security"></a><span data-ttu-id="4042c-341">Seguridad</span><span class="sxs-lookup"><span data-stu-id="4042c-341">Security</span></span>

<span data-ttu-id="4042c-342">La protección de las aplicaciones web es un tema amplio, con muchas consideraciones.</span><span class="sxs-lookup"><span data-stu-id="4042c-342">Securing web applications is a large topic, with many considerations.</span></span> <span data-ttu-id="4042c-343">En su nivel más básico, la seguridad implica asegurarse de saber de quién procede una solicitud determinada y, después, asegurarse de que la solicitud solo tiene acceso a los recursos que debe.</span><span class="sxs-lookup"><span data-stu-id="4042c-343">At its most basic level, security involves ensuring you know who a given request is coming from, and then ensuring that the request only has access to resources it should.</span></span> <span data-ttu-id="4042c-344">La autenticación es el proceso de comparación de las credenciales proporcionadas con una solicitud con las de un almacén de datos de confianza, para ver si la solicitud se debe tratar como procedente de una entidad conocida.</span><span class="sxs-lookup"><span data-stu-id="4042c-344">Authentication is the process of comparing credentials provided with a request to those in a trusted data store, to see if the request should be treated as coming from a known entity.</span></span> <span data-ttu-id="4042c-345">La autorización es el proceso de restringir el acceso a determinados recursos en función de la identidad del usuario.</span><span class="sxs-lookup"><span data-stu-id="4042c-345">Authorization is the process of restricting access to certain resources based on user identity.</span></span> <span data-ttu-id="4042c-346">Un tercer interés de seguridad es proteger las solicitudes contra el espionaje por parte de terceros, para lo que al menos se debe [asegurar de que la aplicación usa SSL](/aspnet/core/security/enforcing-ssl).</span><span class="sxs-lookup"><span data-stu-id="4042c-346">A third security concern is protecting requests from eavesdropping by third parties, for which you should at least [ensure that SSL is used by your application](/aspnet/core/security/enforcing-ssl).</span></span>

### <a name="identity"></a><span data-ttu-id="4042c-347">Identidad</span><span class="sxs-lookup"><span data-stu-id="4042c-347">Identity</span></span>

<span data-ttu-id="4042c-348">ASP.NET Core Identity es un sistema de pertenencia que se puede usar para admitir la funcionalidad de inicio de sesión para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="4042c-348">ASP.NET Core Identity is a membership system you can use to support login functionality for your application.</span></span> <span data-ttu-id="4042c-349">Tiene compatibilidad con cuentas de usuario locales y también con proveedores de inicio de sesión externo como Microsoft Account, Twitter, Facebook, Google y muchos más.</span><span class="sxs-lookup"><span data-stu-id="4042c-349">It has support for local user accounts as well as external login provider support from providers like Microsoft Account, Twitter, Facebook, Google, and more.</span></span> <span data-ttu-id="4042c-350">Además de ASP.NET Core Identity, la aplicación puede usar la autenticación de Windows o un proveedor de identidades de terceros como [Identity Server](https://github.com/IdentityServer/IdentityServer4).</span><span class="sxs-lookup"><span data-stu-id="4042c-350">In addition to ASP.NET Core Identity, your application can use windows authentication, or a third-party identity provider like [Identity Server](https://github.com/IdentityServer/IdentityServer4).</span></span>

<span data-ttu-id="4042c-351">ASP.NET Core Identity se incluye en las nuevas plantillas de proyecto si se selecciona la opción Cuentas de usuario individuales.</span><span class="sxs-lookup"><span data-stu-id="4042c-351">ASP.NET Core Identity is included in new project templates if the Individual User Accounts option is selected.</span></span> <span data-ttu-id="4042c-352">Esta plantilla incluye compatibilidad para el registro, inicio de sesión, inicios de sesión externos, contraseñas olvidadas y funcionalidad adicional.</span><span class="sxs-lookup"><span data-stu-id="4042c-352">This template includes support for registration, login, external logins, forgotten passwords, and additional functionality.</span></span>

![Selección de cuentas de usuario individuales para preconfigurar Identity](./media/image7-3.png)

<span data-ttu-id="4042c-354">**Figura 7-3**.</span><span class="sxs-lookup"><span data-stu-id="4042c-354">**Figure 7-3**.</span></span> <span data-ttu-id="4042c-355">Figura 7-3 Selección de Cuentas de usuario individuales para preconfigurar Identity.</span><span class="sxs-lookup"><span data-stu-id="4042c-355">Select Individual User Accounts to have Identity preconfigured.</span></span>

<span data-ttu-id="4042c-356">La compatibilidad con Identity se configura en Startup, tanto en ConfigureServices y Configure:</span><span class="sxs-lookup"><span data-stu-id="4042c-356">Identity support is configured in Startup, both in ConfigureServices and Configure:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    // Add framework services.
    services.AddDbContext<ApplicationDbContext>(options =>
    options.UseSqlServer(Configuration.GetConnectionString("DefaultConnection")));
    services.AddIdentity<ApplicationUser, IdentityRole>()
        .AddEntityFrameworkStores<ApplicationDbContext>()
        .AddDefaultTokenProviders();
    services.AddMvc();
}

public void Configure(IApplicationBuilder app)
{
    app.UseStaticFiles();
    app.UseIdentity();
    app.UseEndpoints(endpoints =>
    {
        endpoints.MapControllerRoute(name: "default", pattern: "{controller=Home}/{action=Index}/{id?}");
    });
}
```

<span data-ttu-id="4042c-357">Es importante que UseIdentity aparezca antes de UseMvc en el método Configure.</span><span class="sxs-lookup"><span data-stu-id="4042c-357">It's important that UseIdentity appear before UseMvc in the Configure method.</span></span> <span data-ttu-id="4042c-358">Al configurar Identity en ConfigureServices, observará una llamada a AddDefaultTokenProviders.</span><span class="sxs-lookup"><span data-stu-id="4042c-358">When configuring Identity in ConfigureServices, you'll notice a call to AddDefaultTokenProviders.</span></span> <span data-ttu-id="4042c-359">Esto no tiene nada que ver con los tokens que se pueden usar para proteger las comunicaciones web, sino que, en su lugar, hace referencia a los proveedores que crean mensajes que se pueden enviar a los usuarios a través de SMS o correo electrónico para que confirmen su identidad.</span><span class="sxs-lookup"><span data-stu-id="4042c-359">This has nothing to do with tokens that may be used to secure web communications, but instead refers to providers that create prompts that can be sent to users via SMS or email in order for them to confirm their identity.</span></span>

<span data-ttu-id="4042c-360">Puede obtener más información sobre la [configuración de la autenticación en dos fases](/aspnet/core/security/authentication/2fa) y la [habilitación de proveedores de inicio de sesión externos](/aspnet/core/security/authentication/social/) en la documentación oficial de ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="4042c-360">You can learn more about [configuring two-factor authentication](/aspnet/core/security/authentication/2fa) and [enabling external login providers](/aspnet/core/security/authentication/social/) from the official ASP.NET Core docs.</span></span>

### <a name="authentication"></a><span data-ttu-id="4042c-361">Authentication</span><span class="sxs-lookup"><span data-stu-id="4042c-361">Authentication</span></span>

<span data-ttu-id="4042c-362">La autenticación es el proceso de determinar quién tiene acceso al sistema.</span><span class="sxs-lookup"><span data-stu-id="4042c-362">Authentication is the process of determining who is accessing the system.</span></span> <span data-ttu-id="4042c-363">Si usa ASP.NET Core Identity y los métodos de configuración que hemos visto en la sección anterior, se configurarán automáticamente algunos valores predeterminados de autenticación en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="4042c-363">If you're using ASP.NET Core Identity and the configuration methods shown in the previous section, it will automatically configure some authentication defaults in the application.</span></span> <span data-ttu-id="4042c-364">Pero también puede configurar estos valores predeterminados de forma manual o reemplazar los valores definidos por AddIdentity.</span><span class="sxs-lookup"><span data-stu-id="4042c-364">However, you can also configure these defaults manually, or override the ones set by AddIdentity.</span></span> <span data-ttu-id="4042c-365">Si usa Identity, este sistema configura la autenticación basada en cookies como el *esquema* predeterminado.</span><span class="sxs-lookup"><span data-stu-id="4042c-365">If you're using Identity, it configures cookie-based authentication as the default *scheme*.</span></span>

<span data-ttu-id="4042c-366">En la autenticación basada en web, normalmente se pueden realizar hasta cinco acciones durante la autenticación de un cliente de un sistema.</span><span class="sxs-lookup"><span data-stu-id="4042c-366">In web-based authentication, there are typically up to five actions that may be performed in the course of authenticating a client of a system.</span></span> <span data-ttu-id="4042c-367">Dichos componentes son:</span><span class="sxs-lookup"><span data-stu-id="4042c-367">These are:</span></span>

- <span data-ttu-id="4042c-368">Autenticar:</span><span class="sxs-lookup"><span data-stu-id="4042c-368">Authenticate.</span></span> <span data-ttu-id="4042c-369">use la información que proporciona el cliente a fin de crearle una identidad para que la use dentro de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="4042c-369">Use the information provided by the client to create an identity for them to use within the application.</span></span>
- <span data-ttu-id="4042c-370">Desafiar:</span><span class="sxs-lookup"><span data-stu-id="4042c-370">Challenge.</span></span> <span data-ttu-id="4042c-371">esta acción se usa para exigir que el cliente se identifique.</span><span class="sxs-lookup"><span data-stu-id="4042c-371">This action is used to require the client to identify themselves.</span></span>
- <span data-ttu-id="4042c-372">Prohibir:</span><span class="sxs-lookup"><span data-stu-id="4042c-372">Forbid.</span></span> <span data-ttu-id="4042c-373">informe al cliente de que tiene prohibido realizar una acción.</span><span class="sxs-lookup"><span data-stu-id="4042c-373">Inform the client they are forbidden from performing an action.</span></span>
- <span data-ttu-id="4042c-374">Iniciar sesión:</span><span class="sxs-lookup"><span data-stu-id="4042c-374">Sign-in.</span></span> <span data-ttu-id="4042c-375">conserve el cliente existente de alguna manera.</span><span class="sxs-lookup"><span data-stu-id="4042c-375">Persist the existing client in some way.</span></span>
- <span data-ttu-id="4042c-376">Cerrar sesión: quite el cliente de la persistencia.</span><span class="sxs-lookup"><span data-stu-id="4042c-376">Sign-out. Remove the client from persistence.</span></span>

<span data-ttu-id="4042c-377">Hay una serie de técnicas comunes para llevar a cabo la autenticación en aplicaciones web.</span><span class="sxs-lookup"><span data-stu-id="4042c-377">There are a number of common techniques for performing authentication in web applications.</span></span> <span data-ttu-id="4042c-378">Se conocen como "esquemas".</span><span class="sxs-lookup"><span data-stu-id="4042c-378">These are referred to as schemes.</span></span> <span data-ttu-id="4042c-379">Un esquema determinado definirá las acciones de algunas o de todas las opciones anteriores.</span><span class="sxs-lookup"><span data-stu-id="4042c-379">A given scheme will define actions for some or all of the above options.</span></span> <span data-ttu-id="4042c-380">Algunos esquemas solo admiten un subconjunto de acciones y pueden requerir un esquema independiente para realizar aquellas que no admiten.</span><span class="sxs-lookup"><span data-stu-id="4042c-380">Some schemes only support a subset of actions, and may require a separate scheme to perform those it does not support.</span></span> <span data-ttu-id="4042c-381">Por ejemplo, el esquema OpenId Connect (OIDC) no admite el inicio o el cierre de sesión, sino que se configura normalmente para usar la autenticación de cookies para esta persistencia.</span><span class="sxs-lookup"><span data-stu-id="4042c-381">For example, the OpenId-Connect (OIDC) scheme doesn't support Sign-in or Sign-out, but is commonly configured to use Cookie authentication for this persistence.</span></span>

<span data-ttu-id="4042c-382">En la aplicación de ASP.NET Core, puede configurar un esquema `DefaultAuthenticateScheme`, así como esquemas específicos opcionales para cada una de las acciones descritas anteriormente.</span><span class="sxs-lookup"><span data-stu-id="4042c-382">In your ASP.NET Core application, you can configure a `DefaultAuthenticateScheme` as well as optional specific schemes for each of the actions described above.</span></span> <span data-ttu-id="4042c-383">Por ejemplo, `DefaultChallengeScheme`, `DefaultForbidScheme`, etc. Al llamar a [`AddIdentity<TUser,TRole>`](https://github.com/dotnet/aspnetcore/blob/release/3.1/src/Identity/Core/src/IdentityServiceCollectionExtensions.cs#L38-L102), se configuran varios aspectos de la aplicación y se agregan muchos servicios necesarios.</span><span class="sxs-lookup"><span data-stu-id="4042c-383">For example, `DefaultChallengeScheme`, `DefaultForbidScheme`, etc. Calling [`AddIdentity<TUser,TRole>`](https://github.com/dotnet/aspnetcore/blob/release/3.1/src/Identity/Core/src/IdentityServiceCollectionExtensions.cs#L38-L102) configures a number of aspects of the application and adds many required services.</span></span> <span data-ttu-id="4042c-384">También se incluye esta llamada para configurar el esquema de autenticación:</span><span class="sxs-lookup"><span data-stu-id="4042c-384">It also includes this call to configure the authentication scheme:</span></span>

```csharp
services.AddAuthentication(options =>
{
    options.DefaultAuthenticateScheme = IdentityConstants.ApplicationScheme;
    options.DefaultChallengeScheme = IdentityConstants.ApplicationScheme;
    options.DefaultSignInScheme = IdentityConstants.ExternalScheme;
});
```

<span data-ttu-id="4042c-385">De forma predeterminada, estos esquemas usan cookies para la persistencia y el redireccionamiento a páginas de inicio de sesión para la autenticación.</span><span class="sxs-lookup"><span data-stu-id="4042c-385">These schemes use cookies for persistence and redirection to login pages for authentication by default.</span></span> <span data-ttu-id="4042c-386">Estos esquemas son adecuados para las aplicaciones web que interactúan con los usuarios a través de exploradores web, pero no se recomiendan para las API.</span><span class="sxs-lookup"><span data-stu-id="4042c-386">These schemes are appropriate for web applications that interact with users via web browsers, but not recommended for APIs.</span></span> <span data-ttu-id="4042c-387">En su lugar, las API suelen usar otra forma de autenticación, como los tokens de portador JWT.</span><span class="sxs-lookup"><span data-stu-id="4042c-387">Instead, APIs will typically use another form of authentication, such as JWT bearer tokens.</span></span>

<span data-ttu-id="4042c-388">Las API web se consumen mediante código, como `HttpClient` en aplicaciones .NET y tipos equivalentes en otros marcos de trabajo.</span><span class="sxs-lookup"><span data-stu-id="4042c-388">Web APIs are consumed by code, such as `HttpClient` in .NET applications and equivalent types in other frameworks.</span></span> <span data-ttu-id="4042c-389">Estos clientes esperan una respuesta que puedan usar de una llamada API, o bien un código de estado que indique qué problema se ha producido, si hubiera uno.</span><span class="sxs-lookup"><span data-stu-id="4042c-389">These clients expect a usable response from an API call, or a status code indicating what, if any, problem has occurred.</span></span> <span data-ttu-id="4042c-390">Estos clientes no interactúan a través de un explorador y tampoco interactúan con ningún código HTML que pueda devolver una API, ni lo representan.</span><span class="sxs-lookup"><span data-stu-id="4042c-390">These clients are not interacting through a browser and do not render or interact with any HTML that an API might return.</span></span> <span data-ttu-id="4042c-391">Por lo tanto, no es adecuado que los puntos de conexión de API redirijan a sus clientes a páginas de inicio de sesión si estos no se han autenticado.</span><span class="sxs-lookup"><span data-stu-id="4042c-391">Thus, it is not appropriate for API endpoints to redirect their clients to login pages if they are not authenticated.</span></span> <span data-ttu-id="4042c-392">Hay otro esquema más adecuado.</span><span class="sxs-lookup"><span data-stu-id="4042c-392">Another scheme is more appropriate.</span></span>

<span data-ttu-id="4042c-393">Para configurar la autenticación para las API, puede establecer la siguiente autenticación, la cual usa el proyecto `PublicApi` en la aplicación eShopOnWeb de referencia:</span><span class="sxs-lookup"><span data-stu-id="4042c-393">To configure authentication for APIs, you might set up authentication like the following, used by the `PublicApi` project in the eShopOnWeb reference application:</span></span>

```csharp
services.AddAuthentication(config =>
{
    config.DefaultScheme = JwtBearerDefaults.AuthenticationScheme;
})
    .AddJwtBearer(config =>
    {
        config.RequireHttpsMetadata = false;
        config.SaveToken = true;
        config.TokenValidationParameters = new TokenValidationParameters
        {
            ValidateIssuerSigningKey = true,
            IssuerSigningKey = new SymmetricSecurityKey(key),
            ValidateIssuer = false,
            ValidateAudience = false
        };
    });
```

<span data-ttu-id="4042c-394">Aunque se pueden configurar varios esquemas de autenticación diferentes en un único proyecto, es mucho más sencillo configurar un único esquema predeterminado.</span><span class="sxs-lookup"><span data-stu-id="4042c-394">While it is possible to configure multiple different authentication schemes within a single project, it is much simpler to configure a single default scheme.</span></span> <span data-ttu-id="4042c-395">Por este motivo, entre otros, la aplicación de referencia eShopOnWeb separa sus API en su propio proyecto, `PublicApi`, que es independiente del proyecto `Web` principal que incluye las vistas y las instancias de Razor Pages de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="4042c-395">For this reason, among others, the eShopOnWeb reference application separates its APIs into their own project, `PublicApi`, separate from the main `Web` project that includes the application's views and Razor Pages.</span></span>

#### <a name="authentication-in-no-locblazor-apps"></a><span data-ttu-id="4042c-396">Autenticación en aplicaciones Blazor</span><span class="sxs-lookup"><span data-stu-id="4042c-396">Authentication in Blazor apps</span></span>

<span data-ttu-id="4042c-397">Las aplicaciones Blazor Server pueden aprovechar las mismas características de autenticación que cualquier otra aplicación ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="4042c-397">Blazor Server applications can leverage the same authentication features as any other ASP.NET Core application.</span></span> <span data-ttu-id="4042c-398">Pero las aplicaciones Blazor WebAssembly no pueden usar los proveedores de identidad de autenticación integrados, ya que se ejecutan en el explorador.</span><span class="sxs-lookup"><span data-stu-id="4042c-398">Blazor WebAssembly applications cannot use the built-in Identity and Authentication providers, however, since they run in the browser.</span></span> <span data-ttu-id="4042c-399">Las aplicaciones Blazor WebAssembly pueden almacenar el estado de autenticación de los usuarios localmente y acceder a las notificaciones para determinar qué acciones deberían poder llevar a cabo los usuarios.</span><span class="sxs-lookup"><span data-stu-id="4042c-399">Blazor WebAssembly applications can store user authentication status locally and can access claims to determine what actions users should be able to perform.</span></span> <span data-ttu-id="4042c-400">Todas las comprobaciones de autenticación y autorización deben realizarse en el servidor, independientemente de la lógica implementada dentro de la aplicación BlazorWebAssembly, ya que los usuarios pueden omitir fácilmente la aplicación e interactuar directamente con las API.</span><span class="sxs-lookup"><span data-stu-id="4042c-400">However, all authentication and authorization checks should be performed on the server regardless of any logic implemented inside the Blazor WebAssembly app, since users can easily bypass the app and interact with the APIs directly.</span></span>

> ### <a name="references--authentication"></a><span data-ttu-id="4042c-401">Referencias: autenticación</span><span class="sxs-lookup"><span data-stu-id="4042c-401">References – Authentication</span></span>
>
> - <span data-ttu-id="4042c-402">**Acciones de autenticación y valores predeterminados**</span><span class="sxs-lookup"><span data-stu-id="4042c-402">**Authentication Actions and Defaults**</span></span>\
>   <https://stackoverflow.com/a/52493428>
> - <span data-ttu-id="4042c-403">**Autenticación y autorización para aplicaciones de página única**</span><span class="sxs-lookup"><span data-stu-id="4042c-403">**Authentication and Authorization for SPAs**</span></span>\
>   <https://docs.microsoft.com/aspnet/core/security/authentication/identity-api-authorization>
> - <span data-ttu-id="4042c-404">**Autenticación y autorización de ASP.NET Core Blazor** </span><span class="sxs-lookup"><span data-stu-id="4042c-404">**ASP.NET Core Blazor Authentication and Authorization**</span></span>\
>   <https://docs.microsoft.com/aspnet/core/blazor/security/>
> - <span data-ttu-id="4042c-405">**Seguridad: Autenticación y autorización en ASP.NET Web Forms y Blazor** </span><span class="sxs-lookup"><span data-stu-id="4042c-405">**Security: Authentication and Authorization in ASP.NET Web Forms and Blazor**</span></span>\
>   <https://docs.microsoft.com/dotnet/architecture/blazor-for-web-forms-developers/security-authentication-authorization>

### <a name="authorization"></a><span data-ttu-id="4042c-406">Autorización</span><span class="sxs-lookup"><span data-stu-id="4042c-406">Authorization</span></span>

<span data-ttu-id="4042c-407">La forma más sencilla de autorización implica restringir el acceso a los usuarios anónimos.</span><span class="sxs-lookup"><span data-stu-id="4042c-407">The simplest form of authorization involves restricting access to anonymous users.</span></span> <span data-ttu-id="4042c-408">Esta función se puede lograr mediante la aplicación del atributo \[Authorize\] a determinados controladores o acciones.</span><span class="sxs-lookup"><span data-stu-id="4042c-408">This functionality can be achieved by applying the \[Authorize\] attribute to certain controllers or actions.</span></span> <span data-ttu-id="4042c-409">Si se usan roles, el atributo se puede ampliar más para restringir el acceso a los usuarios que pertenecen a roles concretos, como se muestra a continuación:</span><span class="sxs-lookup"><span data-stu-id="4042c-409">If roles are being used, the attribute can be further extended to restrict access to users who belong to certain roles, as shown:</span></span>

```csharp
[Authorize(Roles = "HRManager,Finance")]
public class SalaryController : Controller
{

}
```

<span data-ttu-id="4042c-410">En este caso, los usuarios que pertenecen a los roles `HRManager` o `Finance` (o a ambos) tendrían acceso a SalaryController.</span><span class="sxs-lookup"><span data-stu-id="4042c-410">In this case, users belonging to either the `HRManager` or `Finance` roles (or both) would have access to the SalaryController.</span></span> <span data-ttu-id="4042c-411">Para requerir que un usuario pertenezca a varios roles (no solo a uno de varios), se puede aplicar el atributo varias veces y especificar un rol necesario cada vez.</span><span class="sxs-lookup"><span data-stu-id="4042c-411">To require that a user belong to multiple roles (not just one of several), you can apply the attribute multiple times, specifying a required role each time.</span></span>

<span data-ttu-id="4042c-412">La especificación de determinados conjuntos de roles como cadenas en muchos controladores y acciones diferentes puede dar lugar a repeticiones no deseadas.</span><span class="sxs-lookup"><span data-stu-id="4042c-412">Specifying certain sets of roles as strings in many different controllers and actions can lead to undesirable repetition.</span></span> <span data-ttu-id="4042c-413">Como mínimo, defina las constantes para estos literales de cadena y use las constantes donde necesite especificar la cadena.</span><span class="sxs-lookup"><span data-stu-id="4042c-413">At a minimum, define constants for these string literals and use the constants anywhere you need to specify the string.</span></span> <span data-ttu-id="4042c-414">También se pueden configurar directivas de autorización, que encapsulan las reglas de autorización y, después, especificar la directiva en lugar de roles individuales al aplicar el atributo \[Authorize\]:</span><span class="sxs-lookup"><span data-stu-id="4042c-414">You can also configure authorization policies, which encapsulate authorization rules, and then specify the policy instead of individual roles when applying the \[Authorize\] attribute:</span></span>

```csharp
[Authorize(Policy = "CanViewPrivateReport")]
public IActionResult ExecutiveSalaryReport()
{
    return View();
}
```

<span data-ttu-id="4042c-415">Al usar las directivas de esta manera, se pueden separar los tipos de acciones que se restringen de las reglas o roles específicos a los que se aplican.</span><span class="sxs-lookup"><span data-stu-id="4042c-415">Using policies in this way, you can separate the kinds of actions being restricted from the specific roles or rules that apply to it.</span></span> <span data-ttu-id="4042c-416">Más adelante, si se crea un rol que necesita tener acceso a recursos concretos, se puede actualizar simplemente una directiva, en lugar de actualizar cada lista de roles en todos los atributos \[Authorize\].</span><span class="sxs-lookup"><span data-stu-id="4042c-416">Later, if you create a new role that needs to have access to certain resources, you can just update a policy, rather than updating every list of roles on every \[Authorize\] attribute.</span></span>

#### <a name="claims"></a><span data-ttu-id="4042c-417">Notificaciones</span><span class="sxs-lookup"><span data-stu-id="4042c-417">Claims</span></span>

<span data-ttu-id="4042c-418">Las notificaciones son pares nombre-valor que representan las propiedades de un usuario autenticado.</span><span class="sxs-lookup"><span data-stu-id="4042c-418">Claims are name value pairs that represent properties of an authenticated user.</span></span> <span data-ttu-id="4042c-419">Por ejemplo, es posible almacenar el número de empleado de los usuarios como una notificación.</span><span class="sxs-lookup"><span data-stu-id="4042c-419">For example, you might store users' employee number as a claim.</span></span> <span data-ttu-id="4042c-420">Después, las notificaciones se pueden usar como parte de las directivas de autorización.</span><span class="sxs-lookup"><span data-stu-id="4042c-420">Claims can then be used as part of authorization policies.</span></span> <span data-ttu-id="4042c-421">Podría crear una directiva denominada "EmployeeOnly" que requiera la existencia de una notificación denominada "EmployeeNumber", como se muestra en este ejemplo:</span><span class="sxs-lookup"><span data-stu-id="4042c-421">You could create a policy called "EmployeeOnly" that requires the existence of a claim called "EmployeeNumber", as shown in this example:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddMvc();
    services.AddAuthorization(options =>
    {
        options.AddPolicy("EmployeeOnly", policy => policy.RequireClaim("EmployeeNumber"));
    });
}
```

<span data-ttu-id="4042c-422">Después, esta directiva se podría usar con el atributo \[Authorize\] para proteger cualquier controlador o acción, como se describió anteriormente.</span><span class="sxs-lookup"><span data-stu-id="4042c-422">This policy could then be used with the \[Authorize\] attribute to protect any controller and/or action, as described above.</span></span>

#### <a name="securing-web-apis"></a><span data-ttu-id="4042c-423">Protección de las API web</span><span class="sxs-lookup"><span data-stu-id="4042c-423">Securing web APIs</span></span>

<span data-ttu-id="4042c-424">La mayoría de las API web deben implementar un sistema de autenticación basado en tokens.</span><span class="sxs-lookup"><span data-stu-id="4042c-424">Most web APIs should implement a token-based authentication system.</span></span> <span data-ttu-id="4042c-425">La autenticación por tokens carece de estado y está diseñada para que sea escalable.</span><span class="sxs-lookup"><span data-stu-id="4042c-425">Token authentication is stateless and designed to be scalable.</span></span> <span data-ttu-id="4042c-426">En un sistema de autenticación basado en tokens, el cliente debe autenticarse primero con el proveedor de autenticación.</span><span class="sxs-lookup"><span data-stu-id="4042c-426">In a token-based authentication system, the client must first authenticate with the authentication provider.</span></span> <span data-ttu-id="4042c-427">Si se realiza correctamente, se emite un token para el cliente, que simplemente es una cadena de caracteres criptográficamente significativa.</span><span class="sxs-lookup"><span data-stu-id="4042c-427">If successful, the client is issued a token, which is simply a cryptographically meaningful string of characters.</span></span> <span data-ttu-id="4042c-428">El formato más común para los tokens es JSON Web Token o JWT (que a menudo se pronuncia "jot").</span><span class="sxs-lookup"><span data-stu-id="4042c-428">The most common format for tokens is JSON Web Token, or JWT (often pronounced "jot").</span></span> <span data-ttu-id="4042c-429">Después, cuando el cliente tiene que emitir una solicitud a una API, agrega este token como un encabezado a la solicitud.</span><span class="sxs-lookup"><span data-stu-id="4042c-429">When the client then needs to issue a request to an API, it adds this token as a header on the request.</span></span> <span data-ttu-id="4042c-430">Luego, el servidor valida el token que se encuentra en el encabezado de solicitud antes de completar la solicitud.</span><span class="sxs-lookup"><span data-stu-id="4042c-430">The server then validates the token found in the request header before completing the request.</span></span> <span data-ttu-id="4042c-431">En la figura 7-4 se muestra este proceso.</span><span class="sxs-lookup"><span data-stu-id="4042c-431">Figure 7-4 demonstrates this process.</span></span>

![TokenAuth](./media/image7-4.png)

<span data-ttu-id="4042c-433">**Figura 7-4.**</span><span class="sxs-lookup"><span data-stu-id="4042c-433">**Figure 7-4.**</span></span> <span data-ttu-id="4042c-434">Autenticación basada en tokens para las API web.</span><span class="sxs-lookup"><span data-stu-id="4042c-434">Token-based authentication for Web APIs.</span></span>

<span data-ttu-id="4042c-435">Puede crear su propio servicio de autenticación, realizar la integración con Azure AD y OAuth o implementar un servicio mediante una herramienta de código abierto como [IdentityServer](https://github.com/IdentityServer).</span><span class="sxs-lookup"><span data-stu-id="4042c-435">You can create your own authentication service, integrate with Azure AD and OAuth, or implement a service using an open-source tool like [IdentityServer](https://github.com/IdentityServer).</span></span>

<span data-ttu-id="4042c-436">Los tokens JWT pueden insertar notificaciones sobre el usuario que se pueden leer en el cliente o en el servidor.</span><span class="sxs-lookup"><span data-stu-id="4042c-436">JWT tokens can embed claims about the user, which can be read on the client or server.</span></span> <span data-ttu-id="4042c-437">Puede usar una herramienta como [jwt.io](https://jwt.io/) para ver el contenido de un token JWT.</span><span class="sxs-lookup"><span data-stu-id="4042c-437">You can use a tool like [jwt.io](https://jwt.io/) to view the contents of a JWT token.</span></span> <span data-ttu-id="4042c-438">No almacene datos confidenciales (como contraseñas o claves) en tokens de JWT, ya que su contenido se puede leer fácilmente.</span><span class="sxs-lookup"><span data-stu-id="4042c-438">Do not store sensitive data like passwords or keys in JTW tokens, since their contents are easily read.</span></span>

<span data-ttu-id="4042c-439">Al usar tokens JWT con aplicaciones de página única o Blazor WebAssembly, debe almacenar el token en algún lugar del cliente y, después, agregarlo a cada llamada API.</span><span class="sxs-lookup"><span data-stu-id="4042c-439">When using JWT tokens with SPA or Blazor WebAssembly applications, you must store the token somewhere on the client and then add it to every API call.</span></span> <span data-ttu-id="4042c-440">Esta actividad se suele hacer como encabezado, tal y como se muestra en el código siguiente:</span><span class="sxs-lookup"><span data-stu-id="4042c-440">This activity is typically done as a header, as the following code demonstrates:</span></span>

```csharp
// AuthService.cs in BlazorAdmin project of eShopOnWeb
private async Task SetAuthorizationHeader()
{
    var token = await GetToken();
    _httpClient.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", token);
}
```

<span data-ttu-id="4042c-441">Después de llamar al método anterior, las solicitudes realizadas con `_httpClient` tendrán el token insertado en los encabezados de solicitud, lo que permite que la API del lado servidor autentique y autorice la solicitud.</span><span class="sxs-lookup"><span data-stu-id="4042c-441">After calling the above method, requests made with the `_httpClient` will have the token embedded in the request's headers, allowing the server-side API to authenticate and authorize the request.</span></span>

#### <a name="custom-security"></a><span data-ttu-id="4042c-442">Seguridad personalizada</span><span class="sxs-lookup"><span data-stu-id="4042c-442">Custom Security</span></span>

<span data-ttu-id="4042c-443">Tenga especial cuidado al crear una implementación de criptografía, una pertenencia de usuarios o un sistema de generación de tokens propios.</span><span class="sxs-lookup"><span data-stu-id="4042c-443">Be especially careful about "rolling your own" implementation of cryptography, user membership, or token generation system.</span></span> <span data-ttu-id="4042c-444">Existen muchas alternativas comerciales y de código abierto disponibles que seguramente ofrecerán una mayor seguridad que una implementación personalizada.</span><span class="sxs-lookup"><span data-stu-id="4042c-444">There are many commercial and open-source alternatives available, which will almost certainly have better security than a custom implementation.</span></span>

> ### <a name="references--security"></a><span data-ttu-id="4042c-445">Referencias: seguridad</span><span class="sxs-lookup"><span data-stu-id="4042c-445">References – Security</span></span>
>
> - <span data-ttu-id="4042c-446">**Información general de la documentación de seguridad**</span><span class="sxs-lookup"><span data-stu-id="4042c-446">**Security Docs Overview**</span></span>\
>   <https://docs.microsoft.com/aspnet/core/security/>
> - <span data-ttu-id="4042c-447">**Exigencia de SSL en una aplicación de ASP.NET Core**</span><span class="sxs-lookup"><span data-stu-id="4042c-447">**Enforcing SSL in an ASP.NET Core App**</span></span>\
>   <https://docs.microsoft.com/aspnet/core/security/enforcing-ssl>
> - <span data-ttu-id="4042c-448">**Introducción a Identity**</span><span class="sxs-lookup"><span data-stu-id="4042c-448">**Introduction to Identity**</span></span>\
>   <https://docs.microsoft.com/aspnet/core/security/authentication/identity>
> - <span data-ttu-id="4042c-449">**Introducción a la autorización**</span><span class="sxs-lookup"><span data-stu-id="4042c-449">**Introduction to Authorization**</span></span>\
>   <https://docs.microsoft.com/aspnet/core/security/authorization/introduction>
> - <span data-ttu-id="4042c-450">**Autenticación y autorización para API Apps en Azure App Service**</span><span class="sxs-lookup"><span data-stu-id="4042c-450">**Authentication and Authorization for API Apps in Azure App Service**</span></span>\
>   <https://docs.microsoft.com/azure/app-service-api/app-service-api-authentication>
> - <span data-ttu-id="4042c-451">**IdentityServer**</span><span class="sxs-lookup"><span data-stu-id="4042c-451">**Identity Server**</span></span>\
>   <https://github.com/IdentityServer>

## <a name="client-communication"></a><span data-ttu-id="4042c-452">Comunicación de cliente</span><span class="sxs-lookup"><span data-stu-id="4042c-452">Client communication</span></span>

<span data-ttu-id="4042c-453">Además de servir páginas y responder a las solicitudes de datos a través de las API web, las aplicaciones ASP.NET Core se pueden comunicar directamente con los clientes conectados.</span><span class="sxs-lookup"><span data-stu-id="4042c-453">In addition to serving pages and responding to requests for data via web APIs, ASP.NET Core apps can communicate directly with connected clients.</span></span> <span data-ttu-id="4042c-454">En esta comunicación de salida se puede usar una amplia variedad de tecnologías de transporte, siendo WebSockets la más común.</span><span class="sxs-lookup"><span data-stu-id="4042c-454">This outbound communication can use a variety of transport technologies, the most common being WebSockets.</span></span> <span data-ttu-id="4042c-455">ASP.NET Core SignalR es una biblioteca que simplifica la funcionalidad de agregar comunicación de servidor a cliente en tiempo real en las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="4042c-455">ASP.NET Core SignalR is a library that makes it simple to add real-time server-to-client communication functionality to your applications.</span></span> <span data-ttu-id="4042c-456">SignalR admite diversas tecnologías de transporte, incluyendo WebSockets, y abstrae muchos de los detalles de implementación del desarrollador.</span><span class="sxs-lookup"><span data-stu-id="4042c-456">SignalR supports a variety of transport technologies, including WebSockets, and abstracts away many of the implementation details from the developer.</span></span>

<span data-ttu-id="4042c-457">La comunicación de cliente en tiempo real, con independencia de que se use WebSockets directamente u otras técnicas, es útil en una variedad de escenarios de aplicación.</span><span class="sxs-lookup"><span data-stu-id="4042c-457">Real-time client communication, whether using WebSockets directly or other techniques, are useful in a variety of application scenarios.</span></span> <span data-ttu-id="4042c-458">Estos son algunos ejemplos:</span><span class="sxs-lookup"><span data-stu-id="4042c-458">Some examples include:</span></span>

- <span data-ttu-id="4042c-459">Aplicaciones de salón de chat en vivo</span><span class="sxs-lookup"><span data-stu-id="4042c-459">Live chat room applications</span></span>

- <span data-ttu-id="4042c-460">Aplicaciones de supervisión</span><span class="sxs-lookup"><span data-stu-id="4042c-460">Monitoring applications</span></span>

- <span data-ttu-id="4042c-461">Actualizaciones de progreso de trabajo</span><span class="sxs-lookup"><span data-stu-id="4042c-461">Job progress updates</span></span>

- <span data-ttu-id="4042c-462">Notificaciones</span><span class="sxs-lookup"><span data-stu-id="4042c-462">Notifications</span></span>

- <span data-ttu-id="4042c-463">Aplicaciones de formularios interactivos</span><span class="sxs-lookup"><span data-stu-id="4042c-463">Interactive forms applications</span></span>

<span data-ttu-id="4042c-464">Al compilar la comunicación de cliente en las aplicaciones, normalmente hay dos componentes:</span><span class="sxs-lookup"><span data-stu-id="4042c-464">When building client communication into your applications, there are typically two components:</span></span>

- <span data-ttu-id="4042c-465">El administrador de conexiones del lado servidor (SignalR Hub, WebSocketManager WebSocketHandler)</span><span class="sxs-lookup"><span data-stu-id="4042c-465">Server-side connection manager (SignalR Hub, WebSocketManager WebSocketHandler)</span></span>

- <span data-ttu-id="4042c-466">La biblioteca del lado cliente</span><span class="sxs-lookup"><span data-stu-id="4042c-466">Client-side library</span></span>

<span data-ttu-id="4042c-467">Los clientes no están limitados a los exploradores: aplicaciones móviles, aplicaciones de consola y otras aplicaciones nativas también se pueden comunicar mediante SignalR/WebSockets.</span><span class="sxs-lookup"><span data-stu-id="4042c-467">Clients aren't limited to browsers – mobile apps, console apps, and other native apps can also communicate using SignalR/WebSockets.</span></span> <span data-ttu-id="4042c-468">El siguiente programa sencillo devuelve a la consola todo el contenido enviado a una aplicación de chat, como parte de una aplicación de ejemplo WebSocketManager:</span><span class="sxs-lookup"><span data-stu-id="4042c-468">The following simple program echoes all content sent to a chat application to the console, as part of a WebSocketManager sample application:</span></span>

```csharp
public class Program
{
    private static Connection _connection;
    public static void Main(string[] args)
    {
        StartConnectionAsync();
        _connection.On("receiveMessage", (arguments) =>
        {
            Console.WriteLine($"{arguments[0]} said: {arguments[1]}");
        });
        Console.ReadLine();
        StopConnectionAsync();
    }

    public static async Task StartConnectionAsync()
    {
        _connection = new Connection();
        await _connection.StartConnectionAsync("ws://localhost:65110/chat");
    }

    public static async Task StopConnectionAsync()
    {
        await _connection.StopConnectionAsync();
    }
}
```

<span data-ttu-id="4042c-469">Considere las formas en que las aplicaciones se comunican directamente con las aplicaciones cliente, y considere si la comunicación en tiempo real mejoraría la experiencia del usuario de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="4042c-469">Consider ways in which your applications communicate directly with client applications, and consider whether real-time communication would improve your app's user experience.</span></span>

> ### <a name="references--client-communication"></a><span data-ttu-id="4042c-470">Referencias: comunicación de cliente</span><span class="sxs-lookup"><span data-stu-id="4042c-470">References – Client Communication</span></span>
>
> - <span data-ttu-id="4042c-471">**SignalR de ASP.NET Core**</span><span class="sxs-lookup"><span data-stu-id="4042c-471">**ASP.NET Core SignalR**</span></span>\
>   <https://github.com/dotnet/aspnetcore/tree/master/src/SignalR>
> - <span data-ttu-id="4042c-472">**Administrador de WebSocket**</span><span class="sxs-lookup"><span data-stu-id="4042c-472">**WebSocket Manager**</span></span>\
>   <https://github.com/radu-matei/websocket-manager>

## <a name="domain-driven-design--should-you-apply-it"></a><span data-ttu-id="4042c-473">¿Se debe aplicar el diseño controlado por dominios?</span><span class="sxs-lookup"><span data-stu-id="4042c-473">Domain-driven design – Should you apply it?</span></span>

<span data-ttu-id="4042c-474">El Diseño controlado por dominios (DDD) es un enfoque ágil para la creación de software que resalta centrarse en el _dominio de negocio_.</span><span class="sxs-lookup"><span data-stu-id="4042c-474">Domain-Driven Design (DDD) is an agile approach to building software that emphasizes focusing on the _business domain_.</span></span> <span data-ttu-id="4042c-475">Coloca un gran énfasis en la comunicación e interacción con los expertos de dominio de negocio, que pueden identificarse con los desarrolladores sobre cómo funciona el sistema del mundo real.</span><span class="sxs-lookup"><span data-stu-id="4042c-475">It places a heavy emphasis on communication and interaction with business domain expert(s) who can relate to the developers how the real-world system works.</span></span> <span data-ttu-id="4042c-476">Por ejemplo, si está creando un sistema que controla cotizaciones de bolsa, es posible que el experto de dominio sea un broker de bolsa con experiencia.</span><span class="sxs-lookup"><span data-stu-id="4042c-476">For example, if you're building a system that handles stock trades, your domain expert might be an experienced stock broker.</span></span> <span data-ttu-id="4042c-477">DDD está diseñado para resolver problemas empresariales grandes y complejos, y no suele ser adecuado para aplicaciones más pequeñas y sencillas, dado que la inversión necesaria para comprender y modelar el dominio no es rentable.</span><span class="sxs-lookup"><span data-stu-id="4042c-477">DDD is designed to address large, complex business problems, and is often not appropriate for smaller, simpler applications, as the investment in understanding and modeling the domain is not worth it.</span></span>

<span data-ttu-id="4042c-478">Al compilar software con un enfoque de DDD, el equipo (incluidas las partes interesadas sin experiencia técnica y los colaboradores) deberían desarrollar un _lenguaje ubicuo_ para el espacio del problema.</span><span class="sxs-lookup"><span data-stu-id="4042c-478">When building software following a DDD approach, your team (including non-technical stakeholders and contributors) should develop a _ubiquitous language_ for the problem space.</span></span> <span data-ttu-id="4042c-479">Es decir, se debe usar la misma terminología para el concepto del mundo real que se está modelando, el equivalente de software y las estructuras que podrían existir para conservar el concepto (por ejemplo, las tablas de base de datos).</span><span class="sxs-lookup"><span data-stu-id="4042c-479">That is, the same terminology should be used for the real-world concept being modeled, the software equivalent, and any structures that might exist to persist the concept (for example, database tables).</span></span> <span data-ttu-id="4042c-480">Por tanto, los conceptos descritos en el lenguaje ubicuo deberían ser la base del _modelo de dominio_.</span><span class="sxs-lookup"><span data-stu-id="4042c-480">Thus, the concepts described in the ubiquitous language should form the basis for your _domain model_.</span></span>

<span data-ttu-id="4042c-481">El modelo de dominio se compone de objetos que interactúan entre sí para representar el comportamiento del sistema.</span><span class="sxs-lookup"><span data-stu-id="4042c-481">Your domain model comprises objects that interact with one another to represent the behavior of the system.</span></span> <span data-ttu-id="4042c-482">Estos objetos se dividen en las categorías siguientes:</span><span class="sxs-lookup"><span data-stu-id="4042c-482">These objects may fall into the following categories:</span></span>

- <span data-ttu-id="4042c-483">[Entidades](https://deviq.com/entity/), que representan objetos con un subproceso de identidad.</span><span class="sxs-lookup"><span data-stu-id="4042c-483">[Entities](https://deviq.com/entity/), which represent objects with a thread of identity.</span></span> <span data-ttu-id="4042c-484">Normalmente las entidades se almacenan en la persistencia con una clave por la que después se pueden recuperar.</span><span class="sxs-lookup"><span data-stu-id="4042c-484">Entities are typically stored in persistence with a key by which they can later be retrieved.</span></span>

- <span data-ttu-id="4042c-485">[Agregados](https://deviq.com/aggregate-pattern/), que representan grupos de objetos que se deben conservar como una unidad.</span><span class="sxs-lookup"><span data-stu-id="4042c-485">[Aggregates](https://deviq.com/aggregate-pattern/), which represent groups of objects that should be persisted as a unit.</span></span>

- <span data-ttu-id="4042c-486">[Objetos de valor](https://deviq.com/value-object/), que representan conceptos que se pueden comparar en función de la suma de sus valores de propiedad.</span><span class="sxs-lookup"><span data-stu-id="4042c-486">[Value objects](https://deviq.com/value-object/), which represent concepts that can be compared on the basis of the sum of their property values.</span></span> <span data-ttu-id="4042c-487">Por ejemplo, DateRange consta de una fecha de inicio y una fecha de finalización.</span><span class="sxs-lookup"><span data-stu-id="4042c-487">For example, DateRange consisting of a start and end date.</span></span>

- <span data-ttu-id="4042c-488">[Eventos de dominio](https://martinfowler.com/eaaDev/DomainEvent.html), que representan lo que ocurre en el sistema que resulta de interés para otros elementos del sistema.</span><span class="sxs-lookup"><span data-stu-id="4042c-488">[Domain events](https://martinfowler.com/eaaDev/DomainEvent.html), which represent things happening within the system that are of interest to other parts of the system.</span></span>

<span data-ttu-id="4042c-489">Un modelo de dominio de DDD debe encapsular un comportamiento complejo dentro del modelo.</span><span class="sxs-lookup"><span data-stu-id="4042c-489">A DDD domain model should encapsulate complex behavior within the model.</span></span> <span data-ttu-id="4042c-490">Las entidades, en concreto, no deben ser simplemente colecciones de propiedades.</span><span class="sxs-lookup"><span data-stu-id="4042c-490">Entities, in particular, should not merely be collections of properties.</span></span> <span data-ttu-id="4042c-491">Cuando el modelo de dominio carece de comportamiento y simplemente representa el estado del sistema, se dice que es un [modelo anémico](https://deviq.com/anemic-model/), lo que no es deseable en DDD.</span><span class="sxs-lookup"><span data-stu-id="4042c-491">When the domain model lacks behavior and merely represents the state of the system, it is said to be an [anemic model](https://deviq.com/anemic-model/), which is undesirable in DDD.</span></span>

<span data-ttu-id="4042c-492">Además de estos tipos de modelo, DDD normalmente emplea diversos modelos:</span><span class="sxs-lookup"><span data-stu-id="4042c-492">In addition to these model types, DDD typically employs a variety of patterns:</span></span>

- <span data-ttu-id="4042c-493">[Repositorio](https://deviq.com/repository-pattern/), para abstraer los detalles de persistencia.</span><span class="sxs-lookup"><span data-stu-id="4042c-493">[Repository](https://deviq.com/repository-pattern/), for abstracting persistence details.</span></span>

- <span data-ttu-id="4042c-494">[Generador](https://en.wikipedia.org/wiki/Factory_method_pattern), para encapsular la creación de objetos complejos.</span><span class="sxs-lookup"><span data-stu-id="4042c-494">[Factory](https://en.wikipedia.org/wiki/Factory_method_pattern), for encapsulating complex object creation.</span></span>

- <span data-ttu-id="4042c-495">[Servicios](http://gorodinski.com/blog/2012/04/14/services-in-domain-driven-design-ddd/), para encapsular un comportamiento complejo o los detalles de implementación de la infraestructura.</span><span class="sxs-lookup"><span data-stu-id="4042c-495">[Services](http://gorodinski.com/blog/2012/04/14/services-in-domain-driven-design-ddd/), for encapsulating complex behavior and/or infrastructure implementation details.</span></span>

- <span data-ttu-id="4042c-496">[Comando](https://en.wikipedia.org/wiki/Command_pattern), para desacoplar la emisión de comandos y la ejecución del propio comando.</span><span class="sxs-lookup"><span data-stu-id="4042c-496">[Command](https://en.wikipedia.org/wiki/Command_pattern), for decoupling issuing commands and executing the command itself.</span></span>

- <span data-ttu-id="4042c-497">[Especificación](https://deviq.com/specification-pattern/), para encapsular los detalles de la consulta.</span><span class="sxs-lookup"><span data-stu-id="4042c-497">[Specification](https://deviq.com/specification-pattern/), for encapsulating query details.</span></span>

<span data-ttu-id="4042c-498">DDD también recomienda el uso de la arquitectura limpia que se describió anteriormente, lo que permite acoplamiento débil, encapsulación y código que se pueda comprobar fácilmente mediante pruebas unitarias.</span><span class="sxs-lookup"><span data-stu-id="4042c-498">DDD also recommends the use of the Clean Architecture discussed previously, allowing for loose coupling, encapsulation, and code that can easily be verified using unit tests.</span></span>

### <a name="when-should-you-apply-ddd"></a><span data-ttu-id="4042c-499">Casos en los que se debe aplicar DDD</span><span class="sxs-lookup"><span data-stu-id="4042c-499">When should you apply DDD</span></span>

<span data-ttu-id="4042c-500">DDD es ideal para aplicaciones de gran tamaño con complejidad de negocio significativa (no solo técnica).</span><span class="sxs-lookup"><span data-stu-id="4042c-500">DDD is well suited to large applications with significant business (not just technical) complexity.</span></span> <span data-ttu-id="4042c-501">La aplicación debe requerir el conocimiento de expertos de dominio.</span><span class="sxs-lookup"><span data-stu-id="4042c-501">The application should require the knowledge of domain experts.</span></span> <span data-ttu-id="4042c-502">Debe haber un comportamiento importante en el propio modelo de dominio, que represente las reglas de negocio e interacciones más allá de simplemente almacenar y recuperar el estado actual de diferentes registros desde almacenes de datos.</span><span class="sxs-lookup"><span data-stu-id="4042c-502">There should be significant behavior in the domain model itself, representing business rules and interactions beyond simply storing and retrieving the current state of various records from data stores.</span></span>

### <a name="when-shouldnt-you-apply-ddd"></a><span data-ttu-id="4042c-503">Casos en los que no se debe aplicar DDD</span><span class="sxs-lookup"><span data-stu-id="4042c-503">When shouldn't you apply DDD</span></span>

<span data-ttu-id="4042c-504">DDD implica invertir en modelado, arquitectura y comunicación, lo que puede que no esté garantizado para aplicaciones más pequeñas o aplicaciones que esencialmente son de tipo CRUD (crear/leer/actualizar/eliminar).</span><span class="sxs-lookup"><span data-stu-id="4042c-504">DDD involves investments in modeling, architecture, and communication that may not be warranted for smaller applications or applications that are essentially just CRUD (create/read/update/delete).</span></span> <span data-ttu-id="4042c-505">Si se elige el enfoque de DDD para la aplicación, pero se descubre que el dominio tiene un modelo anémico sin comportamiento, es posible que haya que reconsiderar el enfoque.</span><span class="sxs-lookup"><span data-stu-id="4042c-505">If you choose to approach your application following DDD, but find that your domain has an anemic model with no behavior, you may need to rethink your approach.</span></span> <span data-ttu-id="4042c-506">O la aplicación no necesita DDD o es posible que necesite asistencia para refactorizarla con el fin de encapsular la lógica de negocios en el modelo de dominio, en lugar de la interfaz de usuario o la base de datos.</span><span class="sxs-lookup"><span data-stu-id="4042c-506">Either your application may not need DDD, or you may need assistance refactoring your application to encapsulate business logic in the domain model, rather than in your database or user interface.</span></span>

<span data-ttu-id="4042c-507">Un enfoque híbrido consistiría en usar DDD solo para las áreas más complejas o transaccionales de la aplicación, pero no para partes CRUD más sencillas o de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="4042c-507">A hybrid approach would be to only use DDD for the transactional or more complex areas of the application, but not for simpler CRUD or read-only portions of the application.</span></span> <span data-ttu-id="4042c-508">Por ejemplo, no se necesitan las restricciones de un agregado si se están consultando datos para mostrar un informe o visualizar datos para un panel.</span><span class="sxs-lookup"><span data-stu-id="4042c-508">For instance, you don't need the constraints of an Aggregate if you're querying data to display a report or to visualize data for a dashboard.</span></span> <span data-ttu-id="4042c-509">Es absolutamente aceptable tener un modelo de lectura más sencillo e independiente para estos requisitos.</span><span class="sxs-lookup"><span data-stu-id="4042c-509">It's perfectly acceptable to have a separate, simpler read model for such requirements.</span></span>

> ### <a name="references--domain-driven-design"></a><span data-ttu-id="4042c-510">Referencias: diseño controlado por dominios</span><span class="sxs-lookup"><span data-stu-id="4042c-510">References – Domain-Driven Design</span></span>
>
> - <span data-ttu-id="4042c-511">**DDD en términos sencillos (respuesta en StackOverflow)** </span><span class="sxs-lookup"><span data-stu-id="4042c-511">**DDD in Plain English (StackOverflow Answer)**</span></span>\
>   <https://stackoverflow.com/questions/1222392/can-someone-explain-domain-driven-design-ddd-in-plain-english-please/1222488#1222488>

## <a name="deployment"></a><span data-ttu-id="4042c-512">Implementación</span><span class="sxs-lookup"><span data-stu-id="4042c-512">Deployment</span></span>

<span data-ttu-id="4042c-513">En el proceso de implementación de la aplicación ASP.NET Core hay algunos pasos implicados, independientemente de dónde se vaya a hospedar.</span><span class="sxs-lookup"><span data-stu-id="4042c-513">There are a few steps involved in the process of deploying your ASP.NET Core application, regardless of where it will be hosted.</span></span> <span data-ttu-id="4042c-514">El primer paso consiste en publicar la aplicación, lo que se puede hacer con el comando de CLI `dotnet publish`.</span><span class="sxs-lookup"><span data-stu-id="4042c-514">The first step is to publish the application, which can be done using the `dotnet publish` CLI command.</span></span> <span data-ttu-id="4042c-515">Este paso compilará la aplicación y colocará todos los archivos necesarios para ejecutarla en una carpeta designada.</span><span class="sxs-lookup"><span data-stu-id="4042c-515">This step will compile the application and place all of the files needed to run the application into a designated folder.</span></span> <span data-ttu-id="4042c-516">Cuando se implementa desde Visual Studio, este paso se realiza de forma automática.</span><span class="sxs-lookup"><span data-stu-id="4042c-516">When you deploy from Visual Studio, this step is performed for you automatically.</span></span> <span data-ttu-id="4042c-517">La carpeta publish contiene archivos .exe y .dll de la aplicación y sus dependencias.</span><span class="sxs-lookup"><span data-stu-id="4042c-517">The publish folder contains .exe and .dll files for the application and its dependencies.</span></span> <span data-ttu-id="4042c-518">Una aplicación independiente también incluirá una versión del runtime de .NET.</span><span class="sxs-lookup"><span data-stu-id="4042c-518">A self-contained application will also include a version of the .NET runtime.</span></span> <span data-ttu-id="4042c-519">Las aplicaciones ASP.NET Core también incluyen archivos de configuración, activos de cliente estáticos y vistas MVC.</span><span class="sxs-lookup"><span data-stu-id="4042c-519">ASP.NET Core applications will also include configuration files, static client assets, and MVC views.</span></span>

<span data-ttu-id="4042c-520">Las aplicaciones ASP.NET Core son aplicaciones de consola que se deben iniciar cuando se inicia el servidor y reiniciarse si la aplicación (o el servidor) se bloquea.</span><span class="sxs-lookup"><span data-stu-id="4042c-520">ASP.NET Core applications are console applications that must be started when the server boots and restarted if the application (or server) crashes.</span></span> <span data-ttu-id="4042c-521">Para automatizar este proceso se puede usar un administrador de procesos.</span><span class="sxs-lookup"><span data-stu-id="4042c-521">A process manager can be used to automate this process.</span></span> <span data-ttu-id="4042c-522">Los administradores de procesos más comunes para ASP.NET Core son Nginx y Apache en Linux, e IIS y Servicio de Windows en Windows.</span><span class="sxs-lookup"><span data-stu-id="4042c-522">The most common process managers for ASP.NET Core are Nginx and Apache on Linux and IIS or Windows Service on Windows.</span></span>

<span data-ttu-id="4042c-523">Además de un administrador de procesos, las aplicaciones de ASP.NET Core pueden usar un servidor proxy inverso.</span><span class="sxs-lookup"><span data-stu-id="4042c-523">In addition to a process manager, ASP.NET Core applications may use a reverse proxy server.</span></span> <span data-ttu-id="4042c-524">Un servidor proxy inverso recibe las solicitudes HTTP de Internet y las reenvía a Kestrel después de un control preliminar.</span><span class="sxs-lookup"><span data-stu-id="4042c-524">A reverse proxy server receives HTTP requests from the Internet and forwards them to Kestrel after some preliminary handling.</span></span> <span data-ttu-id="4042c-525">Los servidores proxy inversos proporcionan una capa de seguridad para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="4042c-525">Reverse proxy servers provide a layer of security for the application.</span></span> <span data-ttu-id="4042c-526">Kestrel tampoco admite el hospedaje de varias aplicaciones en el mismo puerto, por lo que no se pueden usar técnicas como los encabezados de host con él para habilitar el hospedaje de varias aplicaciones en el mismo puerto y dirección IP.</span><span class="sxs-lookup"><span data-stu-id="4042c-526">Kestrel also doesn't support hosting multiple applications on the same port, so techniques like host headers cannot be used with it to enable hosting multiple applications on the same port and IP address.</span></span>

![Kestrel a Internet](./media/image7-5.png)

<span data-ttu-id="4042c-528">**Figura 7-5**.</span><span class="sxs-lookup"><span data-stu-id="4042c-528">**Figure 7-5**.</span></span> <span data-ttu-id="4042c-529">ASP.NET hospedado en Kestrel detrás de un servidor proxy inverso</span><span class="sxs-lookup"><span data-stu-id="4042c-529">ASP.NET hosted in Kestrel behind a reverse proxy server</span></span>

<span data-ttu-id="4042c-530">Otro escenario en el que un proxy inverso puede ser útil es para proteger varias aplicaciones mediante SSL/HTTPS.</span><span class="sxs-lookup"><span data-stu-id="4042c-530">Another scenario in which a reverse proxy can be helpful is to secure multiple applications using SSL/HTTPS.</span></span> <span data-ttu-id="4042c-531">En este caso, solo sería necesario configurar SSL en el proxy inverso.</span><span class="sxs-lookup"><span data-stu-id="4042c-531">In this case, only the reverse proxy would need to have SSL configured.</span></span> <span data-ttu-id="4042c-532">La comunicación entre el servidor proxy inverso y Kestrel se podría llevar a cabo a través de HTTP, como se muestra en la figura 7-6.</span><span class="sxs-lookup"><span data-stu-id="4042c-532">Communication between the reverse proxy server and Kestrel could take place over HTTP, as shown in Figure 7-6.</span></span>

![ASP.NET hospedado detrás de un servidor proxy inverso protegido mediante HTTPS](./media/image7-6.png)

<span data-ttu-id="4042c-534">**Figura 7-6**.</span><span class="sxs-lookup"><span data-stu-id="4042c-534">**Figure 7-6**.</span></span> <span data-ttu-id="4042c-535">ASP.NET hospedado detrás de un servidor proxy inverso protegido mediante HTTPS</span><span class="sxs-lookup"><span data-stu-id="4042c-535">ASP.NET hosted behind an HTTPS-secured reverse proxy server</span></span>

<span data-ttu-id="4042c-536">Un enfoque cada vez más popular consiste en hospedar la aplicación ASP.NET Core en un contenedor de Docker, que después se puede hospedar localmente o implementar en Azure para hospedaje basado en la nube.</span><span class="sxs-lookup"><span data-stu-id="4042c-536">An increasingly popular approach is to host your ASP.NET Core application in a Docker container, which then can be hosted locally or deployed to Azure for cloud-based hosting.</span></span> <span data-ttu-id="4042c-537">El contenedor de Docker podría contener el código de aplicación que se ejecuta en Kestrel y se implementaría detrás de un servidor proxy inverso, como se mostró anteriormente.</span><span class="sxs-lookup"><span data-stu-id="4042c-537">The Docker container could contain your application code, running on Kestrel, and would be deployed behind a reverse proxy server, as shown above.</span></span>

<span data-ttu-id="4042c-538">Si la aplicación se va a hospedar en Azure, se puede usar Microsoft Azure Application Gateway como un dispositivo virtual dedicado para proporcionar varios servicios.</span><span class="sxs-lookup"><span data-stu-id="4042c-538">If you're hosting your application on Azure, you can use Microsoft Azure Application Gateway as a dedicated virtual appliance to provide several services.</span></span> <span data-ttu-id="4042c-539">Además de actuar como un proxy inverso para aplicaciones individuales, Application Gateway también puede ofrecer las características siguientes:</span><span class="sxs-lookup"><span data-stu-id="4042c-539">In addition to acting as a reverse proxy for individual applications, Application Gateway can also offer the following features:</span></span>

- <span data-ttu-id="4042c-540">Equilibrio de carga HTTP</span><span class="sxs-lookup"><span data-stu-id="4042c-540">HTTP load balancing</span></span>

- <span data-ttu-id="4042c-541">Descarga SSL (SSL solo para Internet)</span><span class="sxs-lookup"><span data-stu-id="4042c-541">SSL offload (SSL only to Internet)</span></span>

- <span data-ttu-id="4042c-542">SSL de extremo a extremo</span><span class="sxs-lookup"><span data-stu-id="4042c-542">End to End SSL</span></span>

- <span data-ttu-id="4042c-543">Enrutamiento de varios sitios (hasta 20 sitios consolidados en una sola instancia de Application Gateway)</span><span class="sxs-lookup"><span data-stu-id="4042c-543">Multi-site routing (consolidate up to 20 sites on a single Application Gateway)</span></span>

- <span data-ttu-id="4042c-544">Firewall de aplicación web</span><span class="sxs-lookup"><span data-stu-id="4042c-544">Web application firewall</span></span>

- <span data-ttu-id="4042c-545">Compatibilidad de WebSocket</span><span class="sxs-lookup"><span data-stu-id="4042c-545">Websocket support</span></span>

- <span data-ttu-id="4042c-546">Diagnósticos avanzados</span><span class="sxs-lookup"><span data-stu-id="4042c-546">Advanced diagnostics</span></span>

<span data-ttu-id="4042c-547">_Más información sobre las opciones de implementación de Azure en el [capítulo 10](development-process-for-azure.md)._</span><span class="sxs-lookup"><span data-stu-id="4042c-547">_Learn more about Azure deployment options in [Chapter 10](development-process-for-azure.md)._</span></span>

> ### <a name="references--deployment"></a><span data-ttu-id="4042c-548">Referencias: implementación</span><span class="sxs-lookup"><span data-stu-id="4042c-548">References – Deployment</span></span>
>
> - <span data-ttu-id="4042c-549">**Información general sobre hospedaje e implementación**</span><span class="sxs-lookup"><span data-stu-id="4042c-549">**Hosting and Deployment Overview**</span></span>\
>   <https://docs.microsoft.com/aspnet/core/publishing/>
> - <span data-ttu-id="4042c-550">**Casos en los que usar Kestrel con un proxy inverso**</span><span class="sxs-lookup"><span data-stu-id="4042c-550">**When to use Kestrel with a reverse proxy**</span></span>\
>   <https://docs.microsoft.com/aspnet/core/fundamentals/servers/kestrel#when-to-use-kestrel-with-a-reverse-proxy>
> - <span data-ttu-id="4042c-551">**Hospedaje de aplicaciones ASP.NET Core en contenedores de Docker**</span><span class="sxs-lookup"><span data-stu-id="4042c-551">**Host ASP.NET Core apps in Docker**</span></span>\
>   <https://docs.microsoft.com/aspnet/core/publishing/docker>
> - <span data-ttu-id="4042c-552">**Introducción a Azure Application Gateway**</span><span class="sxs-lookup"><span data-stu-id="4042c-552">**Introducing Azure Application Gateway**</span></span>\
>   <https://docs.microsoft.com/azure/application-gateway/application-gateway-introduction>

>[!div class="step-by-step"]
><span data-ttu-id="4042c-553">[Anterior](common-client-side-web-technologies.md)
>[Siguiente](work-with-data-in-asp-net-core-apps.md)</span><span class="sxs-lookup"><span data-stu-id="4042c-553">[Previous](common-client-side-web-technologies.md)
[Next](work-with-data-in-asp-net-core-apps.md)</span></span>
