---
title: 'Creación de servicios resistentes y aptos para la nube: aceptación de errores transitorios en la nube'
description: 'Modernización de las aplicaciones .NET existentes con Azure Clour y contenedores Windows | Creación de servicios resistentes y aptos para la nube: aceptación de errores transitorios en la nube'
ms.date: 12/21/2020
ms.openlocfilehash: 4d592a5761cdf696f3e57516d747cbd770512053
ms.sourcegitcommit: 5d9cee27d9ffe8f5670e5f663434511e81b8ac38
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 01/08/2021
ms.locfileid: "98025334"
---
# <a name="build-resilient-services-ready-for-the-cloud-embrace-transient-failures-in-the-cloud"></a><span data-ttu-id="329e8-105">Creación de servicios resistentes y aptos para la nube: aceptación de errores transitorios en la nube</span><span class="sxs-lookup"><span data-stu-id="329e8-105">Build resilient services ready for the cloud: Embrace transient failures in the cloud</span></span>

<span data-ttu-id="329e8-106">La resistencia es la capacidad de recuperarse de errores y seguir funcionando.</span><span class="sxs-lookup"><span data-stu-id="329e8-106">Resiliency is the ability to recover from failures and continue to function.</span></span> <span data-ttu-id="329e8-107">La resistencia no es evitar los errores, sino aceptar el hecho de que se producirán errores y responder a ellos para evitar el tiempo de inactividad o la pérdida de datos.</span><span class="sxs-lookup"><span data-stu-id="329e8-107">Resiliency is not about avoiding failures, but accepting the fact that failures will occur, and then responding to them in a way that avoids downtime or data loss.</span></span> <span data-ttu-id="329e8-108">El objetivo de la resistencia consiste en que la aplicación vuelva a un estado totalmente operativo después de un error.</span><span class="sxs-lookup"><span data-stu-id="329e8-108">The goal of resiliency is to return the application to a fully functioning state after a failure.</span></span>

<span data-ttu-id="329e8-109">La aplicación está lista para la nube cuando, como mínimo, implementa un modelo de resistencia basado en software, en lugar de un modelo basado en hardware.</span><span class="sxs-lookup"><span data-stu-id="329e8-109">Your application is ready for the cloud when, at a minimum, it implements a software-based model of resiliency, rather than a hardware-based model.</span></span> <span data-ttu-id="329e8-110">La aplicación en la nube debe adoptar los errores parciales que se producirán con certeza.</span><span class="sxs-lookup"><span data-stu-id="329e8-110">Your cloud application must embrace the partial failures that will certainly occur.</span></span> <span data-ttu-id="329e8-111">Diseñe o refactorice parcialmente la aplicación para lograr resistencia a los errores parciales esperados.</span><span class="sxs-lookup"><span data-stu-id="329e8-111">Design or partially refactor your application to achieve resiliency with expected partial failures.</span></span> <span data-ttu-id="329e8-112">Debe estar diseñada para hacer frente a errores parciales, como las interrupciones de red transitorias o el bloqueo de nodos o máquinas virtuales en la nube.</span><span class="sxs-lookup"><span data-stu-id="329e8-112">It should be designed to cope with partial failures, like transient network outages and nodes, or VMs crashing in the cloud.</span></span> <span data-ttu-id="329e8-113">Incluso los contenedores que se trasladan a otro nodo dentro de un clúster de orquestador pueden causar breves errores intermitentes dentro de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="329e8-113">Even containers being moved to a different node within an orchestrator cluster can cause intermittent short failures within the application.</span></span>

## <a name="handling-partial-failure"></a><span data-ttu-id="329e8-114">Controlar errores parciales</span><span class="sxs-lookup"><span data-stu-id="329e8-114">Handling partial failure</span></span>

<span data-ttu-id="329e8-115">En una aplicación basada en la nube, siempre hay un riesgo de que se produzca un error parcial.</span><span class="sxs-lookup"><span data-stu-id="329e8-115">In a cloud-based application, there's an ever-present risk of partial failure.</span></span> <span data-ttu-id="329e8-116">Por ejemplo, puede producirse un error en una única instancia de un sitio web o contenedor, o puede que no esté disponible o no responda durante un breve período de tiempo.</span><span class="sxs-lookup"><span data-stu-id="329e8-116">For instance, a single website instance or a container might fail, or it might be unavailable or unresponsive for a short time.</span></span> <span data-ttu-id="329e8-117">O bien, podría bloquearse una sola máquina virtual o servidor.</span><span class="sxs-lookup"><span data-stu-id="329e8-117">Or, a single VM or server might crash.</span></span>

<span data-ttu-id="329e8-118">Como los clientes y los servicios son procesos independientes, es posible que un servicio no pueda responder de forma oportuna a una solicitud del cliente.</span><span class="sxs-lookup"><span data-stu-id="329e8-118">Because clients and services are separate processes, a service might not be able to respond in a timely manner to a client's request.</span></span> <span data-ttu-id="329e8-119">Es posible que el servicio esté sobrecargado y responda lentamente a las solicitudes, o bien que no sea accesible durante un breve período debido a problemas de red.</span><span class="sxs-lookup"><span data-stu-id="329e8-119">The service might be overloaded and respond slowly to requests, or it might not be accessible for a short time because of network issues.</span></span>

<span data-ttu-id="329e8-120">Por ejemplo, considere una aplicación de .NET monolítica que tiene acceso a una base de datos de Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="329e8-120">For example, consider a monolithic .NET application that accesses a database in Azure SQL Database.</span></span> <span data-ttu-id="329e8-121">Si la base de datos de Azure SQL o cualquier otro servicio de terceros no responden durante un breve período de tiempo (una base de datos de Azure SQL podría haberse movido a otro nodo o servidor y no responder durante unos segundos), cuando el usuario intenta realizar cualquier acción, la aplicación podría bloquearse y mostrarse una excepción al momento.</span><span class="sxs-lookup"><span data-stu-id="329e8-121">If the Azure SQL database or any other third-party service is unresponsive for a brief time (an Azure SQL database might be moved to a different node or server, and be unresponsive for a few seconds), when the user tries to do any action, the application might crash and show an exception at the same moment.</span></span>

<span data-ttu-id="329e8-122">Podría producirse un escenario similar en una aplicación que consume servicios HTTP.</span><span class="sxs-lookup"><span data-stu-id="329e8-122">A similar scenario might occur in an app that consumes HTTP services.</span></span> <span data-ttu-id="329e8-123">Es posible que la red o el propio servicio no estén disponibles en la nube durante un breve error transitorio.</span><span class="sxs-lookup"><span data-stu-id="329e8-123">The network or the service itself might not be available in the cloud during a short, transient failure.</span></span>

<span data-ttu-id="329e8-124">Una aplicación resistente como la que se muestra en la figura 4-9 debe implementar técnicas como "reintentos con retroceso exponencial" para ofrecer a la aplicación la posibilidad de controlar los errores transitorios en los recursos.</span><span class="sxs-lookup"><span data-stu-id="329e8-124">A resilient application like the one shown in Figure 4-9 should implement techniques like "retries with exponential backoff" to give the application an opportunity to handle transient failures in resources.</span></span> <span data-ttu-id="329e8-125">También debe usar "disyuntores" en las aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="329e8-125">You also should use "circuit breakers" in your applications.</span></span> <span data-ttu-id="329e8-126">Un disyuntor impide que una aplicación intente obtener acceso a un recurso cuando realmente se trata de un error a largo plazo.</span><span class="sxs-lookup"><span data-stu-id="329e8-126">A circuit breaker stops an application from trying to access a resource when it's actually a long-term failure.</span></span> <span data-ttu-id="329e8-127">Los disyuntores evitan que la aplicación se provoque una denegación del servicio a sí misma.</span><span class="sxs-lookup"><span data-stu-id="329e8-127">By using a circuit breaker, the application avoids provoking a denial of service to itself.</span></span>

![Diagrama de errores parciales administrados por reintentos con retroceso exponencial.](./media/retry-partial-failures.png)

<span data-ttu-id="329e8-129">**Figura 4-9.**</span><span class="sxs-lookup"><span data-stu-id="329e8-129">**Figure 4-9.**</span></span> <span data-ttu-id="329e8-130">Errores parciales administrados por reintentos con retroceso exponencial</span><span class="sxs-lookup"><span data-stu-id="329e8-130">Partial failures handled by retries with exponential backoff</span></span>

<span data-ttu-id="329e8-131">Puede usar estas técnicas tanto en recursos HTTP como en recursos de base de datos.</span><span class="sxs-lookup"><span data-stu-id="329e8-131">You can use these techniques both in HTTP resources and in database resources.</span></span> <span data-ttu-id="329e8-132">En la figura 4-9, la aplicación se basa en una arquitectura de tres niveles, por lo que necesita estas técnicas en el nivel de servicios (HTTP) y en el nivel de capa de datos (TCP).</span><span class="sxs-lookup"><span data-stu-id="329e8-132">In Figure 4-9, the application is based on a 3-tier architecture, so you need these techniques at the services level (HTTP) and at the data tier level (TCP).</span></span> <span data-ttu-id="329e8-133">En una aplicación monolítica que usa un único nivel de aplicación, además de la base de datos (sin servicios o microservicios adicionales), es posible que el control de los errores transitorios en el nivel de conexión de base de datos sea suficiente.</span><span class="sxs-lookup"><span data-stu-id="329e8-133">In a monolithic application that uses only a single app tier in addition to the database (no additional services or microservices), handling transient failures at the database connection level might be enough.</span></span> <span data-ttu-id="329e8-134">En ese escenario, solo se requiere una configuración concreta de la conexión de base de datos.</span><span class="sxs-lookup"><span data-stu-id="329e8-134">In that scenario, just a particular configuration of the database connection is required.</span></span>

<span data-ttu-id="329e8-135">Implementar comunicaciones resistentes que tienen acceso a la base de datos, en función de la versión de .NET que use, puede ser sencillo (por ejemplo, con [Entity Framework 6 o versiones posteriores](/ef/ef6/fundamentals/connection-resiliency/retry-logic).</span><span class="sxs-lookup"><span data-stu-id="329e8-135">When implementing resilient communications that access the database, depending on the version of .NET you are using, it can be straightforward (for example, [with Entity Framework 6 or later](/ef/ef6/fundamentals/connection-resiliency/retry-logic).</span></span> <span data-ttu-id="329e8-136">Solo es cuestión de configurar la conexión de base de datos).</span><span class="sxs-lookup"><span data-stu-id="329e8-136">It's just a matter of configuring the database connection).</span></span> <span data-ttu-id="329e8-137">O bien, puede que necesite usar bibliotecas adicionales como [Transient Fault Handling Application Block](/previous-versions/msp-n-p/hh680934(v=pandp.50)) (para versiones anteriores de .NET) o incluso implementar su propia biblioteca.</span><span class="sxs-lookup"><span data-stu-id="329e8-137">Or, you might need to use additional libraries like the [Transient Fault Handling Application Block](/previous-versions/msp-n-p/hh680934(v=pandp.50)) (for earlier versions of .NET), or even implement your own library.</span></span>

<span data-ttu-id="329e8-138">Al implementar los reintentos HTTP y los disyuntores, la recomendación para .NET consiste en usar la biblioteca [Polly](https://github.com/App-vNext/Polly), que tiene como destino .NET Standard 1.1 (cobertura: .NET Core 1.0, Mono, Xamarin, UWP, y WP8.1 y versiones posteriores), y .NET Standard 2.0 y versiones posteriores (cobertura: .NET Core 2.0 y versiones posteriores, .NET Core 3.0, y destinos posteriores de Mono, Xamarin y UWP).</span><span class="sxs-lookup"><span data-stu-id="329e8-138">When implementing HTTP retries and circuit breakers, the recommendation for .NET is to use the [Polly](https://github.com/App-vNext/Polly) library, which targets .NET Standard 1.1 (coverage: .NET Core 1.0, Mono, Xamarin, UWP, WP8.1+) and .NET Standard 2.0+ (coverage: .NET Core 2.0+, .NET Core 3.0, and later Mono, Xamarin and UWP targets).</span></span> <span data-ttu-id="329e8-139">El paquete NuGet también incluye destinos directos para .NET Framework 4.6.1 y 4.7.2.</span><span class="sxs-lookup"><span data-stu-id="329e8-139">The nuget package also includes direct targets for .NET Framework 4.6.1 and 4.7.2.</span></span>

<span data-ttu-id="329e8-140">Para obtener información sobre cómo implementar estrategias para controlar errores parciales en la nube, consulte las referencias siguientes.</span><span class="sxs-lookup"><span data-stu-id="329e8-140">To learn how to implement strategies for handling partial failures in the cloud, see the following references.</span></span>

### <a name="additional-resources"></a><span data-ttu-id="329e8-141">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="329e8-141">Additional resources</span></span>

- <span data-ttu-id="329e8-142">**Implementación de una comunicación resistente para controlar errores parciales**</span><span class="sxs-lookup"><span data-stu-id="329e8-142">**Implementing resilient communication to handle partial failure**</span></span>

    [https://docs.microsoft.com/dotnet/architecture/microservices/implement-resilient-applications/partial-failure-strategies](../../microservices/implement-resilient-applications/partial-failure-strategies.md)

- <span data-ttu-id="329e8-143">**Resistencia de la conexión de Entity Framework y lógica de reintento (versión 6 y posteriores)**</span><span class="sxs-lookup"><span data-stu-id="329e8-143">**Entity Framework connection resiliency and retry logic (version 6 and later)**</span></span>

    [https://docs.microsoft.com/ef/ef6/fundamentals/connection-resiliency/retry-logic](/ef/ef6/fundamentals/connection-resiliency/retry-logic)

- <span data-ttu-id="329e8-144">**Bloque de aplicación de control de errores transitorios**</span><span class="sxs-lookup"><span data-stu-id="329e8-144">**The Transient Fault Handling Application Block**</span></span>

- <https://docs.microsoft.com/previous-versions/msp-n-p/hh680934(v=pandp.50)>

- <span data-ttu-id="329e8-145">**Biblioteca Polly para una comunicación HTTP resistente**</span><span class="sxs-lookup"><span data-stu-id="329e8-145">**Polly library for resilient HTTP communication**</span></span>

    <https://github.com/App-vNext/Polly>

>[!div class="step-by-step"]
><span data-ttu-id="329e8-146">[Anterior](when-to-deploy-windows-containers-to-azure-container-service-kubernetes.md)
>[Siguiente](modernize-your-apps-with-monitoring-and-telemetry.md)</span><span class="sxs-lookup"><span data-stu-id="329e8-146">[Previous](when-to-deploy-windows-containers-to-azure-container-service-kubernetes.md)
[Next](modernize-your-apps-with-monitoring-and-telemetry.md)</span></span>
