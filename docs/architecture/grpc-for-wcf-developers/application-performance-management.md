---
title: 'Administración del rendimiento de las aplicaciones: gRPC para desarrolladores de WCF'
description: Registro, métricas y seguimiento de ASP.NET Core aplicaciones gRPC.
ms.date: 12/15/2020
ms.openlocfilehash: 8a2a89e268e3b2dffdcc945ac71b2de85b4d4964
ms.sourcegitcommit: 655f8a16c488567dfa696fc0b293b34d3c81e3df
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/06/2021
ms.locfileid: "97938460"
---
# <a name="application-performance-management"></a><span data-ttu-id="d3a5e-103">Administración del rendimiento de las aplicaciones</span><span class="sxs-lookup"><span data-stu-id="d3a5e-103">Application Performance Management</span></span>

<span data-ttu-id="d3a5e-104">En entornos de producción como Kubernetes, es importante supervisar las aplicaciones para asegurarse de que se ejecutan de forma óptima.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-104">In production environments like Kubernetes, it's important to monitor applications to ensure they're running optimally.</span></span> <span data-ttu-id="d3a5e-105">El registro y las métricas son importantes en concreto.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-105">Logging and metrics are important in particular.</span></span> <span data-ttu-id="d3a5e-106">ASP.NET Core, incluido gRPC, proporciona compatibilidad integrada para generar y administrar mensajes de registro y datos de métricas, así como datos de *seguimiento* .</span><span class="sxs-lookup"><span data-stu-id="d3a5e-106">ASP.NET Core, including gRPC, provides built-in support for producing and managing log messages and metrics data, as well as *tracing* data.</span></span>

## <a name="the-difference-between-logging-and-metrics"></a><span data-ttu-id="d3a5e-107">La diferencia entre el registro y las métricas</span><span class="sxs-lookup"><span data-stu-id="d3a5e-107">The difference between logging and metrics</span></span>

<span data-ttu-id="d3a5e-108">El *registro* se refiere a los mensajes de texto que registran información detallada sobre las cosas que se han producido en el sistema.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-108">*Logging* is concerned with text messages that record detailed information about things that have happened in the system.</span></span> <span data-ttu-id="d3a5e-109">Los mensajes de registro pueden incluir datos de excepciones, como seguimientos de la pila o datos estructurados que proporcionan contexto sobre el mensaje.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-109">Log messages might include exception data, like stack traces, or structured data that provide context about the message.</span></span> <span data-ttu-id="d3a5e-110">La salida del registro se escribe normalmente en un almacén de texto en el que se pueden realizar búsquedas.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-110">Logging output is commonly written to a searchable text store.</span></span>

<span data-ttu-id="d3a5e-111">*Métricas* se refiere a los datos numéricos que se diseñan y presentan mediante gráficos y gráficos en un panel.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-111">*Metrics* refers to numeric data designed to be aggregated and presented by using charts and graphs in a dashboard.</span></span> <span data-ttu-id="d3a5e-112">El panel proporciona una vista del estado general y el rendimiento de una aplicación.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-112">The dashboard provides a view of the overall health and performance of an application.</span></span> <span data-ttu-id="d3a5e-113">Los datos de métricas también se pueden usar para desencadenar alertas automatizadas cuando se supera un umbral.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-113">Metrics data can also be used to trigger automated alerts when a threshold is exceeded.</span></span> <span data-ttu-id="d3a5e-114">Estos son algunos ejemplos de datos de métricas:</span><span class="sxs-lookup"><span data-stu-id="d3a5e-114">Here are some examples of metrics data:</span></span>

- <span data-ttu-id="d3a5e-115">Tiempo necesario para procesar solicitudes.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-115">Time taken to process requests.</span></span>
- <span data-ttu-id="d3a5e-116">Número de solicitudes por segundo controladas por una instancia de un servicio.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-116">The number of requests per second being handled by an instance of a service.</span></span>
- <span data-ttu-id="d3a5e-117">El número de solicitudes con error en una instancia.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-117">The number of failed requests on an instance.</span></span>

## <a name="logging-in-aspnet-core-grpc"></a><span data-ttu-id="d3a5e-118">Inicio de sesión ASP.NET Core gRPC</span><span class="sxs-lookup"><span data-stu-id="d3a5e-118">Logging in ASP.NET Core gRPC</span></span>

<span data-ttu-id="d3a5e-119">ASP.NET Core proporciona compatibilidad integrada para el registro, en forma de paquete NuGet [Microsoft. Extensions. Logging](https://www.nuget.org/packages/Microsoft.Extensions.Logging) .</span><span class="sxs-lookup"><span data-stu-id="d3a5e-119">ASP.NET Core provides built-in support for logging, in the form of [Microsoft.Extensions.Logging](https://www.nuget.org/packages/Microsoft.Extensions.Logging) NuGet package.</span></span> <span data-ttu-id="d3a5e-120">Las partes principales de esta biblioteca se incluyen con el SDK de Web, por lo que no es necesario instalarla manualmente.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-120">The core parts of this library are included with the Web SDK, so there's no need to install it manually.</span></span> <span data-ttu-id="d3a5e-121">De forma predeterminada, los mensajes de registro se escriben en la salida estándar ("Console") y en cualquier depurador asociado.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-121">By default, log messages are written to the standard output (the "console") and to any attached debugger.</span></span> <span data-ttu-id="d3a5e-122">Para escribir registros en almacenes de datos externos persistentes, es posible que necesite importar [paquetes de receptores de registro opcionales](/aspnet/core/fundamentals/logging/?view=aspnetcore-3.0#third-party-logging-providers).</span><span class="sxs-lookup"><span data-stu-id="d3a5e-122">To write logs to persistent external data stores, you might need to import [optional logging sink packages](/aspnet/core/fundamentals/logging/?view=aspnetcore-3.0#third-party-logging-providers).</span></span>

<span data-ttu-id="d3a5e-123">El marco de ASP.NET Core gRPC escribe mensajes de registro de diagnóstico detallados en este marco de registro, por lo que se pueden procesar y almacenar junto con los mensajes de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-123">The ASP.NET Core gRPC framework writes detailed diagnostic logging messages to this logging framework, so they can be processed and stored along with your application's own messages.</span></span>

### <a name="produce-log-messages"></a><span data-ttu-id="d3a5e-124">Generar mensajes de registro</span><span class="sxs-lookup"><span data-stu-id="d3a5e-124">Produce log messages</span></span>

<span data-ttu-id="d3a5e-125">La extensión de registro se registra automáticamente en el sistema de inserción de dependencias de ASP.NET Core, por lo que puede especificar loggers como un parámetro de constructor en los tipos de servicio de gRPC.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-125">The logging extension is automatically registered with ASP.NET Core's dependency injection system, so you can specify loggers as a constructor parameter on gRPC service types.</span></span>

```csharp
public class StockData : Stocks.StocksBase
{
    private readonly ILogger<StockData> _logger;

    public StockData(ILogger<StockData> logger)
    {
        _logger = logger;
    }
}
```

<span data-ttu-id="d3a5e-126">Muchos mensajes de registro, como solicitudes y excepciones, los proporcionan los componentes del marco de ASP.NET Core y gRPC.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-126">Many log messages, such as requests and exceptions, are provided by the ASP.NET Core and gRPC framework components.</span></span> <span data-ttu-id="d3a5e-127">Agregue sus propios mensajes de registro para proporcionar detalles y contexto sobre la lógica de la aplicación, en lugar de preocuparse por los niveles inferiores.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-127">Add your own log messages to provide detail and context about application logic, rather than lower-level concerns.</span></span>

<span data-ttu-id="d3a5e-128">Para obtener más información sobre la escritura de mensajes de registro y los receptores y destinos de registro disponibles, consulte  [Inicio de sesión en .net Core y ASP.net Core](/aspnet/core/fundamentals/logging/).</span><span class="sxs-lookup"><span data-stu-id="d3a5e-128">For more information about writing log messages and available logging sinks and targets, see  [Logging in .NET Core and ASP.NET Core](/aspnet/core/fundamentals/logging/).</span></span>

## <a name="metrics-in-aspnet-core-grpc"></a><span data-ttu-id="d3a5e-129">Métricas en ASP.NET Core gRPC</span><span class="sxs-lookup"><span data-stu-id="d3a5e-129">Metrics in ASP.NET Core gRPC</span></span>

<span data-ttu-id="d3a5e-130">El tiempo de ejecución de .NET Core proporciona un conjunto de componentes para emitir y observar métricas.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-130">The .NET Core runtime provides a set of components for emitting and observing metrics.</span></span> <span data-ttu-id="d3a5e-131">Estas incluyen API como las <xref:System.Diagnostics.Tracing.EventSource> clases y <xref:System.Diagnostics.Tracing.EventCounter> .</span><span class="sxs-lookup"><span data-stu-id="d3a5e-131">These include APIs such as the <xref:System.Diagnostics.Tracing.EventSource> and <xref:System.Diagnostics.Tracing.EventCounter> classes.</span></span> <span data-ttu-id="d3a5e-132">Estas API pueden emitir datos numéricos básicos que pueden usar los procesos externos, como la [herramienta global dotnet-counters](../../core/diagnostics/dotnet-counters.md)o el seguimiento de eventos para Windows.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-132">These APIs can emit basic numeric data that can be consumed by external processes, like the [dotnet-counters global tool](../../core/diagnostics/dotnet-counters.md), or Event Tracing for Windows.</span></span> <span data-ttu-id="d3a5e-133">Para obtener más información sobre `EventCounter` el uso de en su propio código, vea [Introducción a EventCounter](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.Tracing/documentation/EventCounterTutorial.md).</span><span class="sxs-lookup"><span data-stu-id="d3a5e-133">For more information about using `EventCounter` in your own code, see [EventCounter introduction](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.Tracing/documentation/EventCounterTutorial.md).</span></span>

<span data-ttu-id="d3a5e-134">Para obtener métricas más avanzadas y escribir datos de métricas en una gama más amplia de almacenes de datos, puede probar un proyecto de código abierto denominado [métricas](https://www.app-metrics.io)de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-134">For more advanced metrics and for writing metric data to a wider range of data stores, you might try an open-source project called [App Metrics](https://www.app-metrics.io).</span></span> <span data-ttu-id="d3a5e-135">Este conjunto de bibliotecas proporciona un amplio conjunto de tipos para instrumentar el código.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-135">This suite of libraries provides an extensive set of types to instrument your code.</span></span> <span data-ttu-id="d3a5e-136">También ofrece paquetes para escribir métricas en diferentes tipos de destinos que incluyen bases de datos de series temporales, como Prometheus y InfluxDB, y [Application Insights](/azure/azure-monitor/app/app-insights-overview).</span><span class="sxs-lookup"><span data-stu-id="d3a5e-136">It also offers packages to write metrics to different kinds of targets that include time-series databases, such as Prometheus and InfluxDB, and [Application Insights](/azure/azure-monitor/app/app-insights-overview).</span></span> <span data-ttu-id="d3a5e-137">El paquete NuGet [app. Metrics. AspNetCore. Mvc](https://www.nuget.org/packages/App.Metrics.AspNetCore.Mvc/) incluye incluso un conjunto completo de métricas básicas que se generan automáticamente mediante la integración con el marco de ASP.net Core.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-137">The [App.Metrics.AspNetCore.Mvc](https://www.nuget.org/packages/App.Metrics.AspNetCore.Mvc/) NuGet package even adds a comprehensive set of basic metrics that are automatically generated via integration with the ASP.NET Core framework.</span></span> <span data-ttu-id="d3a5e-138">El sitio web del proyecto proporciona [plantillas](https://www.app-metrics.io/samples/grafana/) para mostrar dichas métricas con la plataforma de visualización [Grafana](https://grafana.com/) .</span><span class="sxs-lookup"><span data-stu-id="d3a5e-138">The project website provides [templates](https://www.app-metrics.io/samples/grafana/) for displaying those metrics with the [Grafana](https://grafana.com/) visualization platform.</span></span>

### <a name="produce-metrics"></a><span data-ttu-id="d3a5e-139">Generar métricas</span><span class="sxs-lookup"><span data-stu-id="d3a5e-139">Produce metrics</span></span>

<span data-ttu-id="d3a5e-140">La mayoría de las plataformas de métricas admiten los siguientes tipos:</span><span class="sxs-lookup"><span data-stu-id="d3a5e-140">Most metrics platforms support the following types:</span></span>

| <span data-ttu-id="d3a5e-141">Tipo de métrica</span><span class="sxs-lookup"><span data-stu-id="d3a5e-141">Metric type</span></span> | <span data-ttu-id="d3a5e-142">Descripción</span><span class="sxs-lookup"><span data-stu-id="d3a5e-142">Description</span></span> |
| ----------- | ----------- |
| <span data-ttu-id="d3a5e-143">Contador</span><span class="sxs-lookup"><span data-stu-id="d3a5e-143">Counter</span></span>     | <span data-ttu-id="d3a5e-144">Realiza un seguimiento de la frecuencia con la que sucede algo, como solicitudes y errores.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-144">Tracks how often something happens, such as requests and errors.</span></span> |
| <span data-ttu-id="d3a5e-145">Indicador</span><span class="sxs-lookup"><span data-stu-id="d3a5e-145">Gauge</span></span>       | <span data-ttu-id="d3a5e-146">Registra un valor único que cambia con el tiempo, como las conexiones activas.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-146">Records a single value that changes over time, such as active connections.</span></span> |
| <span data-ttu-id="d3a5e-147">Histograma</span><span class="sxs-lookup"><span data-stu-id="d3a5e-147">Histogram</span></span>   | <span data-ttu-id="d3a5e-148">Mide una distribución de valores a través de límites arbitrarios.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-148">Measures a distribution of values across arbitrary limits.</span></span> <span data-ttu-id="d3a5e-149">Por ejemplo, un histograma puede realizar un seguimiento del tamaño del conjunto de registros, contando cuántos contenían <10 registros, cuántos contenía 11-100 registros, cuántos contenía 101-1000 registros y cuántos contenía >1000 registros.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-149">For example, a histogram can track dataset size, counting how many contained <10 records, how many contained 11-100 records, how many contained 101-1000 records, and how many contained >1000 records.</span></span> |
| <span data-ttu-id="d3a5e-150">Medidor</span><span class="sxs-lookup"><span data-stu-id="d3a5e-150">Meter</span></span>       | <span data-ttu-id="d3a5e-151">Mide la velocidad a la que se produce un evento en varios intervalos de tiempo.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-151">Measures the rate at which an event occurs in various time spans.</span></span> |
| <span data-ttu-id="d3a5e-152">Timer</span><span class="sxs-lookup"><span data-stu-id="d3a5e-152">Timer</span></span>       | <span data-ttu-id="d3a5e-153">Realiza un seguimiento de la duración de los eventos y la velocidad a la que se produce, almacenado como histograma.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-153">Tracks the duration of events and the rate at which it occurs, stored as a histogram.</span></span> |

<span data-ttu-id="d3a5e-154">Mediante el uso de *métricas* de la aplicación, `IMetrics` se puede obtener una interfaz a través de la inserción de dependencias y se usa para registrar cualquiera de estas métricas para un servicio de gRPC.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-154">By using *App Metrics*, an `IMetrics` interface can be obtained via dependency injection, and used to record any of these metrics for a gRPC service.</span></span> <span data-ttu-id="d3a5e-155">En el ejemplo siguiente se muestra cómo contar el número de `Get` solicitudes realizadas a lo largo del tiempo:</span><span class="sxs-lookup"><span data-stu-id="d3a5e-155">The following example shows how to count the number of `Get` requests made over time:</span></span>

```csharp
public class StockData : Stocks.StocksBase
{
    private static readonly CounterOptions GetRequestCounter = new CounterOptions
    {
        Name = "StockData_Get_Requests",
        MeasurementUnit = Unit.Calls
    };

    private readonly IStockRepository _repository;
    private readonly IMetrics _metrics;

    public StockData(IStockRepository repository, IMetrics metrics)
    {
        _repository = repository;
        _metrics = metrics;
    }

    public override async Task<GetResponse> Get(GetRequest request, ServerCallContext context)
    {
        _metrics.Measure.Counter.Increment(GetRequestCounter);

        // Serve request...
    }
}
```

### <a name="store-and-visualize-metrics-data"></a><span data-ttu-id="d3a5e-156">Almacenar y visualizar datos de métricas</span><span class="sxs-lookup"><span data-stu-id="d3a5e-156">Store and visualize metrics data</span></span>

<span data-ttu-id="d3a5e-157">La mejor manera de almacenar los datos de métricas es en una base de datos de *serie temporal*, un almacén de datos especializado diseñado para registrar series de datos numéricas marcadas con marcas de tiempo.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-157">The best way to store metrics data is in a *time-series database*, a specialized data store designed to record numerical data series marked with timestamps.</span></span> <span data-ttu-id="d3a5e-158">Las bases de datos más populares son [Prometheus](https://prometheus.io/) y [InfluxDB](https://www.influxdata.com/products/influxdb-overview/).</span><span class="sxs-lookup"><span data-stu-id="d3a5e-158">The most popular of these databases are [Prometheus](https://prometheus.io/) and [InfluxDB](https://www.influxdata.com/products/influxdb-overview/).</span></span> <span data-ttu-id="d3a5e-159">Microsoft Azure también proporciona almacenamiento de métricas dedicadas a través del servicio [Azure monitor](/azure/azure-monitor/overview) .</span><span class="sxs-lookup"><span data-stu-id="d3a5e-159">Microsoft Azure also provides dedicated metrics storage through the [Azure Monitor](/azure/azure-monitor/overview) service.</span></span>

<span data-ttu-id="d3a5e-160">La solución de "ir a" actual para visualizar datos de métricas es [Grafana](https://grafana.com), que funciona con una amplia gama de proveedores de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-160">The current go-to solution for visualizing metrics data is [Grafana](https://grafana.com), which works with a wide range of storage providers.</span></span> <span data-ttu-id="d3a5e-161">En la siguiente imagen se muestra un panel de Grafana de ejemplo que muestra las métricas de la malla de servicio de Linkerd que ejecuta el ejemplo StockData:</span><span class="sxs-lookup"><span data-stu-id="d3a5e-161">The following image shows an example Grafana dashboard that displays metrics from the Linkerd service mesh running the StockData sample:</span></span>

![Captura de pantalla del panel de Grafana](media/application-performance-management/grafana-screenshot.png)

### <a name="metrics-based-alerting"></a><span data-ttu-id="d3a5e-163">Alertas basadas en métricas</span><span class="sxs-lookup"><span data-stu-id="d3a5e-163">Metrics-based alerting</span></span>

<span data-ttu-id="d3a5e-164">La naturaleza numérica de los datos de métricas significa que es ideal para impulsar los sistemas de alerta, notificando a los desarrolladores o ingenieros de soporte cuando un valor está fuera de una tolerancia definida.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-164">The numerical nature of metrics data means that it's ideally suited to drive alerting systems, notifying developers or support engineers when a value falls outside of some defined tolerance.</span></span> <span data-ttu-id="d3a5e-165">Las plataformas ya mencionadas proporcionan compatibilidad para las alertas a través de una variedad de opciones, como correos electrónicos, mensajes de texto o visualizaciones en el panel.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-165">The platforms already mentioned all provide support for alerting via a range of options, including emails, text messages, or in-dashboard visualizations.</span></span>

## <a name="distributed-tracing"></a><span data-ttu-id="d3a5e-166">Seguimiento distribuido</span><span class="sxs-lookup"><span data-stu-id="d3a5e-166">Distributed tracing</span></span>

<span data-ttu-id="d3a5e-167">La traza distribuida es un desarrollo relativamente reciente en la supervisión, que ha surgido del creciente uso de microservicios y arquitecturas distribuidas.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-167">Distributed tracing is a relatively recent development in monitoring, which has arisen from the increasing use of microservices and distributed architectures.</span></span> <span data-ttu-id="d3a5e-168">Una única solicitud desde un explorador cliente, una aplicación o un dispositivo se puede dividir en muchos pasos y subsolicitudes, e implicar el uso de muchos servicios a través de una red.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-168">A single request from a client browser, application, or device can be broken down into many steps and sub-requests, and involve the use of many services across a network.</span></span> <span data-ttu-id="d3a5e-169">Esta actividad dificulta la correlación de mensajes y métricas de registro con la solicitud específica que los desencadenó.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-169">This activity makes it difficult to correlate log messages and metrics with the specific request that triggered them.</span></span> <span data-ttu-id="d3a5e-170">El seguimiento distribuido aplica identificadores a las solicitudes y permite correlacionar los registros y las métricas con una operación determinada.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-170">Distributed tracing applies identifiers to requests, and allows logs and metrics to be correlated with a particular operation.</span></span> <span data-ttu-id="d3a5e-171">Este seguimiento es similar al [seguimiento de un extremo a otro de WCF](../../framework/wcf/diagnostics/tracing/end-to-end-tracing.md), pero se aplica en varias plataformas.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-171">This tracing is similar to [WCF's end-to-end tracing](../../framework/wcf/diagnostics/tracing/end-to-end-tracing.md), but it's applied across multiple platforms.</span></span>

<span data-ttu-id="d3a5e-172">La traza distribuida ha crecido rápidamente en popularidad y está empezando a normalizarse.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-172">Distributed tracing has grown quickly in popularity and is beginning to standardize.</span></span> <span data-ttu-id="d3a5e-173">Cloud Native Computing Foundation crea el [estándar de seguimiento abierto](https://opentracing.io), intentando proporcionar bibliotecas independientes del proveedor para trabajar con back-ends como [Jaeger](https://www.jaegertracing.io/) y [APM elástico](https://www.elastic.co/products/apm).</span><span class="sxs-lookup"><span data-stu-id="d3a5e-173">The Cloud Native Computing Foundation created the [Open Tracing standard](https://opentracing.io), attempting to provide vendor-neutral libraries for working with back ends like [Jaeger](https://www.jaegertracing.io/) and [Elastic APM](https://www.elastic.co/products/apm).</span></span> <span data-ttu-id="d3a5e-174">Al mismo tiempo, Google creó el [proyecto OpenCensus](https://opencensus.io/) para resolver el mismo conjunto de problemas.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-174">At the same time, Google created the [OpenCensus project](https://opencensus.io/) to address the same set of problems.</span></span> <span data-ttu-id="d3a5e-175">Estos dos proyectos se combinan en un nuevo proyecto, [OpenTelemetry](https://opentelemetry.io), que pretende ser el estándar del sector del futuro.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-175">These two projects are merging into a new project, [OpenTelemetry](https://opentelemetry.io), which aims to be the industry standard of the future.</span></span>

### <a name="how-distributed-tracing-works"></a><span data-ttu-id="d3a5e-176">Cómo funciona el seguimiento distribuido</span><span class="sxs-lookup"><span data-stu-id="d3a5e-176">How distributed tracing works</span></span>

<span data-ttu-id="d3a5e-177">La traza distribuida se basa en el concepto de *intervalos*: operaciones con nombre que forman parte de un único *seguimiento*, que pueden implicar el procesamiento en varios nodos de un sistema.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-177">Distributed tracing is based on the concept of *spans*: named, timed operations that are part of a single *trace*, which can involve processing on multiple nodes of a system.</span></span> <span data-ttu-id="d3a5e-178">Cuando se inicia una nueva operación, se crea un seguimiento con un identificador único.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-178">When a new operation is initiated, a trace is created with a unique identifier.</span></span> <span data-ttu-id="d3a5e-179">Para cada suboperación, se crea un intervalo con su propio identificador y identificador de seguimiento.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-179">For each sub-operation, a span is created with its own identifier and trace identifier.</span></span> <span data-ttu-id="d3a5e-180">A medida que la solicitud pasa por el sistema, varios componentes pueden crear intervalos *secundarios* que incluyen el identificador de su *elemento primario*.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-180">As the request passes around the system, various components can create *child* spans that include the identifier of their *parent*.</span></span> <span data-ttu-id="d3a5e-181">Un intervalo tiene un *contexto*, que contiene los identificadores de intervalo y de seguimiento, así como datos útiles en forma de pares de clave y valor (denominado *equipaje*).</span><span class="sxs-lookup"><span data-stu-id="d3a5e-181">A span has a *context*, which contains the trace and span identifiers, as well as useful data in the form of key and value pairs (called *baggage*).</span></span>

### <a name="distributed-tracing-with-diagnosticsource"></a><span data-ttu-id="d3a5e-182">Seguimiento distribuido con `DiagnosticSource`</span><span class="sxs-lookup"><span data-stu-id="d3a5e-182">Distributed tracing with `DiagnosticSource`</span></span>

<span data-ttu-id="d3a5e-183">.NET tiene un módulo interno que se asigna bien a los seguimientos distribuidos y a los intervalos: [DiagnosticSource](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#diagnosticsource-users-guide).</span><span class="sxs-lookup"><span data-stu-id="d3a5e-183">.NET has an internal module that maps well to distributed traces and spans: [DiagnosticSource](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#diagnosticsource-users-guide).</span></span> <span data-ttu-id="d3a5e-184">Además de proporcionar una manera sencilla de generar y consumir diagnósticos dentro de un proceso, el `DiagnosticSource` módulo tiene el concepto de una *actividad*.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-184">As well as providing a simple way to produce and consume diagnostics within a process, the `DiagnosticSource` module has the concept of an *activity*.</span></span> <span data-ttu-id="d3a5e-185">Una actividad es realmente una implementación de un seguimiento distribuido o un intervalo dentro de un seguimiento.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-185">An activity is effectively an implementation of a distributed trace, or a span within a trace.</span></span> <span data-ttu-id="d3a5e-186">Los elementos internos del módulo se encargan de las actividades primarias/secundarias, incluida la asignación de identificadores.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-186">The internals of the module take care of parent/child activities, including allocating identifiers.</span></span> <span data-ttu-id="d3a5e-187">Para obtener más información sobre el uso del `Activity` tipo, consulte la [Guía de usuario de la actividad en github](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-user-guide).</span><span class="sxs-lookup"><span data-stu-id="d3a5e-187">For more information about using the `Activity` type, see the [Activity User Guide on GitHub](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-user-guide).</span></span>

<span data-ttu-id="d3a5e-188">Dado `DiagnosticSource` que forma parte del marco de trabajo principal y versiones posteriores, es compatible con varios componentes principales.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-188">Because `DiagnosticSource` is a part of the core framework and later, it's supported by several core components.</span></span> <span data-ttu-id="d3a5e-189">Entre ellas se incluyen <xref:System.Net.Http.HttpClient> , Entity Framework Core y ASP.net Core, incluida la compatibilidad explícita en el marco de trabajo de gRPC.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-189">These include <xref:System.Net.Http.HttpClient>, Entity Framework Core, and ASP.NET Core, including explicit support in the gRPC framework.</span></span> <span data-ttu-id="d3a5e-190">Cuando ASP.NET Core recibe una solicitud, busca un par de encabezados HTTP que coincidan con el estándar de [contexto de seguimiento de W3C](https://www.w3.org/TR/trace-context) .</span><span class="sxs-lookup"><span data-stu-id="d3a5e-190">When ASP.NET Core receives a request, it checks for a pair of HTTP headers matching the [W3C Trace Context](https://www.w3.org/TR/trace-context) standard.</span></span> <span data-ttu-id="d3a5e-191">Si se encuentran los encabezados, se inicia una actividad utilizando los valores de identidad y el contexto de los encabezados.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-191">If the headers are found, an activity is started by using the identity values and context from the headers.</span></span> <span data-ttu-id="d3a5e-192">Si no se encuentra ningún encabezado, se inicia una actividad con los valores de identidad generados que coinciden con el formato estándar.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-192">If no headers are found, an activity is started with generated identity values that match the standard format.</span></span> <span data-ttu-id="d3a5e-193">Los diagnósticos generados por el marco de trabajo o por el código de aplicación durante la vigencia de esta actividad se pueden etiquetar con los identificadores de intervalo y seguimiento.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-193">Any diagnostics generated by the framework or by application code during the lifetime of this activity can be tagged with the trace and span identifiers.</span></span> <span data-ttu-id="d3a5e-194">La `HttpClient` compatibilidad amplía aún más esta funcionalidad comprobando una actividad actual en cada solicitud y agregando automáticamente los encabezados de seguimiento a la solicitud de salida.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-194">The `HttpClient` support extends this functionality further by checking for a current activity on every request, and automatically adding the trace headers to the outgoing request.</span></span>

<span data-ttu-id="d3a5e-195">Las bibliotecas de cliente y servidor de ASP.NET Core gRPC incluyen compatibilidad explícita para `DiagnosticSource` y `Activity` , y crean actividades y aplican y usan la información de encabezado de forma automática.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-195">The ASP.NET Core gRPC client and server libraries include explicit support for `DiagnosticSource` and `Activity`, and create activities and apply and use header information automatically.</span></span>

> [!NOTE]
> <span data-ttu-id="d3a5e-196">Todo esto sucede solo si un agente de escucha está consumiendo la información de diagnóstico.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-196">All of this happens only if a listener is consuming the diagnostic information.</span></span> <span data-ttu-id="d3a5e-197">Si no hay ningún agente de escucha, no se escribe ningún diagnóstico y no se crea ninguna actividad.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-197">If there's no listener, no diagnostics are written and no activities are created.</span></span>

### <a name="add-your-own-diagnosticsource-and-activity"></a><span data-ttu-id="d3a5e-198">Agregue sus propios `DiagnosticSource` y `Activity`</span><span class="sxs-lookup"><span data-stu-id="d3a5e-198">Add your own `DiagnosticSource` and `Activity`</span></span>

<span data-ttu-id="d3a5e-199">Para agregar sus propios diagnósticos o crear intervalos explícitos dentro del código de la aplicación, consulte la guía de [usuario de DiagnosticSource](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#instrumenting-with-diagnosticsourcediagnosticlistener) y la guía de usuario de la [actividad](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-usage).</span><span class="sxs-lookup"><span data-stu-id="d3a5e-199">To add your own diagnostics or create explicit spans within your application code, see the [DiagnosticSource User Guide](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#instrumenting-with-diagnosticsourcediagnosticlistener) and [Activity User Guide](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-usage).</span></span>

### <a name="store-distributed-trace-data"></a><span data-ttu-id="d3a5e-200">Almacenar datos de seguimiento distribuidos</span><span class="sxs-lookup"><span data-stu-id="d3a5e-200">Store distributed trace data</span></span>

<span data-ttu-id="d3a5e-201">En el momento de escribir este documento, el proyecto OpenTelemetry todavía está en las primeras fases y solo los paquetes de calidad alfa están disponibles para las aplicaciones .NET.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-201">At the time of writing, the OpenTelemetry project is still in the early stages, and only alpha-quality packages are available for .NET applications.</span></span> <span data-ttu-id="d3a5e-202">El proyecto OpenTracing actualmente ofrece más bibliotecas maduras.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-202">The OpenTracing project currently offers more mature libraries.</span></span>

<span data-ttu-id="d3a5e-203">La API de OpenTracing se describe en la sección siguiente.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-203">The OpenTracing API is described in the following section.</span></span> <span data-ttu-id="d3a5e-204">Si desea usar la API de OpenTelemetry en su aplicación en su lugar, consulte el [repositorio del SDK de OpenTelemetry para .net](https://github.com/open-telemetry/opentelemetry-dotnet) en github.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-204">If you want to use the OpenTelemetry API in your application instead, refer to the [OpenTelemetry .NET SDK repository](https://github.com/open-telemetry/opentelemetry-dotnet) on GitHub.</span></span>

#### <a name="use-the-opentracing-package-to-store-distributed-trace-data"></a><span data-ttu-id="d3a5e-205">Usar el paquete OpenTracing para almacenar datos de seguimiento distribuidos</span><span class="sxs-lookup"><span data-stu-id="d3a5e-205">Use the OpenTracing package to store distributed trace data</span></span>

<span data-ttu-id="d3a5e-206">El [paquete NuGet OpenTracing](https://www.nuget.org/packages/OpenTracing/) es compatible con todos los back-ends compatibles con OpenTracing (que se pueden usar independientemente de `DiagnosticSource` ).</span><span class="sxs-lookup"><span data-stu-id="d3a5e-206">The [OpenTracing NuGet package](https://www.nuget.org/packages/OpenTracing/) supports all OpenTracing-compliant back ends (which can be used independently of `DiagnosticSource`).</span></span> <span data-ttu-id="d3a5e-207">Hay un paquete adicional del proyecto de contribuciones de API de OpenTracing, [OpenTracing. comtrib. NetCore](https://www.nuget.org/packages/OpenTracing.Contrib.NetCore/).</span><span class="sxs-lookup"><span data-stu-id="d3a5e-207">There's an additional package from the OpenTracing API Contributions project, [OpenTracing.Contrib.NetCore](https://www.nuget.org/packages/OpenTracing.Contrib.NetCore/).</span></span> <span data-ttu-id="d3a5e-208">Este paquete agrega un `DiagnosticSource` agente de escucha y escribe automáticamente los eventos y las actividades en un back-end.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-208">This package adds a `DiagnosticSource` listener, and writes events and activities to a back end automatically.</span></span> <span data-ttu-id="d3a5e-209">Habilitar este paquete es tan sencillo como instalarlo desde NuGet y agregarlo como un servicio en la `Startup` clase.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-209">Enabling this package is as simple as installing it from NuGet and adding it as a service in your `Startup` class.</span></span>

```csharp
public class Startup
{
    public void ConfigureServices(IServiceCollection services)
    {
        services.AddOpenTracing();
    }
}
```

<span data-ttu-id="d3a5e-210">El paquete OpenTracing es una capa de abstracción y, como tal, requiere una implementación específica para el back-end.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-210">The OpenTracing package is an abstraction layer, and as such it requires implementation specific to the back end.</span></span> <span data-ttu-id="d3a5e-211">Las implementaciones de la API de OpenTracing están disponibles para los siguientes back-ends de código abierto.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-211">OpenTracing API implementations are available for the following open source back ends.</span></span>

| <span data-ttu-id="d3a5e-212">Nombre</span><span class="sxs-lookup"><span data-stu-id="d3a5e-212">Name</span></span> | <span data-ttu-id="d3a5e-213">Paquete</span><span class="sxs-lookup"><span data-stu-id="d3a5e-213">Package</span></span> | <span data-ttu-id="d3a5e-214">Sitio web</span><span class="sxs-lookup"><span data-stu-id="d3a5e-214">Website</span></span> |
| ---- | ------- | -------- |
| <span data-ttu-id="d3a5e-215">Jaeger</span><span class="sxs-lookup"><span data-stu-id="d3a5e-215">Jaeger</span></span> | [<span data-ttu-id="d3a5e-216">Jaeger</span><span class="sxs-lookup"><span data-stu-id="d3a5e-216">Jaeger</span></span>](https://www.nuget.org/packages/Jaeger/) | [<span data-ttu-id="d3a5e-217">jaegertracing.io</span><span class="sxs-lookup"><span data-stu-id="d3a5e-217">jaegertracing.io</span></span>](https://jaegertracing.io) |
| <span data-ttu-id="d3a5e-218">APM elástica</span><span class="sxs-lookup"><span data-stu-id="d3a5e-218">Elastic APM</span></span> | [<span data-ttu-id="d3a5e-219">Elástico. APM. NetCoreAll</span><span class="sxs-lookup"><span data-stu-id="d3a5e-219">Elastic.Apm.NetCoreAll</span></span>](https://www.nuget.org/packages/Elastic.Apm.NetCoreAll/) | [<span data-ttu-id="d3a5e-220">elastic.co/products/apm</span><span class="sxs-lookup"><span data-stu-id="d3a5e-220">elastic.co/products/apm</span></span>](https://www.elastic.co/products/apm) |

<span data-ttu-id="d3a5e-221">Para obtener más información sobre la API de OpenTracing para .NET, vea los repositorios [OpenTracing para c#](https://github.com/opentracing/opentracing-csharp) y [OpenTracing de c#/.net Core](https://github.com/opentracing-contrib/csharp-netcore) en github.</span><span class="sxs-lookup"><span data-stu-id="d3a5e-221">For more information on the OpenTracing API for .NET, see the [OpenTracing for C#](https://github.com/opentracing/opentracing-csharp) and the [OpenTracing Contrib C#/.NET Core](https://github.com/opentracing-contrib/csharp-netcore) repositories on GitHub.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="d3a5e-222">[Anterior](load-balancing.md)
>[Siguiente](appendix.md)</span><span class="sxs-lookup"><span data-stu-id="d3a5e-222">[Previous](load-balancing.md)
[Next](appendix.md)</span></span>
