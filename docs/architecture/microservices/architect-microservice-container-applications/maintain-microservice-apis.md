---
title: Creación, desarrollo y control de versiones de los contratos y las API de microservicio
description: Cree las API de microservicio y contratos teniendo en cuenta la evolución y el control de versiones, porque las necesidades pueden cambiar.
ms.date: 09/20/2018
ms.openlocfilehash: 1972d02d8bf7935c71bfd383707ae19ea2baded9
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 03/14/2020
ms.locfileid: "68672902"
---
# <a name="creating-evolving-and-versioning-microservice-apis-and-contracts"></a><span data-ttu-id="0d409-103">Creación, desarrollo y control de versiones de los contratos y las API de microservicio</span><span class="sxs-lookup"><span data-stu-id="0d409-103">Creating, evolving, and versioning microservice APIs and contracts</span></span>

<span data-ttu-id="0d409-104">Una API de microservicio es un contrato entre el servicio y sus clientes.</span><span class="sxs-lookup"><span data-stu-id="0d409-104">A microservice API is a contract between the service and its clients.</span></span> <span data-ttu-id="0d409-105">Solo podrá desarrollar un microservicio de forma independiente si no incumple el contrato de su API. Por este motivo el contrato es tan importante.</span><span class="sxs-lookup"><span data-stu-id="0d409-105">You'll be able to evolve a microservice independently only if you do not break its API contract, which is why the contract is so important.</span></span> <span data-ttu-id="0d409-106">Cualquier cambio en el contrato afectará a sus aplicaciones cliente o a la puerta de enlace de API.</span><span class="sxs-lookup"><span data-stu-id="0d409-106">If you change the contract, it will impact your client applications or your API Gateway.</span></span>

<span data-ttu-id="0d409-107">La naturaleza de la definición de API depende del protocolo que esté utilizando.</span><span class="sxs-lookup"><span data-stu-id="0d409-107">The nature of the API definition depends on which protocol you're using.</span></span> <span data-ttu-id="0d409-108">Por ejemplo, si usa mensajería (como [AMQP](https://www.amqp.org/)), la API consiste en los tipos de mensaje.</span><span class="sxs-lookup"><span data-stu-id="0d409-108">For instance, if you're using messaging (like [AMQP](https://www.amqp.org/)), the API consists of the message types.</span></span> <span data-ttu-id="0d409-109">Si usa servicios HTTP y RESTful, la API consiste en las direcciones URL y los formatos JSON de solicitud y respuesta.</span><span class="sxs-lookup"><span data-stu-id="0d409-109">If you're using HTTP and RESTful services, the API consists of the URLs and the request and response JSON formats.</span></span>

<span data-ttu-id="0d409-110">Pero, aunque piense en su contrato inicial, una API de servicio debe cambiar con el tiempo.</span><span class="sxs-lookup"><span data-stu-id="0d409-110">However, even if you're thoughtful about your initial contract, a service API will need to change over time.</span></span> <span data-ttu-id="0d409-111">Normalmente, cuando esto ocurre, y especialmente si la API es una API pública utilizada por varias aplicaciones cliente, no puede forzar a todos los clientes a actualizar la versión a su nuevo contrato de API.</span><span class="sxs-lookup"><span data-stu-id="0d409-111">When that happens—and especially if your API is a public API consumed by multiple client applications — you typically can't force all clients to upgrade to your new API contract.</span></span> <span data-ttu-id="0d409-112">Lo más habitual es implementar progresivamente nuevas versiones de un servicio, de forma que se ejecuten simultáneamente las versiones anteriores y las nuevas de un contrato de servicio.</span><span class="sxs-lookup"><span data-stu-id="0d409-112">You usually need to incrementally deploy new versions of a service in a way that both old and new versions of a service contract are running simultaneously.</span></span> <span data-ttu-id="0d409-113">Por tanto, es importante contar con una estrategia para el control de versiones del servicio.</span><span class="sxs-lookup"><span data-stu-id="0d409-113">Therefore, it's important to have a strategy for your service versioning.</span></span>

<span data-ttu-id="0d409-114">Cuando los cambios en la API son pequeños, por ejemplo, si agrega atributos o parámetros a la API, los clientes que usen una API anterior deberán cambiar y trabajar con la nueva versión del servicio.</span><span class="sxs-lookup"><span data-stu-id="0d409-114">When the API changes are small, like if you add attributes or parameters to your API, clients that use an older API should switch and work with the new version of the service.</span></span> <span data-ttu-id="0d409-115">Usted puede proporcionar los valores predeterminados para los atributos que falten y que sean necesarios, y los clientes pueden pasar por alto cualquier atributo de respuesta adicional.</span><span class="sxs-lookup"><span data-stu-id="0d409-115">You might be able to provide default values for any missing attributes that are required, and the clients might be able to ignore any extra response attributes.</span></span>

<span data-ttu-id="0d409-116">Pero en ciertas ocasiones necesitará realizar cambios importantes e incompatibles en una API de servicio.</span><span class="sxs-lookup"><span data-stu-id="0d409-116">However, sometimes you need to make major and incompatible changes to a service API.</span></span> <span data-ttu-id="0d409-117">Puesto que es posible que no pueda forzar a los servicios o aplicaciones cliente a que se actualicen inmediatamente a la nueva versión, un servicio debe admitir versiones anteriores de la API durante cierto período de tiempo.</span><span class="sxs-lookup"><span data-stu-id="0d409-117">Because you might not be able to force client applications or services to upgrade immediately to the new version, a service must support older versions of the API for some period.</span></span> <span data-ttu-id="0d409-118">Si está utilizando un mecanismo basado en HTTP, como REST, una opción es insertar el número de versión de la API en la dirección URL o en un encabezado HTTP.</span><span class="sxs-lookup"><span data-stu-id="0d409-118">If you're using an HTTP-based mechanism such as REST, one approach is to embed the API version number in the URL or into an HTTP header.</span></span> <span data-ttu-id="0d409-119">A continuación, puede decidir si quiere implementar ambas versiones del servicio al mismo tiempo en la misma instancia de servicio o si prefiere implementar distintas instancias y que cada una controle una versión de la API.</span><span class="sxs-lookup"><span data-stu-id="0d409-119">Then you can decide between implementing both versions of the service simultaneously within the same service instance, or deploying different instances that each handle a version of the API.</span></span> <span data-ttu-id="0d409-120">Una buena opción es utilizar el [patrón mediador](https://en.wikipedia.org/wiki/Mediator_pattern) (por ejemplo, la [biblioteca MediatR](https://github.com/jbogard/MediatR)) para desacoplar las diferentes versiones de implementación en los controladores independientes.</span><span class="sxs-lookup"><span data-stu-id="0d409-120">A good approach for this is the [Mediator pattern](https://en.wikipedia.org/wiki/Mediator_pattern) (for example, [MediatR library](https://github.com/jbogard/MediatR)) to decouple the different implementation versions into independent handlers.</span></span>

<span data-ttu-id="0d409-121">Por último, si utiliza una arquitectura REST, [Hypermedia](https://www.infoq.com/articles/mark-baker-hypermedia) es la mejor solución para controlar las versiones de los servicios y permitir las API avanzadas.</span><span class="sxs-lookup"><span data-stu-id="0d409-121">Finally, if you're using a REST architecture, [Hypermedia](https://www.infoq.com/articles/mark-baker-hypermedia) is the best solution for versioning your services and allowing evolvable APIs.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="0d409-122">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="0d409-122">Additional resources</span></span>

- <span data-ttu-id="0d409-123">**Scott Hanselman. ASP.NET Core RESTful Web API versioning made easy** (Control de versiones simplificado de API web RESTful de ASP.NET Core) </span><span class="sxs-lookup"><span data-stu-id="0d409-123">**Scott Hanselman. ASP.NET Core RESTful Web API versioning made easy** </span></span>\
  <https://www.hanselman.com/blog/ASPNETCoreRESTfulWebAPIVersioningMadeEasy.aspx>

- <span data-ttu-id="0d409-124">**Control de versiones de una API web RESTful** </span><span class="sxs-lookup"><span data-stu-id="0d409-124">**Versioning a RESTful web API** </span></span>\
  <https://docs.microsoft.com/azure/architecture/best-practices/api-design#versioning-a-restful-web-api>

- <span data-ttu-id="0d409-125">**Roy Fielding. Control de versiones, hipermedios y REST** </span><span class="sxs-lookup"><span data-stu-id="0d409-125">**Roy Fielding. Versioning, Hypermedia, and REST** </span></span>\
  <https://www.infoq.com/articles/roy-fielding-on-versioning>

>[!div class="step-by-step"]
><span data-ttu-id="0d409-126">[Anterior](asynchronous-message-based-communication.md)
>[Siguiente](microservices-addressability-service-registry.md)</span><span class="sxs-lookup"><span data-stu-id="0d409-126">[Previous](asynchronous-message-based-communication.md)
[Next](microservices-addressability-service-registry.md)</span></span>
