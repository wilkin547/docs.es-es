---
title: Implementación de comunicación basada en eventos entre microservicios (eventos de integración)
description: Arquitectura de microservicios de .NET para aplicaciones .NET en contenedor | Información sobre los eventos de integración para implementar la comunicación basada en eventos entre microservicios.
ms.date: 01/13/2021
ms.openlocfilehash: 65c0414184fdd1bccfbc61ef4df8fdcb88284ebe
ms.sourcegitcommit: a4cecb7389f02c27e412b743f9189bd2a6dea4d6
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 01/14/2021
ms.locfileid: "98188210"
---
# <a name="implementing-event-based-communication-between-microservices-integration-events"></a><span data-ttu-id="23dda-103">Implementación de comunicación basada en eventos entre microservicios (eventos de integración)</span><span class="sxs-lookup"><span data-stu-id="23dda-103">Implementing event-based communication between microservices (integration events)</span></span>

<span data-ttu-id="23dda-104">Como se describió anteriormente, si utiliza una comunicación basada en eventos, un microservicio publica un evento cuando sucede algo importante, como cuando actualiza una entidad de negocio.</span><span class="sxs-lookup"><span data-stu-id="23dda-104">As described earlier, when you use event-based communication, a microservice publishes an event when something notable happens, such as when it updates a business entity.</span></span> <span data-ttu-id="23dda-105">Otros microservicios se suscriben a esos eventos.</span><span class="sxs-lookup"><span data-stu-id="23dda-105">Other microservices subscribe to those events.</span></span> <span data-ttu-id="23dda-106">Cuando un microservicio recibe un evento, puede actualizar sus propias entidades de negocio, lo que puede comportar que se publiquen más eventos.</span><span class="sxs-lookup"><span data-stu-id="23dda-106">When a microservice receives an event, it can update its own business entities, which might lead to more events being published.</span></span> <span data-ttu-id="23dda-107">Esta es la esencia del concepto de la coherencia final.</span><span class="sxs-lookup"><span data-stu-id="23dda-107">This is the essence of the eventual consistency concept.</span></span> <span data-ttu-id="23dda-108">Este sistema de publicación/suscripción normalmente se realiza mediante una implementación de un bus de eventos.</span><span class="sxs-lookup"><span data-stu-id="23dda-108">This publish/subscribe system is usually performed by using an implementation of an event bus.</span></span> <span data-ttu-id="23dda-109">El bus de eventos puede diseñarse como una interfaz con la API necesaria para suscribirse a eventos, cancelar las suscripciones y publicar eventos.</span><span class="sxs-lookup"><span data-stu-id="23dda-109">The event bus can be designed as an interface with the API needed to subscribe and unsubscribe to events and to publish events.</span></span> <span data-ttu-id="23dda-110">También puede tener una o más implementaciones basadas en cualquier comunicación de mensajería o entre procesos, como una cola de mensajes o un bus de servicio que admita la comunicación asincrónica y un modelo de publicación/suscripción.</span><span class="sxs-lookup"><span data-stu-id="23dda-110">It can also have one or more implementations based on any inter-process or messaging communication, such as a messaging queue or a service bus that supports asynchronous communication and a publish/subscribe model.</span></span>

<span data-ttu-id="23dda-111">Puede usar eventos para implementar transacciones de negocio que abarquen varios servicios, lo cual termina proporcionando coherencia entre dichos servicios.</span><span class="sxs-lookup"><span data-stu-id="23dda-111">You can use events to implement business transactions that span multiple services, which give you eventual consistency between those services.</span></span> <span data-ttu-id="23dda-112">Una eventual transacción coherente consta de una serie de acciones distribuidas.</span><span class="sxs-lookup"><span data-stu-id="23dda-112">An eventually consistent transaction consists of a series of distributed actions.</span></span> <span data-ttu-id="23dda-113">En cada acción, el microservicio actualiza una entidad de negocio y publica un evento que desencadena la siguiente acción.</span><span class="sxs-lookup"><span data-stu-id="23dda-113">At each action, the microservice updates a business entity and publishes an event that triggers the next action.</span></span> <span data-ttu-id="23dda-114">En la figura 6-18 siguiente se muestra un evento PriceUpdated publicado mediante un bus de eventos, para que la actualización de los precios se propague a la cesta y a otros microservicios.</span><span class="sxs-lookup"><span data-stu-id="23dda-114">Figure 6-18 below, shows a PriceUpdated event published through an event bus, so the price update is propagated to the Basket and other microservices.</span></span>

![Diagrama de comunicación asincrónica controlada por eventos con un bus de eventos.](./media/integration-event-based-microservice-communications/event-driven-communication.png)

<span data-ttu-id="23dda-116">**Figura 6-18**.</span><span class="sxs-lookup"><span data-stu-id="23dda-116">**Figure 6-18**.</span></span> <span data-ttu-id="23dda-117">Comunicación orientada a eventos basada en un bus de eventos</span><span class="sxs-lookup"><span data-stu-id="23dda-117">Event-driven communication based on an event bus</span></span>

<span data-ttu-id="23dda-118">En esta sección se describe cómo puede implementar este tipo de comunicación con .NET mediante un bus de eventos genéricos, como se muestra en la Figura 6-18.</span><span class="sxs-lookup"><span data-stu-id="23dda-118">This section describes how you can implement this type of communication with .NET by using a generic event bus interface, as shown in Figure 6-18.</span></span> <span data-ttu-id="23dda-119">Hay varias implementaciones posibles, cada una de las cuales usa una tecnología o infraestructura distinta, como RabbitMQ, Azure Service Bus o cualquier otro bus de servicio de código abierto de terceros o comercial.</span><span class="sxs-lookup"><span data-stu-id="23dda-119">There are multiple potential implementations, each using a different technology or infrastructure such as RabbitMQ, Azure Service Bus, or any other third-party open-source or commercial service bus.</span></span>

## <a name="using-message-brokers-and-services-buses-for-production-systems"></a><span data-ttu-id="23dda-120">Uso de buses de agentes y servicios de mensajería para sistemas de producción</span><span class="sxs-lookup"><span data-stu-id="23dda-120">Using message brokers and services buses for production systems</span></span>

<span data-ttu-id="23dda-121">Como se indicó en la sección de arquitectura, puede escoger entre diferentes tecnologías de mensajería para implementar el bus de eventos abstractos.</span><span class="sxs-lookup"><span data-stu-id="23dda-121">As noted in the architecture section, you can choose from multiple messaging technologies for implementing your abstract event bus.</span></span> <span data-ttu-id="23dda-122">Pero estas tecnologías se encuentran en distintos niveles.</span><span class="sxs-lookup"><span data-stu-id="23dda-122">But these technologies are at different levels.</span></span> <span data-ttu-id="23dda-123">Por ejemplo, RabbitMQ, un transporte de agentes de mensajería, está en un nivel inferior al de productos comerciales como Azure Service Bus, NServiceBus, MassTransit o Brighter.</span><span class="sxs-lookup"><span data-stu-id="23dda-123">For instance, RabbitMQ, a messaging broker transport, is at a lower level than commercial products like Azure Service Bus, NServiceBus, MassTransit, or Brighter.</span></span> <span data-ttu-id="23dda-124">La mayoría de estos productos puede trabajar encima de RabbitMQ o Azure Service Bus.</span><span class="sxs-lookup"><span data-stu-id="23dda-124">Most of these products can work on top of either RabbitMQ or Azure Service Bus.</span></span> <span data-ttu-id="23dda-125">La selección que haga del producto depende de la cantidad de características y de la escalabilidad de serie que necesite para la aplicación.</span><span class="sxs-lookup"><span data-stu-id="23dda-125">Your choice of product depends on how many features and how much out-of-the-box scalability you need for your application.</span></span>

<span data-ttu-id="23dda-126">Para implementar solo una prueba de concepto de bus de eventos para su entorno de desarrollo, como en el ejemplo de eShopOnContainers, una implementación sencilla encima de RabbitMQ ejecutándose como contenedor podría ser suficiente.</span><span class="sxs-lookup"><span data-stu-id="23dda-126">For implementing just an event bus proof-of-concept for your development environment, as in the eShopOnContainers sample, a simple implementation on top of RabbitMQ running as a container might be enough.</span></span> <span data-ttu-id="23dda-127">Pero para sistemas importantes y de producción que necesiten alta escalabilidad, se recomienda evaluar y usar Azure Service Bus.</span><span class="sxs-lookup"><span data-stu-id="23dda-127">But for mission-critical and production systems that need high scalability, you might want to evaluate and use Azure Service Bus.</span></span>

<span data-ttu-id="23dda-128">Si necesita abstracciones de alto nivel y características más potentes, como [Sagas](https://docs.particular.net/nservicebus/sagas/), para procesos de larga duración que faciliten el desarrollo distribuido, vale la pena tener en cuenta otros buses de servicio comerciales y de código abierto, como NServiceBus, MassTransit y Brighter.</span><span class="sxs-lookup"><span data-stu-id="23dda-128">If you require high-level abstractions and richer features like [Sagas](https://docs.particular.net/nservicebus/sagas/) for long-running processes that make distributed development easier, other commercial and open-source service buses like NServiceBus, MassTransit, and Brighter are worth evaluating.</span></span> <span data-ttu-id="23dda-129">En este caso, las abstracciones y la API que se van a utilizar suelen ser las proporcionadas directamente por los buses de servicio de alto nivel, en vez de las propias abstracciones (como las [abstracciones de bus de eventos sencillos proporcionadas en eShopOnContainers](https://github.com/dotnet-architecture/eShopOnContainers/blob/dev/src/BuildingBlocks/EventBus/EventBus/Abstractions/IEventBus.cs)).</span><span class="sxs-lookup"><span data-stu-id="23dda-129">In this case, the abstractions and API to use would usually be directly the ones provided by those high-level service buses instead of your own abstractions (like the [simple event bus abstractions provided at eShopOnContainers](https://github.com/dotnet-architecture/eShopOnContainers/blob/dev/src/BuildingBlocks/EventBus/EventBus/Abstractions/IEventBus.cs)).</span></span> <span data-ttu-id="23dda-130">Con este propósito, puede analizar [eShopOnContainers bifurcado con NServiceBus](https://go.particular.net/eShopOnContainers) (ejemplo derivado adicional implementado por Particular Software).</span><span class="sxs-lookup"><span data-stu-id="23dda-130">For that matter, you can research the [forked eShopOnContainers using NServiceBus](https://go.particular.net/eShopOnContainers) (additional derived sample implemented by Particular Software).</span></span>

<span data-ttu-id="23dda-131">Obviamente, siempre puede crear sus propias características de bus de servicio sobre tecnologías de nivel inferior, como RabbitMQ y Docker, pero el trabajo necesario para "volver a inventar la rueda" puede ser demasiado costoso para una aplicación de empresa personalizada.</span><span class="sxs-lookup"><span data-stu-id="23dda-131">Of course, you could always build your own service bus features on top of lower-level technologies like RabbitMQ and Docker, but the work needed to "reinvent the wheel" might be too costly for a custom enterprise application.</span></span>

<span data-ttu-id="23dda-132">Para reiterar: las abstracciones de bus de eventos de ejemplo y la implementación presentada en el ejemplo de eShopOnContainers están diseñadas para usarse solo como una prueba de concepto.</span><span class="sxs-lookup"><span data-stu-id="23dda-132">To reiterate: the sample event bus abstractions and implementation showcased in the eShopOnContainers sample are intended to be used only as a proof of concept.</span></span> <span data-ttu-id="23dda-133">Una vez que haya decidido que quiere tener comunicación asincrónica y controlada por eventos, como se explica en la sección actual, debe elegir el producto de bus de servicio que mejor se adapte a sus necesidades de producción.</span><span class="sxs-lookup"><span data-stu-id="23dda-133">Once you have decided that you want to have asynchronous and event-driven communication, as explained in the current section, you should choose the service bus product that best fits your needs for production.</span></span>

## <a name="integration-events"></a><span data-ttu-id="23dda-134">Eventos de integración</span><span class="sxs-lookup"><span data-stu-id="23dda-134">Integration events</span></span>

<span data-ttu-id="23dda-135">Los eventos de integración se utilizan para sincronizar el estado de dominio en varios microservicios o sistemas externos.</span><span class="sxs-lookup"><span data-stu-id="23dda-135">Integration events are used for bringing domain state in sync across multiple microservices or external systems.</span></span> <span data-ttu-id="23dda-136">Esta funcionalidad se lleva a cabo mediante la publicación de eventos de integración fuera del microservicio.</span><span class="sxs-lookup"><span data-stu-id="23dda-136">This functionality is done by publishing integration events outside the microservice.</span></span> <span data-ttu-id="23dda-137">Cuando se publica un evento en varios microservicios de receptor (en tantos microservicios como estén suscritos al evento de integración), el controlador de eventos correspondiente en cada microservicio de receptor controla el evento.</span><span class="sxs-lookup"><span data-stu-id="23dda-137">When an event is published to multiple receiver microservices (to as many microservices as are subscribed to the integration event), the appropriate event handler in each receiver microservice handles the event.</span></span>

<span data-ttu-id="23dda-138">Un evento de integración es básicamente una clase de almacenamiento de datos, como en el ejemplo siguiente:</span><span class="sxs-lookup"><span data-stu-id="23dda-138">An integration event is basically a data-holding class, as in the following example:</span></span>

```csharp
public class ProductPriceChangedIntegrationEvent : IntegrationEvent
{
    public int ProductId { get; private set; }
    public decimal NewPrice { get; private set; }
    public decimal OldPrice { get; private set; }

    public ProductPriceChangedIntegrationEvent(int productId, decimal newPrice,
        decimal oldPrice)
    {
        ProductId = productId;
        NewPrice = newPrice;
        OldPrice = oldPrice;
    }
}
```

<span data-ttu-id="23dda-139">Los eventos de integración pueden definirse en el nivel de aplicación de cada microservicio, por lo que se separan de otros microservicios de una forma comparable a cómo se define ViewModels en el servidor y en el cliente.</span><span class="sxs-lookup"><span data-stu-id="23dda-139">The integration events can be defined at the application level of each microservice, so they are decoupled from other microservices, in a way comparable to how ViewModels are defined in the server and client.</span></span> <span data-ttu-id="23dda-140">Lo que no se recomienda es compartir una biblioteca de eventos de integración común entre varios microservicios. De hacerlo, podría estar acoplando esos microservicios a una biblioteca de datos de definición de eventos únicos.</span><span class="sxs-lookup"><span data-stu-id="23dda-140">What is not recommended is sharing a common integration events library across multiple microservices; doing that would be coupling those microservices with a single event definition data library.</span></span> <span data-ttu-id="23dda-141">Esto no le interesa por el mismo motivo que no le interesa compartir un modelo de dominio común entre varios microservicios: los microservicios deben ser completamente autónomos.</span><span class="sxs-lookup"><span data-stu-id="23dda-141">You do not want to do that for the same reasons that you do not want to share a common domain model across multiple microservices: microservices must be completely autonomous.</span></span>

<span data-ttu-id="23dda-142">Solo hay unos cuantos tipos de bibliotecas que debería compartir entre microservicios.</span><span class="sxs-lookup"><span data-stu-id="23dda-142">There are only a few kinds of libraries you should share across microservices.</span></span> <span data-ttu-id="23dda-143">Por un lado, las bibliotecas que son bloques de aplicaciones finales, como la [API de cliente de bus de eventos](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/BuildingBlocks/EventBus), como en eShopOnContainers.</span><span class="sxs-lookup"><span data-stu-id="23dda-143">One is libraries that are final application blocks, like the [Event Bus client API](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/BuildingBlocks/EventBus), as in eShopOnContainers.</span></span> <span data-ttu-id="23dda-144">Por otro lado, las bibliotecas que constituyen herramientas que también se podrían compartir como componentes de NuGet, igual que los serializadores JSON.</span><span class="sxs-lookup"><span data-stu-id="23dda-144">Another is libraries that constitute tools that could also be shared as NuGet components, like JSON serializers.</span></span>

## <a name="the-event-bus"></a><span data-ttu-id="23dda-145">El bus de eventos</span><span class="sxs-lookup"><span data-stu-id="23dda-145">The event bus</span></span>

<span data-ttu-id="23dda-146">Un bus de eventos permite una comunicación de estilo de suscripción/publicación entre microservicios, sin requerir que los componentes se reconozcan entre sí, como se muestra en la Figura 6-19.</span><span class="sxs-lookup"><span data-stu-id="23dda-146">An event bus allows publish/subscribe-style communication between microservices without requiring the components to explicitly be aware of each other, as shown in Figure 6-19.</span></span>

![Diagrama que muestra el patrón de publicación/suscripción básico.](./media/integration-event-based-microservice-communications/publish-subscribe-basics.png)

<span data-ttu-id="23dda-148">**Figura 6-19**.</span><span class="sxs-lookup"><span data-stu-id="23dda-148">**Figure 6-19**.</span></span> <span data-ttu-id="23dda-149">Aspectos básicos de publicación/suscripción con un bus de eventos</span><span class="sxs-lookup"><span data-stu-id="23dda-149">Publish/subscribe basics with an event bus</span></span>

<span data-ttu-id="23dda-150">En el diagrama anterior se muestra que el microservicio A se publica en el bus de eventos, que lo distribuye a los microservicios B y C suscritos, sin que el editor tenga que conocer a los suscriptores.</span><span class="sxs-lookup"><span data-stu-id="23dda-150">The above diagram shows that microservice A publishes to Event Bus, which distributes to subscribing microservices B and C, without the publisher needing to know the subscribers.</span></span> <span data-ttu-id="23dda-151">El bus de eventos está relacionado con el patrón de observador y con el patrón de publicación/suscripción.</span><span class="sxs-lookup"><span data-stu-id="23dda-151">The event bus is related to the Observer pattern and the publish-subscribe pattern.</span></span>

### <a name="observer-pattern"></a><span data-ttu-id="23dda-152">Patrón de observador</span><span class="sxs-lookup"><span data-stu-id="23dda-152">Observer pattern</span></span>

<span data-ttu-id="23dda-153">En el [patrón de observador](https://en.wikipedia.org/wiki/Observer_pattern), su objeto principal (conocido como "Observable") proporciona información pertinente (eventos) a otros objetos interesados (conocidos como "Observadores").</span><span class="sxs-lookup"><span data-stu-id="23dda-153">In the [Observer pattern](https://en.wikipedia.org/wiki/Observer_pattern), your primary object (known as the Observable) notifies other interested objects (known as Observers) with relevant information (events).</span></span>

### <a name="publishsubscribe-pubsub-pattern"></a><span data-ttu-id="23dda-154">Patrón de publicación/suscripción (Pub/Sus)</span><span class="sxs-lookup"><span data-stu-id="23dda-154">Publish/Subscribe (Pub/Sub) pattern</span></span>

<span data-ttu-id="23dda-155">El propósito del [patrón de publicación/suscripción ](/previous-versions/msp-n-p/ff649664(v=pandp.10)) es el mismo que el del modelo de observador: informar a otros servicios de la realización de determinados eventos.</span><span class="sxs-lookup"><span data-stu-id="23dda-155">The purpose of the [Publish/Subscribe pattern](/previous-versions/msp-n-p/ff649664(v=pandp.10)) is the same as the Observer pattern: you want to notify other services when certain events take place.</span></span> <span data-ttu-id="23dda-156">Pero hay una diferencia importante entre los patrones Observador y Pub/Sus.</span><span class="sxs-lookup"><span data-stu-id="23dda-156">But there is an important difference between the Observer and Pub/Sub patterns.</span></span> <span data-ttu-id="23dda-157">En el patrón de observador, la difusión se realiza directamente desde el objeto observable a los observadores, por lo que "se reconocen" entre sí.</span><span class="sxs-lookup"><span data-stu-id="23dda-157">In the observer pattern, the broadcast is performed directly from the observable to the observers, so they "know" each other.</span></span> <span data-ttu-id="23dda-158">Sin embargo, si se usa un patrón Pub/Sus, hay un tercer componente, denominado "agente", "agente de mensaje" o "bus de eventos", que tanto el publicador como el suscriptor conocen.</span><span class="sxs-lookup"><span data-stu-id="23dda-158">But when using a Pub/Sub pattern, there is a third component, called broker, or message broker or event bus, which is known by both the publisher and subscriber.</span></span> <span data-ttu-id="23dda-159">Por lo tanto, al utilizar el patrón Pub/Sus, el publicador y los suscriptores se desvinculan precisamente gracias al bus de eventos o al mensaje de agente mencionados.</span><span class="sxs-lookup"><span data-stu-id="23dda-159">Therefore, when using the Pub/Sub pattern the publisher and the subscribers are precisely decoupled thanks to the mentioned event bus or message broker.</span></span>

### <a name="the-middleman-or-event-bus"></a><span data-ttu-id="23dda-160">El intermediario o bus de eventos</span><span class="sxs-lookup"><span data-stu-id="23dda-160">The middleman or event bus</span></span>

<span data-ttu-id="23dda-161">¿Cómo se consigue el anonimato entre el publicador y el suscriptor?</span><span class="sxs-lookup"><span data-stu-id="23dda-161">How do you achieve anonymity between publisher and subscriber?</span></span> <span data-ttu-id="23dda-162">Una forma sencilla de hacerlo es permitir que un intermediario se ocupe de toda la comunicación.</span><span class="sxs-lookup"><span data-stu-id="23dda-162">An easy way is let a middleman take care of all the communication.</span></span> <span data-ttu-id="23dda-163">Un bus de eventos es un intermediario de este tipo.</span><span class="sxs-lookup"><span data-stu-id="23dda-163">An event bus is one such middleman.</span></span>

<span data-ttu-id="23dda-164">Normalmente, los buses de eventos están compuestos de dos partes:</span><span class="sxs-lookup"><span data-stu-id="23dda-164">An event bus is typically composed of two parts:</span></span>

- <span data-ttu-id="23dda-165">La abstracción o interfaz.</span><span class="sxs-lookup"><span data-stu-id="23dda-165">The abstraction or interface.</span></span>

- <span data-ttu-id="23dda-166">Una o varias implementaciones.</span><span class="sxs-lookup"><span data-stu-id="23dda-166">One or more implementations.</span></span>

<span data-ttu-id="23dda-167">En la Figura 6-19 puede ver cómo, desde el punto de vista de la aplicación, el bus de eventos no es más que un canal de Pub/Sus.</span><span class="sxs-lookup"><span data-stu-id="23dda-167">In Figure 6-19 you can see how, from an application point of view, the event bus is nothing more than a Pub/Sub channel.</span></span> <span data-ttu-id="23dda-168">La forma de implementar este tipo de comunicación asincrónica puede variar.</span><span class="sxs-lookup"><span data-stu-id="23dda-168">The way you implement this asynchronous communication can vary.</span></span> <span data-ttu-id="23dda-169">Puede tener varias implementaciones para intercambiarlas dependiendo de los requisitos del entorno (por ejemplo, entornos de producción frente a entornos de desarrollo).</span><span class="sxs-lookup"><span data-stu-id="23dda-169">It can have multiple implementations so that you can swap between them, depending on the environment requirements (for example, production versus development environments).</span></span>

<span data-ttu-id="23dda-170">En la figura 6-20, puede ver una abstracción de un bus de eventos con varias implementaciones basadas en tecnologías de mensajería de infraestructura, como RabbitMQ, Azure Service Bus, u otro agente de eventos o de mensajería.</span><span class="sxs-lookup"><span data-stu-id="23dda-170">In Figure 6-20, you can see an abstraction of an event bus with multiple implementations based on infrastructure messaging technologies like RabbitMQ, Azure Service Bus, or another event/message broker.</span></span>

![Diagrama que muestra la adición de una capa de abstracción de bus de eventos.](./media/integration-event-based-microservice-communications/multiple-implementations-event-bus.png)

<span data-ttu-id="23dda-172">**Figura 6-20**.</span><span class="sxs-lookup"><span data-stu-id="23dda-172">**Figure 6- 20.**</span></span> <span data-ttu-id="23dda-173">Varias implementaciones de un bus de eventos</span><span class="sxs-lookup"><span data-stu-id="23dda-173">Multiple implementations of an event bus</span></span>

<span data-ttu-id="23dda-174">Es conveniente definir el bus de eventos través de una interfaz, de forma que pueda implementarse con varias tecnologías, como RabbitMQ y Azure Service Bus entre otras.</span><span class="sxs-lookup"><span data-stu-id="23dda-174">It's good to have the event bus defined through an interface so it can be implemented with several technologies, like RabbitMQ Azure Service bus or others.</span></span> <span data-ttu-id="23dda-175">Pero, como se ha mencionado anteriormente, usar sus propias abstracciones (la interfaz del bus de eventos) solo es una buena opción si necesita características de bus de eventos compatibles con sus abstracciones.</span><span class="sxs-lookup"><span data-stu-id="23dda-175">However, and as mentioned previously, using your own abstractions (the event bus interface) is good only if you need basic event bus features supported by your abstractions.</span></span> <span data-ttu-id="23dda-176">Si necesita características más completas del bus de servicio, probablemente tendrá que usar la API y las abstracciones proporcionadas por el bus de servicio comercial que prefiera, en vez de usar sus propias abstracciones.</span><span class="sxs-lookup"><span data-stu-id="23dda-176">If you need richer service bus features, you should probably use the API and abstractions provided by your preferred commercial service bus instead of your own abstractions.</span></span>

### <a name="defining-an-event-bus-interface"></a><span data-ttu-id="23dda-177">Definición de una interfaz de bus de eventos</span><span class="sxs-lookup"><span data-stu-id="23dda-177">Defining an event bus interface</span></span>

<span data-ttu-id="23dda-178">Comencemos con código de implementación para la interfaz de bus de eventos y las posibles implementaciones con fines de exploración.</span><span class="sxs-lookup"><span data-stu-id="23dda-178">Let's start with some implementation code for the event bus interface and possible implementations for exploration purposes.</span></span> <span data-ttu-id="23dda-179">La interfaz debe ser sencilla y genérica, como la interfaz siguiente.</span><span class="sxs-lookup"><span data-stu-id="23dda-179">The interface should be generic and straightforward, as in the following interface.</span></span>

```csharp
public interface IEventBus
{
    void Publish(IntegrationEvent @event);

    void Subscribe<T, TH>()
        where T : IntegrationEvent
        where TH : IIntegrationEventHandler<T>;

    void SubscribeDynamic<TH>(string eventName)
        where TH : IDynamicIntegrationEventHandler;

    void UnsubscribeDynamic<TH>(string eventName)
        where TH : IDynamicIntegrationEventHandler;

    void Unsubscribe<T, TH>()
        where TH : IIntegrationEventHandler<T>
        where T : IntegrationEvent;
}
```

<span data-ttu-id="23dda-180">El método `Publish` es sencillo.</span><span class="sxs-lookup"><span data-stu-id="23dda-180">The `Publish` method is straightforward.</span></span> <span data-ttu-id="23dda-181">El bus de eventos difunde el evento de integración que ha recibido a cualquier microservicio, o incluso a una aplicación externa, que se haya suscrito a ese evento.</span><span class="sxs-lookup"><span data-stu-id="23dda-181">The event bus will broadcast the integration event passed to it to any microservice, or even an external application, subscribed to that event.</span></span> <span data-ttu-id="23dda-182">El microservicio que está publicando el evento utiliza este método.</span><span class="sxs-lookup"><span data-stu-id="23dda-182">This method is used by the microservice that is publishing the event.</span></span>

<span data-ttu-id="23dda-183">Los microservicios que quieren recibir eventos utilizan los métodos `Subscribe` (puede tener varias implementaciones dependiendo de los argumentos).</span><span class="sxs-lookup"><span data-stu-id="23dda-183">The `Subscribe` methods (you can have several implementations depending on the arguments) are used by the microservices that want to receive events.</span></span> <span data-ttu-id="23dda-184">Este método tiene dos argumentos.</span><span class="sxs-lookup"><span data-stu-id="23dda-184">This method has two arguments.</span></span> <span data-ttu-id="23dda-185">El primero es el evento de integración para suscribirse a (`IntegrationEvent`).</span><span class="sxs-lookup"><span data-stu-id="23dda-185">The first is the integration event to subscribe to (`IntegrationEvent`).</span></span> <span data-ttu-id="23dda-186">El segundo es el controlador del evento de integración (o el método de devolución de llamada), denominado `IIntegrationEventHandler<T>`, que se ejecuta cuando el microservicio receptor recibe ese mensaje de evento de integración.</span><span class="sxs-lookup"><span data-stu-id="23dda-186">The second argument is the integration event handler (or callback method), named `IIntegrationEventHandler<T>`, to be executed when the receiver microservice gets that integration event message.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="23dda-187">Recursos adicionales</span><span class="sxs-lookup"><span data-stu-id="23dda-187">Additional resources</span></span>

<span data-ttu-id="23dda-188">Algunas soluciones de mensajería listas para producción:</span><span class="sxs-lookup"><span data-stu-id="23dda-188">Some production-ready messaging solutions:</span></span>

- <span data-ttu-id="23dda-189">**Azure Service Bus** </span><span class="sxs-lookup"><span data-stu-id="23dda-189">**Azure Service Bus** </span></span>\
  <https://docs.microsoft.com/azure/service-bus-messaging/>
  
- <span data-ttu-id="23dda-190">**NServiceBus** </span><span class="sxs-lookup"><span data-stu-id="23dda-190">**NServiceBus** </span></span>\
  <https://particular.net/nservicebus>
  
- <span data-ttu-id="23dda-191">**MassTransit** </span><span class="sxs-lookup"><span data-stu-id="23dda-191">**MassTransit** </span></span>\
  <https://masstransit-project.com/>

> [!div class="step-by-step"]
> <span data-ttu-id="23dda-192">[Anterior](database-server-container.md)
> [Siguiente](rabbitmq-event-bus-development-test-environment.md)</span><span class="sxs-lookup"><span data-stu-id="23dda-192">[Previous](database-server-container.md)
[Next](rabbitmq-event-bus-development-test-environment.md)</span></span>
