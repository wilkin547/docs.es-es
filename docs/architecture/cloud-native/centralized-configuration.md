---
title: Configuración centralizada
description: Centralizar la configuración de aplicaciones nativas en la nube con la configuración de App de Azure y el almacén de AzureKey.
ms.date: 05/13/2020
ms.openlocfilehash: d389d29dcdb1db5162d95370d181ab5a85d72dc8
ms.sourcegitcommit: 27db07ffb26f76912feefba7b884313547410db5
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 05/19/2020
ms.locfileid: "83614232"
---
# <a name="centralized-configuration"></a><span data-ttu-id="a7c0b-103">Configuración centralizada</span><span class="sxs-lookup"><span data-stu-id="a7c0b-103">Centralized configuration</span></span>

<span data-ttu-id="a7c0b-104">A diferencia de una aplicación monolítica en la que todo se ejecuta dentro de una única instancia, una aplicación nativa en la nube se compone de servicios independientes distribuidos entre máquinas virtuales, contenedores y regiones geográficas.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-104">Unlike a monolithic app in which everything runs within a single instance, a cloud-native application consists of independent services distributed across virtual machines, containers, and geographic regions.</span></span> <span data-ttu-id="a7c0b-105">La administración de los valores de configuración para docenas de servicios interdependientes puede resultar complicada.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-105">Managing configuration settings for dozens of interdependent services can be challenging.</span></span> <span data-ttu-id="a7c0b-106">Las copias duplicadas de los valores de configuración en diferentes ubicaciones es propensa a errores y difíciles de administrar.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-106">Duplicate copies of configuration settings across different locations is error prone and difficult to manage.</span></span> <span data-ttu-id="a7c0b-107">La configuración centralizada es un requisito fundamental para las aplicaciones distribuidas nativas en la nube.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-107">Centralized configuration is a critical requirement for distributed cloud-native applications.</span></span>

<span data-ttu-id="a7c0b-108">Como se describe en el [capítulo 1](introduction.md), las recomendaciones de la aplicación de doce factores requieren una separación estricta entre el código y la configuración.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-108">As discussed in [Chapter 1](introduction.md), the Twelve-Factor App recommendations require strict separation between code and configuration.</span></span> <span data-ttu-id="a7c0b-109">La configuración se debe almacenar externamente desde la aplicación y se puede leer según sea necesario.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-109">Configuration must be stored externally from the application and read-in as needed.</span></span> <span data-ttu-id="a7c0b-110">El almacenamiento de valores de configuración como constantes o valores literales en el código es una infracción.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-110">Storing configuration values as constants or literal values in code is a violation.</span></span> <span data-ttu-id="a7c0b-111">Muchos servicios de la misma aplicación suelen usar los mismos valores de configuración.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-111">The same configuration values are often be used by many services in the same application.</span></span> <span data-ttu-id="a7c0b-112">Además, debemos admitir los mismos valores en varios entornos, como desarrollo, pruebas y producción.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-112">Additionally, we must support the same values across multiple environments, such as dev, testing, and production.</span></span> <span data-ttu-id="a7c0b-113">La práctica recomendada es almacenarlas en un almacén de configuración centralizado.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-113">The best practice is store them in a centralized configuration store.</span></span>

<span data-ttu-id="a7c0b-114">La nube de Azure presenta varias opciones excelentes.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-114">The Azure cloud presents several great options.</span></span>

## <a name="azure-app-configuration"></a><span data-ttu-id="a7c0b-115">Azure App Configuration</span><span class="sxs-lookup"><span data-stu-id="a7c0b-115">Azure App Configuration</span></span>

<span data-ttu-id="a7c0b-116">[App de Azure configuración](https://docs.microsoft.com/azure/azure-app-configuration/overview) es un servicio de Azure totalmente administrado que almacena la configuración no secreta en una ubicación segura y centralizada.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-116">[Azure App Configuration](https://docs.microsoft.com/azure/azure-app-configuration/overview) is a fully managed Azure service that stores non-secret configuration settings in a secure, centralized location.</span></span> <span data-ttu-id="a7c0b-117">Los valores almacenados se pueden compartir entre varios servicios y aplicaciones.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-117">Stored values can be shared among multiple services and applications.</span></span>

<span data-ttu-id="a7c0b-118">El servicio es fácil de usar y proporciona varias ventajas:</span><span class="sxs-lookup"><span data-stu-id="a7c0b-118">The service is simple to use and provides several benefits:</span></span>

- <span data-ttu-id="a7c0b-119">Asignaciones y representaciones de claves/valores flexibles</span><span class="sxs-lookup"><span data-stu-id="a7c0b-119">Flexible key/value representations and mappings</span></span>
- <span data-ttu-id="a7c0b-120">Etiquetado con etiquetas de Azure</span><span class="sxs-lookup"><span data-stu-id="a7c0b-120">Tagging with Azure labels</span></span>
- <span data-ttu-id="a7c0b-121">Interfaz de usuario dedicada para administración</span><span class="sxs-lookup"><span data-stu-id="a7c0b-121">Dedicated UI for management</span></span>
- <span data-ttu-id="a7c0b-122">Cifrado de información confidencial</span><span class="sxs-lookup"><span data-stu-id="a7c0b-122">Encryption of sensitive information</span></span>
- <span data-ttu-id="a7c0b-123">Consultas y recuperación por lotes</span><span class="sxs-lookup"><span data-stu-id="a7c0b-123">Querying and batch retrieval</span></span>

<span data-ttu-id="a7c0b-124">La configuración de App de Azure mantiene los cambios realizados en la configuración de clave-valor durante siete días.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-124">Azure App Configuration maintains changes made to key-value settings for seven days.</span></span> <span data-ttu-id="a7c0b-125">La característica de instantánea de un momento dado permite reconstruir el historial de una configuración e incluso revertirla para una implementación con errores.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-125">The point-in-time snapshot feature enables you to reconstruct the history of a setting and even rollback for a failed deployment.</span></span>

<span data-ttu-id="a7c0b-126">La configuración de la aplicación almacena automáticamente en caché cada configuración para evitar demasiadas llamadas al almacén de configuración.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-126">App Configuration automatically caches each setting to avoid excessive calls to the configuration store.</span></span> <span data-ttu-id="a7c0b-127">La operación de actualización espera hasta que el valor de una opción almacenada en la caché expira y, después, actualiza ese valor, incluso aunque este haya cambiado ya en el almacén de configuración.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-127">The refresh operation waits until the cached value of a setting expires to update that setting, even when its value changes in the configuration store.</span></span> <span data-ttu-id="a7c0b-128">El tiempo de expiración predeterminado de la memoria caché es de 30 segundos.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-128">The default cache expiration time is 30 seconds.</span></span> <span data-ttu-id="a7c0b-129">Puede invalidar la hora de expiración.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-129">You can override the expiration time.</span></span>

<span data-ttu-id="a7c0b-130">La configuración de la aplicación cifra todos los valores de configuración en tránsito y en reposo.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-130">App Configuration encrypts all configuration values in transit and at rest.</span></span> <span data-ttu-id="a7c0b-131">Los nombres de clave y las etiquetas se usan como índices para recuperar los datos de configuración y no se cifran.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-131">Key names and labels are used as indexes for retrieving configuration data and aren't encrypted.</span></span>

<span data-ttu-id="a7c0b-132">Aunque la configuración de la aplicación proporciona seguridad protegida, Azure Key Vault sigue siendo el mejor lugar para almacenar los secretos de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-132">Although App Configuration provides hardened security, Azure Key Vault is still the best place for storing application secrets.</span></span> <span data-ttu-id="a7c0b-133">Key Vault proporciona cifrado de nivel de hardware, directivas de acceso granular y operaciones de administración, como la rotación de certificados.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-133">Key Vault provides hardware-level encryption, granular access policies, and management operations such as certificate rotation.</span></span> <span data-ttu-id="a7c0b-134">Puede crear valores de configuración de aplicaciones que hagan referencia a secretos almacenados en un Key Vault.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-134">You can create App Configuration values that reference secrets stored in a Key Vault.</span></span>

## <a name="azure-key-vault"></a><span data-ttu-id="a7c0b-135">Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="a7c0b-135">Azure Key Vault</span></span>

<span data-ttu-id="a7c0b-136">Key Vault es un servicio administrado para almacenar y obtener acceso a secretos de forma segura.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-136">Key Vault is a managed service for securely storing and accessing secrets.</span></span> <span data-ttu-id="a7c0b-137">Un secreto es todo aquello a lo cual se desea controlar estrechamente el acceso, como certificados, contraseñas o claves de API.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-137">A secret is anything that you want to tightly control access to, such as API keys, passwords, or certificates.</span></span> <span data-ttu-id="a7c0b-138">Un almacén es un grupo lógico de secretos.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-138">A vault is a logical group of secrets.</span></span>

<span data-ttu-id="a7c0b-139">Key Vault reduce en gran medida las posibilidades de que se puedan filtrar por accidente los secretos.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-139">Key Vault greatly reduces the chances that secrets may be accidentally leaked.</span></span> <span data-ttu-id="a7c0b-140">Cuando usan Key Vault, los desarrolladores de aplicaciones ya no tienen que almacenar la información de seguridad en su aplicación.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-140">When using Key Vault, application developers no longer need to store security information in their application.</span></span> <span data-ttu-id="a7c0b-141">Esta práctica elimina la necesidad de almacenar esta información dentro del código.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-141">This practice eliminates the need to store this information inside your code.</span></span> <span data-ttu-id="a7c0b-142">Por ejemplo, puede que una aplicación necesite conectarse a una base de datos.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-142">For example, an application may need to connect to a database.</span></span> <span data-ttu-id="a7c0b-143">En lugar de almacenar la cadena de conexión en el código de la aplicación, puede almacenarla de forma segura en Key Vault.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-143">Instead of storing the connection string in the app's code, you can store it securely in Key Vault.</span></span>

<span data-ttu-id="a7c0b-144">Las aplicaciones pueden acceder de manera protegida a la información que necesitan a través de URI.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-144">Your applications can securely access the information they need by using URIs.</span></span> <span data-ttu-id="a7c0b-145">Estos URI permiten que las aplicaciones recuperen versiones específicas de un secreto.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-145">These URIs allow the applications to retrieve specific versions of a secret.</span></span> <span data-ttu-id="a7c0b-146">No es necesario escribir código personalizado para proteger la información secreta almacenada en Key Vault.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-146">There's no need to write custom code to protect any of the secret information stored in Key Vault.</span></span>

<span data-ttu-id="a7c0b-147">El acceso a Key Vault requiere la autenticación y autorización adecuadas del llamador.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-147">Access to Key Vault requires proper caller authentication and authorization.</span></span> <span data-ttu-id="a7c0b-148">Normalmente, cada microservicio nativo de la nube usa una combinación de ClientId/ClientSecret.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-148">Typically, each cloud-native microservice uses a ClientId/ClientSecret combination.</span></span> <span data-ttu-id="a7c0b-149">Es importante mantener estas credenciales fuera del control de código fuente.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-149">It's important to keep these credentials outside source control.</span></span> <span data-ttu-id="a7c0b-150">Un procedimiento recomendado es establecerlos en el entorno de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-150">A best practice is to set them in  the application's environment.</span></span> <span data-ttu-id="a7c0b-151">El acceso directo a Key Vault desde AKS se puede lograr mediante [key Vault FlexVolume](https://github.com/Azure/kubernetes-keyvault-flexvol).</span><span class="sxs-lookup"><span data-stu-id="a7c0b-151">Direct access to Key Vault from AKS can be achieved using [Key Vault FlexVolume](https://github.com/Azure/kubernetes-keyvault-flexvol).</span></span>

## <a name="configuration-in-eshop"></a><span data-ttu-id="a7c0b-152">Configuración en eShop</span><span class="sxs-lookup"><span data-stu-id="a7c0b-152">Configuration in eShop</span></span>

<span data-ttu-id="a7c0b-153">La aplicación eShopOnContainers incluye los archivos de configuración de la aplicación local con cada microservicio.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-153">The eShopOnContainers application includes local application settings files with each microservice.</span></span> <span data-ttu-id="a7c0b-154">Estos archivos se protegen en el control de código fuente, pero no incluyen secretos de producción, como cadenas de conexión o claves de API.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-154">These files are checked into source control, but don't include production secrets such as connection strings or API keys.</span></span> <span data-ttu-id="a7c0b-155">En producción, se puede sobrescribir la configuración individual con variables de entorno por servicio.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-155">In production, individual settings may be overwritten with per-service environment variables.</span></span> <span data-ttu-id="a7c0b-156">Insertar secretos en variables de entorno es una práctica común para las aplicaciones hospedadas, pero no proporciona un almacén de configuración central.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-156">Injecting secrets in environment variables is a common practice for hosted applications, but doesn't provide a central configuration store.</span></span> <span data-ttu-id="a7c0b-157">Para admitir la administración centralizada de las opciones de configuración, cada microservicio incluye una configuración para alternar entre el uso de la configuración local o la configuración de Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="a7c0b-157">To support centralized management of configuration settings, each microservice includes a setting to toggle between its use of local settings or Azure Key Vault settings.</span></span>

## <a name="references"></a><span data-ttu-id="a7c0b-158">Referencias</span><span class="sxs-lookup"><span data-stu-id="a7c0b-158">References</span></span>

- [<span data-ttu-id="a7c0b-159">Arquitectura de eShopOnContainers</span><span class="sxs-lookup"><span data-stu-id="a7c0b-159">The eShopOnContainers Architecture</span></span>](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Architecture)
- [<span data-ttu-id="a7c0b-160">Orquestación de microservicios y aplicaciones de varios contenedores para una alta escalabilidad y disponibilidad</span><span class="sxs-lookup"><span data-stu-id="a7c0b-160">Orchestrating microservices and multi-container applications for high scalability and availability</span></span>](https://docs.microsoft.com/dotnet/architecture/microservices/architect-microservice-container-applications/scalable-available-multi-container-microservice-applications)
- [<span data-ttu-id="a7c0b-161">Azure API Management</span><span class="sxs-lookup"><span data-stu-id="a7c0b-161">Azure API Management</span></span>](https://docs.microsoft.com/azure/api-management/api-management-key-concepts)
- [<span data-ttu-id="a7c0b-162">Información general de Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="a7c0b-162">Azure SQL Database Overview</span></span>](https://docs.microsoft.com/azure/sql-database/sql-database-technical-overview)
- [<span data-ttu-id="a7c0b-163">Azure Cache for Redis</span><span class="sxs-lookup"><span data-stu-id="a7c0b-163">Azure Cache for Redis</span></span>](https://azure.microsoft.com/services/cache/)
- [<span data-ttu-id="a7c0b-164">API de Azure Cosmos DB para MongoDB</span><span class="sxs-lookup"><span data-stu-id="a7c0b-164">Azure Cosmos DB's API for MongoDB</span></span>](https://docs.microsoft.com/azure/cosmos-db/mongodb-introduction)
- [<span data-ttu-id="a7c0b-165">Azure Service Bus</span><span class="sxs-lookup"><span data-stu-id="a7c0b-165">Azure Service Bus</span></span>](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-messaging-overview)
- [<span data-ttu-id="a7c0b-166">Introducción a Azure Monitor</span><span class="sxs-lookup"><span data-stu-id="a7c0b-166">Azure Monitor overview</span></span>](https://docs.microsoft.com/azure/azure-monitor/overview)
- <span data-ttu-id="a7c0b-167">[eShopOnContainers: creación de un clúster de Kubernetes en AKS](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Deploy-to-Azure-Kubernetes-Service-(AKS)#create-kubernetes-cluster-in-aks)</span><span class="sxs-lookup"><span data-stu-id="a7c0b-167">[eShopOnContainers: Create Kubernetes cluster in AKS](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Deploy-to-Azure-Kubernetes-Service-(AKS)#create-kubernetes-cluster-in-aks)</span></span>
- [<span data-ttu-id="a7c0b-168">eShopOnContainers: Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="a7c0b-168">eShopOnContainers: Azure Dev Spaces</span></span>](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Azure-Dev-Spaces)
- [<span data-ttu-id="a7c0b-169">Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="a7c0b-169">Azure Dev Spaces</span></span>](https://docs.microsoft.com/azure/dev-spaces/about)

>[!div class="step-by-step"]
><span data-ttu-id="a7c0b-170">[Anterior](deploy-eshoponcontainers-azure.md)
>[Siguiente](scale-applications.md)</span><span class="sxs-lookup"><span data-stu-id="a7c0b-170">[Previous](deploy-eshoponcontainers-azure.md)
[Next](scale-applications.md)</span></span>
