---
title: Estrategias para migrar con la ejecución en producción
description: Es posible que no se tenable migrar una aplicación grande desde ASP.NET MVC a ASP.NET Core todas a la vez. Aprenda algunas estrategias para migrar una aplicación a ASP.NET Core mientras se mantiene en ejecución y en producción para los usuarios existentes.
author: ardalis
ms.date: 11/13/2020
ms.openlocfilehash: 4910984cb281139493aa5424809ba3eedab776e9
ms.sourcegitcommit: 42d436ebc2a7ee02fc1848c7742bc7d80e13fc2f
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 03/04/2021
ms.locfileid: "102401692"
---
# <a name="strategies-for-migrating-while-running-in-production"></a><span data-ttu-id="7c7a1-104">Estrategias para migrar con la ejecución en producción</span><span class="sxs-lookup"><span data-stu-id="7c7a1-104">Strategies for migrating while running in production</span></span>

<span data-ttu-id="7c7a1-105">Muchos equipos tienen .NET Framework aplicaciones que planean migrar a .NET Core, pero la aplicación es tan grande que la migración requiere una cantidad de tiempo considerable para completarse.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-105">Many teams have .NET Framework apps they plan to migrate to .NET Core, but the app is so large that the migration requires a significant amount of time to complete.</span></span> <span data-ttu-id="7c7a1-106">La aplicación original debe vivir mientras la migración se realiza por parte.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-106">The original app needs to live on while the migration is done piece by piece.</span></span> <span data-ttu-id="7c7a1-107">Debe haber una manera de que las versiones antiguas y nuevas de la aplicación funcionen juntas en paralelo, o para que la versión anterior se migre en contexto, al menos parte del proceso, sin interrumpirla.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-107">There needs to be a way for the old and new versions of the app to work together side-by-side, or for the old version to be migrated in-place, at least some of the way, without breaking it.</span></span> <span data-ttu-id="7c7a1-108">Los equipos pueden emplear muchas estrategias distintas para admitir estos objetivos.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-108">Teams can employ many different strategies to support these goals.</span></span>

## <a name="refactor-the-net-framework-solution"></a><span data-ttu-id="7c7a1-109">Refactorizar la solución .NET Framework</span><span class="sxs-lookup"><span data-stu-id="7c7a1-109">Refactor the .NET Framework solution</span></span>

<span data-ttu-id="7c7a1-110">Un buen punto de partida si tiene previsto migrar una aplicación .NET Framework a .NET Core es refactorizarla para que funcione mejor con .NET Core.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-110">A good place to start if you plan to port a .NET Framework app to .NET Core is to refactor it to work better with .NET Core.</span></span> <span data-ttu-id="7c7a1-111">Esto significa actualizar bibliotecas de clases individuales a .NET Standard de destino y mover la lógica de sus proyectos de MVC de ASP.NET y a estas bibliotecas de clases.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-111">This means updating individual class libraries to target .NET Standard and moving as much logic out of your ASP.NET MVC projects and into these class libraries.</span></span> <span data-ttu-id="7c7a1-112">Cualquier código que tenga en .NET Standard bibliotecas debe moverse de .NET Framework a .NET Core.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-112">Any code you have in .NET Standard libraries should move relatively easily from .NET Framework to .NET Core.</span></span>

<span data-ttu-id="7c7a1-113">Al refactorizar, asegúrese de seguir los buenos aspectos básicos de refactorización.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-113">When refactoring, make sure you're following good refactoring fundamentals.</span></span> <span data-ttu-id="7c7a1-114">Por ejemplo, cree pruebas que comprueben lo que hace el sistema antes de iniciar la refactorización.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-114">For example, create tests that verify what the system does before you start refactoring.</span></span> <span data-ttu-id="7c7a1-115">Ejecute estas pruebas cuando haya terminado de confirmar que no ha cambiado el comportamiento del sistema.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-115">Run these tests when you're done to confirm you didn't change the system's behavior.</span></span> <span data-ttu-id="7c7a1-116">Es posible que tenga que agregar pruebas de caracterización al sistema si aún no tiene un buen conjunto de pruebas automatizadas de las que puede confiar.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-116">You may need to add characterization tests to the system if you don't already have a good suite of automated tests you can rely on.</span></span>

## <a name="extract-front-end-assets-to-a-cdn"></a><span data-ttu-id="7c7a1-117">Extraer recursos de front-end a una red CDN</span><span class="sxs-lookup"><span data-stu-id="7c7a1-117">Extract front-end assets to a CDN</span></span>

<span data-ttu-id="7c7a1-118">Si las aplicaciones .NET Framework incluyen muchos recursos estáticos, como scripts, archivos CSS o imágenes, es posible que pueda migrarlos a una red CDN independiente.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-118">If your .NET Framework apps include a lot of static assets, like scripts, CSS files, or images, you may be able to migrate these to a separate CDN.</span></span> <span data-ttu-id="7c7a1-119">A continuación, actualice la aplicación existente para que haga referencia a los vínculos de la red CDN para estos recursos.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-119">Then, update the existing app to reference the CDN links for these assets.</span></span> <span data-ttu-id="7c7a1-120">Al migrar la aplicación a .NET Core, estos archivos estáticos no formarán parte de la migración y simplemente seguirá haciendo referencia a ellos desde la red CDN en la aplicación ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-120">When you port the app to .NET Core, these static files won't be part of the migration, and you'll just continue referencing them from the CDN in the ASP.NET Core app.</span></span>

## <a name="extract-and-migrate-individual-microservices"></a><span data-ttu-id="7c7a1-121">Extraer y migrar microservicios individuales</span><span class="sxs-lookup"><span data-stu-id="7c7a1-121">Extract and migrate individual microservices</span></span>

<span data-ttu-id="7c7a1-122">Es posible que las aplicaciones de gran .NET Framework ya consten de sistemas front-end independientes que se pueden migrar de forma individual.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-122">Large .NET Framework apps may already be comprised of separate front-end systems that can be migrated individually.</span></span> <span data-ttu-id="7c7a1-123">O bien, pueden ser candidatas para la migración a una arquitectura de microservicios, con algunas partes de las aplicaciones de ASP.NET MVC existentes que se extraen en nuevas implementaciones de microservicios de ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-123">Or they may be candidates for migration to a microservices architecture, with some pieces of existing ASP.NET MVC apps being pulled out into new ASP.NET Core microservice implementations.</span></span> <span data-ttu-id="7c7a1-124">Puede obtener más información sobre los microservicios en el libro electrónico asociado, [microservicios de .net: arquitectura para aplicaciones .net en contenedor](https://aka.ms/microservicesebook).</span><span class="sxs-lookup"><span data-stu-id="7c7a1-124">You can learn more about microservices in the associated ebook, [.NET Microservices: Architecture for Containerized .NET Applications](https://aka.ms/microservicesebook).</span></span>

<span data-ttu-id="7c7a1-125">Por ejemplo, la aplicación existente podría tener un conjunto de características que usa relacionado con el registro y el inicio de sesión de usuario.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-125">For example, the existing app might have a set of features it uses related to user sign-in and registration.</span></span> <span data-ttu-id="7c7a1-126">Se pueden migrar a un microservicio independiente, que podría compilarse e implementarse mediante ASP.NET Core y, a continuación, integrarse en la aplicación de .NET Framework heredada.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-126">These could be migrated to a separate microservice, which could be built and deployed using ASP.NET Core and then integrated into the legacy .NET Framework app.</span></span> <span data-ttu-id="7c7a1-127">A continuación, la aplicación podría tener algunas páginas dedicadas a realizar el seguimiento del carro de la compra del usuario individual.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-127">Next, the app might have a few pages dedicated to tracking the individual user's shopping cart.</span></span> <span data-ttu-id="7c7a1-128">Estas páginas también se podrían extraer en su propio microservicio independiente y volver a integrarse en la aplicación existente.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-128">These pages could also be pulled out into their own separate microservice and again integrated into the existing app.</span></span> <span data-ttu-id="7c7a1-129">De esta manera, la aplicación de .NET Framework original continúa ejecutándose en producción, pero con más y más características procedentes de microservicios de .NET Core modernizados.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-129">In this way, the original .NET Framework app continues running in production, but with more and more of its features coming from modernized .NET Core microservices.</span></span>

## <a name="deploy-multiple-versions-of-the-app-side-by-side-in-iis"></a><span data-ttu-id="7c7a1-130">Implementar varias versiones de la aplicación en paralelo en IIS</span><span class="sxs-lookup"><span data-stu-id="7c7a1-130">Deploy multiple versions of the app side-by-side in IIS</span></span>

<span data-ttu-id="7c7a1-131">Mediante una combinación de encabezados y redirecciones de host, se puede configurar una aplicación ASP.NET MVC existente para que se ejecute en paralelo con una aplicación ASP.NET Core en el mismo servidor IIS.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-131">Using a combination of host headers and redirects, an existing ASP.NET MVC app can be configured to run side by side with an ASP.NET Core app on the same IIS server.</span></span> <span data-ttu-id="7c7a1-132">Como los elementos de funcionalidad, como los controladores individuales, se trasladan a ASP.NET Core, sus rutas y direcciones URL se asignan en IIS para tener como destino el ASP.NET Core sitio web o la subaplicación (no se admiten los directorios virtuales de IIS con ASP.NET Core aplicaciones).</span><span class="sxs-lookup"><span data-stu-id="7c7a1-132">As pieces of functionality, such as individual controllers, are ported to ASP.NET Core, their routes and URLs are mapped within IIS to target the ASP.NET Core web site or sub-application (IIS virtual directories aren't supported with ASP.NET Core apps).</span></span> <span data-ttu-id="7c7a1-133">Se puede hospedar una aplicación ASP.NET Core como una subaplicación IIS.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-133">An ASP.NET Core app can be hosted as an IIS sub-application (sub-app).</span></span> <span data-ttu-id="7c7a1-134">La ruta de acceso de la subaplicación se convierte en parte de la dirección URL de la aplicación raíz.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-134">The sub-app's path becomes part of the root app's URL.</span></span>

## <a name="apply-the-strangler-pattern"></a><span data-ttu-id="7c7a1-135">Aplicar el patrón STRANGLER</span><span class="sxs-lookup"><span data-stu-id="7c7a1-135">Apply the Strangler pattern</span></span>

<span data-ttu-id="7c7a1-136">Las aplicaciones grandes de ASP.NET MVC se pueden reemplazar gradualmente por una nueva ASP.NET Core aplicación mediante la migración incremental de partes de la funcionalidad.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-136">Large ASP.NET MVC apps can be gradually replaced with a new ASP.NET Core app by incrementally migrating pieces of functionality.</span></span> <span data-ttu-id="7c7a1-137">Un enfoque a esto se denomina [patrón STRANGLER](/azure/architecture/patterns/strangler), denominado para STRANGLER Vines que Strangle y que finalmente anulan árboles.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-137">One approach to this is called the [strangler pattern](/azure/architecture/patterns/strangler), named for strangler vines that strangle and eventually tear down trees.</span></span> <span data-ttu-id="7c7a1-138">Este enfoque se basa en la primera implementación de una capa de fachada en la parte superior de la solución existente.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-138">This approach relies on first implementing a facade layer over top of the existing solution.</span></span> <span data-ttu-id="7c7a1-139">Esta fachada debe compilarse con el nuevo enfoque del problema o con una solución de uso como, por ejemplo, una puerta de enlace de API.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-139">This facade should be built using the new approach to the problem, or an off-the-shelf solution such as an API gateway.</span></span>

<span data-ttu-id="7c7a1-140">Una vez que la fachada está en su lugar, puede redirigirla a una nueva ASP.NET Core aplicación.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-140">Once the facade is in place, you can route part of it to a new ASP.NET Core app.</span></span> <span data-ttu-id="7c7a1-141">Al trasladar más la aplicación de .NET Framework original a .NET Core, sigue actualizando la capa de fachada en consecuencia, enviando más de la funcionalidad total de façade's al nuevo sistema.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-141">As you port more of the original .NET Framework app to .NET Core, you continue to update the facade layer accordingly, sending more of the facade's total functionality to the new system.</span></span> <span data-ttu-id="7c7a1-142">En la figura 3-5 se muestra la progresión del patrón STRANGLER a lo largo del tiempo.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-142">Figure 3-5 shows the strangler pattern progression over time.</span></span>

## <a name="multi-targeting-approaches"></a><span data-ttu-id="7c7a1-143">Enfoques de compatibilidad con múltiples versiones</span><span class="sxs-lookup"><span data-stu-id="7c7a1-143">Multi-targeting approaches</span></span>

<span data-ttu-id="7c7a1-144">Las aplicaciones de gran tamaño que tienen como destino .NET Framework se pueden migrar a ASP.NET Core con el tiempo mediante la compatibilidad con múltiples versiones y rutas de acceso de código independientes para cada marco.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-144">Large apps that target .NET Framework may be migrated to ASP.NET Core over time by using multi-targeting and separate code paths for each framework.</span></span> <span data-ttu-id="7c7a1-145">Por ejemplo, el código que se debe ejecutar en ambos entornos podría modificarse con directivas de [preprocesador `#if` ](../../csharp/language-reference/preprocessor-directives/preprocessor-if.md) para implementar una funcionalidad diferente o usar diferentes dependencias cuando se ejecuten en .NET Framework frente a .net Core.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-145">For example, code that must run in both environments could be modified with [preprocessor `#if`](../../csharp/language-reference/preprocessor-directives/preprocessor-if.md) directives to implement different functionality or use different dependencies when run in .NET Framework versus .NET Core.</span></span> <span data-ttu-id="7c7a1-146">Otra opción consiste en modificar los archivos de proyecto para incluir diferentes conjuntos de archivos en función de la plataforma de destino.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-146">Another option is to modify project files to include different sets of files based on which framework is being targeted.</span></span> <span data-ttu-id="7c7a1-147">Los archivos de proyecto pueden usar diferentes patrones de comodines, como `*.core.cs` , para incluir diferentes conjuntos de archivos de código fuente en función del marco de destino.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-147">Project files can use different globbing patterns, such as `*.core.cs`, to include different sets of source files depending on the framework being targeted.</span></span>

<span data-ttu-id="7c7a1-148">Estas técnicas permiten que se mantenga un solo código base común mientras se agrega una nueva funcionalidad y (parte de) la aplicación se transporta para usar .NET Core.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-148">These techniques allow a single common codebase to be maintained while new functionality is added and (parts of) the app are ported to use .NET Core.</span></span>

![Figura 3-5](media/Figure3-5.png)

<span data-ttu-id="7c7a1-150">**Figura 3-5.**</span><span class="sxs-lookup"><span data-stu-id="7c7a1-150">**Figure 3-5.**</span></span> <span data-ttu-id="7c7a1-151">Patrón STRANGLER a lo largo del tiempo.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-151">The Strangler pattern over time.</span></span>

<span data-ttu-id="7c7a1-152">Finalmente, la capa de fachada completa corresponde a la nueva implementación moderna.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-152">Eventually, the entire facade layer corresponds to the new, modern implementation.</span></span> <span data-ttu-id="7c7a1-153">En este momento, se pueden retirar tanto el sistema heredado como la capa de caras.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-153">At this point, both the legacy system and the face layer can be retired.</span></span>

## <a name="summary"></a><span data-ttu-id="7c7a1-154">Resumen</span><span class="sxs-lookup"><span data-stu-id="7c7a1-154">Summary</span></span>

<span data-ttu-id="7c7a1-155">Con frecuencia, las aplicaciones de API de web y MVC de gran tamaño de ASP.NET no se trasladarán a una sola vez, sino ASP.NET Core que se migrarán de forma incremental a lo largo del tiempo.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-155">Frequently, large ASP.NET MVC and Web API apps won't be ported to ASP.NET Core all at once, but will migrate incrementally over time.</span></span> <span data-ttu-id="7c7a1-156">En esta sección se ofrecen varias estrategias para realizar esta migración incremental.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-156">This section offers several strategies for performing this incremental migration.</span></span> <span data-ttu-id="7c7a1-157">Elija el que mejor se adapte a su organización y aplicación.</span><span class="sxs-lookup"><span data-stu-id="7c7a1-157">Choose the one(s) that will work best for your organization and app.</span></span>

## <a name="references"></a><span data-ttu-id="7c7a1-158">Referencias</span><span class="sxs-lookup"><span data-stu-id="7c7a1-158">References</span></span>

- [<span data-ttu-id="7c7a1-159">Microservicios de .NET: arquitectura para aplicaciones .NET en contenedor</span><span class="sxs-lookup"><span data-stu-id="7c7a1-159">.NET Microservices: Architecture for Containerized .NET Applications</span></span>](https://aka.ms/microservicesebook)
- [<span data-ttu-id="7c7a1-160">Aplicación de microservicios de referencia de eShopOnContainers</span><span class="sxs-lookup"><span data-stu-id="7c7a1-160">eShopOnContainers Reference Microservices Application</span></span>](https://github.com/dotnet-architecture/eShopOnContainers)
- [<span data-ttu-id="7c7a1-161">Hospedaje de ASP.NET Core en Windows con IIS</span><span class="sxs-lookup"><span data-stu-id="7c7a1-161">Host ASP.NET Core on Windows with IIS</span></span>](/aspnet/core/host-and-deploy/iis/)
- [<span data-ttu-id="7c7a1-162">Patrón Strangler</span><span class="sxs-lookup"><span data-stu-id="7c7a1-162">Strangler pattern</span></span>](/azure/architecture/patterns/strangler)

>[!div class="step-by-step"]
><span data-ttu-id="7c7a1-163">[Anterior](understand-update-dependencies.md)
>[Siguiente](example-migration-eshop.md)</span><span class="sxs-lookup"><span data-stu-id="7c7a1-163">[Previous](understand-update-dependencies.md)
[Next](example-migration-eshop.md)</span></span>
