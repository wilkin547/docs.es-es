---
title: Análisis de opiniones mediante la CLI de ML.NET
description: Generar automáticamente un modelo de ML y el código de C# relacionado desde un conjunto de datos de ejemplo
author: cesardl
ms.author: cesardl
ms.date: 06/03/2020
ms.custom: mvc,mlnet-tooling
ms.topic: tutorial
ms.openlocfilehash: 47c38bb0b66a6fc08dd319583847dd83baedcd1e
ms.sourcegitcommit: 42d436ebc2a7ee02fc1848c7742bc7d80e13fc2f
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 03/04/2021
ms.locfileid: "102103704"
---
# <a name="analyze-sentiment-using-the-mlnet-cli"></a><span data-ttu-id="5e844-103">Análisis de opiniones mediante la CLI de ML.NET</span><span class="sxs-lookup"><span data-stu-id="5e844-103">Analyze sentiment using the ML.NET CLI</span></span>

<span data-ttu-id="5e844-104">Aprenda a usar la CLI de ML.NET para generar automáticamente un modelo de ML.NET y el código de C# subyacente.</span><span class="sxs-lookup"><span data-stu-id="5e844-104">Learn how to use ML.NET CLI to automatically generate an ML.NET model and underlying C# code.</span></span> <span data-ttu-id="5e844-105">Usted proporciona el conjunto de datos y la tarea de aprendizaje automático que quiere implementar, y la CLI utiliza el motor de AutoML para crear el código fuente de implementación y generación de modelos, así como el modelo de clasificación.</span><span class="sxs-lookup"><span data-stu-id="5e844-105">You provide your dataset and the machine learning task you want to implement, and the CLI uses the AutoML engine to create model generation and deployment source code, as well as the classification model.</span></span>

<span data-ttu-id="5e844-106">En este tutorial, llevará a cabo los pasos siguientes:</span><span class="sxs-lookup"><span data-stu-id="5e844-106">In this tutorial, you will do the following steps:</span></span>
> [!div class="checklist"]
>
> - <span data-ttu-id="5e844-107">Preparar los datos para la tarea de aprendizaje automático seleccionada</span><span class="sxs-lookup"><span data-stu-id="5e844-107">Prepare your data for the selected machine learning task</span></span>
> - <span data-ttu-id="5e844-108">Ejecución del comando "mlnet classification" desde la CLI</span><span class="sxs-lookup"><span data-stu-id="5e844-108">Run the 'mlnet classification' command from the CLI</span></span>
> - <span data-ttu-id="5e844-109">Revisar los resultados de métrica de calidad</span><span class="sxs-lookup"><span data-stu-id="5e844-109">Review the quality metric results</span></span>
> - <span data-ttu-id="5e844-110">Comprender el código de C# generado para usar el modelo en la aplicación</span><span class="sxs-lookup"><span data-stu-id="5e844-110">Understand the generated C# code to use the model in your application</span></span>
> - <span data-ttu-id="5e844-111">Explorar el código de C# generado que se usó para entrenar el modelo</span><span class="sxs-lookup"><span data-stu-id="5e844-111">Explore the generated C# code that was used to train the model</span></span>

> [!NOTE]
> <span data-ttu-id="5e844-112">Este tema hace referencia a la herramienta de la CLI de ML.NET, que se encuentra actualmente en versión preliminar, por lo que el material está sujeto a cambios.</span><span class="sxs-lookup"><span data-stu-id="5e844-112">This topic refers to the ML.NET CLI tool, which is currently in Preview, and material may be subject to change.</span></span> <span data-ttu-id="5e844-113">Para obtener más información, visite la página de [ML.NET](https://dotnet.microsoft.com/apps/machinelearning-ai/ml-dotnet).</span><span class="sxs-lookup"><span data-stu-id="5e844-113">For more information, visit the [ML.NET](https://dotnet.microsoft.com/apps/machinelearning-ai/ml-dotnet) page.</span></span>

<span data-ttu-id="5e844-114">La CLI de ML.NET forma parte de ML.NET y su objetivo principal es "democratizar" ML.NET para desarrolladores de .NET durante el aprendizaje de ML.NET, por lo que no es necesario codificar desde cero para empezar a trabajar.</span><span class="sxs-lookup"><span data-stu-id="5e844-114">The ML.NET CLI is part of ML.NET and its main goal is to "democratize" ML.NET for .NET developers when learning ML.NET so you don't need to code from scratch to get started.</span></span>

<span data-ttu-id="5e844-115">Puede ejecutar la CLI de ML.NET en cualquier símbolo del sistema (Windows, Mac o Linux) para generar modelos de ML.NET de buena calidad y el código fuente basado en los conjuntos de datos de entrenamiento que proporcione.</span><span class="sxs-lookup"><span data-stu-id="5e844-115">You can run the ML.NET CLI on any command-prompt (Windows, Mac, or Linux) to generate good quality ML.NET models and source code based on training datasets you provide.</span></span>

## <a name="pre-requisites"></a><span data-ttu-id="5e844-116">Requisitos previos</span><span class="sxs-lookup"><span data-stu-id="5e844-116">Pre-requisites</span></span>

- <span data-ttu-id="5e844-117">[SDK de .NET Core 3.1](https://dotnet.microsoft.com/download/dotnet/3.1) o versiones posteriores</span><span class="sxs-lookup"><span data-stu-id="5e844-117">[.NET Core 3.1 SDK](https://dotnet.microsoft.com/download/dotnet/3.1) or later</span></span>
- <span data-ttu-id="5e844-118">(Opcional) [Visual Studio 2019](https://visualstudio.microsoft.com/vs/)</span><span class="sxs-lookup"><span data-stu-id="5e844-118">(Optional) [Visual Studio 2019](https://visualstudio.microsoft.com/vs/)</span></span>
- [<span data-ttu-id="5e844-119">CLI de ML.NET</span><span class="sxs-lookup"><span data-stu-id="5e844-119">ML.NET CLI</span></span>](../how-to-guides/install-ml-net-cli.md)

<span data-ttu-id="5e844-120">Puede ejecutar los proyectos del código de C# generado desde Visual Studio o con `dotnet run` (CLI de .NET Core).</span><span class="sxs-lookup"><span data-stu-id="5e844-120">You can either run the generated C# code projects from Visual Studio or with `dotnet run` (.NET Core CLI).</span></span>

## <a name="prepare-your-data"></a><span data-ttu-id="5e844-121">Preparar los datos</span><span class="sxs-lookup"><span data-stu-id="5e844-121">Prepare your data</span></span>

<span data-ttu-id="5e844-122">Vamos a usar un conjunto de datos existente utilizado para un escenario de "análisis de sentimiento", que es una tarea de aprendizaje automático de clasificación binaria.</span><span class="sxs-lookup"><span data-stu-id="5e844-122">We are going to use an existing dataset used for a 'Sentiment Analysis' scenario, which is a binary classification machine learning task.</span></span> <span data-ttu-id="5e844-123">Puede usar su propio conjunto de datos de forma similar, y el modelo y el código se generarán automáticamente.</span><span class="sxs-lookup"><span data-stu-id="5e844-123">You can use your own dataset in a similar way, and the model and code will be generated for you.</span></span>

1. <span data-ttu-id="5e844-124">Descargue el [archivo ZIP del conjunto de datos UCI Sentiment Labeled Sentences (vea la referencia en la nota siguiente)](http://archive.ics.uci.edu/ml/machine-learning-databases/00331/sentiment%20labelled%20sentences.zip) y descomprímalo en la carpeta de su elección.</span><span class="sxs-lookup"><span data-stu-id="5e844-124">Download [The UCI Sentiment Labeled Sentences dataset zip file (see citations in the following note)](http://archive.ics.uci.edu/ml/machine-learning-databases/00331/sentiment%20labelled%20sentences.zip), and unzip it on any folder you choose.</span></span>

    > [!NOTE]
    > <span data-ttu-id="5e844-125">Los conjuntos de datos que se utilizan en este tutorial provienen de "From Group to Individual Labels using Deep Features", Kotzias et. al.,</span><span class="sxs-lookup"><span data-stu-id="5e844-125">The datasets this tutorial uses a dataset from the 'From Group to Individual Labels using Deep Features', Kotzias et al,.</span></span> <span data-ttu-id="5e844-126">KDD 2015, and hosted at the UCI Machine Learning Repository - Dua, D. and Karra Taniskidou, E. (2017).</span><span class="sxs-lookup"><span data-stu-id="5e844-126">KDD 2015, and hosted at the UCI Machine Learning Repository - Dua, D. and Karra Taniskidou, E. (2017).</span></span> <span data-ttu-id="5e844-127">UCI Machine Learning Repository [http://archive.ics.uci.edu/ml ].</span><span class="sxs-lookup"><span data-stu-id="5e844-127">UCI Machine Learning Repository [http://archive.ics.uci.edu/ml].</span></span> <span data-ttu-id="5e844-128">Irvine, CA: University of California, School of Information and Computer Science.</span><span class="sxs-lookup"><span data-stu-id="5e844-128">Irvine, CA: University of California, School of Information and Computer Science.</span></span>

2. <span data-ttu-id="5e844-129">Copie el archivo `yelp_labelled.txt` en cualquier carpeta que haya creado anteriormente (como `/cli-test`).</span><span class="sxs-lookup"><span data-stu-id="5e844-129">Copy the `yelp_labelled.txt` file into any folder you previously created (such as `/cli-test`).</span></span>

3. <span data-ttu-id="5e844-130">Abra su símbolo del sistema preferido y muévalo a la carpeta donde copió el archivo del conjunto de datos.</span><span class="sxs-lookup"><span data-stu-id="5e844-130">Open your preferred command prompt and move to the folder where you copied the dataset file.</span></span> <span data-ttu-id="5e844-131">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="5e844-131">For example:</span></span>

    ```console
    cd /cli-test
    ```

    <span data-ttu-id="5e844-132">Con cualquier editor de texto como Visual Studio Code, puede abrir y explorar el archivo del conjunto de datos `yelp_labelled.txt`.</span><span class="sxs-lookup"><span data-stu-id="5e844-132">Using any text editor such as Visual Studio Code, you can open, and explore the `yelp_labelled.txt` dataset file.</span></span> <span data-ttu-id="5e844-133">Puede ver la estructura de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="5e844-133">You can see that the structure is:</span></span>

    - <span data-ttu-id="5e844-134">El archivo no tiene encabezado.</span><span class="sxs-lookup"><span data-stu-id="5e844-134">The file has no header.</span></span> <span data-ttu-id="5e844-135">Usará el índice de la columna.</span><span class="sxs-lookup"><span data-stu-id="5e844-135">You will use the column's index.</span></span>

    - <span data-ttu-id="5e844-136">Solo hay dos columnas:</span><span class="sxs-lookup"><span data-stu-id="5e844-136">There are just two columns:</span></span>

        | <span data-ttu-id="5e844-137">Texto (índice de la columna 0)</span><span class="sxs-lookup"><span data-stu-id="5e844-137">Text (Column index 0)</span></span> | <span data-ttu-id="5e844-138">Etiqueta (índice de la columna 1)</span><span class="sxs-lookup"><span data-stu-id="5e844-138">Label (Column index 1)</span></span>|
        |--------------------------|-------|
        | <span data-ttu-id="5e844-139">¡Anda! Me encantó el lugar.</span><span class="sxs-lookup"><span data-stu-id="5e844-139">Wow... Loved this place.</span></span> | <span data-ttu-id="5e844-140">1</span><span class="sxs-lookup"><span data-stu-id="5e844-140">1</span></span> |
        | <span data-ttu-id="5e844-141">La corteza no es buena.</span><span class="sxs-lookup"><span data-stu-id="5e844-141">Crust is not good.</span></span> | <span data-ttu-id="5e844-142">0</span><span class="sxs-lookup"><span data-stu-id="5e844-142">0</span></span> |
        | <span data-ttu-id="5e844-143">No es sabrosa y la textura era simplemente desagradable.</span><span class="sxs-lookup"><span data-stu-id="5e844-143">Not tasty and the texture was just nasty.</span></span> | <span data-ttu-id="5e844-144">0</span><span class="sxs-lookup"><span data-stu-id="5e844-144">0</span></span> |
        | <span data-ttu-id="5e844-145">...MUCHAS MÁS FILAS DE TEXTO...</span><span class="sxs-lookup"><span data-stu-id="5e844-145">...MANY MORE TEXT ROWS...</span></span> | <span data-ttu-id="5e844-146">...(1 o 0)...</span><span class="sxs-lookup"><span data-stu-id="5e844-146">...(1 or 0)...</span></span> |

    <span data-ttu-id="5e844-147">Asegúrese de cerrar el archivo del conjunto de datos desde el editor.</span><span class="sxs-lookup"><span data-stu-id="5e844-147">Make sure you close the dataset file from the editor.</span></span>

    <span data-ttu-id="5e844-148">Ya está listo para empezar a usar la CLI en este escenario de "análisis de sentimiento".</span><span class="sxs-lookup"><span data-stu-id="5e844-148">Now, you are ready to start using the CLI for this 'Sentiment Analysis' scenario.</span></span>

    > [!NOTE]
    > <span data-ttu-id="5e844-149">Al finalizar este tutorial, también puede probar con sus propios conjuntos de datos, siempre que estén listos para usarse en cualquiera de las tareas de ML compatibles actualmente con la versión preliminar de la CLI de ML.NET, que son *"Clasificación binaria", "Clasificación", "Regresión"* y *"Recomendación"* .</span><span class="sxs-lookup"><span data-stu-id="5e844-149">After finishing this tutorial you can also try with your own datasets as long as they are ready to be used for any of the ML tasks currently supported by the ML.NET CLI Preview which are *'Binary Classification', 'Classification', 'Regression',* and *'Recommendation'*.</span></span>

## <a name="run-the-mlnet-classification-command"></a><span data-ttu-id="5e844-150">Ejecución del comando "mlnet classification"</span><span class="sxs-lookup"><span data-stu-id="5e844-150">Run the 'mlnet classification' command</span></span>

1. <span data-ttu-id="5e844-151">Ejecute el siguiente comando de la CLI de ML.NET:</span><span class="sxs-lookup"><span data-stu-id="5e844-151">Run the following ML.NET CLI command:</span></span>

    ```console
    mlnet classification --dataset "yelp_labelled.txt" --label-col 1 --has-header false --train-time 10
    ```

    <span data-ttu-id="5e844-152">Este comando ejecuta el **comando `mlnet classification`** :</span><span class="sxs-lookup"><span data-stu-id="5e844-152">This command runs the **`mlnet classification` command**:</span></span>
    - <span data-ttu-id="5e844-153">para la **Tarea de Machine Learning** de *clasificación*</span><span class="sxs-lookup"><span data-stu-id="5e844-153">for the **ML task** of *classification*</span></span>
    - <span data-ttu-id="5e844-154">usa el **archivo del conjunto de datos `yelp_labelled.txt`** como conjunto de datos de entrenamiento y pruebas (internamente la CLI utilizará la validación cruzada o lo dividirá en dos conjuntos de datos: uno para el entrenamiento y otro para las pruebas)</span><span class="sxs-lookup"><span data-stu-id="5e844-154">uses the **dataset file `yelp_labelled.txt`** as training and testing dataset (internally the CLI will either use cross-validation or split it in two datasets, one for training and one for testing)</span></span>
    - <span data-ttu-id="5e844-155">donde la **columna de objetivo/destino** que desea predecir (comúnmente denominada **"etiqueta"** ) es la **columna con el índice 1** (que es la segunda columna, ya que el índice es de base cero)</span><span class="sxs-lookup"><span data-stu-id="5e844-155">where the **objective/target column** you want to predict (commonly called **'label'**) is the **column with index 1** (that is the second column, since the index is zero-based)</span></span>
    - <span data-ttu-id="5e844-156">**no usa un encabezado de archivo** con nombres de columna, puesto que este archivo de conjunto de datos concreto no tiene un encabezado</span><span class="sxs-lookup"><span data-stu-id="5e844-156">does **not use a file header** with column names since this particular dataset file doesn't have a header</span></span>
    - <span data-ttu-id="5e844-157">el **tiempo de exploración/entrenamiento de destino** del experimento es de **10 segundos**</span><span class="sxs-lookup"><span data-stu-id="5e844-157">the **targeted exploration/train time** for the experiment is **10 seconds**</span></span>

    <span data-ttu-id="5e844-158">Verá la salida de la CLI, similar a:</span><span class="sxs-lookup"><span data-stu-id="5e844-158">You will see output from the CLI, similar to:</span></span>

    ![Clasificación de la CLI de ML.NET en PowerShell](./media/mlnet-cli/mlnet-classification-powershell.gif)

    <span data-ttu-id="5e844-160">En este caso en concreto, en solo 10 segundos y con el pequeño conjunto de datos proporcionado, la herramienta de la CLI fue capaz de ejecutar varias iteraciones, lo que implica entrenar varias veces según diferentes combinaciones de algoritmos o la configuración con diferentes transformaciones de datos internos e hiperparámetros del algoritmo.</span><span class="sxs-lookup"><span data-stu-id="5e844-160">In this particular case, in only 10 seconds and with the small dataset provided, the CLI tool was able to run quite a few iterations, meaning training multiple times based on different combinations of algorithms/configuration with different internal data transformations and algorithm's hyper-parameters.</span></span>

    <span data-ttu-id="5e844-161">Por último, el modelo de "mejor calidad" que se encontró en 10 segundos es un modelo que usa un instructor o algoritmo concreto con cualquier configuración específica.</span><span class="sxs-lookup"><span data-stu-id="5e844-161">Finally, the "best quality" model found in 10 seconds is a model using a particular trainer/algorithm with any specific configuration.</span></span> <span data-ttu-id="5e844-162">Según el tiempo de exploración, el comando puede generar un resultado diferente.</span><span class="sxs-lookup"><span data-stu-id="5e844-162">Depending on the exploration time, the command can produce a different result.</span></span> <span data-ttu-id="5e844-163">La selección se basa en las diversas métricas que se muestran, como `Accuracy`.</span><span class="sxs-lookup"><span data-stu-id="5e844-163">The selection is based on the multiple metrics shown, such as `Accuracy`.</span></span>

    <span data-ttu-id="5e844-164">**Descripción de las métricas de calidad del modelo**</span><span class="sxs-lookup"><span data-stu-id="5e844-164">**Understanding the model's quality metrics**</span></span>

    <span data-ttu-id="5e844-165">La primera métrica y la más sencilla para evaluar un modelo de clasificación binaria es la precisión, la cual es muy fácil de entender.</span><span class="sxs-lookup"><span data-stu-id="5e844-165">The first and easiest metric to evaluate a binary-classification model is the accuracy, which is simple to understand.</span></span> <span data-ttu-id="5e844-166">"La precisión es la proporción de predicciones correctas con un conjunto de datos de prueba".</span><span class="sxs-lookup"><span data-stu-id="5e844-166">"Accuracy is the proportion of correct predictions with a test data set.".</span></span> <span data-ttu-id="5e844-167">Cuanto más cerca del 100 % (1,00), mejor.</span><span class="sxs-lookup"><span data-stu-id="5e844-167">The closer to 100% (1.00), the better.</span></span>

    <span data-ttu-id="5e844-168">Sin embargo, hay casos en los que solo medir con la métrica de precisión no es suficiente, especialmente cuando la etiqueta (0 y 1 en este caso) está desequilibrada en el conjunto de datos de prueba.</span><span class="sxs-lookup"><span data-stu-id="5e844-168">However, there are cases where just measuring with the Accuracy metric is not enough, especially when the label (0 and 1 in this case) is unbalanced in the test dataset.</span></span>

    <span data-ttu-id="5e844-169">Para ver métricas adicionales e **información más detallada acerca de las métricas**, como la precisión, AUC, AUCPR y la puntuación F1 utilizada para evaluar los distintos modelos, lea [Descripción de las métricas de ML.NET](../resources/metrics.md).</span><span class="sxs-lookup"><span data-stu-id="5e844-169">For additional metrics and more **detailed information about the metrics** such as Accuracy, AUC, AUCPR, and F1-score used to evaluate the different models, see [Understanding ML.NET metrics](../resources/metrics.md).</span></span>

    > [!NOTE]
    > <span data-ttu-id="5e844-170">Puede probar este mismo conjunto de datos y especificar unos minutos para `--max-exploration-time` (por ejemplo, tres minutos, por lo que se especifican 180 segundos) que encontrará un "mejor modelo" con una configuración de canalización de entrenamiento distinta para este conjunto de datos (que es bastante pequeño: 1000 filas).</span><span class="sxs-lookup"><span data-stu-id="5e844-170">You can try this very same dataset and specify a few minutes for `--max-exploration-time` (for instance three minutes so you specify 180 seconds) which will find a better "best model" for you with a different training pipeline configuration for this dataset (which is pretty small, 1000 rows).</span></span>

    <span data-ttu-id="5e844-171">Para encontrar un modelo de "mejor o buena calidad" que sea un "modelo listo para la producción" dirigido a conjuntos de datos grandes, debe realizar experimentos con la CLI normalmente especificando mucho más tiempo de exploración según el tamaño del conjunto de datos.</span><span class="sxs-lookup"><span data-stu-id="5e844-171">In order to find a "best/good quality" model that is a "production-ready model" targeting larger datasets, you should make experiments with the CLI usually specifying much more exploration time depending on the size of the dataset.</span></span> <span data-ttu-id="5e844-172">De hecho, en muchos casos es posible que necesite varias horas de exploración, sobre todo si el conjunto de datos es de gran tamaño en filas y columnas.</span><span class="sxs-lookup"><span data-stu-id="5e844-172">In fact, in many cases you might require multiple hours of exploration time especially if the dataset is large on rows and columns.</span></span>

1. <span data-ttu-id="5e844-173">La ejecución del comando anterior ha generado los siguientes recursos:</span><span class="sxs-lookup"><span data-stu-id="5e844-173">The previous command execution has generated the following assets:</span></span>

    - <span data-ttu-id="5e844-174">Un .zip de modelo serializado ("mejor modelo") listo para usarse.</span><span class="sxs-lookup"><span data-stu-id="5e844-174">A serialized model .zip ("best model") ready to use.</span></span>
    - <span data-ttu-id="5e844-175">El código de C# para ejecutar o calificar dicho modelo generado (para realizar predicciones en las aplicaciones del usuario final con ese modelo).</span><span class="sxs-lookup"><span data-stu-id="5e844-175">C# code to run/score that generated model (To make predictions in your end-user apps with that model).</span></span>
    - <span data-ttu-id="5e844-176">El código de entrenamiento de C# utilizado para generar ese modelo (con fines de aprendizaje).</span><span class="sxs-lookup"><span data-stu-id="5e844-176">C# training code used to generate that model (Learning purposes).</span></span>
    - <span data-ttu-id="5e844-177">Un archivo de registro con todas las iteraciones exploradas con información detallada específica acerca de cada algoritmo que se ha intentado con su combinación de hiperparámetros y transformaciones de datos.</span><span class="sxs-lookup"><span data-stu-id="5e844-177">A log file with all the iterations explored having specific detailed information about each algorithm tried with its combination of hyper-parameters and data transformations.</span></span>

    <span data-ttu-id="5e844-178">Los dos primeros recursos (modelo de archivo ZIP y el código de C# para ejecutar ese modelo) se pueden usar directamente en las aplicaciones de usuario final (aplicación web ASP.NET Core, servicios, aplicación de escritorio, etc.) para realizar predicciones con dicho modelo de ML generado.</span><span class="sxs-lookup"><span data-stu-id="5e844-178">The first two assets (.ZIP file model and C# code to run that model) can directly be used in your end-user apps (ASP.NET Core web app, services, desktop app, etc.) to make predictions with that generated ML model.</span></span>

    <span data-ttu-id="5e844-179">El tercer recurso, el código de aprendizaje, le muestra el código de la API de ML.NET que utilizó la CLI para entrenar el modelo generado, de modo que pueda investigar qué hiperparámetros y algoritmos o instructores específicos seleccionó la CLI.</span><span class="sxs-lookup"><span data-stu-id="5e844-179">The third asset, the training code, shows you what ML.NET API code was used by the CLI to train the generated model, so you can investigate what specific trainer/algorithm and hyper-parameters were selected by the CLI.</span></span>

<span data-ttu-id="5e844-180">Esos recursos enumerados se explican en los pasos siguientes del tutorial.</span><span class="sxs-lookup"><span data-stu-id="5e844-180">Those enumerated assets are explained in the following steps of the tutorial.</span></span>

## <a name="explore-the-generated-c-code-to-use-for-running-the-model-to-make-predictions"></a><span data-ttu-id="5e844-181">Explorar el código de C# generado que se usará para ejecutar el modelo a fin de realizar predicciones</span><span class="sxs-lookup"><span data-stu-id="5e844-181">Explore the generated C# code to use for running the model to make predictions</span></span>

1. <span data-ttu-id="5e844-182">En Visual Studio (2017 o 2019), abra la solución generada en la carpeta denominada `SampleClassification` dentro de la carpeta de destino original (en el tutorial se denominaba `/cli-test`).</span><span class="sxs-lookup"><span data-stu-id="5e844-182">In Visual Studio (2017 or 2019) open the solution generated in the folder named `SampleClassification` within your original destination folder (in the tutorial was named `/cli-test`).</span></span> <span data-ttu-id="5e844-183">Debería ver una solución similar a esta:</span><span class="sxs-lookup"><span data-stu-id="5e844-183">You should see a solution similar to:</span></span>

    > [!NOTE]
    > <span data-ttu-id="5e844-184">En el tutorial, se recomienda usar Visual Studio, pero también puede explorar el código de C# generado (dos proyectos) con cualquier editor de texto y ejecutar la aplicación de consola generada con la `dotnet CLI` en macOS, máquina Linux o Windows.</span><span class="sxs-lookup"><span data-stu-id="5e844-184">In the tutorial we suggest to use Visual Studio, but you can also explore the generated C# code (two projects) with any text editor and run the generated console app with the `dotnet CLI` on macOS, Linux or Windows machine.</span></span>

    ![Solución de VS generada por la CLI](./media/mlnet-cli/mlnet-cli-solution-explorer.png)

    - <span data-ttu-id="5e844-186">La **biblioteca de clases** generada que contiene el modelo serializado de ML (archivo .zip) y las clases de datos (modelo de datos) es algo que puede usar directamente en la aplicación del usuario final, incluso haciendo referencia directamente a esa biblioteca de clases (o moviendo el código, como desee).</span><span class="sxs-lookup"><span data-stu-id="5e844-186">The generated **class library** containing the serialized ML model (.zip file) and the data classes (data models) is something you can directly use in your end-user application, even by directly referencing that class library (or moving the code, as you prefer).</span></span>
    - <span data-ttu-id="5e844-187">La **aplicación de consola** generada contiene un código de ejecución que debe revisar. Después, normalmente reutiliza el "código de puntuación" (el código que ejecuta el modelo de ML para realizar predicciones) moviendo ese código sencillo (unas cuantas líneas) a la aplicación del usuario final en la que quiere realizar las predicciones.</span><span class="sxs-lookup"><span data-stu-id="5e844-187">The generated **console app** contains execution code that you must review and then you usually reuse the 'scoring code' (code that runs the ML model to make predictions) by moving that simple code (just a few lines) to your end-user application where you want to make the predictions.</span></span>

1. <span data-ttu-id="5e844-188">Abra los archivos de clase **ModelInput.cs** y **ModelOutput.cs** en el proyecto de la biblioteca de clases.</span><span class="sxs-lookup"><span data-stu-id="5e844-188">Open the **ModelInput.cs** and **ModelOutput.cs** class files within the class library project.</span></span> <span data-ttu-id="5e844-189">Verá que estas clases son "clases de datos" o clases POCO que se usan para almacenar datos.</span><span class="sxs-lookup"><span data-stu-id="5e844-189">You will see that these classes are 'data classes' or POCO classes used to hold data.</span></span> <span data-ttu-id="5e844-190">Se trata de "código reutilizable", pero resulta útil generarlo si el conjunto de datos tiene decenas o incluso centenares de columnas.</span><span class="sxs-lookup"><span data-stu-id="5e844-190">It is 'boilerplate code' but useful to have it generated if your dataset has tens or even hundreds of columns.</span></span>
    - <span data-ttu-id="5e844-191">La clase `ModelInput` se usa al leer los datos del conjunto de datos.</span><span class="sxs-lookup"><span data-stu-id="5e844-191">The `ModelInput` class is used when reading data from the dataset.</span></span>
    - <span data-ttu-id="5e844-192">La clase `ModelOutput` se utiliza para obtener el resultado de la predicción (datos de predicción).</span><span class="sxs-lookup"><span data-stu-id="5e844-192">The `ModelOutput` class is used to get the prediction result (prediction data).</span></span>

1. <span data-ttu-id="5e844-193">Abra el archivo Program.cs y explore el código.</span><span class="sxs-lookup"><span data-stu-id="5e844-193">Open the Program.cs file and explore the code.</span></span> <span data-ttu-id="5e844-194">En unas cuantas líneas, podrá ejecutar el modelo y realizar una predicción de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="5e844-194">In just a few lines, you are able to run the model and make a sample prediction.</span></span>

    ```csharp
    static void Main(string[] args)
    {
        // Create single instance of sample data from first line of dataset for model input
        ModelInput sampleData = new ModelInput()
        {
            Col0 = @"Wow... Loved this place.",
        };

        // Make a single prediction on the sample data and print results
        var predictionResult = ConsumeModel.Predict(sampleData);

        Console.WriteLine("Using model to make single prediction -- Comparing actual Col1 with predicted Col1 from sample data...\n\n");
        Console.WriteLine($"Col0: {sampleData.Col0}");
        Console.WriteLine($"\n\nPredicted Col1 value {predictionResult.Prediction} \nPredicted Col1 scores: [{String.Join(",", predictionResult.Score)}]\n\n");
        Console.WriteLine("=============== End of process, hit any key to finish ===============");
        Console.ReadKey();
    }
    ```

    - Las primeras líneas de código crean *datos de ejemplo únicos*, en este caso basados en la primera fila del conjunto de datos que se va a usar para la predicción. <span data-ttu-id="5e844-196">También puede crear sus propios datos "codificados de forma rígida" actualizando el código:</span><span class="sxs-lookup"><span data-stu-id="5e844-196">You can also create you own 'hard-coded' data by updating the code:</span></span>

        ```csharp
        ModelInput sampleData = new ModelInput()
        {
            Col0 = "The ML.NET CLI is great for getting started. Very cool!"
        };
        ```

    - <span data-ttu-id="5e844-197">La siguiente línea de código usa el método `ConsumeModel.Predict()` en los datos de entrada especificados para crear una predicción y devolver los resultados (según el esquema ModelOutput.cs).</span><span class="sxs-lookup"><span data-stu-id="5e844-197">The next line of code uses the `ConsumeModel.Predict()` method on the specified input data to make a prediction and return the results (based on the ModelOutput.cs schema).</span></span>
    - <span data-ttu-id="5e844-198">Las últimas líneas de código imprimen las propiedades de los datos de ejemplo (en este caso, el comentario), así como la predicción de opiniones y las puntuaciones correspondientes para la opinión positiva (1) y la opinión negativa (2).</span><span class="sxs-lookup"><span data-stu-id="5e844-198">The last lines of code print out the properties of the sample data (in this case the Comment) as well as the Sentiment prediction and corresponding Scores for positive sentiment (1) and negative sentiment (2).</span></span>

1. <span data-ttu-id="5e844-199">Ejecute el proyecto, ya sea mediante los datos de ejemplo originales cargados desde la primera fila del conjunto de datos o proporcionando sus propios datos de ejemplo codificados de forma rígida y personalizados.</span><span class="sxs-lookup"><span data-stu-id="5e844-199">Run the project, either using the original sample data loaded from the first row of the dataset or by providing your own custom hard-coded sample data.</span></span> <span data-ttu-id="5e844-200">Debería obtener una predicción comparable a esta:</span><span class="sxs-lookup"><span data-stu-id="5e844-200">You should get a prediction comparable to:</span></span>

![Ejecución de la aplicación con la CLI de ML.NET desde Visual Studio](./media/mlnet-cli/mlnet-cli-console-app.png)<span data-ttu-id="5e844-202">)</span><span class="sxs-lookup"><span data-stu-id="5e844-202">)</span></span>

1. <span data-ttu-id="5e844-203">Pruebe a cambiar los datos de ejemplo codificados de forma rígida a otras frases con diferentes opiniones y vea cómo el modelo predice opiniones positivas o negativas.</span><span class="sxs-lookup"><span data-stu-id="5e844-203">Try changing the hard-coded sample data to other sentences with different sentiment and see how the model predicts positive or negative sentiment.</span></span>

## <a name="infuse-your-end-user-applications-with-ml-model-predictions"></a><span data-ttu-id="5e844-204">Incorporar las aplicaciones del usuario final con predicciones del modelo de ML</span><span class="sxs-lookup"><span data-stu-id="5e844-204">Infuse your end-user applications with ML model predictions</span></span>

<span data-ttu-id="5e844-205">Puede usar un "código de puntuación del modelo de ML" similar para ejecutar el modelo en la aplicación del usuario final y realizar predicciones.</span><span class="sxs-lookup"><span data-stu-id="5e844-205">You can use similar 'ML model scoring code' to run the model in your end-user application and make predictions.</span></span>

<span data-ttu-id="5e844-206">Por ejemplo, podría mover directamente ese código a cualquier aplicación de escritorio de Windows como **WPF** y **WinForms** y ejecutar el modelo de la misma manera que se realizó en la aplicación de consola.</span><span class="sxs-lookup"><span data-stu-id="5e844-206">For instance, you could directly move that code to any Windows desktop application such as **WPF** and **WinForms** and run the model in the same way than it was done in the console app.</span></span>

<span data-ttu-id="5e844-207">Sin embargo, la forma de implementar esas líneas de código para ejecutar un modelo de ML debe optimizarse (es decir, copie en caché el archivo .zip del modelo y cárguelo una vez) y debe tener objetos singleton en lugar de crearlos en cada solicitud, especialmente si la aplicación debe ser escalable como una aplicación web o un servicio distribuido, tal como se explica en la sección siguiente.</span><span class="sxs-lookup"><span data-stu-id="5e844-207">However, the way you implement those lines of code to run an ML model should be optimized (that is, cache the model .zip file and load it once) and have singleton objects instead of creating them on every request, especially if your application needs to be scalable such as a web application or distributed service, as explained in the following section.</span></span>

### <a name="running-mlnet-models-in-scalable-aspnet-core-web-apps-and-services-multi-threaded-apps"></a><span data-ttu-id="5e844-208">Ejecución de modelos de ML.NET en aplicaciones web y servicios escalables de ASP.NET Core (aplicaciones multiproceso)</span><span class="sxs-lookup"><span data-stu-id="5e844-208">Running ML.NET models in scalable ASP.NET Core web apps and services (multi-threaded apps)</span></span>

<span data-ttu-id="5e844-209">La creación del objeto de modelo (`ITransformer` cargado desde el archivo .zip de un modelo) y el objeto `PredictionEngine` debe optimizarse especialmente cuando se ejecuta en aplicaciones web escalables y servicios distribuidos.</span><span class="sxs-lookup"><span data-stu-id="5e844-209">The creation of the model object (`ITransformer` loaded from a model's .zip file) and the `PredictionEngine` object should be optimized especially when running on scalable web apps and distributed services.</span></span> <span data-ttu-id="5e844-210">En el primer caso, el objeto de modelo (`ITransformer`), la optimización es sencilla.</span><span class="sxs-lookup"><span data-stu-id="5e844-210">For the first case, the model object (`ITransformer`) the optimization is straightforward.</span></span> <span data-ttu-id="5e844-211">Puesto que el objeto `ITransformer` es seguro para subprocesos, puede copiar en caché el objeto como un singleton o un objeto estático para cargar el modelo una vez.</span><span class="sxs-lookup"><span data-stu-id="5e844-211">Since the `ITransformer` object is thread-safe, you can cache the object as a singleton or static object so you load the model once.</span></span>

<span data-ttu-id="5e844-212">En el segundo objeto, el objeto `PredictionEngine`, no es tan fácil porque el objeto `PredictionEngine` no es seguro para subprocesos, por lo que no se puede crear una instancia de este objeto como singleton u objeto estático en una aplicación de ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="5e844-212">For the second object, the `PredictionEngine` object, it is not so easy because the `PredictionEngine` object is not thread-safe, therefore you cannot instantiate this object as singleton or static object in an ASP.NET Core app.</span></span> <span data-ttu-id="5e844-213">Este problema de escalabilidad y seguridad para subprocesos se describe detalladamente en esta [entrada de blog](https://devblogs.microsoft.com/cesardelatorre/how-to-optimize-and-run-ml-net-models-on-scalable-asp-net-core-webapis-or-web-apps/).</span><span class="sxs-lookup"><span data-stu-id="5e844-213">This thread-safe and scalability problem is deeply discussed in this [Blog Post](https://devblogs.microsoft.com/cesardelatorre/how-to-optimize-and-run-ml-net-models-on-scalable-asp-net-core-webapis-or-web-apps/).</span></span>

<span data-ttu-id="5e844-214">Sin embargo, las cosas ahora son mucho más fáciles de lo que se explica en esa entrada de blog.</span><span class="sxs-lookup"><span data-stu-id="5e844-214">However, things got a lot easier for you than what's explained in that blog post.</span></span> <span data-ttu-id="5e844-215">Hemos trabajado en un enfoque más sencillo para usted y hemos creado un buen **"paquete de integración de .NET Core"** que puede usar fácilmente en sus servicios y aplicaciones de ASP.NET Core registrándolos en los servicios de DI de la aplicación (servicios de inserción de dependencias) y usándolos directamente desde el código.</span><span class="sxs-lookup"><span data-stu-id="5e844-215">We worked on a simpler approach for you and have created a nice **'.NET Core Integration Package'** that you can  easily use in your ASP.NET Core apps and services by registering it in the application DI services (Dependency Injection services) and then directly use it from your code.</span></span> <span data-ttu-id="5e844-216">Consulte el siguiente tutorial y ejemplo para hacerlo:</span><span class="sxs-lookup"><span data-stu-id="5e844-216">Check the following tutorial and example for doing that:</span></span>

- [<span data-ttu-id="5e844-217">Tutorial: Ejecución de modelos de ML.NET en aplicaciones web escalables de ASP.NET Core y WebAPI</span><span class="sxs-lookup"><span data-stu-id="5e844-217">Tutorial: Running ML.NET models on scalable ASP.NET Core web apps and WebAPIs</span></span>](../how-to-guides/serve-model-web-api-ml-net.md)
- [<span data-ttu-id="5e844-218">Ejemplo: Modelo de ML.NET escalable en ASP.NET Core WebAPI</span><span class="sxs-lookup"><span data-stu-id="5e844-218">Sample: Scalable ML.NET model on ASP.NET Core WebAPI</span></span>](https://aka.ms/mlnet-sample-netcoreintegrationpkg)

## <a name="explore-the-generated-c-code-that-was-used-to-train-the-best-quality-model"></a><span data-ttu-id="5e844-219">Explorar el código de C# generado que se usó para entrenar el modelo de "mejor calidad"</span><span class="sxs-lookup"><span data-stu-id="5e844-219">Explore the generated C# code that was used to train the "best quality" model</span></span>

<span data-ttu-id="5e844-220">Para fines de aprendizaje más avanzados, también puede explorar el código de C# generado que utilizó la herramienta de la CLI para entrenar el modelo generado.</span><span class="sxs-lookup"><span data-stu-id="5e844-220">For more advanced learning purposes, you can also explore the generated C# code that was used by the CLI tool to train the generated model.</span></span>

<span data-ttu-id="5e844-221">Dicho "código de modelo de entrenamiento" se genera actualmente en la clase personalizada generada denominada `ModelBuilder` para que pueda investigar el código de entrenamiento.</span><span class="sxs-lookup"><span data-stu-id="5e844-221">That 'training model code' is currently generated in the custom class generated named `ModelBuilder` so you can investigate that training code.</span></span>

<span data-ttu-id="5e844-222">Más importante aún, para este escenario en particular (modelo de análisis de sentimiento) también puede comparar dicho código de entrenamiento generado con el código que se explica en el tutorial siguiente:</span><span class="sxs-lookup"><span data-stu-id="5e844-222">More importantly, for this particular scenario (Sentiment Analysis model) you can also compare that generated training code with the code explained in the following tutorial:</span></span>

- <span data-ttu-id="5e844-223">Comparación: [Tutorial: Uso de ML.NET en un escenario de clasificación binaria de análisis de sentimiento](sentiment-analysis.md).</span><span class="sxs-lookup"><span data-stu-id="5e844-223">Compare: [Tutorial: Use ML.NET in a sentiment analysis binary classification scenario](sentiment-analysis.md).</span></span>

<span data-ttu-id="5e844-224">Resulta interesante comparar el algoritmo elegido y la configuración de canalización en el tutorial con el código generado por la herramienta de la CLI.</span><span class="sxs-lookup"><span data-stu-id="5e844-224">It is interesting to compare the chosen algorithm and pipeline configuration in the tutorial with the code generated by the CLI tool.</span></span> <span data-ttu-id="5e844-225">Según cuánto tiempo dedique a iterar y buscar modelos mejores, el algoritmo elegido podría ser diferente, junto con su configuración de canalización e hiperparámetros determinados.</span><span class="sxs-lookup"><span data-stu-id="5e844-225">Depending on how much time you spend iterating and searching for better models, the chosen algorithm might be different along with its particular hyper-parameters and pipeline configuration.</span></span>

<span data-ttu-id="5e844-226">En este tutorial ha aprendido a:</span><span class="sxs-lookup"><span data-stu-id="5e844-226">In this tutorial, you learned how to:</span></span>
> [!div class="checklist"]
>
> - <span data-ttu-id="5e844-227">Preparar los datos para la tarea de ML seleccionada (problema para resolver)</span><span class="sxs-lookup"><span data-stu-id="5e844-227">Prepare your data for the selected ML task (problem to solve)</span></span>
> - <span data-ttu-id="5e844-228">Ejecución del comando "mlnet classification" en la herramienta de la CLI</span><span class="sxs-lookup"><span data-stu-id="5e844-228">Run the 'mlnet classification' command in the CLI tool</span></span>
> - <span data-ttu-id="5e844-229">Revisar los resultados de métrica de calidad</span><span class="sxs-lookup"><span data-stu-id="5e844-229">Review the quality metric results</span></span>
> - <span data-ttu-id="5e844-230">Comprender el código de C# generado para ejecutar el modelo (código para usar en la aplicación del usuario final)</span><span class="sxs-lookup"><span data-stu-id="5e844-230">Understand the generated C# code to run the model (Code to use in your end-user app)</span></span>
> - <span data-ttu-id="5e844-231">Exploración del código de C# generado que se usó para entrenar el modelo de "mejor calidad" (con fines de aprendizaje)</span><span class="sxs-lookup"><span data-stu-id="5e844-231">Explore the generated C# code that was used to train the "best quality" model (earning purposes)</span></span>

## <a name="see-also"></a><span data-ttu-id="5e844-232">Vea también</span><span class="sxs-lookup"><span data-stu-id="5e844-232">See also</span></span>

- [<span data-ttu-id="5e844-233">Automatizar el entrenamiento del modelo con la CLI de ML.NET</span><span class="sxs-lookup"><span data-stu-id="5e844-233">Automate model training with the ML.NET CLI</span></span>](../automate-training-with-cli.md)
- [<span data-ttu-id="5e844-234">Tutorial: Ejecución de modelos de ML.NET en aplicaciones web escalables de ASP.NET Core y WebAPI</span><span class="sxs-lookup"><span data-stu-id="5e844-234">Tutorial: Running ML.NET models on scalable ASP.NET Core web apps and WebAPIs</span></span>](../how-to-guides/serve-model-web-api-ml-net.md)
- [<span data-ttu-id="5e844-235">Ejemplo: Modelo de ML.NET escalable en ASP.NET Core WebAPI</span><span class="sxs-lookup"><span data-stu-id="5e844-235">Sample: Scalable ML.NET model on ASP.NET Core WebAPI</span></span>](https://aka.ms/mlnet-sample-netcoreintegrationpkg)
- [<span data-ttu-id="5e844-236">Guía de referencia de comandos de entrenamiento automático de la CLI de ML.NET</span><span class="sxs-lookup"><span data-stu-id="5e844-236">ML.NET CLI auto-train command reference guide</span></span>](../reference/ml-net-cli-reference.md)
- [<span data-ttu-id="5e844-237">Telemetría en la CLI de ML.NET</span><span class="sxs-lookup"><span data-stu-id="5e844-237">Telemetry in ML.NET CLI</span></span>](../resources/ml-net-cli-telemetry.md)
