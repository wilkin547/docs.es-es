---
title: 'CA5359: no deshabilitar la validación de certificados (análisis de código)'
description: Proporciona información sobre la regla de análisis de código CA5359, incluidas las causas, cómo corregir las infracciones y cuándo suprimirlas.
ms.date: 05/07/2020
ms.topic: reference
author: LLLXXXCCC
ms.author: linche
f1_keywords:
- CA5359
ms.openlocfilehash: 16d77e402fbd2eaa97f2a45e29c36dee1ccd7d40
ms.sourcegitcommit: 4df8e005c074ceb1f978f007b222fe253be2baf3
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/04/2021
ms.locfileid: "99543948"
---
# <a name="ca5359-do-not-disable-certificate-validation"></a><span data-ttu-id="517a1-103">CA5359: No deshabilitar la validación de certificado</span><span class="sxs-lookup"><span data-stu-id="517a1-103">CA5359: Do not disable certificate validation</span></span>

| | <span data-ttu-id="517a1-104">Valor</span><span class="sxs-lookup"><span data-stu-id="517a1-104">Value</span></span> |
|-|-|
| <span data-ttu-id="517a1-105">**Identificador de la regla**</span><span class="sxs-lookup"><span data-stu-id="517a1-105">**Rule ID**</span></span> |<span data-ttu-id="517a1-106">CA5359</span><span class="sxs-lookup"><span data-stu-id="517a1-106">CA5359</span></span>|
| <span data-ttu-id="517a1-107">**Categoría**</span><span class="sxs-lookup"><span data-stu-id="517a1-107">**Category**</span></span> |[<span data-ttu-id="517a1-108">Microsoft.Security</span><span class="sxs-lookup"><span data-stu-id="517a1-108">Microsoft.Security</span></span>](security-warnings.md)|
| <span data-ttu-id="517a1-109">**Corrección o interrupción**</span><span class="sxs-lookup"><span data-stu-id="517a1-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="517a1-110">Poco problemático</span><span class="sxs-lookup"><span data-stu-id="517a1-110">Non-breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="517a1-111">Causa</span><span class="sxs-lookup"><span data-stu-id="517a1-111">Cause</span></span>

<span data-ttu-id="517a1-112">La devolución de llamada asignada a <xref:System.Net.ServicePointManager.ServerCertificateValidationCallback?displayProperty=nameWithType> siempre devuelve `true` .</span><span class="sxs-lookup"><span data-stu-id="517a1-112">The callback assigned to <xref:System.Net.ServicePointManager.ServerCertificateValidationCallback?displayProperty=nameWithType> always returns `true`.</span></span>

## <a name="rule-description"></a><span data-ttu-id="517a1-113">Descripción de la regla</span><span class="sxs-lookup"><span data-stu-id="517a1-113">Rule description</span></span>

<span data-ttu-id="517a1-114">Un certificado puede ayudar a autenticar la identidad del servidor.</span><span class="sxs-lookup"><span data-stu-id="517a1-114">A certificate can help authenticate the identity of the server.</span></span> <span data-ttu-id="517a1-115">Los clientes deben validar el certificado de servidor para asegurarse de que las solicitudes se envían al servidor previsto.</span><span class="sxs-lookup"><span data-stu-id="517a1-115">Clients should validate the server certificate to ensure requests are sent to the intended server.</span></span> <span data-ttu-id="517a1-116">Si <xref:System.Net.ServicePointManager.ServerCertificateValidationCallback?displayProperty=nameWithType> siempre devuelve `true` , de forma predeterminada, cualquier certificado pasará la validación de todas las solicitudes HTTPS salientes.</span><span class="sxs-lookup"><span data-stu-id="517a1-116">If the <xref:System.Net.ServicePointManager.ServerCertificateValidationCallback?displayProperty=nameWithType> always returns `true`, then by default any certificate will pass validation for all outgoing HTTPS requests.</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="517a1-117">Cómo corregir infracciones</span><span class="sxs-lookup"><span data-stu-id="517a1-117">How to fix violations</span></span>

- <span data-ttu-id="517a1-118">Considere la posibilidad de invalidar la lógica de validación de certificados en las solicitudes HTTPS de salida específicas que requieren la validación de certificados personalizados, en lugar de invalidar el global <xref:System.Net.ServicePointManager.ServerCertificateValidationCallback?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="517a1-118">Considering overriding certificate validation logic on the specific outgoing HTTPS requests that require custom certificate validation, instead of overriding the global <xref:System.Net.ServicePointManager.ServerCertificateValidationCallback?displayProperty=nameWithType>.</span></span>
- <span data-ttu-id="517a1-119">Aplique la lógica de validación personalizada solo a los nombres de host y certificados específicos y, de lo contrario, compruebe que el <xref:System.Net.Security.SslPolicyErrors> valor de enumeración es `None` .</span><span class="sxs-lookup"><span data-stu-id="517a1-119">Apply custom validation logic to only specific hostnames and certificates, and otherwise check that the <xref:System.Net.Security.SslPolicyErrors> enum value is `None`.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="517a1-120">Cuándo suprimir advertencias</span><span class="sxs-lookup"><span data-stu-id="517a1-120">When to suppress warnings</span></span>

<span data-ttu-id="517a1-121">Si hay varios delegados asociados <xref:System.Net.ServicePointManager.ServerCertificateValidationCallback> , solo se respeta el valor del último delegado, por lo que es seguro suprimir las advertencias de otros delegados.</span><span class="sxs-lookup"><span data-stu-id="517a1-121">If multiple delegates are attached to <xref:System.Net.ServicePointManager.ServerCertificateValidationCallback>, only the value from the last delegate is respected, so it's safe to suppress warnings from other delegates.</span></span> <span data-ttu-id="517a1-122">Sin embargo, puede que desee quitar completamente los delegados sin usar.</span><span class="sxs-lookup"><span data-stu-id="517a1-122">However, you may want to remove the unused delegates entirely.</span></span>

## <a name="pseudo-code-examples"></a><span data-ttu-id="517a1-123">Ejemplos de pseudocódigo</span><span class="sxs-lookup"><span data-stu-id="517a1-123">Pseudo-code examples</span></span>

### <a name="violation"></a><span data-ttu-id="517a1-124">Infracción</span><span class="sxs-lookup"><span data-stu-id="517a1-124">Violation</span></span>

```csharp
using System.Net;

class ExampleClass
{
    public void ExampleMethod()
    {
        ServicePointManager.ServerCertificateValidationCallback += (sender, cert, chain, error) => { return true; };
    }
}
```

### <a name="solution"></a><span data-ttu-id="517a1-125">Solución</span><span class="sxs-lookup"><span data-stu-id="517a1-125">Solution</span></span>

```csharp
using System.Net;
using System.Net.Security;
using System.Security.Cryptography.X509Certificates;

class ExampleClass
{
    public void ExampleMethod()
    {
        ServicePointManager.ServerCertificateValidationCallback += SelfSignedForLocalhost;
    }

    private static bool SelfSignedForLocalhost(object sender, X509Certificate certificate, X509Chain chain, SslPolicyErrors sslPolicyErrors)
    {
        if (sslPolicyErrors == SslPolicyErrors.None)
        {
            return true;
        }

        // For HTTPS requests to this specific host, we expect this specific certificate.
        // In practice, you'd want this to be configurable and allow for multiple certificates per host, to enable
        // seamless certificate rotations.
        return sender is HttpWebRequest httpWebRequest
                && httpWebRequest.RequestUri.Host == "localhost"
                && certificate is X509Certificate2 x509Certificate2
                && x509Certificate2.Thumbprint == "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                && sslPolicyErrors == SslPolicyErrors.RemoteCertificateChainErrors;
    }
}
```
