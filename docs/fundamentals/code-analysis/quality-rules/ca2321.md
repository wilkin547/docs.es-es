---
title: 'CA2321: no deserializar con JavaScriptSerializer mediante SimpleTypeResolver (análisis de código)'
description: 'Más información sobre la regla de análisis de código CA2321: no deserializar con JavaScriptSerializer mediante SimpleTypeResolver'
ms.date: 05/08/2019
ms.topic: reference
author: dotpaul
ms.author: paulming
dev_langs:
- CSharp
- VB
f1_keywords:
- CA2321
- DoNotCallBinaryFormatterDeserializeWithoutFirstSettingBinaryFormatterBinder
ms.openlocfilehash: f40b666bc9c199996c1bcea2031707da24516cc1
ms.sourcegitcommit: 2e4adc490c1d2a705a0592b295d606b10b9f51f1
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 09/25/2020
ms.locfileid: "96592229"
---
# <a name="ca2321-do-not-deserialize-with-javascriptserializer-using-a-simpletyperesolver"></a>CA2321: No deserializar con JavaScriptSerializer mediante SimpleTypeResolver

| | Valor |
|-|-|
| **Identificador de la regla** |CA2321|
| **Categoría** |Microsoft.Security|
| **Corrección o interrupción** |Poco problemático|

## <a name="cause"></a>Causa

<xref:System.Web.Script.Serialization.JavaScriptSerializer?displayProperty=nameWithType>Se llamó a un método de deserialización o se hizo referencia después de inicializarlo con un <xref:System.Web.Script.Serialization.SimpleTypeResolver?displayProperty=nameWithType> .

De forma predeterminada, esta regla analiza todo el código base, pero esto es [configurable](#configurability).

## <a name="rule-description"></a>Descripción de la regla

[!INCLUDE[insecure-deserializers-description](~/includes/code-analysis/insecure-deserializers-description.md)]

Esta regla busca <xref:System.Web.Script.Serialization.JavaScriptSerializer?displayProperty=nameWithType> llamadas al método de deserialización o referencias, después de inicializar el <xref:System.Web.Script.Serialization.JavaScriptSerializer> con un <xref:System.Web.Script.Serialization.SimpleTypeResolver?displayProperty=nameWithType> .

## <a name="how-to-fix-violations"></a>Cómo corregir infracciones

- No se inicializa <xref:System.Web.Script.Serialization.JavaScriptTypeResolver?displayPropertyName=nameWithType> con un <xref:System.Web.Script.Serialization.SimpleTypeResolver?displayProperty=nameWithType> .
- Si el código necesita leer los datos serializados mediante <xref:System.Web.Script.Serialization.SimpleTypeResolver> , restrinja los tipos deserializados a una lista esperada implementando un personalizado <xref:System.Web.Script.Serialization.JavaScriptTypeResolver> .
- Convierta la prueba de alteración de los datos serializados. Después de la serialización, firme criptográficamente los datos serializados. Antes de la deserialización, valide la firma criptográfica. Proteja la clave criptográfica para que no se revele y diseñe las rotaciones de clave.

## <a name="when-to-suppress-warnings"></a>Cuándo suprimir advertencias

[!INCLUDE[insecure-deserializers-common-safe-to-suppress](~/includes/code-analysis/insecure-deserializers-common-safe-to-suppress.md)]

## <a name="configurability"></a>Configurabilidad

Esta regla tiene las siguientes opciones configurables.

### <a name="excluded-symbol-names"></a>Nombres de símbolos excluidos

Puede configurar qué partes del código base se excluirán del análisis. Por ejemplo, para especificar que la regla no se debe ejecutar en ningún código dentro de los tipos denominados `MyType` , agregue el siguiente par clave-valor a un archivo *. editorconfig* en el proyecto:

```ini
dotnet_code_quality.CA2321.excluded_symbol_names = MyType
```

Formatos de nombre de símbolo permitidos en el valor de opción (separados por `|` ):

- Solo nombre de símbolo (incluye todos los símbolos con el nombre, independientemente del tipo o espacio de nombres contenedor)
- Nombres completos en el [formato de ID](https://github.com/dotnet/csharplang/blob/master/spec/documentation-comments.md#id-string-format). de documentación del símbolo. Cada nombre de símbolo requiere un prefijo de tipo de símbolo, como el prefijo "M:" para los métodos, el prefijo `T:` para los tipos, el prefijo "N:" para los espacios de nombres, etc.
- `.ctor` para constructores y `.cctor` para constructores estáticos

Ejemplos:

| Valor de la opción | Resumen |
| --- | --- |
|`dotnet_code_quality.CA2321.excluded_symbol_names = MyType` | Coincide con todos los símbolos denominados ' altype ' en la compilación
|`dotnet_code_quality.CA2321.excluded_symbol_names = MyType1|MyType2` | Coincide con todos los símbolos denominados ' MyType1 ' o ' MyType2 ' en la compilación
|`dotnet_code_quality.CA2321.excluded_symbol_names = M:NS.MyType.MyMethod(ParamType)` | Coincide con el método específico ' MyMethod ' con la firma completa especificada
|`dotnet_code_quality.CA2321.excluded_symbol_names = M:NS1.MyType1.MyMethod1(ParamType)|M:NS2.MyType2.MyMethod2(ParamType)` | Coincide con los métodos específicos ' MyMethod1 ' y ' MyMethod2 ' con la firma completa correspondiente

Puede configurar todas estas opciones solo para esta regla, para todas las reglas o para todas las reglas de esta categoría (seguridad). Para obtener más información, vea [Opciones de configuración de reglas de calidad de código](../code-quality-rule-options.md).

## <a name="pseudo-code-examples"></a>Ejemplos de pseudocódigo

### <a name="violation-1"></a>Infracción 1

```csharp
using System.Web.Script.Serialization;

public class ExampleClass
{
    public T Deserialize<T>(string str)
    {
        JavaScriptSerializer s = new JavaScriptSerializer(new SimpleTypeResolver());
        return s.Deserialize<T>(str);
    }
}
```

```vb
Imports System.Web.Script.Serialization

Public Class ExampleClass
    Public Function Deserialize(Of T)(str As String) As T
        Dim s As JavaScriptSerializer = New JavaScriptSerializer(New SimpleTypeResolver())
        Return s.Deserialize(Of T)(str)
    End Function
End Class
```

### <a name="solution-1"></a>Solución 1

```csharp
using System.Web.Script.Serialization;

public class ExampleClass
{
    public T Deserialize<T>(string str)
    {
        JavaScriptSerializer s = new JavaScriptSerializer();
        return s.Deserialize<T>(str);
    }
}
```

```vb
Imports System.Web.Script.Serialization

Public Class ExampleClass
    Public Function Deserialize(Of T)(str As String) As T
        Dim s As JavaScriptSerializer = New JavaScriptSerializer()
        Return s.Deserialize(Of T)(str)
    End Function
End Class
```

### <a name="violation-2"></a>Infracción 2

```csharp
using System.Web.Script.Serialization;

public class BookRecord
{
    public string Title { get; set; }
    public string Author { get; set; }
    public int PageCount { get; set; }
    public AisleLocation Location { get; set; }
}

public class AisleLocation
{
    public char Aisle { get; set; }
    public byte Shelf { get; set; }
}

public class ExampleClass
{
    public BookRecord DeserializeBookRecord(string s)
    {
        JavaScriptSerializer serializer = new JavaScriptSerializer(new SimpleTypeResolver());
        return serializer.Deserialize<BookRecord>(s);
    }
}
```

```vb
Imports System.Web.Script.Serialization

Public Class BookRecord
    Public Property Title As String
    Public Property Author As String
    Public Property Location As AisleLocation
End Class

Public Class AisleLocation
    Public Property Aisle As Char
    Public Property Shelf As Byte
End Class

Public Class ExampleClass
    Public Function DeserializeBookRecord(str As String) As BookRecord
        Dim serializer As JavaScriptSerializer = New JavaScriptSerializer(New SimpleTypeResolver())
        Return serializer.Deserialize(Of BookRecord)(str)
    End Function
End Class
```

### <a name="solution-2"></a>Solución 2

```csharp
using System;
using System.Web.Script.Serialization;

public class BookRecordTypeResolver : JavaScriptTypeResolver
{
    // For compatibility with data serialized with a JavaScriptSerializer initialized with SimpleTypeResolver.
    private static readonly SimpleTypeResolver Simple = new SimpleTypeResolver();

    public override Type ResolveType(string id)
    {
        // One way to discover expected types is through testing deserialization
        // of **valid** data and logging the types used.

        ////Console.WriteLine($"ResolveType('{id}')");

        if (id == typeof(BookRecord).AssemblyQualifiedName || id == typeof(AisleLocation).AssemblyQualifiedName)
        {
            return Simple.ResolveType(id);
        }
        else
        {
            throw new ArgumentException("Unexpected type ID", nameof(id));
        }
    }

    public override string ResolveTypeId(Type type)
    {
        return Simple.ResolveTypeId(type);
    }
}

public class BookRecord
{
    public string Title { get; set; }
    public string Author { get; set; }
    public int PageCount { get; set; }
    public AisleLocation Location { get; set; }
}

public class AisleLocation
{
    public char Aisle { get; set; }
    public byte Shelf { get; set; }
}

public class ExampleClass
{
    public BookRecord DeserializeBookRecord(string s)
    {
        JavaScriptSerializer serializer = new JavaScriptSerializer(new BookRecordTypeResolver());
        return serializer.Deserialize<BookRecord>(s);
    }
}
```

```vb
Imports System
Imports System.Web.Script.Serialization

Public Class BookRecordTypeResolver
    Inherits JavaScriptTypeResolver

    ' For compatibility with data serialized with a JavaScriptSerializer initialized with SimpleTypeResolver.
    Private Dim Simple As SimpleTypeResolver = New SimpleTypeResolver()

    Public Overrides Function ResolveType(id As String) As Type
        ' One way to discover expected types is through testing deserialization
        ' of **valid** data and logging the types used.

        ''Console.WriteLine($"ResolveType('{id}')")

        If id = GetType(BookRecord).AssemblyQualifiedName Or id = GetType(AisleLocation).AssemblyQualifiedName Then
            Return Simple.ResolveType(id)
        Else
            Throw New ArgumentException("Unexpected type", NameOf(id))
        End If
    End Function

    Public Overrides Function ResolveTypeId(type As Type) As String
        Return Simple.ResolveTypeId(type)
    End Function
End Class

Public Class BookRecord
    Public Property Title As String
    Public Property Author As String
    Public Property Location As AisleLocation
End Class

Public Class AisleLocation
    Public Property Aisle As Char
    Public Property Shelf As Byte
End Class

Public Class ExampleClass
    Public Function DeserializeBookRecord(str As String) As BookRecord
        Dim serializer As JavaScriptSerializer = New JavaScriptSerializer(New BookRecordTypeResolver())
        Return serializer.Deserialize(Of BookRecord)(str)
    End Function
End Class
```

## <a name="related-rules"></a>Reglas relacionadas

[CA2322: Asegúrese de que JavaScriptSerializer no se ha inicializado con SimpleTypeResolver antes de deserializar](ca2322.md)
