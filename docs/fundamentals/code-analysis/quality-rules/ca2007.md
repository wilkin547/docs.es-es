---
title: 'CA2007: no esperar directamente a una tarea (análisis de código)'
description: 'Más información sobre la regla de análisis de código CA2007: no espera directamente a una tarea'
ms.date: 03/08/2019
ms.topic: reference
f1_keywords:
- CA2007
- DoNotDirectlyAwaitATaskAnalyzer
helpviewer_keywords:
- CA2007
author: gewarren
ms.author: gewarren
dev_langs:
- CSharp
ms.openlocfilehash: b556a59d9ef0bf7c03563cc63c96b35946241254
ms.sourcegitcommit: e301979e3049ce412d19b094c60ed95b316a8f8c
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 12/16/2020
ms.locfileid: "97595143"
---
# <a name="ca2007-do-not-directly-await-a-task"></a><span data-ttu-id="656d0-103">CA2007: No esperar una tarea directamente</span><span class="sxs-lookup"><span data-stu-id="656d0-103">CA2007: Do not directly await a Task</span></span>

| | <span data-ttu-id="656d0-104">Valor</span><span class="sxs-lookup"><span data-stu-id="656d0-104">Value</span></span> |
|-|-|
| <span data-ttu-id="656d0-105">**Identificador de la regla**</span><span class="sxs-lookup"><span data-stu-id="656d0-105">**Rule ID**</span></span> |<span data-ttu-id="656d0-106">CA2007</span><span class="sxs-lookup"><span data-stu-id="656d0-106">CA2007</span></span>|
| <span data-ttu-id="656d0-107">**Categoría**</span><span class="sxs-lookup"><span data-stu-id="656d0-107">**Category**</span></span> |<span data-ttu-id="656d0-108">Microsoft.Reliability</span><span class="sxs-lookup"><span data-stu-id="656d0-108">Microsoft.Reliability</span></span>|
| <span data-ttu-id="656d0-109">**Corrección o interrupción**</span><span class="sxs-lookup"><span data-stu-id="656d0-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="656d0-110">Poco problemático</span><span class="sxs-lookup"><span data-stu-id="656d0-110">Non-breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="656d0-111">Causa</span><span class="sxs-lookup"><span data-stu-id="656d0-111">Cause</span></span>

<span data-ttu-id="656d0-112">Un método asincrónico [espera](../../../csharp/language-reference/operators/await.md) <xref:System.Threading.Tasks.Task> directamente.</span><span class="sxs-lookup"><span data-stu-id="656d0-112">An asynchronous method [awaits](../../../csharp/language-reference/operators/await.md) a <xref:System.Threading.Tasks.Task> directly.</span></span>

## <a name="rule-description"></a><span data-ttu-id="656d0-113">Descripción de la regla</span><span class="sxs-lookup"><span data-stu-id="656d0-113">Rule description</span></span>

<span data-ttu-id="656d0-114">Cuando un método asincrónico espera <xref:System.Threading.Tasks.Task> directamente, la continuación se produce normalmente en el mismo subproceso que creó la tarea, dependiendo del contexto asincrónico.</span><span class="sxs-lookup"><span data-stu-id="656d0-114">When an asynchronous method awaits a <xref:System.Threading.Tasks.Task> directly, continuation usually occurs in the same thread that created the task, depending on the async context.</span></span> <span data-ttu-id="656d0-115">Este comportamiento puede ser costoso en términos de rendimiento y puede dar lugar a un interbloqueo en el subproceso de la interfaz de usuario.</span><span class="sxs-lookup"><span data-stu-id="656d0-115">This behavior can be costly in terms of performance and can result in a deadlock on the UI thread.</span></span> <span data-ttu-id="656d0-116">Considere <xref:System.Threading.Tasks.Task.ConfigureAwait(System.Boolean)?displayProperty=nameWithType> la posibilidad de llamar a para señalar su intención de continuación.</span><span class="sxs-lookup"><span data-stu-id="656d0-116">Consider calling <xref:System.Threading.Tasks.Task.ConfigureAwait(System.Boolean)?displayProperty=nameWithType> to signal your intention for continuation.</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="656d0-117">Cómo corregir infracciones</span><span class="sxs-lookup"><span data-stu-id="656d0-117">How to fix violations</span></span>

<span data-ttu-id="656d0-118">Para corregir las infracciones, llame a <xref:System.Threading.Tasks.Task.ConfigureAwait%2A> en el Await <xref:System.Threading.Tasks.Task> .</span><span class="sxs-lookup"><span data-stu-id="656d0-118">To fix violations, call <xref:System.Threading.Tasks.Task.ConfigureAwait%2A> on the awaited <xref:System.Threading.Tasks.Task>.</span></span> <span data-ttu-id="656d0-119">Puede pasar `true` o `false` para el `continueOnCapturedContext` parámetro.</span><span class="sxs-lookup"><span data-stu-id="656d0-119">You can pass either `true` or `false` for the `continueOnCapturedContext` parameter.</span></span>

- <span data-ttu-id="656d0-120">Llamar a `ConfigureAwait(true)` en la tarea tiene el mismo comportamiento que no llamar explícitamente a <xref:System.Threading.Tasks.Task.ConfigureAwait%2A> .</span><span class="sxs-lookup"><span data-stu-id="656d0-120">Calling `ConfigureAwait(true)` on the task has the same behavior as not explicitly calling <xref:System.Threading.Tasks.Task.ConfigureAwait%2A>.</span></span> <span data-ttu-id="656d0-121">Al llamar explícitamente a este método, está permitiendo a los lectores saber que desea realizar la continuación en el contexto de sincronización original.</span><span class="sxs-lookup"><span data-stu-id="656d0-121">By explicitly calling this method, you're letting readers know you intentionally want to perform the continuation on the original synchronization context.</span></span>

- <span data-ttu-id="656d0-122">Llame a `ConfigureAwait(false)` en la tarea para programar continuaciones en el grupo de subprocesos, evitando así un interbloqueo en el subproceso de la interfaz de usuario.</span><span class="sxs-lookup"><span data-stu-id="656d0-122">Call `ConfigureAwait(false)` on the task to schedule continuations to the thread pool, thereby avoiding a deadlock on the UI thread.</span></span> <span data-ttu-id="656d0-123">Pasar `false` es una buena opción para las bibliotecas independientes de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="656d0-123">Passing `false` is a good option for app-independent libraries.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="656d0-124">Cuándo suprimir advertencias</span><span class="sxs-lookup"><span data-stu-id="656d0-124">When to suppress warnings</span></span>

<span data-ttu-id="656d0-125">Esta advertencia está destinada a las bibliotecas, donde el código se puede ejecutar en entornos arbitrarios y donde el código no debe realizar suposiciones sobre el entorno o cómo el llamador del método puede invocar o esperar en él.</span><span class="sxs-lookup"><span data-stu-id="656d0-125">This warning is intended for libraries, where the code may be executed in arbitrary environments and where code shouldn't make assumptions about the environment or how the caller of the method may be invoking or waiting on it.</span></span> <span data-ttu-id="656d0-126">Por lo general, es adecuado suprimir la advertencia por completo para los proyectos que representan código de aplicación en lugar de código de biblioteca. de hecho, la ejecución de este analizador en el código de la aplicación (por ejemplo, los controladores de eventos de clic de botón en un proyecto de WinForms o WPF) podría provocar que se realicen las acciones incorrectas.</span><span class="sxs-lookup"><span data-stu-id="656d0-126">It is generally appropriate to suppress the warning entirely for projects that represent application code rather than library code; in fact, running this analyzer on application code (for example, button click event handlers in a WinForms or WPF project) is likely to lead to the wrong actions being taken.</span></span>

<span data-ttu-id="656d0-127">Puede suprimir esta advertencia en cualquier situación en la que la continuación se deba programar de nuevo en el contexto original o en el lugar en el que no haya ningún contexto de ese tipo.</span><span class="sxs-lookup"><span data-stu-id="656d0-127">You can suppress this warning in any situation where either the continuation should be scheduled back to the original context or where there is no such context in place.</span></span> <span data-ttu-id="656d0-128">Por ejemplo, al escribir código en un controlador de eventos de clic de botón en una aplicación WinForms o WPF, en general la continuación de una Await debe ejecutarse en el subproceso de la interfaz de usuario y, por lo tanto, es conveniente el comportamiento predeterminado de la programación de la continuación en el contexto de origen.</span><span class="sxs-lookup"><span data-stu-id="656d0-128">For example, when writing code in a button click event handler in a WinForms or WPF application, in general the continuation from an await should run on the UI thread, and thus the default behavior of scheduling the continuation back to the originating context is desirable.</span></span> <span data-ttu-id="656d0-129">Como otro ejemplo, al escribir el código en una aplicación ASP.NET Core, de forma predeterminada, no hay ningún <xref:System.Threading.SynchronizationContext> o <xref:System.Threading.Tasks.TaskScheduler> , por lo que no `ConfigureAwait` cambiaría realmente ningún comportamiento.</span><span class="sxs-lookup"><span data-stu-id="656d0-129">As another example, when writing code in an ASP.NET Core application, by default there is no <xref:System.Threading.SynchronizationContext> or <xref:System.Threading.Tasks.TaskScheduler>, for which reason a `ConfigureAwait` wouldn't actually change any behavior.</span></span>

## <a name="example"></a><span data-ttu-id="656d0-130">Ejemplo</span><span class="sxs-lookup"><span data-stu-id="656d0-130">Example</span></span>

<span data-ttu-id="656d0-131">El siguiente fragmento de código genera la ADVERTENCIA:</span><span class="sxs-lookup"><span data-stu-id="656d0-131">The following code snippet generates the warning:</span></span>

```csharp
public async Task Execute()
{
    Task task = null;
    await task;
}
```

<span data-ttu-id="656d0-132">Para corregir la infracción, llame a <xref:System.Threading.Tasks.Task.ConfigureAwait%2A> en Await <xref:System.Threading.Tasks.Task> :</span><span class="sxs-lookup"><span data-stu-id="656d0-132">To fix the violation, call <xref:System.Threading.Tasks.Task.ConfigureAwait%2A> on the awaited <xref:System.Threading.Tasks.Task>:</span></span>

```csharp
public async Task Execute()
{
    Task task = null;
    await task.ConfigureAwait(false);
}
```

## <a name="configure-code-to-analyze"></a><span data-ttu-id="656d0-133">Configurar el código para analizar</span><span class="sxs-lookup"><span data-stu-id="656d0-133">Configure code to analyze</span></span>

<span data-ttu-id="656d0-134">Use las opciones siguientes para configurar en qué partes del código base ejecutar esta regla.</span><span class="sxs-lookup"><span data-stu-id="656d0-134">Use the following options to configure which parts of your codebase to run this rule on.</span></span>

- [<span data-ttu-id="656d0-135">Excluir métodos void Async</span><span class="sxs-lookup"><span data-stu-id="656d0-135">Exclude async void methods</span></span>](#exclude-async-void-methods)
- [<span data-ttu-id="656d0-136">Tipo de salida</span><span class="sxs-lookup"><span data-stu-id="656d0-136">Output kind</span></span>](#output-kind)

<span data-ttu-id="656d0-137">Puede configurar todas estas opciones solo para esta regla, para todas las reglas o para todas las reglas de esta categoría (confiabilidad).</span><span class="sxs-lookup"><span data-stu-id="656d0-137">You can configure all of these options for just this rule, for all rules, or for all rules in this category (Reliability).</span></span> <span data-ttu-id="656d0-138">Para obtener más información, vea [Opciones de configuración de reglas de calidad de código](../code-quality-rule-options.md).</span><span class="sxs-lookup"><span data-stu-id="656d0-138">For more information, see [Code quality rule configuration options](../code-quality-rule-options.md).</span></span>

### <a name="exclude-async-void-methods"></a><span data-ttu-id="656d0-139">Excluir métodos void Async</span><span class="sxs-lookup"><span data-stu-id="656d0-139">Exclude async void methods</span></span>

<span data-ttu-id="656d0-140">Puede configurar si desea excluir métodos asincrónicos que no devuelven un valor de esta regla.</span><span class="sxs-lookup"><span data-stu-id="656d0-140">You can configure whether you want to exclude asynchronous methods that don't return a value from this rule.</span></span> <span data-ttu-id="656d0-141">Para excluir estos tipos de métodos, agregue el siguiente par clave-valor a un archivo *. editorconfig* en el proyecto:</span><span class="sxs-lookup"><span data-stu-id="656d0-141">To exclude these kinds of methods, add the following key-value pair to an *.editorconfig* file in your project:</span></span>

```ini
# Package version 2.9.0 and later
dotnet_code_quality.CA2007.exclude_async_void_methods = true

# Package version 2.6.3 and earlier
dotnet_code_quality.CA2007.skip_async_void_methods = true
```

### <a name="output-kind"></a><span data-ttu-id="656d0-142">Tipo de salida</span><span class="sxs-lookup"><span data-stu-id="656d0-142">Output kind</span></span>

<span data-ttu-id="656d0-143">También puede configurar los tipos de ensamblado de salida a los que aplicar esta regla.</span><span class="sxs-lookup"><span data-stu-id="656d0-143">You can also configure which output assembly kinds to apply this rule to.</span></span> <span data-ttu-id="656d0-144">Por ejemplo, para aplicar esta regla solo al código que produce una aplicación de consola o una biblioteca vinculada dinámicamente (es decir, no una aplicación de interfaz de usuario), agregue el siguiente par clave-valor a un archivo *. editorconfig* en el proyecto:</span><span class="sxs-lookup"><span data-stu-id="656d0-144">For example, to only apply this rule to code that produces a console application or a dynamically linked library (that is, not a UI app), add the following key-value pair to an *.editorconfig* file in your project:</span></span>

```ini
dotnet_code_quality.CA2007.output_kind = ConsoleApplication, DynamicallyLinkedLibrary
```

## <a name="see-also"></a><span data-ttu-id="656d0-145">Consulte también</span><span class="sxs-lookup"><span data-stu-id="656d0-145">See also</span></span>

- [<span data-ttu-id="656d0-146">Preguntas más frecuentes sobre ConfigureAwait</span><span class="sxs-lookup"><span data-stu-id="656d0-146">ConfigureAwait FAQ</span></span>](https://devblogs.microsoft.com/dotnet/configureawait-faq/)
- [<span data-ttu-id="656d0-147">¿Debo esperar una tarea con ConfigureAwait (false)?</span><span class="sxs-lookup"><span data-stu-id="656d0-147">Should I await a task with ConfigureAwait(false)?</span></span>](https://github.com/Microsoft/vs-threading/blob/master/doc/cookbook_vs.md#should-i-await-a-task-with-configureawaitfalse)
- [<span data-ttu-id="656d0-148">CA2008: No crear tareas sin pasar un elemento TaskScheduler</span><span class="sxs-lookup"><span data-stu-id="656d0-148">CA2008: Do not create tasks without passing a TaskScheduler</span></span>](ca2008.md)
- [<span data-ttu-id="656d0-149">Reglas de confiabilidad</span><span class="sxs-lookup"><span data-stu-id="656d0-149">Reliability rules</span></span>](reliability-warnings.md)
