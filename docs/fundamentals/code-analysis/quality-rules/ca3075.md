---
title: 'CA3075: procesamiento de DTD no seguro (análisis de código)'
description: 'Más información sobre la regla de análisis de código CA3075: procesamiento de DTD no seguro'
ms.date: 03/18/2019
ms.topic: reference
author: gewarren
ms.author: gewarren
ms.openlocfilehash: d58619ad8583a7329cd799bb3f52583d79ebb4cc
ms.sourcegitcommit: 4df8e005c074ceb1f978f007b222fe253be2baf3
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/04/2021
ms.locfileid: "99542518"
---
# <a name="ca3075-insecure-dtd-processing"></a><span data-ttu-id="83f5a-103">CA3075: Procesamiento no seguro de DTD</span><span class="sxs-lookup"><span data-stu-id="83f5a-103">CA3075: Insecure DTD Processing</span></span>

| | <span data-ttu-id="83f5a-104">Valor</span><span class="sxs-lookup"><span data-stu-id="83f5a-104">Value</span></span> |
|-|-|
| <span data-ttu-id="83f5a-105">**Identificador de la regla**</span><span class="sxs-lookup"><span data-stu-id="83f5a-105">**Rule ID**</span></span> |<span data-ttu-id="83f5a-106">CA3075</span><span class="sxs-lookup"><span data-stu-id="83f5a-106">CA3075</span></span>|
| <span data-ttu-id="83f5a-107">**Categoría**</span><span class="sxs-lookup"><span data-stu-id="83f5a-107">**Category**</span></span> |[<span data-ttu-id="83f5a-108">Microsoft.Security</span><span class="sxs-lookup"><span data-stu-id="83f5a-108">Microsoft.Security</span></span>](security-warnings.md)|
| <span data-ttu-id="83f5a-109">**Corrección o interrupción**</span><span class="sxs-lookup"><span data-stu-id="83f5a-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="83f5a-110">Poco problemático</span><span class="sxs-lookup"><span data-stu-id="83f5a-110">Non-breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="83f5a-111">Causa</span><span class="sxs-lookup"><span data-stu-id="83f5a-111">Cause</span></span>

<span data-ttu-id="83f5a-112">Si usa instancias de <xref:System.Xml.XmlReaderSettings.DtdProcessing%2A> no seguras o hace referencia a orígenes de entidades externas, el analizador podría aceptar entradas que no sean de confianza y revelar información confidencial a atacantes.</span><span class="sxs-lookup"><span data-stu-id="83f5a-112">If you use insecure <xref:System.Xml.XmlReaderSettings.DtdProcessing%2A> instances or reference external entity sources, the parser may accept untrusted input and disclose sensitive information to attackers.</span></span>

## <a name="rule-description"></a><span data-ttu-id="83f5a-113">Descripción de la regla</span><span class="sxs-lookup"><span data-stu-id="83f5a-113">Rule description</span></span>

<span data-ttu-id="83f5a-114">Una *definición de tipo de documento (DTD)* es una de las dos formas que tiene un analizador XML para determinar la validez de un documento, como se define en el  [lenguaje de marcado extensible (XML) 1.0 de World Wide Web Consortium (W3C)](https://www.w3.org/TR/2008/REC-xml-20081126/).</span><span class="sxs-lookup"><span data-stu-id="83f5a-114">A *Document Type Definition (DTD)* is one of two ways an XML parser can determine the validity of a document, as defined by the  [World Wide Web Consortium (W3C) Extensible Markup Language (XML) 1.0](https://www.w3.org/TR/2008/REC-xml-20081126/).</span></span> <span data-ttu-id="83f5a-115">Esta regla busca propiedades e instancias en las que se aceptan datos que no son de confianza para advertir a los desarrolladores sobre posibles amenazas de [divulgación de información](../../../framework/wcf/feature-details/information-disclosure.md) o ataques [de denegación de servicio (dos)](../../../framework/wcf/feature-details/denial-of-service.md) .</span><span class="sxs-lookup"><span data-stu-id="83f5a-115">This rule seeks properties and instances where untrusted data is accepted to warn developers about potential [Information Disclosure](../../../framework/wcf/feature-details/information-disclosure.md) threats or [Denial of Service (DoS)](../../../framework/wcf/feature-details/denial-of-service.md) attacks.</span></span> <span data-ttu-id="83f5a-116">Esta regla se desencadena cuando:</span><span class="sxs-lookup"><span data-stu-id="83f5a-116">This rule triggers when:</span></span>

- <span data-ttu-id="83f5a-117">DtdProcessing está habilitado en la instancia <xref:System.Xml.XmlReader> , que resuelve entidades XML externas mediante <xref:System.Xml.XmlUrlResolver>.</span><span class="sxs-lookup"><span data-stu-id="83f5a-117">DtdProcessing is enabled on the <xref:System.Xml.XmlReader> instance, which resolves external XML entities using <xref:System.Xml.XmlUrlResolver>.</span></span>

- <span data-ttu-id="83f5a-118">Se ha establecido la propiedad <xref:System.Xml.XmlNode.InnerXml%2A> del XML.</span><span class="sxs-lookup"><span data-stu-id="83f5a-118">The <xref:System.Xml.XmlNode.InnerXml%2A> property in the XML is set.</span></span>

- <span data-ttu-id="83f5a-119"><xref:System.Xml.XmlReaderSettings.DtdProcessing%2A> la propiedad se establece en Parse.</span><span class="sxs-lookup"><span data-stu-id="83f5a-119"><xref:System.Xml.XmlReaderSettings.DtdProcessing%2A> property is set to Parse.</span></span>

- <span data-ttu-id="83f5a-120">Las entradas que no son de confianza se procesan mediante <xref:System.Xml.XmlResolver> en lugar de <xref:System.Xml.XmlSecureResolver> .</span><span class="sxs-lookup"><span data-stu-id="83f5a-120">Untrusted input is processed using <xref:System.Xml.XmlResolver> instead of <xref:System.Xml.XmlSecureResolver>.</span></span>

- <span data-ttu-id="83f5a-121">El <xref:System.Xml.XmlReader.Create%2A?displayProperty=nameWithType> método se invoca con una <xref:System.Xml.XmlReaderSettings> instancia no segura o sin ninguna instancia.</span><span class="sxs-lookup"><span data-stu-id="83f5a-121">The <xref:System.Xml.XmlReader.Create%2A?displayProperty=nameWithType> method is invoked with an insecure <xref:System.Xml.XmlReaderSettings> instance or no instance at all.</span></span>

- <span data-ttu-id="83f5a-122"><xref:System.Xml.XmlReader> se crea con valores o configuraciones predeterminados no seguros.</span><span class="sxs-lookup"><span data-stu-id="83f5a-122"><xref:System.Xml.XmlReader> is created with insecure default settings or values.</span></span>

<span data-ttu-id="83f5a-123">En cada uno de estos casos, el resultado es el mismo: el contenido del sistema de archivos o de los recursos compartidos de red del equipo en el que se procesa el XML se expondrá al atacante, o el procesamiento de DTD se puede usar como vector de DoS.</span><span class="sxs-lookup"><span data-stu-id="83f5a-123">In each of these cases, the outcome is the same: the contents from either the file system or network shares from the machine where the XML is processed will be exposed to the attacker, or DTD processing can be used as a DoS vector.</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="83f5a-124">Cómo corregir infracciones</span><span class="sxs-lookup"><span data-stu-id="83f5a-124">How to fix violations</span></span>

- <span data-ttu-id="83f5a-125">Detecte y procese todas las excepciones de XmlTextReader correctamente para evitar la divulgación de información de ruta de acceso.</span><span class="sxs-lookup"><span data-stu-id="83f5a-125">Catch and process all XmlTextReader exceptions properly to avoid path information disclosure.</span></span>

- <span data-ttu-id="83f5a-126">Use <xref:System.Xml.XmlSecureResolver> para restringir los recursos a los que puede tener acceso XmlTextReader.</span><span class="sxs-lookup"><span data-stu-id="83f5a-126">Use the <xref:System.Xml.XmlSecureResolver> to restrict the resources that the XmlTextReader can access.</span></span>

- <span data-ttu-id="83f5a-127">Establezca la propiedad <xref:System.Xml.XmlReader> en <xref:System.Xml.XmlResolver> null **para evitar que** abra ningún recurso externo.</span><span class="sxs-lookup"><span data-stu-id="83f5a-127">Do not allow the <xref:System.Xml.XmlReader> to open any external resources by setting the <xref:System.Xml.XmlResolver> property to **null**.</span></span>

- <span data-ttu-id="83f5a-128">Asegúrese de que la <xref:System.Data.DataViewManager.DataViewSettingCollectionString%2A?displayProperty=nameWithType> propiedad se asigne desde un origen de confianza.</span><span class="sxs-lookup"><span data-stu-id="83f5a-128">Ensure that the <xref:System.Data.DataViewManager.DataViewSettingCollectionString%2A?displayProperty=nameWithType> property is assigned from a trusted source.</span></span>

### <a name="net-framework-35-and-earlier"></a><span data-ttu-id="83f5a-129">.NET Framework 3,5 y versiones anteriores</span><span class="sxs-lookup"><span data-stu-id="83f5a-129">.NET Framework 3.5 and earlier</span></span>

- <span data-ttu-id="83f5a-130">Deshabilite el procesamiento de DTD si trabaja con orígenes que no son de confianza estableciendo la <xref:System.Xml.XmlReaderSettings.ProhibitDtd%2A> propiedad en **true**.</span><span class="sxs-lookup"><span data-stu-id="83f5a-130">Disable DTD processing if you are dealing with untrusted sources by setting the <xref:System.Xml.XmlReaderSettings.ProhibitDtd%2A> property to **true**.</span></span>

- <span data-ttu-id="83f5a-131">La clase XmlTextReader tiene una petición de herencia de plena confianza.</span><span class="sxs-lookup"><span data-stu-id="83f5a-131">XmlTextReader class has a full trust inheritance demand.</span></span>

### <a name="net-framework-4-and-later"></a><span data-ttu-id="83f5a-132">.NET Framework 4 y versiones posteriores</span><span class="sxs-lookup"><span data-stu-id="83f5a-132">.NET Framework 4 and later</span></span>

- <span data-ttu-id="83f5a-133">Evite habilitar DtdProcessing si trabaja con orígenes que no son de confianza estableciendo la <xref:System.Xml.XmlReaderSettings.DtdProcessing%2A?displayProperty=nameWithType> propiedad en **prohibir** u **omitir**.</span><span class="sxs-lookup"><span data-stu-id="83f5a-133">Avoid enabling DtdProcessing if you're dealing with untrusted sources by setting the <xref:System.Xml.XmlReaderSettings.DtdProcessing%2A?displayProperty=nameWithType> property to **Prohibit** or **Ignore**.</span></span>

- <span data-ttu-id="83f5a-134">Asegúrese de que el método Load() tome una instancia XmlReader en todos los casos InnerXml.</span><span class="sxs-lookup"><span data-stu-id="83f5a-134">Ensure that the Load() method takes an XmlReader instance in all InnerXml cases.</span></span>

> [!NOTE]
> <span data-ttu-id="83f5a-135">Esta regla podría notificar falsos positivos en algunas instancias XmlSecureResolver válidas.</span><span class="sxs-lookup"><span data-stu-id="83f5a-135">This rule might report false positives on some valid XmlSecureResolver instances.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="83f5a-136">Cuándo suprimir advertencias</span><span class="sxs-lookup"><span data-stu-id="83f5a-136">When to suppress warnings</span></span>

<span data-ttu-id="83f5a-137">A menos que esté seguro de que la entrada es de un origen de confianza, no suprima ninguna regla de esta advertencia.</span><span class="sxs-lookup"><span data-stu-id="83f5a-137">Unless you're sure that the input is known to be from a trusted source, do not suppress a rule from this warning.</span></span>

## <a name="pseudo-code-examples"></a><span data-ttu-id="83f5a-138">Ejemplos de pseudocódigo</span><span class="sxs-lookup"><span data-stu-id="83f5a-138">Pseudo-code examples</span></span>

### <a name="violation-1"></a><span data-ttu-id="83f5a-139">Infracción 1</span><span class="sxs-lookup"><span data-stu-id="83f5a-139">Violation 1</span></span>

```csharp
using System.IO;
using System.Xml.Schema;

class TestClass
{
    public XmlSchema Test
    {
        get
        {
            var src = "";
            TextReader tr = new StreamReader(src);
            XmlSchema schema = XmlSchema.Read(tr, null); // warn
            return schema;
        }
    }
}
```

### <a name="solution-1"></a><span data-ttu-id="83f5a-140">Solución 1</span><span class="sxs-lookup"><span data-stu-id="83f5a-140">Solution 1</span></span>

```csharp
using System.IO;
using System.Xml;
using System.Xml.Schema;

class TestClass
{
    public XmlSchema Test
    {
        get
        {
            var src = "";
            TextReader tr = new StreamReader(src);
            XmlReader reader = XmlReader.Create(tr, new XmlReaderSettings() { XmlResolver = null });
            XmlSchema schema = XmlSchema.Read(reader , null);
            return schema;
        }
    }
}
```

### <a name="violation-2"></a><span data-ttu-id="83f5a-141">Infracción 2</span><span class="sxs-lookup"><span data-stu-id="83f5a-141">Violation 2</span></span>

```csharp
using System.Xml;

namespace TestNamespace
{
    public class TestClass
    {
        public XmlReaderSettings settings = new XmlReaderSettings();
        public void TestMethod(string path)
        {
            var reader = XmlReader.Create(path, settings);  // warn
        }
    }
}
```

### <a name="solution-2"></a><span data-ttu-id="83f5a-142">Solución 2</span><span class="sxs-lookup"><span data-stu-id="83f5a-142">Solution 2</span></span>

```csharp
using System.Xml;

namespace TestNamespace
{
    public class TestClass
    {
        public XmlReaderSettings settings = new XmlReaderSettings()
        {
            DtdProcessing = DtdProcessing.Prohibit
        };

        public void TestMethod(string path)
        {
            var reader = XmlReader.Create(path, settings);
        }
    }
}
```

### <a name="violation-3"></a><span data-ttu-id="83f5a-143">Infracción 3</span><span class="sxs-lookup"><span data-stu-id="83f5a-143">Violation 3</span></span>

```csharp
using System.Xml;

namespace TestNamespace
{
    public class DoNotUseSetInnerXml
    {
        public void TestMethod(string xml)
        {
            XmlDocument doc = new XmlDocument() { XmlResolver = null };
            doc.InnerXml = xml; // warn
        }
    }
}
```

```csharp
using System.Xml;

namespace TestNamespace
{
    public class DoNotUseLoadXml
    {
        public void TestMethod(string xml)
        {
            XmlDocument doc = new XmlDocument(){ XmlResolver = null };
            doc.LoadXml(xml); // warn
        }
    }
}
```

### <a name="solution-3"></a><span data-ttu-id="83f5a-144">Solución 3</span><span class="sxs-lookup"><span data-stu-id="83f5a-144">Solution 3</span></span>

```csharp
using System.Xml;

public static void TestMethod(string xml)
{
    XmlDocument doc = new XmlDocument() { XmlResolver = null };
    System.IO.StringReader sreader = new System.IO.StringReader(xml);
    XmlReader reader = XmlReader.Create(sreader, new XmlReaderSettings() { XmlResolver = null });
    doc.Load(reader);
}
```

### <a name="violation-4"></a><span data-ttu-id="83f5a-145">Infracción 4</span><span class="sxs-lookup"><span data-stu-id="83f5a-145">Violation 4</span></span>

```csharp
using System.IO;
using System.Xml;
using System.Xml.Serialization;

namespace TestNamespace
{
    public class UseXmlReaderForDeserialize
    {
        public void TestMethod(Stream stream)
        {
            XmlSerializer serializer = new XmlSerializer(typeof(UseXmlReaderForDeserialize));
            serializer.Deserialize(stream); // warn
        }
    }
}
```

### <a name="solution-4"></a><span data-ttu-id="83f5a-146">Solución 4</span><span class="sxs-lookup"><span data-stu-id="83f5a-146">Solution 4</span></span>

```csharp
using System.IO;
using System.Xml;
using System.Xml.Serialization;

namespace TestNamespace
{
    public class UseXmlReaderForDeserialize
    {
        public void TestMethod(Stream stream)
        {
            XmlSerializer serializer = new XmlSerializer(typeof(UseXmlReaderForDeserialize));
            XmlReader reader = XmlReader.Create(stream, new XmlReaderSettings() { XmlResolver = null });
            serializer.Deserialize(reader );
        }
    }
}
```

### <a name="violation-5"></a><span data-ttu-id="83f5a-147">Infracción 5</span><span class="sxs-lookup"><span data-stu-id="83f5a-147">Violation 5</span></span>

```csharp
using System.Xml;
using System.Xml.XPath;

namespace TestNamespace
{
    public class UseXmlReaderForXPathDocument
    {
        public void TestMethod(string path)
        {
            XPathDocument doc = new XPathDocument(path); // warn
        }
    }
}
```

### <a name="solution-5"></a><span data-ttu-id="83f5a-148">Solución 5</span><span class="sxs-lookup"><span data-stu-id="83f5a-148">Solution 5</span></span>

```csharp
using System.Xml;
using System.Xml.XPath;

namespace TestNamespace
{
    public class UseXmlReaderForXPathDocument
    {
        public void TestMethod(string path)
        {
            XmlReader reader = XmlReader.Create(path, new XmlReaderSettings() { XmlResolver = null });
            XPathDocument doc = new XPathDocument(reader);
        }
    }
}
```

### <a name="violation-6"></a><span data-ttu-id="83f5a-149">Infracción 6</span><span class="sxs-lookup"><span data-stu-id="83f5a-149">Violation 6</span></span>

```csharp
using System.Xml;

namespace TestNamespace
{
    class TestClass
    {
        public XmlDocument doc = new XmlDocument() { XmlResolver = new XmlUrlResolver() };
    }
}
```

### <a name="solution-6"></a><span data-ttu-id="83f5a-150">Solución 6</span><span class="sxs-lookup"><span data-stu-id="83f5a-150">Solution 6</span></span>

```csharp
using System.Xml;

namespace TestNamespace
{
    class TestClass
    {
        public XmlDocument doc = new XmlDocument() { XmlResolver = null }; // or set to a XmlSecureResolver instance
    }
}
```

### <a name="violation-7"></a><span data-ttu-id="83f5a-151">Infracción 7</span><span class="sxs-lookup"><span data-stu-id="83f5a-151">Violation 7</span></span>

```csharp
using System.Xml;

namespace TestNamespace
{
    class TestClass
    {
        private static void TestMethod()
        {
            var reader = XmlTextReader.Create(""doc.xml""); //warn
        }
    }
}
```

```csharp
using System.Xml;

namespace TestNamespace
{
    public class TestClass
    {
        public void TestMethod(string path)
        {
            try {
                XmlTextReader reader = new XmlTextReader(path); // warn
            }
            catch { throw ; }
            finally {}
        }
    }
}
```

### <a name="solution-7"></a><span data-ttu-id="83f5a-152">Solución 7</span><span class="sxs-lookup"><span data-stu-id="83f5a-152">Solution 7</span></span>

```csharp
using System.Xml;

namespace TestNamespace
{
    public class TestClass
    {
        public void TestMethod(string path)
        {
            XmlReaderSettings settings = new XmlReaderSettings() { XmlResolver = null };
            XmlReader reader = XmlReader.Create(path, settings);
        }
    }
}
```

> [!NOTE]
> <span data-ttu-id="83f5a-153">Aunque <xref:System.Xml.XmlReader.Create%2A?displayProperty=nameWithType> es el método recomendado para crear una <xref:System.Xml.XmlReader> instancia de, existen diferencias de comportamiento con respecto a <xref:System.Xml.XmlTextReader> .</span><span class="sxs-lookup"><span data-stu-id="83f5a-153">Although <xref:System.Xml.XmlReader.Create%2A?displayProperty=nameWithType> is the recommended way to create an <xref:System.Xml.XmlReader> instance, there are behavior differences from <xref:System.Xml.XmlTextReader>.</span></span> <span data-ttu-id="83f5a-154">Una <xref:System.Xml.XmlReader> de <xref:System.Xml.XmlReader.Create%2A> normaliza en `\r\n` `\n` valores XML, mientras que <xref:System.Xml.XmlTextReader> conserva la `\r\n` secuencia.</span><span class="sxs-lookup"><span data-stu-id="83f5a-154">An <xref:System.Xml.XmlReader> from <xref:System.Xml.XmlReader.Create%2A> normalizes `\r\n` to `\n` in XML values, while <xref:System.Xml.XmlTextReader> preserves the `\r\n` sequence.</span></span>
