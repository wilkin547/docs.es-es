---
title: 'CA5392: usar el atributo DefaultDllImportSearchPaths para P/Invoke (análisis de código)'
description: Proporciona información sobre la regla de análisis de código CA5392, incluidas las causas, cómo corregir las infracciones y cuándo suprimirlas.
ms.date: 05/28/2020
ms.topic: reference
author: LLLXXXCCC
ms.author: linche
f1_keywords:
- CA5392
ms.openlocfilehash: 2a68a567592775a69ca8f5170fed37f08a5c0eec
ms.sourcegitcommit: 4df8e005c074ceb1f978f007b222fe253be2baf3
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/04/2021
ms.locfileid: "99541985"
---
# <a name="ca5392-use-defaultdllimportsearchpaths-attribute-for-pinvokes"></a><span data-ttu-id="24684-103">CA5392: Usar el atributo DefaultDllImportSearchPaths para P/Invoke</span><span class="sxs-lookup"><span data-stu-id="24684-103">CA5392: Use DefaultDllImportSearchPaths attribute for P/Invokes</span></span>

| | <span data-ttu-id="24684-104">Valor</span><span class="sxs-lookup"><span data-stu-id="24684-104">Value</span></span> |
|-|-|
| <span data-ttu-id="24684-105">**Identificador de la regla**</span><span class="sxs-lookup"><span data-stu-id="24684-105">**Rule ID**</span></span> |<span data-ttu-id="24684-106">CA5392</span><span class="sxs-lookup"><span data-stu-id="24684-106">CA5392</span></span>|
| <span data-ttu-id="24684-107">**Categoría**</span><span class="sxs-lookup"><span data-stu-id="24684-107">**Category**</span></span> |[<span data-ttu-id="24684-108">Microsoft.Security</span><span class="sxs-lookup"><span data-stu-id="24684-108">Microsoft.Security</span></span>](security-warnings.md)|
| <span data-ttu-id="24684-109">**Corrección o interrupción**</span><span class="sxs-lookup"><span data-stu-id="24684-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="24684-110">Poco problemático</span><span class="sxs-lookup"><span data-stu-id="24684-110">Non-breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="24684-111">Causa</span><span class="sxs-lookup"><span data-stu-id="24684-111">Cause</span></span>

<span data-ttu-id="24684-112"><xref:System.Runtime.InteropServices.DefaultDllImportSearchPathsAttribute>No se ha especificado para una función de [invocación de plataforma (P/Invoke)](../../../standard/native-interop/pinvoke.md) .</span><span class="sxs-lookup"><span data-stu-id="24684-112">The <xref:System.Runtime.InteropServices.DefaultDllImportSearchPathsAttribute> is not specified for a [Platform Invoke (P/Invoke)](../../../standard/native-interop/pinvoke.md) function.</span></span>

## <a name="rule-description"></a><span data-ttu-id="24684-113">Descripción de la regla</span><span class="sxs-lookup"><span data-stu-id="24684-113">Rule description</span></span>

<span data-ttu-id="24684-114">De forma predeterminada, las funciones P/Invoke <xref:System.Runtime.InteropServices.DllImportAttribute> que usan sondeos incluyen un número de directorios, incluido el directorio de trabajo actual de la biblioteca que se va a cargar.</span><span class="sxs-lookup"><span data-stu-id="24684-114">By default, P/Invoke functions using <xref:System.Runtime.InteropServices.DllImportAttribute> probe a number of directories, including the current working directory for the library to load.</span></span> <span data-ttu-id="24684-115">Puede tratarse de un problema de seguridad para ciertas aplicaciones, lo que conduce a la secuestro de DLL.</span><span class="sxs-lookup"><span data-stu-id="24684-115">This can be a security issue for certain applications, leading to DLL hijacking.</span></span>

<span data-ttu-id="24684-116">Por ejemplo, si un archivo DLL malintencionado con el mismo nombre que el importado se coloca en el directorio de trabajo actual, que se buscará en primer lugar de forma predeterminada, se puede cargar el archivo DLL malintencionado.</span><span class="sxs-lookup"><span data-stu-id="24684-116">For example, if a malicious DLL with the same name as the imported one is placed under the current working directory, which will be searched firstly by default, then the malicious DLL could be loaded.</span></span>

<span data-ttu-id="24684-117">Para obtener más información, consulte carga de la [biblioteca de forma segura](https://msrc-blog.microsoft.com/2014/05/13/load-library-safely/).</span><span class="sxs-lookup"><span data-stu-id="24684-117">For more information, see [Load Library Safely](https://msrc-blog.microsoft.com/2014/05/13/load-library-safely/).</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="24684-118">Cómo corregir infracciones</span><span class="sxs-lookup"><span data-stu-id="24684-118">How to fix violations</span></span>

<span data-ttu-id="24684-119">Utilice <xref:System.Runtime.InteropServices.DefaultDllImportSearchPathsAttribute> para especificar la ruta de acceso de búsqueda de dll explícitamente para el ensamblado o el método.</span><span class="sxs-lookup"><span data-stu-id="24684-119">Use <xref:System.Runtime.InteropServices.DefaultDllImportSearchPathsAttribute> to specify the DLL search path explicitly for the assembly or the method.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="24684-120">Cuándo suprimir advertencias</span><span class="sxs-lookup"><span data-stu-id="24684-120">When to suppress warnings</span></span>

<span data-ttu-id="24684-121">Es seguro suprimir esta regla si:</span><span class="sxs-lookup"><span data-stu-id="24684-121">It's safe to suppress this rule if:</span></span>

- <span data-ttu-id="24684-122">Está seguro de que el ensamblado cargado es lo que desea.</span><span class="sxs-lookup"><span data-stu-id="24684-122">You're sure the loaded assembly is what you want.</span></span> <span data-ttu-id="24684-123">Por ejemplo, la aplicación se ejecuta en un servidor de confianza y confía completamente en los archivos.</span><span class="sxs-lookup"><span data-stu-id="24684-123">For example, your application runs on a trusted server and you completely trust the files.</span></span>
- <span data-ttu-id="24684-124">El ensamblado importado es un ensamblado del sistema comúnmente utilizado, como user32.dll, y la estrategia de ruta de acceso de búsqueda sigue el [mecanismo de dll conocido](/archive/blogs/larryosterman/what-are-known-dlls-anyway).</span><span class="sxs-lookup"><span data-stu-id="24684-124">The imported assembly is a commonly used system assembly, like user32.dll, and the search path strategy follows the [Known DLLs mechanism](/archive/blogs/larryosterman/what-are-known-dlls-anyway).</span></span>

## <a name="pseudo-code-examples"></a><span data-ttu-id="24684-125">Ejemplos de pseudocódigo</span><span class="sxs-lookup"><span data-stu-id="24684-125">Pseudo-code examples</span></span>

```csharp
using System;
using System.Runtime.InteropServices;

class ExampleClass
{
    [DllImport("The3rdAssembly.dll")]
    public static extern int MessageBox(IntPtr hWnd, String text, String caption, uint type);

    public void ExampleMethod()
    {
        MessageBox(new IntPtr(0), "Hello World!", "Hello Dialog", 0);
    }
}
```

### <a name="solution"></a><span data-ttu-id="24684-126">Solución</span><span class="sxs-lookup"><span data-stu-id="24684-126">Solution</span></span>

```csharp
using System;
using System.Runtime.InteropServices;

class ExampleClass
{
    [DllImport("The3rdAssembly.dll")]
    [DefaultDllImportSearchPaths(DllImportSearchPath.UserDirectories)]
    public static extern int MessageBox(IntPtr hWnd, String text, String caption, uint type);

    public void ExampleMethod()
    {
        MessageBox(new IntPtr(0), "Hello World!", "Hello Dialog", 0);
    }
}
```

## <a name="related-rules"></a><span data-ttu-id="24684-127">Reglas relacionadas</span><span class="sxs-lookup"><span data-stu-id="24684-127">Related rules</span></span>

[<span data-ttu-id="24684-128">CA5393: No usar un valor de DllImportSearchPath no seguro</span><span class="sxs-lookup"><span data-stu-id="24684-128">CA5393: Do not use unsafe DllImportSearchPath value</span></span>](ca5393.md)
