---
title: 'CA2101: especificar el cálculo de referencias para los argumentos de cadena P-Invoke (análisis de código)'
description: 'Más información sobre la regla de análisis de código CA2101: especificar el cálculo de referencias para los argumentos de cadena P-Invoke'
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- SpecifyMarshalingForPInvokeStringArguments
- CA2101
helpviewer_keywords:
- CA2101
- SpecifyMarshalingForPInvokeStringArguments
author: gewarren
ms.author: gewarren
ms.openlocfilehash: 7ff5341abedd8e5971368272da17c373a018bb7f
ms.sourcegitcommit: 4df8e005c074ceb1f978f007b222fe253be2baf3
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/04/2021
ms.locfileid: "99545508"
---
# <a name="ca2101-specify-marshaling-for-pinvoke-string-arguments"></a><span data-ttu-id="cf35e-103">CA2101: Especifique cálculo de referencias para argumentos de cadena P/Invoke</span><span class="sxs-lookup"><span data-stu-id="cf35e-103">CA2101: Specify marshaling for P/Invoke string arguments</span></span>

| | <span data-ttu-id="cf35e-104">Valor</span><span class="sxs-lookup"><span data-stu-id="cf35e-104">Value</span></span> |
|-|-|
| <span data-ttu-id="cf35e-105">**Identificador de la regla**</span><span class="sxs-lookup"><span data-stu-id="cf35e-105">**Rule ID**</span></span> |<span data-ttu-id="cf35e-106">CA2101</span><span class="sxs-lookup"><span data-stu-id="cf35e-106">CA2101</span></span>|
| <span data-ttu-id="cf35e-107">**Categoría**</span><span class="sxs-lookup"><span data-stu-id="cf35e-107">**Category**</span></span> |[<span data-ttu-id="cf35e-108">Microsoft. Globalization</span><span class="sxs-lookup"><span data-stu-id="cf35e-108">Microsoft.Globalization</span></span>](globalization-warnings.md)|
| <span data-ttu-id="cf35e-109">**Corrección o interrupción**</span><span class="sxs-lookup"><span data-stu-id="cf35e-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="cf35e-110">Poco problemático</span><span class="sxs-lookup"><span data-stu-id="cf35e-110">Non-breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="cf35e-111">Causa</span><span class="sxs-lookup"><span data-stu-id="cf35e-111">Cause</span></span>

<span data-ttu-id="cf35e-112">Un miembro de invocación de plataforma permite llamadores de confianza parcial, tiene un parámetro de cadena y no serializa explícitamente la cadena.</span><span class="sxs-lookup"><span data-stu-id="cf35e-112">A platform invoke member allows for partially trusted callers, has a string parameter, and does not explicitly marshal the string.</span></span>

## <a name="rule-description"></a><span data-ttu-id="cf35e-113">Descripción de la regla</span><span class="sxs-lookup"><span data-stu-id="cf35e-113">Rule description</span></span>

<span data-ttu-id="cf35e-114">Al convertir de Unicode a ANSI, es posible que no todos los caracteres Unicode puedan representarse en una página de códigos ANSI específica.</span><span class="sxs-lookup"><span data-stu-id="cf35e-114">When you convert from Unicode to ANSI, it is possible that not all Unicode characters can be represented in a specific ANSI code page.</span></span> <span data-ttu-id="cf35e-115">La *asignación con ajuste* perfecto intenta resolver este problema sustituyendo un carácter por el carácter que no se puede representar.</span><span class="sxs-lookup"><span data-stu-id="cf35e-115">*Best-fit mapping* tries to solve this problem by substituting a character for the character that cannot be represented.</span></span> <span data-ttu-id="cf35e-116">El uso de esta característica puede causar una posible vulnerabilidad de seguridad porque no se puede controlar el carácter elegido.</span><span class="sxs-lookup"><span data-stu-id="cf35e-116">The use of this feature can cause a potential security vulnerability because you cannot control the character that is chosen.</span></span> <span data-ttu-id="cf35e-117">Por ejemplo, el código malintencionado podría crear intencionadamente una cadena Unicode que contiene caracteres que no se encuentran en una página de códigos determinada, que se convierten en caracteres especiales del sistema de archivos, como '.. '</span><span class="sxs-lookup"><span data-stu-id="cf35e-117">For example, malicious code could intentionally create a Unicode string that contains characters that are not found in a particular code page, which are converted to file system special characters such as '..'</span></span> <span data-ttu-id="cf35e-118">o '/'.</span><span class="sxs-lookup"><span data-stu-id="cf35e-118">or '/'.</span></span> <span data-ttu-id="cf35e-119">Tenga en cuenta también que las comprobaciones de seguridad para los caracteres especiales se producen con frecuencia antes de que la cadena se convierta en ANSI.</span><span class="sxs-lookup"><span data-stu-id="cf35e-119">Note also that security checks for special characters frequently occur before the string is converted to ANSI.</span></span>

<span data-ttu-id="cf35e-120">La asignación con ajuste perfecto es el valor predeterminado para la conversión no administrada, de WChar a MByte.</span><span class="sxs-lookup"><span data-stu-id="cf35e-120">Best-fit mapping is the default for the unmanaged conversion, WChar to MByte.</span></span> <span data-ttu-id="cf35e-121">A menos que se deshabilite explícitamente la asignación con ajuste perfecto, el código podría contener una vulnerabilidad de seguridad explotable debido a este problema.</span><span class="sxs-lookup"><span data-stu-id="cf35e-121">Unless you explicitly disable best-fit mapping, your code might contain an exploitable security vulnerability because of this issue.</span></span>

> [!CAUTION]
> <span data-ttu-id="cf35e-122">La [seguridad de acceso del código](../../../framework/misc/code-access-security.md) (CAS) no se debe considerar un límite de seguridad.</span><span class="sxs-lookup"><span data-stu-id="cf35e-122">[Code Access Security](../../../framework/misc/code-access-security.md) (CAS) should not be considered a security boundary.</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="cf35e-123">Cómo corregir infracciones</span><span class="sxs-lookup"><span data-stu-id="cf35e-123">How to fix violations</span></span>

<span data-ttu-id="cf35e-124">Para corregir una infracción de esta regla, debe serializar explícitamente los tipos de datos de cadena.</span><span class="sxs-lookup"><span data-stu-id="cf35e-124">To fix a violation of this rule, explicitly marshal string data types.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="cf35e-125">Cuándo suprimir advertencias</span><span class="sxs-lookup"><span data-stu-id="cf35e-125">When to suppress warnings</span></span>

<span data-ttu-id="cf35e-126">No suprima las advertencias de esta regla.</span><span class="sxs-lookup"><span data-stu-id="cf35e-126">Do not suppress a warning from this rule.</span></span>

## <a name="example"></a><span data-ttu-id="cf35e-127">Ejemplo</span><span class="sxs-lookup"><span data-stu-id="cf35e-127">Example</span></span>

<span data-ttu-id="cf35e-128">En el ejemplo siguiente se muestra un método que infringe esta regla y, a continuación, muestra cómo corregir la infracción.</span><span class="sxs-lookup"><span data-stu-id="cf35e-128">The following example shows a method that violates this rule, and then shows how to fix the violation.</span></span>

:::code language="csharp" source="snippets/csharp/all-rules/ca2101.cs" id="snippet1":::
