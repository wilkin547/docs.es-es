---
title: 'Personalización de la serialización de parámetros: .NET'
description: Obtenga información sobre cómo personalizar la forma en que .NET serializa los parámetros de una representación nativa.
ms.date: 01/18/2019
ms.openlocfilehash: 36fb8c105a8836d77b862095a616de3ba641073c
ms.sourcegitcommit: 5f236cd78cf09593c8945a7d753e0850e96a0b80
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 01/07/2020
ms.locfileid: "75706366"
---
# <a name="customizing-parameter-marshaling"></a><span data-ttu-id="3b1bb-103">Personalización de la serialización de parámetros</span><span class="sxs-lookup"><span data-stu-id="3b1bb-103">Customizing parameter marshaling</span></span>

<span data-ttu-id="3b1bb-104">Cuando el comportamiento predeterminado de serialización de los parámetros del entorno de ejecución de .NET no hace lo que desea, puede usar el atributo <xref:System.Runtime.InteropServices.MarshalAsAttribute?displayProperty=nameWithType> para personalizar cómo se serializan los parámetros.</span><span class="sxs-lookup"><span data-stu-id="3b1bb-104">When the .NET runtime's default parameter marshaling behavior doesn't do what you want, use can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute?displayProperty=nameWithType> attribute to customize how your parameters are marshaled.</span></span>

## <a name="customizing-string-parameters"></a><span data-ttu-id="3b1bb-105">Parámetros de cadenas de conexión</span><span class="sxs-lookup"><span data-stu-id="3b1bb-105">Customizing string parameters</span></span>

<span data-ttu-id="3b1bb-106">.NET tiene una serie de formatos de serialización de cadenas.</span><span class="sxs-lookup"><span data-stu-id="3b1bb-106">.NET has a variety of formats for marshaling strings.</span></span> <span data-ttu-id="3b1bb-107">Estos métodos se dividen en secciones distintas en cadenas de estilo C y formatos de cadena centrados en Windows.</span><span class="sxs-lookup"><span data-stu-id="3b1bb-107">These methods are split into distinct sections on C-style strings and Windows-centric string formats.</span></span>

### <a name="c-style-strings"></a><span data-ttu-id="3b1bb-108">Cadenas de estilo C</span><span class="sxs-lookup"><span data-stu-id="3b1bb-108">C-Style strings</span></span>

<span data-ttu-id="3b1bb-109">Cada uno de estos formatos pasa una cadena terminada en valor NULL al código nativo.</span><span class="sxs-lookup"><span data-stu-id="3b1bb-109">Each of these formats passes a null-terminated string to native code.</span></span> <span data-ttu-id="3b1bb-110">Se diferencian en la codificación de la cadena nativa.</span><span class="sxs-lookup"><span data-stu-id="3b1bb-110">They differ by the encoding of the native string.</span></span>

| <span data-ttu-id="3b1bb-111">Valor de `System.Runtime.InteropServices.UnmanagedType`</span><span class="sxs-lookup"><span data-stu-id="3b1bb-111">`System.Runtime.InteropServices.UnmanagedType` value</span></span> | <span data-ttu-id="3b1bb-112">Encoding</span><span class="sxs-lookup"><span data-stu-id="3b1bb-112">Encoding</span></span> |
|------------------------------------------------------|----------|
| <span data-ttu-id="3b1bb-113">LPStr</span><span class="sxs-lookup"><span data-stu-id="3b1bb-113">LPStr</span></span> | <span data-ttu-id="3b1bb-114">ANSI</span><span class="sxs-lookup"><span data-stu-id="3b1bb-114">ANSI</span></span> |
| <span data-ttu-id="3b1bb-115">LPUTF8Str</span><span class="sxs-lookup"><span data-stu-id="3b1bb-115">LPUTF8Str</span></span> | <span data-ttu-id="3b1bb-116">UTF-8</span><span class="sxs-lookup"><span data-stu-id="3b1bb-116">UTF-8</span></span> | 
| <span data-ttu-id="3b1bb-117">LPWStr</span><span class="sxs-lookup"><span data-stu-id="3b1bb-117">LPWStr</span></span> | <span data-ttu-id="3b1bb-118">UTF-16</span><span class="sxs-lookup"><span data-stu-id="3b1bb-118">UTF-16</span></span> |
| <span data-ttu-id="3b1bb-119">LPTStr</span><span class="sxs-lookup"><span data-stu-id="3b1bb-119">LPTStr</span></span> | <span data-ttu-id="3b1bb-120">UTF-16</span><span class="sxs-lookup"><span data-stu-id="3b1bb-120">UTF-16</span></span> |

<span data-ttu-id="3b1bb-121">El formato <xref:System.Runtime.InteropServices.UnmanagedType.VBByRefStr?displayProperty=nameWithType> es un poco diferente.</span><span class="sxs-lookup"><span data-stu-id="3b1bb-121">The <xref:System.Runtime.InteropServices.UnmanagedType.VBByRefStr?displayProperty=nameWithType> format is slightly different.</span></span> <span data-ttu-id="3b1bb-122">Al igual que `LPWStr`, serializa la cadena a una cadena de estilo C nativa codificada en UTF-16.</span><span class="sxs-lookup"><span data-stu-id="3b1bb-122">Like `LPWStr`, it marshals the string to a native C-style string encoded in UTF-16.</span></span> <span data-ttu-id="3b1bb-123">Sin embargo, la firma administrada que tiene que pasar en la cadena por referencia y la firma nativa coincidente toma la cadena por valor.</span><span class="sxs-lookup"><span data-stu-id="3b1bb-123">However, the managed signature has you pass in the string by reference and the matching native signature takes the string by value.</span></span> <span data-ttu-id="3b1bb-124">Esta distinción permite usar una API nativa que toma una cadena por valor y la modifica en contexto sin tener que usar `StringBuilder`.</span><span class="sxs-lookup"><span data-stu-id="3b1bb-124">This distinction allows you to use a native API that takes a string by value and modifies it in-place without having to use a `StringBuilder`.</span></span> <span data-ttu-id="3b1bb-125">Se recomienda no usar manualmente este formato, ya que es propenso a provocar confusión con las firmas no coincidentes nativas y administradas.</span><span class="sxs-lookup"><span data-stu-id="3b1bb-125">We recommend against manually using this format since it's prone to cause confusion with the mismatching native and managed signatures.</span></span>

### <a name="windows-centric-string-formats"></a><span data-ttu-id="3b1bb-126">Formatos de cadena centrados en Windows</span><span class="sxs-lookup"><span data-stu-id="3b1bb-126">Windows-centric string formats</span></span>

<span data-ttu-id="3b1bb-127">Al interactuar con interfaces COM u OLE, probablemente descubrirá que las funciones nativas toman cadenas como argumentos `BSTR`.</span><span class="sxs-lookup"><span data-stu-id="3b1bb-127">When interacting with COM or OLE interfaces, you'll likely find that the native functions take strings as `BSTR` arguments.</span></span> <span data-ttu-id="3b1bb-128">Puede usar el tipo <xref:System.Runtime.InteropServices.UnmanagedType.BStr?displayProperty=nameWithType> no administrado para serializar una cadena como `BSTR`.</span><span class="sxs-lookup"><span data-stu-id="3b1bb-128">You can use the <xref:System.Runtime.InteropServices.UnmanagedType.BStr?displayProperty=nameWithType> unmanaged type to marshal a string as a `BSTR`.</span></span>

<span data-ttu-id="3b1bb-129">Si está interactuando con API de WinRT, puede usar el formato <xref:System.Runtime.InteropServices.UnmanagedType.HString?displayProperty=nameWithType> para serializar una cadena como `HSTRING`.</span><span class="sxs-lookup"><span data-stu-id="3b1bb-129">If you're interacting with WinRT APIs, you can use the <xref:System.Runtime.InteropServices.UnmanagedType.HString?displayProperty=nameWithType> format to marshal a string as an `HSTRING`.</span></span>

## <a name="customizing-array-parameters"></a><span data-ttu-id="3b1bb-130">Personalización de parámetros de matriz</span><span class="sxs-lookup"><span data-stu-id="3b1bb-130">Customizing array parameters</span></span>

<span data-ttu-id="3b1bb-131">.NET también proporciona varias maneras de serializar los parámetros de matriz.</span><span class="sxs-lookup"><span data-stu-id="3b1bb-131">.NET also provides you multiple ways to marshal array parameters.</span></span> <span data-ttu-id="3b1bb-132">Si está llamando a una API que toma una matriz de estilo C, use el tipo <xref:System.Runtime.InteropServices.UnmanagedType.LPArray?displayProperty=nameWithType> no administrado.</span><span class="sxs-lookup"><span data-stu-id="3b1bb-132">If you're calling an API that takes a C-style array, use the <xref:System.Runtime.InteropServices.UnmanagedType.LPArray?displayProperty=nameWithType> unmanaged type.</span></span> <span data-ttu-id="3b1bb-133">Si los valores de la matriz necesitan una serialización personalizada, puede usar el campo <xref:System.Runtime.InteropServices.MarshalAsAttribute.ArraySubType> en el atributo `[MarshalAs]` de dicho campo.</span><span class="sxs-lookup"><span data-stu-id="3b1bb-133">If the values in the array need customized marshaling, you can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute.ArraySubType> field on the `[MarshalAs]` attribute for that.</span></span>

<span data-ttu-id="3b1bb-134">Si usa API de COM, probablemente tendrá que serializar los parámetros de matriz como `SAFEARRAY*`.</span><span class="sxs-lookup"><span data-stu-id="3b1bb-134">If you're using COM APIs, you'll likely have to marshal your array parameters as `SAFEARRAY*`s.</span></span> <span data-ttu-id="3b1bb-135">Para ello, puede usar el tipo <xref:System.Runtime.InteropServices.UnmanagedType.SafeArray?displayProperty=nameWithType> no administrado.</span><span class="sxs-lookup"><span data-stu-id="3b1bb-135">To do so, you can use the <xref:System.Runtime.InteropServices.UnmanagedType.SafeArray?displayProperty=nameWithType> unmanaged type.</span></span> <span data-ttu-id="3b1bb-136">El tipo predeterminado de los elementos de `SAFEARRAY` puede verse en la tabla sobre cómo [personalizar campos `object`](./customize-struct-marshaling.md#marshaling-systemobjects).</span><span class="sxs-lookup"><span data-stu-id="3b1bb-136">The default type of the elements of the `SAFEARRAY` can be seen in the table on [customizing `object` fields](./customize-struct-marshaling.md#marshaling-systemobjects).</span></span> <span data-ttu-id="3b1bb-137">Puede usar campos <xref:System.Runtime.InteropServices.MarshalAsAttribute.SafeArraySubType?displayProperty=nameWithType> y <xref:System.Runtime.InteropServices.MarshalAsAttribute.SafeArrayUserDefinedSubType?displayProperty=nameWithType> para personalizar el tipo de elemento exacto de `SAFEARRAY`.</span><span class="sxs-lookup"><span data-stu-id="3b1bb-137">You can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute.SafeArraySubType?displayProperty=nameWithType> and <xref:System.Runtime.InteropServices.MarshalAsAttribute.SafeArrayUserDefinedSubType?displayProperty=nameWithType> fields to customize the exact element type of the `SAFEARRAY`.</span></span>

## <a name="customizing-boolean-or-decimal-parameters"></a><span data-ttu-id="3b1bb-138">Personalización de los parámetros booleanos o decimales</span><span class="sxs-lookup"><span data-stu-id="3b1bb-138">Customizing boolean or decimal parameters</span></span>

<span data-ttu-id="3b1bb-139">Para obtener información sobre la serialización de parámetros booleanos o decimales, consulte [Personalización de la serialización de estructuras](customize-struct-marshaling.md).</span><span class="sxs-lookup"><span data-stu-id="3b1bb-139">For information on marshaling boolean or decimal parameters, see [Customizing structure marshaling](customize-struct-marshaling.md).</span></span>

## <a name="customizing-object-parameters-windows-only"></a><span data-ttu-id="3b1bb-140">Personalización de parámetros de objeto (solo Windows)</span><span class="sxs-lookup"><span data-stu-id="3b1bb-140">Customizing object parameters (Windows-only)</span></span>

<span data-ttu-id="3b1bb-141">En Windows, el entorno de ejecución de .NET proporciona diferentes formas de serializar parámetros de objetos al código nativo.</span><span class="sxs-lookup"><span data-stu-id="3b1bb-141">On Windows, the .NET runtime provides a number of different ways to marshal object parameters to native code.</span></span>

### <a name="marshaling-as-specific-com-interfaces"></a><span data-ttu-id="3b1bb-142">Serialización como interfaces COM específicas</span><span class="sxs-lookup"><span data-stu-id="3b1bb-142">Marshaling as specific COM interfaces</span></span>

<span data-ttu-id="3b1bb-143">Si la API toma un puntero a un objeto COM, puede usar cualquiera de los siguientes formatos `UnmanagedType` en un parámetro con el tipo `object` para indicar a .NET que serialice estas interfaces específicas:</span><span class="sxs-lookup"><span data-stu-id="3b1bb-143">If your API takes a pointer to a COM object, you can use any of the following `UnmanagedType` formats on an `object`-typed parameter to tell .NET to marshal as these specific interfaces:</span></span>

- `IUnknown`
- `IDispatch`
- `IInspectable`

<span data-ttu-id="3b1bb-144">Además, si el tipo se marca como `[ComVisible(true)]` o si está serializando el tipo `object`, puede usar el formato <xref:System.Runtime.InteropServices.UnmanagedType.Interface?displayProperty=nameWithType> para serializar el objeto como un contenedor CCW para la vista COM del tipo.</span><span class="sxs-lookup"><span data-stu-id="3b1bb-144">Additionally, if your type is marked `[ComVisible(true)]` or you're marshaling the `object` type, you can use the <xref:System.Runtime.InteropServices.UnmanagedType.Interface?displayProperty=nameWithType> format to marshal your object as a COM callable wrapper for the COM view of your type.</span></span>

### <a name="marshaling-to-a-variant"></a><span data-ttu-id="3b1bb-145">Calcular las referencias a un `VARIANT`</span><span class="sxs-lookup"><span data-stu-id="3b1bb-145">Marshaling to a `VARIANT`</span></span>

<span data-ttu-id="3b1bb-146">Si la API nativa toma un tipo `VARIANT` de Win32, puede usar el formato <xref:System.Runtime.InteropServices.UnmanagedType.Struct?displayProperty=nameWithType> en su parámetro `object` para serializar los objetos como `VARIANT`.</span><span class="sxs-lookup"><span data-stu-id="3b1bb-146">If your native API takes a Win32 `VARIANT`, you can use the <xref:System.Runtime.InteropServices.UnmanagedType.Struct?displayProperty=nameWithType> format on your `object` parameter to marshal your objects as `VARIANT`s.</span></span> <span data-ttu-id="3b1bb-147">Consulte la documentación sobre cómo [personalizar campos `object`](customize-struct-marshaling.md#marshaling-systemobjects) para realizar una asignación entre tipos .NET y `VARIANT`.</span><span class="sxs-lookup"><span data-stu-id="3b1bb-147">See the documentation on [customizing `object` fields](customize-struct-marshaling.md#marshaling-systemobjects) for a mapping between .NET types and `VARIANT` types.</span></span>

### <a name="custom-marshalers"></a><span data-ttu-id="3b1bb-148">Serializadores personalizados</span><span class="sxs-lookup"><span data-stu-id="3b1bb-148">Custom marshalers</span></span>

<span data-ttu-id="3b1bb-149">Si desea proyectar una interfaz COM nativa en un tipo administrado diferente, puede usar el formato `UnmanagedType.CustomMarshaler` y una implementación de <xref:System.Runtime.InteropServices.ICustomMarshaler> para proporcionar su propio código de serialización personalizado.</span><span class="sxs-lookup"><span data-stu-id="3b1bb-149">If you want to project a native COM interface into a different managed type, you can use the `UnmanagedType.CustomMarshaler` format and an implementation of <xref:System.Runtime.InteropServices.ICustomMarshaler> to provide your own custom marshaling code.</span></span>
