---
title: Información general sobre BlockingCollection
description: Obtenga información sobre BlockingCollection<T>, una clase de colección segura para subprocesos en .NET. Esta clase ofrece características como la adición y la toma simultáneas de elementos de muchos subprocesos.
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- BlockingCollection, overview
ms.assetid: 987ea3d7-0ad5-4238-8b64-331ce4eb3f0b
ms.openlocfilehash: fc11f6c28a551e56d3bac4c5be9c08a396c0c6b1
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 06/09/2020
ms.locfileid: "84600807"
---
# <a name="blockingcollection-overview"></a><span data-ttu-id="d87c7-104">Información general sobre BlockingCollection</span><span class="sxs-lookup"><span data-stu-id="d87c7-104">BlockingCollection Overview</span></span>
<span data-ttu-id="d87c7-105"><xref:System.Collections.Concurrent.BlockingCollection%601> es una clase de colección segura para subprocesos que proporciona las siguientes características:</span><span class="sxs-lookup"><span data-stu-id="d87c7-105"><xref:System.Collections.Concurrent.BlockingCollection%601> is a thread-safe collection class that provides the following features:</span></span>  
  
- <span data-ttu-id="d87c7-106">Una implementación del patrón productor-consumidor.</span><span class="sxs-lookup"><span data-stu-id="d87c7-106">An implementation of the Producer-Consumer pattern.</span></span>  
  
- <span data-ttu-id="d87c7-107">Agregar y quitar elementos en varios subprocesos de forma simultánea.</span><span class="sxs-lookup"><span data-stu-id="d87c7-107">Concurrent adding and taking of items from multiple threads.</span></span>  
  
- <span data-ttu-id="d87c7-108">Capacidad máxima opcional.</span><span class="sxs-lookup"><span data-stu-id="d87c7-108">Optional maximum capacity.</span></span>  
  
- <span data-ttu-id="d87c7-109">Operaciones de inserción y eliminación que se bloquean cuando la colección está vacía o completa.</span><span class="sxs-lookup"><span data-stu-id="d87c7-109">Insertion and removal operations that block when collection is empty or full.</span></span>  
  
- <span data-ttu-id="d87c7-110">Inserción y eliminación de operaciones "try" que no se bloquean o que se bloquean en un período de tiempo especificado.</span><span class="sxs-lookup"><span data-stu-id="d87c7-110">Insertion and removal "try" operations that do not block or that block up to a specified period of time.</span></span>  
  
- <span data-ttu-id="d87c7-111">Encapsula cualquier tipo de colección que implementa <xref:System.Collections.Concurrent.IProducerConsumerCollection%601>.</span><span class="sxs-lookup"><span data-stu-id="d87c7-111">Encapsulates any collection type that implements <xref:System.Collections.Concurrent.IProducerConsumerCollection%601></span></span>  
  
- <span data-ttu-id="d87c7-112">Cancelación con tokens de cancelación.</span><span class="sxs-lookup"><span data-stu-id="d87c7-112">Cancellation with cancellation tokens.</span></span>  
  
- <span data-ttu-id="d87c7-113">Dos tipos de enumeraciones con `foreach` (`For Each` en Visual Basic):</span><span class="sxs-lookup"><span data-stu-id="d87c7-113">Two kinds of enumeration with `foreach` (`For Each` in Visual Basic):</span></span>  
  
    1. <span data-ttu-id="d87c7-114">Enumeración de solo lectura.</span><span class="sxs-lookup"><span data-stu-id="d87c7-114">Read-only enumeration.</span></span>  
  
    2. <span data-ttu-id="d87c7-115">Enumeración que quita los elementos que se enumeran.</span><span class="sxs-lookup"><span data-stu-id="d87c7-115">Enumeration that removes items as they are enumerated.</span></span>  
  
## <a name="bounding-and-blocking-support"></a><span data-ttu-id="d87c7-116">Compatibilidad con límites y bloqueos</span><span class="sxs-lookup"><span data-stu-id="d87c7-116">Bounding and Blocking Support</span></span>  
 <span data-ttu-id="d87c7-117"><xref:System.Collections.Concurrent.BlockingCollection%601> admite límites y bloqueos.</span><span class="sxs-lookup"><span data-stu-id="d87c7-117"><xref:System.Collections.Concurrent.BlockingCollection%601> supports bounding and blocking.</span></span> <span data-ttu-id="d87c7-118">Los límites implican que puede establecer la capacidad máxima de la colección.</span><span class="sxs-lookup"><span data-stu-id="d87c7-118">Bounding means you can set the maximum capacity of the collection.</span></span> <span data-ttu-id="d87c7-119">Los límites son importantes en ciertos escenarios, porque le permiten controlar el tamaño máximo de la colección en memoria y evitan que los subprocesos de producción vayan demasiado por delante de los subprocesos de consumo.</span><span class="sxs-lookup"><span data-stu-id="d87c7-119">Bounding is important in certain scenarios because it enables you to control the maximum size of the collection in memory, and it prevents the producing threads from moving too far ahead of the consuming threads.</span></span>  
  
 <span data-ttu-id="d87c7-120">Varios subprocesos o tareas pueden agregar elementos a la colección de forma simultánea y, si la colección alcanza su capacidad máxima especificada, los subprocesos de producción se bloquearán hasta que se quite un elemento.</span><span class="sxs-lookup"><span data-stu-id="d87c7-120">Multiple threads or tasks can add items to the collection concurrently, and if the collection reaches its specified maximum capacity, the producing threads will block until an item is removed.</span></span> <span data-ttu-id="d87c7-121">Varios consumidores pueden quitar elementos de forma simultánea y, si la colección está vacía, los subprocesos de consumo se bloquearán hasta que un productor agregue un elemento.</span><span class="sxs-lookup"><span data-stu-id="d87c7-121">Multiple consumers can remove items concurrently, and if the collection becomes empty, the consuming threads will block until a producer adds an item.</span></span> <span data-ttu-id="d87c7-122">Un subproceso de producción puede llamar a <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A> para indicar que no se agregarán más elementos.</span><span class="sxs-lookup"><span data-stu-id="d87c7-122">A producing thread can call <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A> to indicate that no more items will be added.</span></span> <span data-ttu-id="d87c7-123">Los consumidores supervisan la propiedad <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> para saber cuándo está vacía la colección y no se agregarán más elementos.</span><span class="sxs-lookup"><span data-stu-id="d87c7-123">Consumers monitor the <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> property to know when the collection is empty and no more items will be added.</span></span> <span data-ttu-id="d87c7-124">En el ejemplo siguiente, se muestra una clase BlockingCollection sencilla con una capacidad limitada de 100.</span><span class="sxs-lookup"><span data-stu-id="d87c7-124">The following example shows a simple BlockingCollection with a bounded capacity of 100.</span></span> <span data-ttu-id="d87c7-125">Una tarea de producción agrega elementos a la colección siempre que alguna condición externa sea true y después llama a <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A>.</span><span class="sxs-lookup"><span data-stu-id="d87c7-125">A producer task adds items to the collection as long as some external condition is true, and then calls <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A>.</span></span> <span data-ttu-id="d87c7-126">La tarea de consumidor toma elementos hasta que la propiedad <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> es true.</span><span class="sxs-lookup"><span data-stu-id="d87c7-126">The consumer task takes items until the <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> property is true.</span></span>  
  
 [!code-csharp[CDS_BlockingCollection#04](../../../../samples/snippets/csharp/VS_Snippets_Misc/cds_blockingcollection/cs/blockingcollection.cs#04)]
 [!code-vb[CDS_BlockingCollection#04](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/cds_blockingcollection/vb/introsnippetsbc.vb#04)]  
  
 <span data-ttu-id="d87c7-127">Para obtener un ejemplo completo, vea [Cómo: Agregar y tomar elementos de forma individual en una clase BlockingCollection](how-to-add-and-take-items.md).</span><span class="sxs-lookup"><span data-stu-id="d87c7-127">For a complete example, see [How to: Add and Take Items Individually from a BlockingCollection](how-to-add-and-take-items.md).</span></span>  
  
## <a name="timed-blocking-operations"></a><span data-ttu-id="d87c7-128">Operaciones de bloqueo cronometradas</span><span class="sxs-lookup"><span data-stu-id="d87c7-128">Timed Blocking Operations</span></span>  
 <span data-ttu-id="d87c7-129">En las operaciones de bloqueo cronometradas <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> y <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A> en colecciones limitadas, el método intenta agregar o quitar un elemento.</span><span class="sxs-lookup"><span data-stu-id="d87c7-129">In timed blocking <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> and <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A> operations on bounded collections, the method tries to add or take an item.</span></span> <span data-ttu-id="d87c7-130">Si un elemento está disponible, se coloca en la variable que ha pasado la referencia y el método devuelve true.</span><span class="sxs-lookup"><span data-stu-id="d87c7-130">If an item is available it is placed into the variable that was passed in by reference, and the method returns true.</span></span> <span data-ttu-id="d87c7-131">Si no se recupera ningún elemento después de un período de tiempo de espera especificado, el método devuelve false.</span><span class="sxs-lookup"><span data-stu-id="d87c7-131">If no item is retrieved after a specified time-out period the method returns false.</span></span> <span data-ttu-id="d87c7-132">El subproceso es libre para realizar otro trabajo útil antes de intentar acceder de nuevo a la colección.</span><span class="sxs-lookup"><span data-stu-id="d87c7-132">The thread is then free to do some other useful work before trying again to access the collection.</span></span> <span data-ttu-id="d87c7-133">Para obtener un ejemplo de acceso de bloqueo cronometrado, vea el segundo ejemplo de [Cómo: Agregar y tomar elementos de forma individual en una clase BlockingCollection](how-to-add-and-take-items.md).</span><span class="sxs-lookup"><span data-stu-id="d87c7-133">For an example of timed blocking access, see the second example in [How to: Add and Take Items Individually from a BlockingCollection](how-to-add-and-take-items.md).</span></span>  
  
## <a name="cancelling-add-and-take-operations"></a><span data-ttu-id="d87c7-134">Cancelar operaciones de agregar y tomar</span><span class="sxs-lookup"><span data-stu-id="d87c7-134">Cancelling Add and Take Operations</span></span>  
 <span data-ttu-id="d87c7-135">Las operaciones de agregar y tomar se realizan normalmente en un bucle.</span><span class="sxs-lookup"><span data-stu-id="d87c7-135">Add and Take operations are typically performed in a loop.</span></span> <span data-ttu-id="d87c7-136">Puede cancelar un bucle al pasar <xref:System.Threading.CancellationToken> a los métodos <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> o <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A>, y después comprobar el valor de la propiedad <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> del token en cada iteración.</span><span class="sxs-lookup"><span data-stu-id="d87c7-136">You can cancel a loop by passing in a <xref:System.Threading.CancellationToken> to the <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> or <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A> method, and then checking the value of the token's <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> property on each iteration.</span></span> <span data-ttu-id="d87c7-137">Si el valor es true, puede decidir si responde a la solicitud de cancelación limpiando algún recurso y saliendo del bucle.</span><span class="sxs-lookup"><span data-stu-id="d87c7-137">If the value is true, then it is up to you to respond the cancellation request by cleaning up any resources and exiting the loop.</span></span> <span data-ttu-id="d87c7-138">En el ejemplo siguiente, se muestra una sobrecarga de <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> que toma un token de cancelación y el código que lo usa:</span><span class="sxs-lookup"><span data-stu-id="d87c7-138">The following example shows an overload of <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> that takes a cancellation token, and the code that uses it:</span></span>  
  
 [!code-csharp[CDS_BlockingCollection#05](../../../../samples/snippets/csharp/VS_Snippets_Misc/cds_blockingcollection/cs/blockingcollection.cs#05)]
 [!code-vb[CDS_BlockingCollection#05](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/cds_blockingcollection/vb/introsnippetsbc.vb#05)]  
  
 <span data-ttu-id="d87c7-139">Para obtener un ejemplo de cómo agregar compatibilidad con la cancelación, vea el segundo ejemplo de [Cómo: Agregar y tomar elementos de forma individual en una clase BlockingCollection](how-to-add-and-take-items.md).</span><span class="sxs-lookup"><span data-stu-id="d87c7-139">For an example of how to add cancellation support, see the second example in [How to: Add and Take Items Individually from a BlockingCollection](how-to-add-and-take-items.md).</span></span>  
  
## <a name="specifying-the-collection-type"></a><span data-ttu-id="d87c7-140">Especificar el tipo de colección</span><span class="sxs-lookup"><span data-stu-id="d87c7-140">Specifying the Collection Type</span></span>  
 <span data-ttu-id="d87c7-141">Cuando se crea una <xref:System.Collections.Concurrent.BlockingCollection%601>, puede especificar no solo la capacidad limitada, sino también el tipo de colección que se usará.</span><span class="sxs-lookup"><span data-stu-id="d87c7-141">When you create a <xref:System.Collections.Concurrent.BlockingCollection%601>, you can specify not only the bounded capacity but also the type of collection to use.</span></span> <span data-ttu-id="d87c7-142">Por ejemplo, puede especificar un objeto <xref:System.Collections.Concurrent.ConcurrentQueue%601> para un comportamiento FIFO (primero en entrar, primero en salir) o un objeto <xref:System.Collections.Concurrent.ConcurrentStack%601> para un comportamiento LIFO (último en entrar, primero en salir).</span><span class="sxs-lookup"><span data-stu-id="d87c7-142">For example, you could specify a <xref:System.Collections.Concurrent.ConcurrentQueue%601> for first in-first out (FIFO) behavior, or a <xref:System.Collections.Concurrent.ConcurrentStack%601> for last in-first out (LIFO) behavior.</span></span> <span data-ttu-id="d87c7-143">Puede usar cualquier clase de colección que implemente la interfaz <xref:System.Collections.Concurrent.IProducerConsumerCollection%601>.</span><span class="sxs-lookup"><span data-stu-id="d87c7-143">You can use any collection class that implements the <xref:System.Collections.Concurrent.IProducerConsumerCollection%601> interface.</span></span> <span data-ttu-id="d87c7-144">El tipo de colección predeterminado para <xref:System.Collections.Concurrent.BlockingCollection%601> es <xref:System.Collections.Concurrent.ConcurrentQueue%601>.</span><span class="sxs-lookup"><span data-stu-id="d87c7-144">The default collection type for <xref:System.Collections.Concurrent.BlockingCollection%601> is <xref:System.Collections.Concurrent.ConcurrentQueue%601>.</span></span> <span data-ttu-id="d87c7-145">En el ejemplo de código siguiente, se muestra cómo crear una <xref:System.Collections.Concurrent.BlockingCollection%601> de cadenas que tiene una capacidad de 1000 y usa un objeto <xref:System.Collections.Concurrent.ConcurrentBag%601>:</span><span class="sxs-lookup"><span data-stu-id="d87c7-145">The following code example shows how to create a <xref:System.Collections.Concurrent.BlockingCollection%601> of strings that has a capacity of 1000 and uses a <xref:System.Collections.Concurrent.ConcurrentBag%601>:</span></span>  
  
```vb  
Dim bc = New BlockingCollection(Of String)(New ConcurrentBag(Of String()), 1000)  
```  
  
```csharp  
BlockingCollection<string> bc = new BlockingCollection<string>(new ConcurrentBag<string>(), 1000 );  
```  
  
 <span data-ttu-id="d87c7-146">Para obtener más información, vea [Cómo: Agregar la funcionalidad de límite y bloqueo a una colección](how-to-add-bounding-and-blocking.md).</span><span class="sxs-lookup"><span data-stu-id="d87c7-146">For more information, see [How to: Add Bounding and Blocking Functionality to a Collection](how-to-add-bounding-and-blocking.md).</span></span>  
  
## <a name="ienumerable-support"></a><span data-ttu-id="d87c7-147">Compatibilidad con IEnumerable</span><span class="sxs-lookup"><span data-stu-id="d87c7-147">IEnumerable Support</span></span>  
 <span data-ttu-id="d87c7-148"><xref:System.Collections.Concurrent.BlockingCollection%601> proporciona un método <xref:System.Collections.Concurrent.BlockingCollection%601.GetConsumingEnumerable%2A> que permite a los consumidores usar `foreach` (`For Each` en Visual Basic) para quitar elementos hasta que la colección está completa, lo que significa que está vacía y no se agregan más elementos.</span><span class="sxs-lookup"><span data-stu-id="d87c7-148"><xref:System.Collections.Concurrent.BlockingCollection%601> provides a <xref:System.Collections.Concurrent.BlockingCollection%601.GetConsumingEnumerable%2A> method that enables consumers to use `foreach` (`For Each` in Visual Basic) to remove items until the collection is completed, which means it is empty and no more items will be added.</span></span> <span data-ttu-id="d87c7-149">Para obtener más información, vea [Cómo: Usar ForEach para quitar elementos de BlockingCollection](how-to-use-foreach-to-remove.md).</span><span class="sxs-lookup"><span data-stu-id="d87c7-149">For more information, see [How to: Use ForEach to Remove Items in a BlockingCollection](how-to-use-foreach-to-remove.md).</span></span>  
  
## <a name="using-many-blockingcollections-as-one"></a><span data-ttu-id="d87c7-150">Usar muchas BlockingCollections como una</span><span class="sxs-lookup"><span data-stu-id="d87c7-150">Using Many BlockingCollections As One</span></span>  
 <span data-ttu-id="d87c7-151">Para escenarios en los que un consumidor necesita tomar elementos de varias colecciones de forma simultánea, se pueden crear matrices de <xref:System.Collections.Concurrent.BlockingCollection%601> y usar los métodos estáticos, como <xref:System.Collections.Concurrent.BlockingCollection%601.TakeFromAny%2A> y <xref:System.Collections.Concurrent.BlockingCollection%601.AddToAny%2A>, que agregarán a cualquiera de las colecciones de la matriz o tomarán desde ellas.</span><span class="sxs-lookup"><span data-stu-id="d87c7-151">For scenarios in which a consumer needs to take items from multiple collections simultaneously, you can create arrays of <xref:System.Collections.Concurrent.BlockingCollection%601> and use the static methods such as <xref:System.Collections.Concurrent.BlockingCollection%601.TakeFromAny%2A> and <xref:System.Collections.Concurrent.BlockingCollection%601.AddToAny%2A> that will add to or take from any of the collections in the array.</span></span> <span data-ttu-id="d87c7-152">Si se bloquea una colección, el método intenta otra de forma inmediata hasta que encuentra una que pueda realizar la operación.</span><span class="sxs-lookup"><span data-stu-id="d87c7-152">If one collection is blocking, the method immediately tries another until it finds one that can perform the operation.</span></span> <span data-ttu-id="d87c7-153">Para obtener más información, vea [Cómo: Usar matrices de colecciones de bloqueo en una canalización](how-to-use-arrays-of-blockingcollections.md).</span><span class="sxs-lookup"><span data-stu-id="d87c7-153">For more information, see [How to: Use Arrays of Blocking Collections in a Pipeline](how-to-use-arrays-of-blockingcollections.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d87c7-154">Vea también</span><span class="sxs-lookup"><span data-stu-id="d87c7-154">See also</span></span>

- <xref:System.Collections.Concurrent?displayProperty=nameWithType>
- [<span data-ttu-id="d87c7-155">Colecciones y estructuras de datos</span><span class="sxs-lookup"><span data-stu-id="d87c7-155">Collections and Data Structures</span></span>](../index.md)
- [<span data-ttu-id="d87c7-156">Colecciones seguras para subprocesos</span><span class="sxs-lookup"><span data-stu-id="d87c7-156">Thread-Safe Collections</span></span>](index.md)
