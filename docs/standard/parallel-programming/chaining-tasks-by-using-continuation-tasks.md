---
title: Encadenamiento de tareas mediante tareas de continuación
description: Aprenda a encadenar tareas mediante tareas de continuación en .NET. Una tarea de continuación es una tarea asincrónica invocada por otra tarea.
ms.date: 07/20/2020
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- tasks, continuations
ms.assetid: 0b45e9a2-de28-46ce-8212-1817280ed42d
ms.openlocfilehash: 53457f7f99d96c288b002f58c9db36f431ba863a
ms.sourcegitcommit: 552b4b60c094559db9d8178fa74f5bafaece0caf
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 07/29/2020
ms.locfileid: "87381312"
---
# <a name="chaining-tasks-using-continuation-tasks"></a><span data-ttu-id="72b72-104">Encadenamiento de tareas mediante tareas de continuación</span><span class="sxs-lookup"><span data-stu-id="72b72-104">Chaining tasks using continuation tasks</span></span>

<span data-ttu-id="72b72-105">En la programación asincrónica, es habitual que una operación asincrónica, al finalizar, invoque una segunda operación.</span><span class="sxs-lookup"><span data-stu-id="72b72-105">In asynchronous programming, it's common for one asynchronous operation, on completion, to invoke a second operation.</span></span> <span data-ttu-id="72b72-106">Las continuaciones permiten a las operaciones descendentes usar los resultados de la primera operación.</span><span class="sxs-lookup"><span data-stu-id="72b72-106">Continuations allow decedent operations to consume the results of the first operation.</span></span> <span data-ttu-id="72b72-107">Tradicionalmente, las continuaciones se han realizado mediante métodos de devolución de llamada.</span><span class="sxs-lookup"><span data-stu-id="72b72-107">Traditionally, continuations have been done by using callback methods.</span></span> <span data-ttu-id="72b72-108">En la biblioteca TPL (Task Parallel Library, biblioteca de procesamiento paralelo basado en tareas), se proporciona la misma funcionalidad mediante _tareas de continuación_.</span><span class="sxs-lookup"><span data-stu-id="72b72-108">In the Task Parallel Library, the same functionality is provided by _continuation tasks_.</span></span> <span data-ttu-id="72b72-109">Una tarea de continuación (también conocida simplemente como una continuación) es una tarea asincrónica invocada por otra tarea, conocida como _antecedente_, cuando esta finaliza.</span><span class="sxs-lookup"><span data-stu-id="72b72-109">A continuation task (also known just as a continuation) is an asynchronous task that's invoked by another task, known as the _antecedent_, when the antecedent finishes.</span></span>

<span data-ttu-id="72b72-110">A pesar de que las continuaciones son relativamente fáciles de usar, resultan eficaces y flexibles.</span><span class="sxs-lookup"><span data-stu-id="72b72-110">Continuations are relatively easy to use, but are nevertheless powerful and flexible.</span></span> <span data-ttu-id="72b72-111">Por ejemplo, se puede:</span><span class="sxs-lookup"><span data-stu-id="72b72-111">For example, you can:</span></span>

- <span data-ttu-id="72b72-112">Pasar datos del antecedente a la continuación.</span><span class="sxs-lookup"><span data-stu-id="72b72-112">Pass data from the antecedent to the continuation.</span></span>
- <span data-ttu-id="72b72-113">Especificar las condiciones precisas en las que se invoca o no se invoca la continuación.</span><span class="sxs-lookup"><span data-stu-id="72b72-113">Specify the precise conditions under which the continuation will be invoked or not invoked.</span></span>
- <span data-ttu-id="72b72-114">Cancelar una continuación antes de que se inicie o de forma cooperativa mientras se ejecuta.</span><span class="sxs-lookup"><span data-stu-id="72b72-114">Cancel a continuation either before it starts or cooperatively as it is running.</span></span>
- <span data-ttu-id="72b72-115">Proporcionar sugerencias sobre cómo debería programarse la continuación.</span><span class="sxs-lookup"><span data-stu-id="72b72-115">Provide hints about how the continuation should be scheduled.</span></span>
- <span data-ttu-id="72b72-116">Invocar varias continuaciones desde el mismo antecedente.</span><span class="sxs-lookup"><span data-stu-id="72b72-116">Invoke multiple continuations from the same antecedent.</span></span>
- <span data-ttu-id="72b72-117">Invocar una continuación cuando todos o alguno de los antecedentes finalicen.</span><span class="sxs-lookup"><span data-stu-id="72b72-117">Invoke one continuation when all or any one of multiple antecedents complete.</span></span>
- <span data-ttu-id="72b72-118">Encadenar las continuaciones una tras otra hasta cualquier longitud arbitraria.</span><span class="sxs-lookup"><span data-stu-id="72b72-118">Chain continuations one after another to any arbitrary length.</span></span>
- <span data-ttu-id="72b72-119">Usar una continuación para controlar las excepciones producidas por el antecedente.</span><span class="sxs-lookup"><span data-stu-id="72b72-119">Use a continuation to handle exceptions thrown by the antecedent.</span></span>

## <a name="about-continuations"></a><span data-ttu-id="72b72-120">Sobre las continuaciones</span><span class="sxs-lookup"><span data-stu-id="72b72-120">About continuations</span></span>

<span data-ttu-id="72b72-121">Una continuación es una tarea que se crea en el estado <xref:System.Threading.Tasks.TaskStatus.WaitingForActivation></span><span class="sxs-lookup"><span data-stu-id="72b72-121">A continuation is a task that is created in the <xref:System.Threading.Tasks.TaskStatus.WaitingForActivation> state.</span></span> <span data-ttu-id="72b72-122">y que se activa automáticamente cuando su tarea (o tareas) antecedente finaliza.</span><span class="sxs-lookup"><span data-stu-id="72b72-122">It is activated automatically when its antecedent task or tasks complete.</span></span> <span data-ttu-id="72b72-123">Llamar a <xref:System.Threading.Tasks.Task.Start%2A?displayProperty=nameWithType> en una continuación en código de usuario produce una excepción <xref:System.InvalidOperationException?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="72b72-123">Calling <xref:System.Threading.Tasks.Task.Start%2A?displayProperty=nameWithType> on a continuation in user code throws an <xref:System.InvalidOperationException?displayProperty=nameWithType> exception.</span></span>

<span data-ttu-id="72b72-124">Una continuación es en sí misma un <xref:System.Threading.Tasks.Task> y no bloquea el subproceso en el que se inicia.</span><span class="sxs-lookup"><span data-stu-id="72b72-124">A continuation is itself a <xref:System.Threading.Tasks.Task> and does not block the thread on which it is started.</span></span> <span data-ttu-id="72b72-125">Para un bloqueo, llame al método <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> hasta que finalice la tarea de continuación.</span><span class="sxs-lookup"><span data-stu-id="72b72-125">Call the <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> method to block until the continuation task finishes.</span></span>

## <a name="create-a-continuation-for-a-single-antecedent"></a><span data-ttu-id="72b72-126">Creación de una continuación para un solo antecedente</span><span class="sxs-lookup"><span data-stu-id="72b72-126">Create a continuation for a single antecedent</span></span>

<span data-ttu-id="72b72-127">Se puede crear una continuación que se ejecute una vez completado su antecedente mediante una llamada al método <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="72b72-127">You create a continuation that executes when its antecedent has completed by calling the <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="72b72-128">En el ejemplo siguiente se muestra el patrón básico (para mayor claridad, se omite el control de excepciones).</span><span class="sxs-lookup"><span data-stu-id="72b72-128">The following example shows the basic pattern (for clarity, exception handling is omitted).</span></span> <span data-ttu-id="72b72-129">En él se ejecuta una tarea antecedente, `taskA`, que devuelve un objeto <xref:System.DayOfWeek> que indica el nombre del día actual de la semana.</span><span class="sxs-lookup"><span data-stu-id="72b72-129">It executes an antecedent task, `taskA`, that returns a <xref:System.DayOfWeek> object that indicates the name of the current day of the week.</span></span> <span data-ttu-id="72b72-130">Cuando finaliza el antecedente, este se pasa a la tarea de continuación, `continuation`, y se muestra una cadena que incluye su resultado.</span><span class="sxs-lookup"><span data-stu-id="72b72-130">When the antecedent completes, the continuation task, `continuation`, is passed the antecedent and displays a string that includes its result.</span></span>

> [!NOTE]
> <span data-ttu-id="72b72-131">En los ejemplos de C# de este artículo se usa el modificador `async` en el método `Main`.</span><span class="sxs-lookup"><span data-stu-id="72b72-131">The C# samples in this article make use of the `async` modifier on the `Main` method.</span></span> <span data-ttu-id="72b72-132">Esa característica está disponible en C# 7.1 y versiones posteriores.</span><span class="sxs-lookup"><span data-stu-id="72b72-132">That feature is available in C# 7.1 and later.</span></span> <span data-ttu-id="72b72-133">En las versiones anteriores se genera [`CS5001`](../../csharp/misc/cs5001.md) al compilar este código de ejemplo.</span><span class="sxs-lookup"><span data-stu-id="72b72-133">Previous versions generate [`CS5001`](../../csharp/misc/cs5001.md) when compiling this sample code.</span></span> <span data-ttu-id="72b72-134">Tendrá que establecer la versión del lenguaje en C# 7.1 o posterior.</span><span class="sxs-lookup"><span data-stu-id="72b72-134">You'll need to set the language version to C# 7.1 or newer.</span></span> <span data-ttu-id="72b72-135">Puede obtener información sobre cómo configurar la versión del lenguaje en el artículo sobre [configuración de la versión del lenguaje](../../csharp/language-reference/configure-language-version.md).</span><span class="sxs-lookup"><span data-stu-id="72b72-135">You can learn how to configure the language version in the article on [configure language version](../../csharp/language-reference/configure-language-version.md).</span></span>

:::code language="csharp" source="snippets/cs/simple1.cs":::

[!code-vb[TPL_Continuations#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/simple1.vb#1)]

## <a name="create-a-continuation-for-multiple-antecedents"></a><span data-ttu-id="72b72-136">Creación de una continuación para varios antecedentes</span><span class="sxs-lookup"><span data-stu-id="72b72-136">Create a continuation for multiple antecedents</span></span>

<span data-ttu-id="72b72-137">También puede crear una continuación que se ejecutará cuando se haya completado una tarea o un grupo de tareas.</span><span class="sxs-lookup"><span data-stu-id="72b72-137">You can also create a continuation that will run when any or all of a group of tasks has completed.</span></span> <span data-ttu-id="72b72-138">Para ejecutar una continuación cuando se hayan completado todas las tareas antecedentes, llame al método estático`Shared` ( <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType> en Visual Basic) o al método de instancia <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="72b72-138">To execute a continuation when all antecedent tasks have completed, you call the static (`Shared` in Visual Basic) <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType> method or the instance <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="72b72-139">Para ejecutar una continuación cuando cualquiera de las tareas antecedentes se haya completado, llame al método estático`Shared` ( <xref:System.Threading.Tasks.Task.WhenAny%2A?displayProperty=nameWithType> en Visual Basic) o al método de instancia <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAny%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="72b72-139">To execute a continuation when any of the antecedent tasks has completed, you call the static (`Shared` in Visual Basic) <xref:System.Threading.Tasks.Task.WhenAny%2A?displayProperty=nameWithType> method or the instance <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAny%2A?displayProperty=nameWithType> method.</span></span>

<span data-ttu-id="72b72-140">Tenga en cuenta que las llamadas a las sobrecargas <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType> y <xref:System.Threading.Tasks.Task.WhenAny%2A?displayProperty=nameWithType> no bloquean el subproceso que realiza la llamada.</span><span class="sxs-lookup"><span data-stu-id="72b72-140">Note that calls to the <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Task.WhenAny%2A?displayProperty=nameWithType> overloads do not block the calling thread.</span></span> <span data-ttu-id="72b72-141">Sin embargo, se suele llamar a todos menos a los métodos <xref:System.Threading.Tasks.Task.WhenAll%28System.Collections.Generic.IEnumerable%7BSystem.Threading.Tasks.Task%7D%29?displayProperty=nameWithType> y <xref:System.Threading.Tasks.Task.WhenAll%28System.Threading.Tasks.Task%5B%5D%29?displayProperty=nameWithType> para recuperar la propiedad <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> devuelta, que bloquea el subproceso que realiza la llamada.</span><span class="sxs-lookup"><span data-stu-id="72b72-141">However, you typically call all but the <xref:System.Threading.Tasks.Task.WhenAll%28System.Collections.Generic.IEnumerable%7BSystem.Threading.Tasks.Task%7D%29?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Task.WhenAll%28System.Threading.Tasks.Task%5B%5D%29?displayProperty=nameWithType> methods to retrieve the returned <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property, which does block the calling thread.</span></span>

<span data-ttu-id="72b72-142">En el ejemplo siguiente se llama al método <xref:System.Threading.Tasks.Task.WhenAll%28System.Collections.Generic.IEnumerable%7BSystem.Threading.Tasks.Task%7D%29?displayProperty=nameWithType> para crear una tarea de continuación que refleje los resultados de sus diez tareas antecedentes.</span><span class="sxs-lookup"><span data-stu-id="72b72-142">The following example calls the <xref:System.Threading.Tasks.Task.WhenAll%28System.Collections.Generic.IEnumerable%7BSystem.Threading.Tasks.Task%7D%29?displayProperty=nameWithType> method to create a continuation task that reflects the results of its 10 antecedent tasks.</span></span> <span data-ttu-id="72b72-143">Cada tarea antecedente eleva al cuadrado un valor de índice que varía entre uno y diez.</span><span class="sxs-lookup"><span data-stu-id="72b72-143">Each antecedent task squares an index value that ranges from one to 10.</span></span> <span data-ttu-id="72b72-144">Si los antecedentes se completan correctamente (su propiedad <xref:System.Threading.Tasks.Task.Status%2A?displayProperty=nameWithType> es <xref:System.Threading.Tasks.TaskStatus.RanToCompletion?displayProperty=nameWithType>), la propiedad <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> de la continuación es una matriz de los valores <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> devueltos por cada antecedente.</span><span class="sxs-lookup"><span data-stu-id="72b72-144">If the antecedents complete successfully (their <xref:System.Threading.Tasks.Task.Status%2A?displayProperty=nameWithType> property is <xref:System.Threading.Tasks.TaskStatus.RanToCompletion?displayProperty=nameWithType>), the <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property of the continuation is an array of the <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> values returned by each antecedent.</span></span> <span data-ttu-id="72b72-145">En el ejemplo se suman para calcular el total de los cuadrados de todos los números entre uno y diez.</span><span class="sxs-lookup"><span data-stu-id="72b72-145">The example adds them to compute the sum of squares for all numbers between one and 10.</span></span>

:::code language="csharp" source="snippets/cs/whenall1.cs":::

[!code-vb[TPL_Continuations#5](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/whenall1.vb#5)]

## <a name="continuation-options"></a><span data-ttu-id="72b72-146">Opciones de continuación</span><span class="sxs-lookup"><span data-stu-id="72b72-146">Continuation options</span></span>

<span data-ttu-id="72b72-147">Cuando se crea una continuación de tarea única, se puede usar una sobrecarga <xref:System.Threading.Tasks.Task.ContinueWith%2A> que toma un valor de enumeración <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> para especificar las condiciones en las que se inicia la continuación.</span><span class="sxs-lookup"><span data-stu-id="72b72-147">When you create a single-task continuation, you can use a <xref:System.Threading.Tasks.Task.ContinueWith%2A> overload that takes a <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> enumeration value to specify the conditions under which the continuation starts.</span></span> <span data-ttu-id="72b72-148">Por ejemplo, se puede especificar que la continuación únicamente se ejecute si el antecedente se completa correctamente, o solo si se completa en un estado de error.</span><span class="sxs-lookup"><span data-stu-id="72b72-148">For example, you can specify that the continuation is to run only if the antecedent completes successfully, or only if it completes in a faulted state.</span></span> <span data-ttu-id="72b72-149">Si la condición no es true cuando el antecedente está listo para invocar la continuación, la continuación realiza la transición directamente al estado <xref:System.Threading.Tasks.TaskStatus.Canceled?displayProperty=nameWithType> y, por tanto, no se puede iniciar.</span><span class="sxs-lookup"><span data-stu-id="72b72-149">If the condition is not true when the antecedent is ready to invoke the continuation, the continuation transitions directly to the <xref:System.Threading.Tasks.TaskStatus.Canceled?displayProperty=nameWithType> state and subsequently cannot be started.</span></span>

<span data-ttu-id="72b72-150">Hay distintos métodos de continuación de varias tareas, como las sobrecargas del método <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A?displayProperty=nameWithType> , que también incluyen un parámetro <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="72b72-150">A number of multi-task continuation methods, such as overloads of the <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A?displayProperty=nameWithType> method, also include a <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> parameter.</span></span> <span data-ttu-id="72b72-151">Sin embargo, solo es válido un subconjunto de todos los miembros de enumeración de <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="72b72-151">Only a subset of all <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> enumeration members are valid, however.</span></span> <span data-ttu-id="72b72-152">Se pueden especificar valores <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> que tengan equivalentes en la enumeración <xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=nameWithType> , como <xref:System.Threading.Tasks.TaskContinuationOptions.AttachedToParent?displayProperty=nameWithType>, <xref:System.Threading.Tasks.TaskContinuationOptions.LongRunning?displayProperty=nameWithType>y <xref:System.Threading.Tasks.TaskContinuationOptions.PreferFairness?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="72b72-152">You can specify <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> values that have counterparts in the <xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=nameWithType> enumeration, such as <xref:System.Threading.Tasks.TaskContinuationOptions.AttachedToParent?displayProperty=nameWithType>, <xref:System.Threading.Tasks.TaskContinuationOptions.LongRunning?displayProperty=nameWithType>, and <xref:System.Threading.Tasks.TaskContinuationOptions.PreferFairness?displayProperty=nameWithType>.</span></span> <span data-ttu-id="72b72-153">Si se especifica cualquiera de las opciones `NotOn` o `OnlyOn` con una continuación de varias tareas, se producirá una excepción <xref:System.ArgumentOutOfRangeException> en tiempo de ejecución.</span><span class="sxs-lookup"><span data-stu-id="72b72-153">If you specify any of the `NotOn` or `OnlyOn` options with a multi-task continuation, an <xref:System.ArgumentOutOfRangeException> exception will be thrown at run time.</span></span>

<span data-ttu-id="72b72-154">Para obtener más información sobre las opciones de continuación de tarea, consulte el tema <xref:System.Threading.Tasks.TaskContinuationOptions> .</span><span class="sxs-lookup"><span data-stu-id="72b72-154">For more information on task continuation options, see the <xref:System.Threading.Tasks.TaskContinuationOptions> topic.</span></span>

## <a name="pass-data-to-a-continuation"></a><span data-ttu-id="72b72-155">Paso de datos a una continuación</span><span class="sxs-lookup"><span data-stu-id="72b72-155">Pass data to a continuation</span></span>

<span data-ttu-id="72b72-156">El método <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> pasa una referencia al antecedente al delegado de usuario de la continuación como argumento.</span><span class="sxs-lookup"><span data-stu-id="72b72-156">The <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> method passes a reference to the antecedent to the user delegate of the continuation as an argument.</span></span> <span data-ttu-id="72b72-157">Si el antecedente es un objeto <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType> y la tarea se ejecutó hasta que se completó, la continuación puede luego tener acceso a la propiedad <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> de la tarea.</span><span class="sxs-lookup"><span data-stu-id="72b72-157">If the antecedent is a <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType> object, and the task ran until it was completed, then the continuation can access the <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property of the task.</span></span>

<span data-ttu-id="72b72-158">La propiedad <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> se bloquea hasta que se completa la tarea.</span><span class="sxs-lookup"><span data-stu-id="72b72-158">The <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property blocks until the task has completed.</span></span> <span data-ttu-id="72b72-159">Sin embargo, si la tarea se canceló o produjo errores y se intenta tener acceso a la propiedad <xref:System.Threading.Tasks.Task%601.Result%2A> , se producirá una excepción <xref:System.AggregateException> .</span><span class="sxs-lookup"><span data-stu-id="72b72-159">However, if the task was canceled or faulted, attempting to access the <xref:System.Threading.Tasks.Task%601.Result%2A> property throws an <xref:System.AggregateException> exception.</span></span> <span data-ttu-id="72b72-160">Puede evitar este problema con la opción <xref:System.Threading.Tasks.TaskContinuationOptions.OnlyOnRanToCompletion> , tal como se muestra en el ejemplo siguiente.</span><span class="sxs-lookup"><span data-stu-id="72b72-160">You can avoid this problem by using the <xref:System.Threading.Tasks.TaskContinuationOptions.OnlyOnRanToCompletion> option, as shown in the following example.</span></span>

:::code language="csharp" source="snippets/cs/result1.cs":::

[!code-vb[TPL_Continuations#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/result1.vb#2)]

<span data-ttu-id="72b72-161">Si desea que la continuación se ejecute aunque el antecedente no finalice correctamente, debe protegerse de la excepción.</span><span class="sxs-lookup"><span data-stu-id="72b72-161">If you want the continuation to run even if the antecedent did not run to successful completion, you must guard against the exception.</span></span> <span data-ttu-id="72b72-162">Un modo de hacerlo es probar la propiedad <xref:System.Threading.Tasks.Task.Status%2A?displayProperty=nameWithType> del antecedente y solo intentar el acceso a la propiedad <xref:System.Threading.Tasks.Task%601.Result%2A> si el estado no es <xref:System.Threading.Tasks.TaskStatus.Faulted> ni <xref:System.Threading.Tasks.TaskStatus.Canceled>.</span><span class="sxs-lookup"><span data-stu-id="72b72-162">One approach is to test the <xref:System.Threading.Tasks.Task.Status%2A?displayProperty=nameWithType> property of the antecedent, and only attempt to access the <xref:System.Threading.Tasks.Task%601.Result%2A> property if the status is not <xref:System.Threading.Tasks.TaskStatus.Faulted> or <xref:System.Threading.Tasks.TaskStatus.Canceled>.</span></span> <span data-ttu-id="72b72-163">También puede examinar la propiedad <xref:System.Threading.Tasks.Task.Exception%2A> del antecedente.</span><span class="sxs-lookup"><span data-stu-id="72b72-163">You can also examine the <xref:System.Threading.Tasks.Task.Exception%2A> property of the antecedent.</span></span> <span data-ttu-id="72b72-164">Para más información, consulte [Control de excepciones](exception-handling-task-parallel-library.md).</span><span class="sxs-lookup"><span data-stu-id="72b72-164">For more information, see [Exception Handling](exception-handling-task-parallel-library.md).</span></span> <span data-ttu-id="72b72-165">En el ejemplo siguiente se modifica el ejemplo anterior para tener acceso a la propiedad <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> del antecedente, pero solo si su estado es <xref:System.Threading.Tasks.TaskStatus.RanToCompletion?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="72b72-165">The following example modifies the previous example to access antecedent's <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property only if its status is <xref:System.Threading.Tasks.TaskStatus.RanToCompletion?displayProperty=nameWithType>.</span></span>

:::code language="csharp" source="snippets/cs/result2.cs":::

[!code-vb[TPL_Continuations#7](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/result2.vb#7)]

## <a name="cancel-a-continuation"></a><span data-ttu-id="72b72-166">Cancelación de una continuación</span><span class="sxs-lookup"><span data-stu-id="72b72-166">Cancel a continuation</span></span>

<span data-ttu-id="72b72-167">La propiedad <xref:System.Threading.Tasks.Task.Status%2A?displayProperty=nameWithType> de una continuación se establece en <xref:System.Threading.Tasks.TaskStatus.Canceled?displayProperty=nameWithType> en las situaciones siguientes:</span><span class="sxs-lookup"><span data-stu-id="72b72-167">The <xref:System.Threading.Tasks.Task.Status%2A?displayProperty=nameWithType> property of a continuation is set to <xref:System.Threading.Tasks.TaskStatus.Canceled?displayProperty=nameWithType> in the following situations:</span></span>

- <span data-ttu-id="72b72-168">Se produce un excepción <xref:System.OperationCanceledException> en respuesta a una solicitud de cancelación.</span><span class="sxs-lookup"><span data-stu-id="72b72-168">It throws an <xref:System.OperationCanceledException> exception in response to a cancellation request.</span></span> <span data-ttu-id="72b72-169">Como sucede con cualquier tarea, si la excepción contiene el mismo token que se ha pasado a la continuación, se trata como una confirmación de cancelación cooperativa.</span><span class="sxs-lookup"><span data-stu-id="72b72-169">As with any task, if the exception contains the same token that was passed to the continuation, it is treated as an acknowledgement of cooperative cancellation.</span></span>
- <span data-ttu-id="72b72-170">A la continuación se le pasa un <xref:System.Threading.CancellationToken?displayProperty=nameWithType> cuya propiedad <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> es `true`.</span><span class="sxs-lookup"><span data-stu-id="72b72-170">The continuation is passed a <xref:System.Threading.CancellationToken?displayProperty=nameWithType> whose <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> property is `true`.</span></span> <span data-ttu-id="72b72-171">En este caso, la continuación no se inicia y realiza la transición al estado <xref:System.Threading.Tasks.TaskStatus.Canceled?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="72b72-171">In this case, the continuation does not start, and it transitions to the <xref:System.Threading.Tasks.TaskStatus.Canceled?displayProperty=nameWithType> state.</span></span>
- <span data-ttu-id="72b72-172">La continuación nunca se ejecuta porque la condición establecida por su argumento <xref:System.Threading.Tasks.TaskContinuationOptions> no se cumplió.</span><span class="sxs-lookup"><span data-stu-id="72b72-172">The continuation never runs because the condition set by its <xref:System.Threading.Tasks.TaskContinuationOptions> argument was not met.</span></span> <span data-ttu-id="72b72-173">Por ejemplo, si un antecedente entra en un estado <xref:System.Threading.Tasks.TaskStatus.Faulted?displayProperty=nameWithType> , su continuación —a la que se le pasó la opción <xref:System.Threading.Tasks.TaskContinuationOptions.NotOnFaulted?displayProperty=nameWithType> — no se ejecutará, pero realizará la transición al estado <xref:System.Threading.Tasks.TaskStatus.Canceled> .</span><span class="sxs-lookup"><span data-stu-id="72b72-173">For example, if an antecedent goes into a <xref:System.Threading.Tasks.TaskStatus.Faulted?displayProperty=nameWithType> state, its continuation that was passed the <xref:System.Threading.Tasks.TaskContinuationOptions.NotOnFaulted?displayProperty=nameWithType> option will not run but will transition to the <xref:System.Threading.Tasks.TaskStatus.Canceled> state.</span></span>

<span data-ttu-id="72b72-174">Si una tarea y su continuación representan dos partes de la misma operación lógica, se puede pasar el mismo token de cancelación a ambas tareas, tal como se muestra en el ejemplo siguiente.</span><span class="sxs-lookup"><span data-stu-id="72b72-174">If a task and its continuation represent two parts of the same logical operation, you can pass the same cancellation token to both tasks, as shown in the following example.</span></span> <span data-ttu-id="72b72-175">Consta de un antecedente que genera una lista de enteros divisibles por 33 y que pasa a la continuación.</span><span class="sxs-lookup"><span data-stu-id="72b72-175">It consists of an antecedent that generates a list of integers that are divisible by 33, which it passes to the continuation.</span></span> <span data-ttu-id="72b72-176">La continuación a su vez muestra la lista.</span><span class="sxs-lookup"><span data-stu-id="72b72-176">The continuation in turn displays the list.</span></span> <span data-ttu-id="72b72-177">El antecedente y la continuación se ponen en pausa periódicamente durante intervalos aleatorios.</span><span class="sxs-lookup"><span data-stu-id="72b72-177">Both the antecedent and the continuation pause regularly for random intervals.</span></span> <span data-ttu-id="72b72-178">Además, un objeto <xref:System.Threading.Timer?displayProperty=nameWithType> se usa para ejecutar el método `Elapsed` después de un intervalo de tiempo de espera de cinco segundos.</span><span class="sxs-lookup"><span data-stu-id="72b72-178">In addition, a <xref:System.Threading.Timer?displayProperty=nameWithType> object is used to execute the `Elapsed` method after a five-second timeout interval.</span></span> <span data-ttu-id="72b72-179">Este ejemplo llama al método <xref:System.Threading.CancellationTokenSource.Cancel%2A?displayProperty=nameWithType>, que hace que la tarea que se ejecuta actualmente llame al método <xref:System.Threading.CancellationToken.ThrowIfCancellationRequested%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="72b72-179">This example calls the <xref:System.Threading.CancellationTokenSource.Cancel%2A?displayProperty=nameWithType> method, which causes the currently executing task to call the <xref:System.Threading.CancellationToken.ThrowIfCancellationRequested%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="72b72-180">Que el método <xref:System.Threading.CancellationTokenSource.Cancel%2A?displayProperty=nameWithType> se invoque cuando se está ejecutando el antecedente o su continuación depende de la duración de las pausas generadas de forma aleatoria.</span><span class="sxs-lookup"><span data-stu-id="72b72-180">Whether the <xref:System.Threading.CancellationTokenSource.Cancel%2A?displayProperty=nameWithType> method is called when the antecedent or its continuation is executing depends on the duration of the randomly generated pauses.</span></span> <span data-ttu-id="72b72-181">Si se cancela el antecedente, la continuación no se iniciará.</span><span class="sxs-lookup"><span data-stu-id="72b72-181">If the antecedent is canceled, the continuation will not start.</span></span> <span data-ttu-id="72b72-182">Si no se cancela el antecedente, el token aún puede usarse para cancelar la continuación.</span><span class="sxs-lookup"><span data-stu-id="72b72-182">If the antecedent is not canceled, the token can still be used to cancel the continuation.</span></span>

:::code language="csharp" source="snippets/cs/cancellation1.cs":::

[!code-vb[TPL_Continuations#3](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/cancellation1.vb#3)]

<span data-ttu-id="72b72-183">También se puede evitar que una continuación se ejecute si su antecedente se cancela sin proporcionar a la continuación un token de cancelación. Para ello, debe especificarse la opción <xref:System.Threading.Tasks.TaskContinuationOptions.NotOnCanceled?displayProperty=nameWithType> al crear la continuación.</span><span class="sxs-lookup"><span data-stu-id="72b72-183">You can also prevent a continuation from executing if its antecedent is canceled without supplying the continuation a cancellation token by specifying the <xref:System.Threading.Tasks.TaskContinuationOptions.NotOnCanceled?displayProperty=nameWithType> option when you create the continuation.</span></span> <span data-ttu-id="72b72-184">Este es un ejemplo sencillo.</span><span class="sxs-lookup"><span data-stu-id="72b72-184">The following is a simple example.</span></span>

:::code language="csharp" source="snippets/cs/cancellation2.cs":::

[!code-vb[TPL_Continuations#8](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/cancellation2.vb#8)]

<span data-ttu-id="72b72-185">Cuando una continuación entra en el estado <xref:System.Threading.Tasks.TaskStatus.Canceled> puede afectar a las continuaciones posteriores, en función de los valores de <xref:System.Threading.Tasks.TaskContinuationOptions> que se especificaron para esas continuaciones.</span><span class="sxs-lookup"><span data-stu-id="72b72-185">After a continuation goes into the <xref:System.Threading.Tasks.TaskStatus.Canceled> state, it may affect continuations that follow, depending on the <xref:System.Threading.Tasks.TaskContinuationOptions> that were specified for those continuations.</span></span>

<span data-ttu-id="72b72-186">Las continuaciones eliminadas no se iniciarán.</span><span class="sxs-lookup"><span data-stu-id="72b72-186">Continuations that are disposed will not start.</span></span>

## <a name="continuations-and-child-tasks"></a><span data-ttu-id="72b72-187">Continuaciones y tareas secundarias</span><span class="sxs-lookup"><span data-stu-id="72b72-187">Continuations and child tasks</span></span>

<span data-ttu-id="72b72-188">Una continuación no se ejecuta hasta que el antecedente y todas sus tareas secundarias asociadas no se completen.</span><span class="sxs-lookup"><span data-stu-id="72b72-188">A continuation does not run until the antecedent and all of its attached child tasks have completed.</span></span> <span data-ttu-id="72b72-189">La continuación no espera a que las tareas secundarias desasociadas finalicen.</span><span class="sxs-lookup"><span data-stu-id="72b72-189">The continuation does not wait for detached child tasks to finish.</span></span> <span data-ttu-id="72b72-190">En los dos ejemplos siguientes se ilustran tareas secundarias que se asocian y desasocian de un antecedente que crea una continuación.</span><span class="sxs-lookup"><span data-stu-id="72b72-190">The following two examples illustrate child tasks that are attached to and detached from an antecedent that creates a continuation.</span></span> <span data-ttu-id="72b72-191">En el ejemplo siguiente la continuación solo se ejecuta después de que se completan todas las tareas secundarias. Si se ejecuta el ejemplo varias veces, se genera una salida idéntica cada vez.</span><span class="sxs-lookup"><span data-stu-id="72b72-191">In the following example, the continuation runs only after all child tasks have completed, and running the example multiple times produces identical output each time.</span></span> <span data-ttu-id="72b72-192">En el ejemplo se inicia el antecedente mediante una llamada al método <xref:System.Threading.Tasks.TaskFactory.StartNew%2A?displayProperty=nameWithType>, ya que de forma predeterminada el método <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=nameWithType> crea una tarea primaria cuya opción de creación de tarea predeterminada es <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="72b72-192">The example launches the antecedent by calling the <xref:System.Threading.Tasks.TaskFactory.StartNew%2A?displayProperty=nameWithType> method, since by default the <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=nameWithType> method creates a parent task whose default task creation option is <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType>.</span></span>

:::code language="csharp" source="snippets/cs/attached1.cs":::

[!code-vb[TPL_Continuations#9](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/attached1.vb#9)]

<span data-ttu-id="72b72-193">No obstante, si las tareas secundarias se desasocian del antecedente, la continuación se ejecuta en cuanto finaliza el antecedente y con independencia del estado de las tareas secundarias.</span><span class="sxs-lookup"><span data-stu-id="72b72-193">If child tasks are detached from the antecedent, however, the continuation runs as soon as the antecedent has terminated, regardless of the state of the child tasks.</span></span> <span data-ttu-id="72b72-194">Como resultado, varias ejecuciones del ejemplo siguiente pueden tener una salida distinta que depende de cómo el programador de tareas controla cada tarea secundaria.</span><span class="sxs-lookup"><span data-stu-id="72b72-194">As a result, multiple runs of the following example can produce variable output that depends on how the task scheduler handled each child task.</span></span>

:::code language="csharp" source="snippets/cs/detached1.cs":::

[!code-vb[TPL_Continuations#10](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/detached1.vb#10)]

<span data-ttu-id="72b72-195">El estado final de la tarea antecedente depende del estado final de las tareas secundarias asociadas.</span><span class="sxs-lookup"><span data-stu-id="72b72-195">The final status of the antecedent task depends on the final status of any attached child tasks.</span></span> <span data-ttu-id="72b72-196">El estado de las tareas secundarias desasociadas no afecta al elemento primario.</span><span class="sxs-lookup"><span data-stu-id="72b72-196">The status of detached child tasks does not affect the parent.</span></span> <span data-ttu-id="72b72-197">Para más información, consulte [Tareas secundarias asociadas y desasociadas](attached-and-detached-child-tasks.md).</span><span class="sxs-lookup"><span data-stu-id="72b72-197">For more information, see [Attached and Detached Child Tasks](attached-and-detached-child-tasks.md).</span></span>

## <a name="associate-state-with-continuations"></a><span data-ttu-id="72b72-198">Asociación de estado con continuaciones</span><span class="sxs-lookup"><span data-stu-id="72b72-198">Associate state with continuations</span></span>

<span data-ttu-id="72b72-199">Un estado arbitrario se puede asociar con una continuación de tarea.</span><span class="sxs-lookup"><span data-stu-id="72b72-199">You can associate arbitrary state with a task continuation.</span></span> <span data-ttu-id="72b72-200">El método <xref:System.Threading.Tasks.Task.ContinueWith%2A> proporciona versiones sobrecargadas, y cada una de ellas toma un valor <xref:System.Object> que representa el estado de la continuación.</span><span class="sxs-lookup"><span data-stu-id="72b72-200">The <xref:System.Threading.Tasks.Task.ContinueWith%2A> method provides overloaded versions that each take an <xref:System.Object> value that represents the state of the continuation.</span></span> <span data-ttu-id="72b72-201">Más adelante se puede tener acceso a este objeto de estado mediante la propiedad <xref:System.Threading.Tasks.Task.AsyncState%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="72b72-201">You can later access this state object by using the <xref:System.Threading.Tasks.Task.AsyncState%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="72b72-202">Si no se proporciona un valor, este objeto de estado es `null` .</span><span class="sxs-lookup"><span data-stu-id="72b72-202">This state object is `null` if you do not provide a value.</span></span>

<span data-ttu-id="72b72-203">El estado de continuación es útil al convertir un código existente que use el [modelo de programación asincrónica (APM)](../asynchronous-programming-patterns/asynchronous-programming-model-apm.md) para utilizar la TPL.</span><span class="sxs-lookup"><span data-stu-id="72b72-203">Continuation state is useful when you convert existing code that uses the [Asynchronous Programming Model (APM)](../asynchronous-programming-patterns/asynchronous-programming-model-apm.md) to use the TPL.</span></span> <span data-ttu-id="72b72-204">En el APM, normalmente se proporciona el estado del objeto en el método **Begin**_Método_ y el acceso posterior a ese estado mediante la propiedad <xref:System.IAsyncResult.AsyncState%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="72b72-204">In the APM, you typically provide object state in the **Begin**_Method_ method and later access that state by using the <xref:System.IAsyncResult.AsyncState%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="72b72-205">Si se usa el método <xref:System.Threading.Tasks.Task.ContinueWith%2A> , se puede conservar este estado al convertir código que usa el APM para usar la TPL.</span><span class="sxs-lookup"><span data-stu-id="72b72-205">By using the <xref:System.Threading.Tasks.Task.ContinueWith%2A> method, you can preserve this state when you convert code that uses the APM to use the TPL.</span></span>

<span data-ttu-id="72b72-206">El estado de continuación también puede ser útil cuando se trabaja con objetos <xref:System.Threading.Tasks.Task> en el depurador de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="72b72-206">Continuation state can also be useful when you work with <xref:System.Threading.Tasks.Task> objects in the Visual Studio debugger.</span></span> <span data-ttu-id="72b72-207">Por ejemplo, en la ventana **Tareas paralelas** , la columna **Tarea** muestra la representación de cadena del objeto de estado de cada tarea.</span><span class="sxs-lookup"><span data-stu-id="72b72-207">For example, in the **Parallel Tasks** window, the **Task** column displays the string representation of the state object for each task.</span></span> <span data-ttu-id="72b72-208">Para más información sobre la ventana **Tareas paralelas**, consulte el artículo [Usar la ventana Tareas](/visualstudio/debugger/using-the-tasks-window).</span><span class="sxs-lookup"><span data-stu-id="72b72-208">For more information about the **Parallel Tasks** window, see [Using the Tasks Window](/visualstudio/debugger/using-the-tasks-window).</span></span>

<span data-ttu-id="72b72-209">En el ejemplo siguiente se muestra cómo usar el estado de continuación.</span><span class="sxs-lookup"><span data-stu-id="72b72-209">The following example shows how to use continuation state.</span></span> <span data-ttu-id="72b72-210">En él se crea una cadena de tareas de continuación.</span><span class="sxs-lookup"><span data-stu-id="72b72-210">It creates a chain of continuation tasks.</span></span> <span data-ttu-id="72b72-211">Cada tarea proporciona la hora actual —un objeto <xref:System.DateTime> — para el parámetro `state` del método <xref:System.Threading.Tasks.Task.ContinueWith%2A> .</span><span class="sxs-lookup"><span data-stu-id="72b72-211">Each task provides the current time, a <xref:System.DateTime> object, for the `state` parameter of the <xref:System.Threading.Tasks.Task.ContinueWith%2A> method.</span></span> <span data-ttu-id="72b72-212">Cada objeto <xref:System.DateTime> representa la hora en que se creó la tarea de continuación.</span><span class="sxs-lookup"><span data-stu-id="72b72-212">Each <xref:System.DateTime> object represents the time at which the continuation task is created.</span></span> <span data-ttu-id="72b72-213">Cada tarea produce como resultado un segundo objeto <xref:System.DateTime> que representa la hora en que finaliza la tarea.</span><span class="sxs-lookup"><span data-stu-id="72b72-213">Each task produces as its result a second <xref:System.DateTime> object that represents the time at which the task finishes.</span></span> <span data-ttu-id="72b72-214">Una vez que finalizan todas las tareas, se muestran la hora de creación y la hora de finalización de cada tarea de continuación.</span><span class="sxs-lookup"><span data-stu-id="72b72-214">After all tasks finish, this example displays the creation time and the time at which each continuation task finishes.</span></span>

:::code language="csharp" source="snippets/cs/continuationstate.cs":::

[!code-vb[TPL_ContinuationState#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuationstate/vb/continuationstate.vb#1)]

## <a name="continuations-that-return-task-types"></a><span data-ttu-id="72b72-215">Continuaciones que devuelven tipos de tareas</span><span class="sxs-lookup"><span data-stu-id="72b72-215">Continuations that return Task types</span></span>

<span data-ttu-id="72b72-216">En ocasiones, puede que deba encadenar una continuación que devuelve un tipo <xref:System.Threading.Tasks.Task>.</span><span class="sxs-lookup"><span data-stu-id="72b72-216">Sometimes you may need to chain a continuation that returns a <xref:System.Threading.Tasks.Task> type.</span></span> <span data-ttu-id="72b72-217">Estas se conocen como tareas anidadas y son comunes.</span><span class="sxs-lookup"><span data-stu-id="72b72-217">These are referred to as nested tasks, and they are common.</span></span> <span data-ttu-id="72b72-218">Por ejemplo, puede ocurrir que una tarea primaria llame a <xref:System.Threading.Tasks.Task%601.ContinueWith%2A?displayProperty=nameWithType> y proporcione un elemento `continuationFunction` que es una tarea que devuelve una llamada a <xref:System.Threading.Tasks.TaskExtensions.Unwrap%2A> para crear una tarea proxy que representa la operación asincrónica de `<Task<Task<T>>>` o `Task(Of Task(Of T))` (Visual Basic).</span><span class="sxs-lookup"><span data-stu-id="72b72-218">When a parent task calls <xref:System.Threading.Tasks.Task%601.ContinueWith%2A?displayProperty=nameWithType>, and provides a `continuationFunction` that is task returning you call <xref:System.Threading.Tasks.TaskExtensions.Unwrap%2A> to create a proxy task that represents the asynchronous operation of the `<Task<Task<T>>>` or `Task(Of Task(Of T))` (Visual Basic).</span></span>

<span data-ttu-id="72b72-219">En el ejemplo siguiente se muestra cómo usar continuaciones que encapsulan funciones adicionales que devuelven tareas.</span><span class="sxs-lookup"><span data-stu-id="72b72-219">The following example shows how to use continuations that wrap additional task returning functions.</span></span> <span data-ttu-id="72b72-220">Cada continuación se puede desencapsular, de modo que se expone la tarea interna que se encapsuló.</span><span class="sxs-lookup"><span data-stu-id="72b72-220">Each continuation can be unwrapped, exposing the inner task that was wrapped.</span></span>

:::code language="csharp" source="snippets/cs/unwrap.cs":::
:::code language="csharp" source="snippets/vb/unwrap.vb":::

<span data-ttu-id="72b72-221">Para más información sobre el uso de <xref:System.Threading.Tasks.TaskExtensions.Unwrap%2A>, consulte [Cómo: Desencapsular una tarea anidada](how-to-unwrap-a-nested-task.md).</span><span class="sxs-lookup"><span data-stu-id="72b72-221">For more information on using <xref:System.Threading.Tasks.TaskExtensions.Unwrap%2A>, see [How to: Unwrap a nested Task](how-to-unwrap-a-nested-task.md).</span></span>

## <a name="handle-exceptions-thrown-from-continuations"></a><span data-ttu-id="72b72-222">Control de excepciones iniciadas por continuaciones</span><span class="sxs-lookup"><span data-stu-id="72b72-222">Handle exceptions thrown from continuations</span></span>

<span data-ttu-id="72b72-223">Una relación antecedente-continuación no es una relación entre elementos primarios y secundarios.</span><span class="sxs-lookup"><span data-stu-id="72b72-223">An antecedent-continuation relationship is not a parent-child relationship.</span></span> <span data-ttu-id="72b72-224">Las excepciones producidas por las continuaciones no se propagan al antecedente.</span><span class="sxs-lookup"><span data-stu-id="72b72-224">Exceptions thrown by continuations are not propagated to the antecedent.</span></span> <span data-ttu-id="72b72-225">Por lo tanto, las excepciones producidas por las continuaciones se deben controlar como en cualquier otra tarea, es decir:</span><span class="sxs-lookup"><span data-stu-id="72b72-225">Therefore, handle exceptions thrown by continuations as you would handle them in any other task, as follows:</span></span>

- <span data-ttu-id="72b72-226">Puede usar el método <xref:System.Threading.Tasks.Task.Wait%2A>, <xref:System.Threading.Tasks.Task.WaitAll%2A>o <xref:System.Threading.Tasks.Task.WaitAny%2A> , o su homólogo genérico, para esperar en la continuación.</span><span class="sxs-lookup"><span data-stu-id="72b72-226">You can use the <xref:System.Threading.Tasks.Task.Wait%2A>, <xref:System.Threading.Tasks.Task.WaitAll%2A>, or <xref:System.Threading.Tasks.Task.WaitAny%2A> method, or its generic counterpart, to wait on the continuation.</span></span> <span data-ttu-id="72b72-227">Puede esperar un antecedente y sus continuaciones en la misma instrucción `try` , tal como se muestra en el ejemplo siguiente.</span><span class="sxs-lookup"><span data-stu-id="72b72-227">You can wait for an antecedent and its continuations in the same `try` statement, as shown in the following example.</span></span>

:::code language="csharp" source="snippets/cs/exception1.cs":::

[!code-vb[TPL_Continuations#6](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/exception1.vb#6)]

- <span data-ttu-id="72b72-228">Puede usar una segunda continuación para observar la propiedad <xref:System.Threading.Tasks.Task.Exception%2A> de la primera continuación.</span><span class="sxs-lookup"><span data-stu-id="72b72-228">You can use a second continuation to observe the <xref:System.Threading.Tasks.Task.Exception%2A> property of the first continuation.</span></span> <span data-ttu-id="72b72-229">En el siguiente ejemplo, una tarea intenta leer en un archivo inexistente.</span><span class="sxs-lookup"><span data-stu-id="72b72-229">In the following example, a task attempts to read from a non-existent file.</span></span> <span data-ttu-id="72b72-230">La continuación muestra entonces información sobre la excepción en la tarea antecedente.</span><span class="sxs-lookup"><span data-stu-id="72b72-230">The continuation then displays information about the exception in the antecedent task.</span></span>

:::code language="csharp" source="snippets/cs/exception2.cs" id="example":::

[!code-vb[TPL_Continuations#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/exception2.vb#4)]

<span data-ttu-id="72b72-231">Dado que se ejecutó con la opción <xref:System.Threading.Tasks.TaskContinuationOptions.OnlyOnFaulted?displayProperty=nameWithType> , la continuación solo se ejecuta si se produce una excepción en el antecedente y, por lo tanto, puede asumir que la propiedad <xref:System.Threading.Tasks.Task.Exception%2A> del antecedente no es `null`.</span><span class="sxs-lookup"><span data-stu-id="72b72-231">Because it was run with the <xref:System.Threading.Tasks.TaskContinuationOptions.OnlyOnFaulted?displayProperty=nameWithType> option, the continuation executes only if an exception occurs in the antecedent, and therefore it can assume that the antecedent's <xref:System.Threading.Tasks.Task.Exception%2A> property is not `null`.</span></span> <span data-ttu-id="72b72-232">Si la continuación se ejecuta tanto si se produce una excepción en el antecedente como si no, habría que comprobar si la propiedad <xref:System.Threading.Tasks.Task.Exception%2A> del antecedente no es `null` antes de intentar controlar la excepción, como se muestra en el fragmento de código siguiente.</span><span class="sxs-lookup"><span data-stu-id="72b72-232">If the continuation executes whether or not an exception is thrown in the antecedent, it would have to check whether the antecedent's <xref:System.Threading.Tasks.Task.Exception%2A> property is not `null` before attempting to handle the exception, as the following code fragment shows.</span></span>

:::code language="csharp" source="snippets/cs/exception2.cs" id="exception":::

[!code-vb[TPL_Continuations#11](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/exception2.vb#11)]

<span data-ttu-id="72b72-233">Para más información, consulte [Control de excepciones](exception-handling-task-parallel-library.md).</span><span class="sxs-lookup"><span data-stu-id="72b72-233">For more information, see [Exception Handling](exception-handling-task-parallel-library.md).</span></span>

- <span data-ttu-id="72b72-234">Si la continuación es una tarea secundaria asociada que se creó mediante la opción <xref:System.Threading.Tasks.TaskContinuationOptions.AttachedToParent?displayProperty=nameWithType> , sus excepciones serán propagadas por el elemento primario hacia el subproceso de llamada, como sucede con cualquier otro elemento secundario asociado.</span><span class="sxs-lookup"><span data-stu-id="72b72-234">If the continuation is an attached child task that was created by using the <xref:System.Threading.Tasks.TaskContinuationOptions.AttachedToParent?displayProperty=nameWithType> option, its exceptions will be propagated by the parent back to the calling thread, as is the case in any other attached child.</span></span> <span data-ttu-id="72b72-235">Para más información, consulte [Tareas secundarias asociadas y desasociadas](attached-and-detached-child-tasks.md).</span><span class="sxs-lookup"><span data-stu-id="72b72-235">For more information, see [Attached and Detached Child Tasks](attached-and-detached-child-tasks.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="72b72-236">Vea también</span><span class="sxs-lookup"><span data-stu-id="72b72-236">See also</span></span>

- [<span data-ttu-id="72b72-237">Biblioteca TPL</span><span class="sxs-lookup"><span data-stu-id="72b72-237">Task Parallel Library (TPL)</span></span>](task-parallel-library-tpl.md)
